{"version":3,"sources":["serviceWorker.js","constants.js","apollo/defaults.js","graphql/layout.js","graphql/order.js","graphql/doc.js","graphql/status.js","graphql/file.js","graphql/drawing.js","graphql/model.js","graphql/enquiry.js","graphql/lists.js","apollo/resolvers.js","apollo/apollo.js","components/styled/styled-semantic.js","components/notifications/NotificationsContext.js","components/notifications/Notification.js","components/notifications/Notifications.js","components/notifications/NotificationsViewer.js","utils/jwtHelper.js","graphql/user.js","components/LoginPage.js","components/special/GlobalContext.js","components/EnquiriesSubmenu.js","components/EnquiriesMenu.js","components/common/Table.js","utils/format.js","components/common/TableRow.js","utils/object.js","components/EnquiriesTable.js","components/DetailsDataProvider.js","components/DetailsHeaderContainer.js","components/DetailsHeaderSubitle.js","components/DetailsHeaderTitle.js","components/DetailsHeaderButtons.js","components/common/RefreshButton.js","components/DetailsMainHeader.js","components/styled/entity-table.js","components/common/DraftEditor.js","components/common/WrappedDraftEditor.js","utils/validateInn.js","utils/dates.js","graphql/org.js","graphql/combinedQueries.js","components/common/DatePicker.js","components/presentational/SecondarySection.js","components/form/utils.js","schema/commonTypes.js","schema/model.js","components/form/FormikCurrency.js","components/form/FormikInput.js","components/form/FormikTel.js","components/form/Field.js","components/Model/Form.js","components/Enquiry/Edit.js","components/common/LocalDatePicker.js","components/common/CurrencyInput.js","components/common/SmartForm.js","components/EnquiryCommercialOffer.js","components/EnquiryDetails.js","components/common/SmartInput.js","components/OrderEdit.js","components/DetailsHeader.js","components/CollapsableSection.js","components/ProdsByDept.js","components/DeptProdTable.js","components/ReserveProdsButton.js","graphql/prod.js","components/special/ProdContext.js","components/ModelProdsSection.js","components/OrderDetails.js","components/Model/Details/Drawings/Drawing.js","components/Model/Details/Drawings/Sortable.js","components/Model/Details/Drawings/SortedCollectionProvider.js","components/special/StatefulList.js","components/special/StatefulBool.js","components/Model/Details/Drawings.js","components/Model/Details.js","components/Details.js","components/ProdTableUtils.js","components/special/ListProvider.js","components/special/OrderContext.js","components/DetailsExtra.js","components/DetailsSidebar.js","components/common/PanelPusher.js","graphql/tel.js","graphql/person.js","graphql/employee.js","components/Employee/PanelHeader.js","components/list/Tel.js","components/list/Field.js","components/list/List.js","schema/tel.js","schema/person.js","schema/employee.js","components/Employee/Details.js","components/Employee/Form.js","components/Employee/Edit.js","components/Employee/Table.js","components/EnquiriesBottomPanel.js","components/EnquiriesPage.js","graphql/article.js","graphql/account.js","graphql/equipment.js","graphql/payment.js","components/Payments/Chart.js","graphql/amo.js","schema/payment.js","components/Payments/Form.js","components/Payments/Stats.js","components/Payments/Table.js","graphql/tochka.js","components/Payments/Page.js","components/Root.js","App.js","index.js"],"names":["Boolean","window","location","hostname","match","AUTH_TOKEN","defaults","newEnquiry","__typename","id","layout","details","extra","bottomPanel","lists","selectedProdIds","getLayout","gql","_templateObject","getLayoutOptions","props","_ref","data","setLayout","_templateObject2","setExpanded","_templateObject3","orderFragmentBasic","order_templateObject","orderFragmentFull","order_templateObject2","upsertOrder","order_templateObject3","orderLocal","_templateObject4","orderDetails","_templateObject5","reserveProds","_templateObject6","docFragmentBasic","doc_templateObject","statusFragment","status_templateObject","fileFragmentFull","file_templateObject","drawingFragmentBasic","drawing_templateObject","drawingFragmentFull","drawing_templateObject2","createDrawings","drawing_templateObject3","deleteDrawings","drawing_templateObject4","setDrawingsSortOrder","drawing_templateObject5","modelFragmentBasic","model_templateObject","modelFragmentWithDrawings","model_templateObject2","modelFragmentFull","model_templateObject3","modelLocal","model_templateObject4","modelDetails","model_templateObject5","upsertModel","model_templateObject6","enquiryFragmentBasic","enquiry_templateObject","allEnquiries","enquiry_templateObject2","enquiryDetails","enquiry_templateObject3","enquiryLocal","enquiry_templateObject4","enquiry_templateObject5","createEnquiry","enquiry_templateObject6","updateEnquiry","_templateObject7","createEnquiryEvent","_templateObject8","enquiryFragment","_templateObject9","getLists","lists_templateObject","setList","lists_templateObject2","resolvers","Enquiry","isExpanded","Mutation","_","_ref2","input","cache","query","readQuery","Object","objectSpread","cloneDeep","writeQuery","_ref3","_ref4","_ref3$args","args","enquiryId","value","enquiries","find","e","_ref5","_ref6","name","InMemoryCache","dataIdFromObject","object","defaultDataIdFromObject","cacheRedirects","Query","orgLocal","getCacheKey","prodsLocal","ids","map","authMiddleware","ApolloLink","operation","forward","token","localStorage","getItem","setContext","_ref6$headers","headers","Authorization","concat","client","ApolloClient","link","from","onError","_ref7","graphQLErrors","networkError","console","log","message","setItem","removeItem","resetStore","withClientState","createUploadLink","uri","theme","widths","formLabel","detailsPL","extraSidebar","colors","green","blue","error","errorBorder","getThemeColor","color","baseSet","bt","bb","bc","bs","c","d","fs","fw","h","lh","mw","minw","m","mb","mt","ml","mr","o","ox","oy","p","pe","pl","pr","pt","ta","va","w","ws","Div","styled","inline","rest","objectWithoutProperties","react_default","a","createElement","styled_semantic_templateObject","P","esm_extends","styled_semantic_templateObject2","Span","styled_semantic_templateObject3","A","styled_semantic_templateObject4","cancel","Header","styled_semantic_templateObject5","Icon","active","activeColor","selectMode","styled_semantic_templateObject6","Caret","disabled","assign","styled_semantic_templateObject7","size","Button","_ref8","menu","styled_semantic_templateObject8","Message","_ref9","section","styled_semantic_templateObject9","SectionPropFiltered","React","forwardRef","_ref10","ref","head","minor","small","secondary","noP","noLP","noIndent","topBorder","bottomBorder","children","onClick","undefined","Section","_templateObject10","Popup","_ref11","showIf","_templateObject11","Label","label","_templateObject12","InputPropFilter","_ref12","Ref","innerRef","Input","_templateObject13","SDropdown","_templateObject14","_ref13","Form","Field","_templateObject15","NotificationsContext","createContext","NotificationsProvider","_Component","_getPrototypeOf2","_this","classCallCheck","this","_len","arguments","length","Array","_key","possibleConstructorReturn","getPrototypeOf","call","apply","state","messages","create","cuid","timerId","setTimeout","dismiss","setState","produce","draft","push","messageId","filter","cancelAutoDismiss","clearTimeout","inherits","createClass","key","Provider","Component","NotificationsConsumer","Consumer","notify","PureChild","memo","Notification","_ref$message","type","title","content","dismissNotification","styled_semantic_Message","compact","icon","header","info","success","warning","onDismiss","onMouseEnter","NotificationsHolder","div","Notifications_templateObject","PosedItem","posed","boobl","y","opacity","enter","exit","x","Notifications","reactDom","createPortal","react_pose_es","animateOnMount","preEnterPose","initialPose","document","getElementById","NotificationsViewer","notifications_NotificationsContext","isTokenExpired","date","decoded","decode","exp","Date","setUTCSeconds","getTokenExpirationDate","valueOf","offsetSeconds","me","user_templateObject","meLocal","user_templateObject2","login","user_templateObject3","MenuDiv","LoginPage_templateObject","MenuHeader","LoginPage_templateObject2","SSegment","Segment","LoginPage_templateObject3","LoginPage","email","password","sendingRequest","handleInputChange","attr","defineProperty","submit","_callee","_this$state","result","regenerator_default","wrap","_context","prev","next","variables","sent","refreshToken","t0","stop","_this2","_this$state2","react","basic","placeholder","onChange","primary","floated","loading","compose","graphql","options","fetchPolicy","_ref$layout","setDetails","setExtra","setBottomPanel","setSelectedProdIds","SubmenuDiv","EnquiriesSubmenu_templateObject","special_GlobalContext","_ref$details","react_apollo_browser_umd","_data$enquiryLocal","num","addNewOrderForbidden","docs","some","styled_semantic_Header","styled_semantic_Popup","position","flowing","trigger","styled_semantic_Button","circular","Content","EnquiriesMenu_templateObject","EnquiriesMenu","refetchEnquiries","enquiriesAreLoading","EnquiriesMenu_MenuDiv","components_EnquiriesSubmenu","_data$me$person","person","fName","lName","menuNameTitle","slice","STable","table","Table_templateObject","TableHeaderRow","tr","Table_templateObject2","noTopBorder","Td","td","Table_templateObject3","TBody","tbody","Table_templateObject4","Table","fields","indent","modes","select","fieldsExtended","expand","toConsumableArray","width","className","f","tableFields","field","formatTel","number","country","conformToMask","guide","conformedValue","currency","trailing","curNum","toFixed","replace","isNaN","Number","Row","TableRow_templateObject","lineHeight","lastSecondaryRow","bold","tdActiveStyle","TableRow_templateObject2","truncated","service","hoverable","hideUnhovered","hasEntries","Untruncated","TableRow_templateObject3","TableRow","_props$rowFields","rowFields","entity","expandFor","expanded","rowField","rf","selected","TableRow_Td","stopPropagation","component","path","iconColor","val","obj","pathArr","split","i","getObjProp","EnquiriesTable","common_Table","enquiry","org","model","orders","common_TableRow","amount","employees","orgId","reduce","res","prods","modelComponent","drawings","styled_semantic_Icon","order","skip","query1","query2","query3","localQuery1","localQuery2","localQuery3","localQuery","refetch","localEntity","SIcon","DetailsHeaderContainer_templateObject","SCaret","DetailsHeaderContainer_templateObject2","DetailsHeaderContainer","close","DetailsHeaderSubitle","DetailsHeaderTitle","subtitle","components_DetailsHeaderSubitle","DetailsHeaderButtons","SButton","RefreshButton_templateObject","RefreshButton","settings","titleNew","titleExisting","Order","Model","DetailsMainHeader","closeDetails","refresh","editMode","fullnum","article","dateLocal","components_DetailsHeaderContainer","components_DetailsHeaderTitle","components_DetailsHeaderButtons","common_RefreshButton","entity_table_templateObject","Tr","entity_table_templateObject2","entity_table_templateObject3","InputTd","entity_table_templateObject4","EditorTd","entity_table_templateObject5","DraftEditor","editorState","newContent","getCurrentContent","_this$props","setEditorHasText","setEditorDiff","setHasFocus","hasText","oriContent","getSelection","getHasFocus","kolmechKeyBindingFn","keyCode","KeyBindingUtil","hasCommandModifier","getDefaultKeyBinding","handleKeyCommand","command","onCtrlEnter","newState","RichUtils","clear","EditorState","ContentState","createFromText","exportHtml","html","stateToHTML","convertFromHTML","contentBlocks","initFromHtml","blocksFromHTML","createWithContent","createFromBlockArray","entityMap","createEmpty","Draft","keyBindingFn","readOnly","EditorWrapper","WrappedDraftEditor_templateObject","borderless","hasFocus","diff","WrappedDraftEditor","forwardedRef","common_DraftEditor","WrappedDraftEditor_WrappedDraftEditor","validateInn","inn","toString","test","code","indexOf","checkDigit","coefficients","n","parseInt","n11","n12","isValidDate","tz","getTimezoneOffset","toLocalISOString","getTime","toISOString","fromLocalISOString","string","parse","orgFragmentBasic","org_templateObject","createOrg","org_templateObject2","org_templateObject3","org_templateObject4","org_templateObject5","allOrgsAndModels","combinedQueries_templateObject","PickerDiv","DatePicker_templateObject","err","DatePicker","selectedDate","selectDay","DayPickerInput_default","onDayChange","dayPickerProps","firstDayOfWeek","month","SecondarySection","onClose","projectEntity","schema","handleObj","preparePayload","values","initialValues","handlePayloadObj","objSchema","keys","forEach","k","isArray","handleArr","endsWith","arrSchema","arr","resultArr","initialObj","handlePayloadArr","initialArr","idValidationType","matches","validationSchema","shape","notRequired","trim","min","max","when","required","formikSchema","FormikCurrency","setField","Fragment","number_format_default","customInput","decimalSeparator","thousandSeparator","decimalScale","allowNegative","onValueChange","floatValue","FormikInput","formik","getIn","Dropdown","selection","fluid","search","noResultsMessage","setFieldValue","styled_semantic_Input","touched","errors","handleChange","onBlur","handleBlur","connect","countryOtions","text","inputError","FormikTel_templateObject","Error","FormikTel_templateObject2","Tel","baseName","renderDropdown","FormikTel_Dropdown","tabIndex","react_input_mask_default","mask","maskChar","inputProps","form_FormikInput","FormikTel_Error","Container","Field_templateObject","Field_templateObject2","Field_templateObject3","InputContainer","Field_templateObject4","Field_templateObject5","inputLabel","Field_Label","formik_esm","render","arrayHelpers","FormikTel","Field_Error","ModelForm","didMount","toggleEditMode","refetchQueries","onSubmit","mutation","onCompleted","asyncToGenerator","mark","upserted","resetForm","abrupt","_x","_x2","handleSubmit","handleReset","form_Field","Edit_templateObject","EnquiryEdit","closeNewModelSection","newModelMode","changeFieldValue","newVal","_this$setState","fieldObj","curVal","isNewEnquiry","oriVal","includes","pickedDate","handleOrgDropdownSearchChange","searchQuery","orgDdn","handleModelDropdownSearchChange","modelDdn","handleQtyInputChange","selectOrg","selectModel","submitNewModel","modelId","componentIsMounted","_callee2","_context2","_x3","_callee3","_context3","_x4","oriEnquiry","events","qty","requiredFields","_this$props2","orgs","models","requiredIsEmpty","someFieldHasError","common_DatePicker","Edit_Dropdown","selectOnBlur","selectOnNavigation","onSearchChange","allowAdditions","additionLabel","onAddItem","Form_ModelForm","hidden","update","sort","b","unshift","LocalDatePicker_templateObject","LocalDatePicker","handleDayChange","_this$props$field","LocalDatePicker_PickerDiv","CurrencyInput","SmartForm","isNewEntity","oriEntity","formState","EnquiryCommercialOffer","isNewCO","co","common_SmartForm","_ref$formState","common_LocalDatePicker","common_CurrencyInput","Divider","fitted","EnquiryDetails_templateObject","Comments","Comment","Group","EnquiryDetails_templateObject2","CIcon","EnquiryDetails_templateObject3","UserLabel","EnquiryDetails_templateObject4","CContent","EnquiryDetails_templateObject5","CMetadata","Metadata","EnquiryDetails_templateObject6","CText","Text","EnquiryDetails_templateObject7","CMessage","EnquiryDetails_templateObject8","EnquiryDetails","editorRef","createRef","noteEditorRef","editorHasText","noteEditorDiff","noteKey","activeCO","creatingComment","changingStatus","statusPending","savingNote","enableEditMode","exitEditMode","bool","setNoteEditorDiff","cancelEdit","createComment","htmlText","current","changeStatus","coStatusId","enquiryQuery","statuses","s","statusId","doc","cancelPendingStatusChange","saveNote","htmlNote","coEvents","curStatus","status","pop","rawStatuses","orderStatusId","refusalStatusIds","stage","eventStatusPresentationHelpers","Edit","entity_table_Table","entity_table_Td","_ref6$doc","common_WrappedDraftEditor","labelPosition","labeled","button","Math","abs","detail","Label_Label","components_EnquiryCommercialOffer","minimal","as","dividing","_e$user$person","user","userInitials","datetimeLocal","dangerouslySetInnerHTML","__html","sanitize","reply","onSave","newEvent","fragment","readFragment","writeFragment","SmartInput","debouncedSetField","debounce","writeVal","intVal","valueAsNumber","_this$props3","OrderEdit","_ref2$formState","common_SmartInput","upsertedOrder","DetailsHeader","buttons","titleSize","OuterSection","CollapsableSection_templateObject","InnerSection","CollapsableSection_templateObject2","CollapsableSection","initiallyExpanded","forceExpanded","headerProps","components_DetailsHeader","ProdsByDept","oriProds","selectedIds","orderId","selectLimit","_ref$selectedProds","selectedProds","orderProdsQty","expandedIds","limitReached","allProds","unionBy","depts","sortBy","groupBy","dept","count","readyCount","progress","hasDefect","isSpoiled","prod","ordered","added","op","removed","sp","orderedCount","selectedCount","availCount","every","unreservedProdsCount","xor","xorBy","defaultFields","DeptProdTable","_ref$skipFields","skipFields","nameFieldWidth","IconRight","ReserveProdsButton_templateObject","ReserveProdsButton","prodIds","modelProds","prod_templateObject","prod_templateObject2","ModelProdsSection","_ref$order","components_CollapsableSection","components_ReserveProdsButton","special_ProdContext","components_ProdsByDept","components_DeptProdTable","OrderDetails","components_ModelProdsSection","AspectRatioDiv","Drawing_templateObject","proportion","Drawing_templateObject2","ImgSpacer","shrinked","height","fullsize","Image","img","Drawing_templateObject3","Mask","Drawing_templateObject4","hide","off","CheckBox","Drawing_templateObject5","Check","Drawing_templateObject6","SortableElement","_ref2$drawing","drawing","files","toggleSelection","sortMode","oriImage","imgFor","image","Drawing_Container","open","focus","pose","src","SortableContainer","toggleDrawingSelection","selectedDrawings","drw","Drawing","index","SortedCollectionProvider","sortedCollection","move","oldIndex","newIndex","_draft$sortedCollecti","splice","slicedToArray","collection","prevPropsCollection","StatefulList","list","toggle","item","removeMany","items","StatefulBool","enable","disable","DropzoneArea","Drawings_templateObject","DropzoneOverlay","Drawings_templateObject2","MenuOverlay","Drawings_templateObject3","MenuLeftIcon","Drawings_templateObject4","Drawings","sidebarRef","NotificationsContext_NotificationsConsumer","creating","deleting","sorting","SortedCollectionProvider_SortedCollectionProvider","moveDrawing","StatefulList_StatefulList","deselectAllDrawings","deselectManyDrawings","StatefulBool_StatefulBool","enableSortMode","disableSortMode","es","onDrop","acceptedFiles","writeData","collapsableSection","disableClick","accept","onDropRejected","getRootProps","getInputProps","openFileDialog","isDragActive","Loader","reordered","sortOrder","Sortable","onSortEnd","getContainer","Model_Details","Drawings_Drawings","Details_templateObject","Details","_ref2$details","Details_Container","components_DetailsDataProvider","components_DetailsMainHeader","components_EnquiryDetails","components_OrderEdit","components_OrderDetails","ProdTableUtils","propDepts","newList","without","difference","idsWithinLimit","take","union","ListProvider","DetailsExtra_templateObject","DetailsExtra","closeExtra","DetailsExtra_Container","special_OrderContext","ListProvider_ListProvider","toggleExpanded","components_ProdTableUtils","SSidebar","Sidebar","DetailsSidebar_templateObject","DetailsSidebar","detailsClosing","_this$props$layout","node","visible","animation","direction","components_Details","components_DetailsExtra","PanelPusher_templateObject","Main","PanelPusher_templateObject2","Panel","PanelPusher_templateObject3","panelVisible","PanelPusher","panel","panelRendered","PanelPusher_Container","telFragment","tel_templateObject","personFragmentBasic","person_templateObject","personContactsFragment","person_templateObject2","persons","person_templateObject3","orgEmployees","employee_templateObject","upsertEmployee","employee_templateObject2","PanelHeader_templateObject","PanelHeader","closePanel","PanelHeader_MenuDiv","list_Tel","tel","list_Field_templateObject","list_Field_templateObject2","list_Field_templateObject3","list_Field","Field_Container","list_Field_Label","Field_Content","List","renderObj","schemaKeys","oneOf","default","lazy","transform","join","is","then","otherwise","mName","tels","array","of","telValidationSchema","personValidationSchema","listSchema","Employee_Details","emp","fullname","EmployeeForm","EmployeeEdit","Form_EmployeeForm","Employee_Table","emps","EmployeesPanelBody","EnquiriesBottomPanel_templateObject","EmployeesPanelTableSection","EnquiriesBottomPanel_templateObject2","EmployeeDetailsSection","EnquiriesBottomPanel_templateObject3","EnquiriesBottomPanel","activeEmp","Edit_EmployeeEdit","_draft$person","Pushable","EnquiriesPage_templateObject","EnquiriesPage","panelClosing","_this$props$allEnquir","components_EnquiriesMenu","components_DetailsSidebar","Pusher","PanelPusher_PanelPusher","components_EnquiriesTable","alias","articleFragmentBasic","article_templateObject","articleFragmentFull","article_templateObject2","accountFragmentBasic","account_templateObject","accountFragmentFull","account_templateObject2","equipmentFragmentBasic","equipment_templateObject","equipment_templateObject2","paymentFragmentBasic","payment_templateObject","paymentsPage","payment_templateObject2","payment_templateObject3","upsertPayment","payment_templateObject4","Chart_templateObject","Chart","_data$reduce","payments","isLoan","isIncome","arrs","y0","_data$reduce2","positive","negative","total","sum","lineData","reverse","pointIndex","findIndex","Chart_Container","react_vis_es","margin","left","stackBy","tickFormat","toLocaleDateString","stack","syncWithAmoContacts","amo_templateObject","articleId","equipmentId","personId","purpose","Form_templateObject","Form_templateObject2","Fields","Form_templateObject3","labelWidth","Payments_Form","payment","reset","articles","equipment","articleOptions","rusName","bankPayment","Form_Container","personsLoading","refetchPersons","Form_Header","foundIndex","enableReinitialize","amoName","relations","Stats_templateObject","SStatistic","Statistic","Stats_templateObject2","Stats","accounts","accountsStats","account","uniquePersons","up","deptsAndLoans","Stats_Container","Value","horizontal","l","lastIndexOf","Payments_Table_templateObject","Payments_Table","onClickRow","Table_Container","syncWithTochkaPayments","tochka_templateObject","Page_templateObject","SLink","Link","Page_templateObject2","Page_templateObject3","TopSection","Page_templateObject4","BottomSection","Page_templateObject5","Page","_useState","useState","_useState2","activePayment","setActivePayment","paymentsLoading","_ref2$data","equipments","refetchPayments","Page_Header","to","matchPath","href","Page_Container","Route","exact","Root","bootStrapData","HashRouter","displayName","Switch","components_EnquiriesPage","Redirect","components_LoginPage","App","NotificationsContext_NotificationsProvider","styled_components_browser_esm","components_Root","ReactDOM","src_App","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.1038f3b0.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n\r\n              // Execute callback\r\n              if (config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","export const AUTH_TOKEN = 'kolmech-token'\r\n","const defaults = {\r\n\tnewEnquiry: {\r\n\t\t__typename: 'Enquiry',\r\n\t\tid: 'new'\r\n\t},\r\n\tlayout: {\r\n\t\t__typename: 'Layout',\r\n\t\tdetails: null,\r\n\t\textra: null,\r\n\t\tbottomPanel: null\r\n\t},\r\n\tlists: {\r\n\t\t__typename: 'Lists',\r\n\t\tselectedProdIds: [],\r\n\t},\r\n}\r\n\r\nexport default defaults","import gql from 'graphql-tag'\r\n\r\nexport const getLayout = gql`\r\n\tquery getLayout {\r\n\t\tlayout @client {\r\n\t\t\tdetails\r\n\t\t\textra\r\n\t\t\tbottomPanel\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const getLayoutOptions = ({\r\n\tprops: ({ data: { layout } }) => {\r\n\t\treturn {\r\n\t\t\tlayout: layout || {}\r\n\t\t}\r\n\t}\r\n})\r\n\r\nexport const setLayout = gql`\r\n\tmutation SetLayout($input: json) {\r\n\t\tsetLayout(input: $input) @client {\r\n\t\t\tresult\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const setExpanded = gql`\r\n\tmutation SetExpanded($args: json) {\r\n\t\tsetExpanded(args: $args) @client {\r\n\t\t\targs\r\n\t\t}\r\n\t}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const orderFragmentBasic = gql`\r\n\tfragment OrderFragmentBasic on Order {\r\n\t\tid\r\n\t\tfullnum\r\n\t\tdateLocal\r\n\t\tqty\r\n\t\tamount\r\n\t}\r\n`\r\n\r\nexport const orderFragmentFull = gql`\r\n\tfragment OrderFragmentFull on Order {\r\n\t\t...OrderFragmentBasic\r\n\t\thtmlNote\r\n\t\torg {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t\tmodel {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t\tprods {\r\n\t\t\tid\r\n\t\t\tfullnumber,\r\n\t\t\thasDefect,\r\n\t\t\tisSpoiled,\r\n\t\t\tprogress,\r\n\t\t\tdept {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\ttype\r\n\t\t\t}\r\n\t\t}\r\n\t\tevents {\r\n\t\t\tid\r\n\t\t\tdatetimeLocal\r\n\t\t\thtmlText\r\n\t\t\ttype\r\n\t\t\tuser {\r\n\t\t\t\tid\r\n\t\t\t\tperson {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tfName\r\n\t\t\t\t\tlName \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\tstage \r\n\t\t\t}\r\n\t\t\tdoc {\r\n\t\t\t\tid\r\n\t\t\t\tdateLocal\r\n\t\t\t\tamount\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${orderFragmentBasic}\r\n`\r\n\r\nexport const upsertOrder = gql`\r\n\tmutation UpsertOrder($id: ID, $enquiryId: ID, $dateLocal: String!, $qty: Int, $amount: Float) {\r\n\t\tupsertOrder(id: $id, enquiryId: $enquiryId, dateLocal: $dateLocal, qty: $qty, amount: $amount) {\r\n\t\t\t...OrderFragmentBasic\r\n\t\t\tenquiry {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t\tprods {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${orderFragmentBasic}\r\n`\r\nexport const orderLocal = gql`\r\n\tquery OrderLocal ($id: ID!) {\r\n\t\torderLocal (id: $id) {\r\n\t\t\tid\r\n\t\t\tfullnum\r\n\t\t\tdateLocal\r\n\t\t\tqty\r\n\t\t\tamount\r\n\t\t}\r\n\t}\r\n`\r\nexport const orderDetails = gql`\r\n\tquery OrderDetails ($id: ID!) {\r\n\t\torder (id: $id) {\r\n\t\t\t...OrderFragmentFull\r\n\t\t}\r\n\t}\r\n\t${orderFragmentFull}\r\n`\r\nexport const reserveProds = gql`\r\n\tmutation ReserveProds ($orderId: ID!, $prodIds: [ID!]!) {\r\n\t\treserveProds (orderId: $orderId, prodIds: $prodIds) {\r\n\t\t\t...OrderFragmentFull\r\n\t\t}\r\n\t}\r\n\t${orderFragmentFull}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const docFragmentBasic = gql`\r\n\tfragment DocFragmentBasic on Doc {\r\n\t\tid\r\n\t\ttype\r\n\t\tdateLocal\r\n\t\tamount\r\n\t}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const statusFragment = gql`\r\n\tfragment StatusFragment on Status {\r\n\t\tid\r\n    name\r\n    stage\r\n\t}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const fileFragmentFull = gql`\r\n\tfragment FileFragmentFull on File {\r\n\t\tid\r\n\t\tpath\r\n\t\tsize\r\n\t\tfilename\r\n\t\tmimetype\r\n\t\twidth\r\n\t\theight\r\n\t\timgFor\r\n\t}\r\n`","import gql from 'graphql-tag'\r\nimport { fileFragmentFull } from './file'\r\n\r\nexport const drawingFragmentBasic = gql`\r\n\tfragment DrawingFragmentBasic on Drawing {\r\n\t\tid\r\n\t\tsortOrder\r\n\t}\r\n`\r\n\r\nexport const drawingFragmentFull = gql`\r\n\tfragment DrawingFragmentFull on Drawing {\r\n\t\t...DrawingFragmentBasic\r\n\t\tfiles { ...FileFragmentFull }\r\n\t}\r\n\t${drawingFragmentBasic}\r\n\t${fileFragmentFull}\r\n`\r\n\r\nexport const createDrawings = gql`\r\n\tmutation CreateDrawings(\r\n\t\t$modelId: ID!\r\n\t\t$files: [Upload!]!\r\n\t) {\r\n\t\tcreateDrawings(\r\n\t\t\tmodelId: $modelId\r\n\t\t\tfiles: $files\r\n\t\t) {\r\n\t\t\t...DrawingFragmentFull\r\n\t\t}\r\n\t}\r\n\t${drawingFragmentFull}\r\n`\r\n\r\nexport const deleteDrawings = gql`\r\n\tmutation DeleteDrawings( $ids: [ID!]! ) {\r\n\t\tdeleteDrawings(ids: $ids) { count }\r\n\t}\r\n`\r\n\r\nexport const setDrawingsSortOrder = gql`\r\n\tmutation SetDrawingsSortOrder( $ids: [ID!]! ) {\r\n\t\tsetDrawingsSortOrder(ids: $ids) { count }\r\n\t}\r\n`\r\n","import gql from 'graphql-tag'\r\nimport { drawingFragmentBasic, drawingFragmentFull } from './drawing';\r\n\r\nexport const modelFragmentBasic = gql`\r\n\tfragment ModelFragmentBasic on Model {\r\n\t\tid\r\n\t\tname\r\n\t\tarticle\r\n\t}\r\n`\r\n\r\nexport const modelFragmentWithDrawings = gql`\r\n\tfragment ModelFragmentWithDrawings on Model {\r\n\t\t...ModelFragmentBasic\r\n\t\tdrawings { ...DrawingFragmentBasic }\r\n\t}\r\n\t${modelFragmentBasic}\r\n\t${drawingFragmentBasic}\r\n`\r\n\r\nexport const modelFragmentFull = gql`\r\n\tfragment ModelFragmentFull on Model {\r\n\t\t...ModelFragmentBasic\r\n\t\tdrawings { ...DrawingFragmentFull }\r\n\t}\r\n\t${modelFragmentBasic}\r\n\t${drawingFragmentFull}\r\n`\r\n\r\nexport const modelLocal = gql`\r\n\tquery ModelLocal ($id: ID!) {\r\n\t\tmodelLocal (id: $id) {\r\n\t\t\t...ModelFragmentBasic\r\n\t\t}\r\n\t}\r\n\t${modelFragmentBasic}\r\n`\r\n\r\nexport const modelDetails = gql`\r\n\tquery ModelDetails ($id: ID!) {\r\n\t\tmodel (id: $id) {\r\n\t\t\t...ModelFragmentFull\r\n\t\t}\r\n\t}\r\n\t${modelFragmentFull}\r\n`\r\n\r\nexport const upsertModel = gql`\r\n\tmutation UpsertModel(\r\n\t\t$input: ModelInput!\r\n\t) {\r\n\t\tupsertModel(\r\n\t\t\tinput: $input\r\n\t\t) {\r\n\t\t\tid\r\n\t\t}\r\n\t}\r\n`","import gql from 'graphql-tag'\r\nimport { orderFragmentBasic } from './order'\r\nimport { docFragmentBasic } from './doc'\r\nimport { statusFragment } from './status'\r\nimport { modelFragmentWithDrawings, modelFragmentBasic } from './model';\r\n\r\nexport const enquiryFragmentBasic = gql`\r\n\tfragment EnquiryFragmentBasic on Enquiry {\r\n\t\tid\r\n\t\tnum\r\n\t\tdateLocal\r\n\t}\r\n`\r\n\r\nexport const allEnquiries = gql`\r\n\tquery AllEnquiries {\r\n\t\tenquiries {\r\n\t\t\t...EnquiryFragmentBasic\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\temployees {\r\n\t\t\t\t\tid\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmodel { ...ModelFragmentWithDrawings }\r\n\t\t\tqty\r\n\t\t\torders {\r\n\t\t\t\t...OrderFragmentBasic\r\n\t\t\t\tprods {\r\n\t\t\t\t\tid\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus { ...StatusFragment }\r\n\t\t\tdocs { ...DocFragmentBasic }\r\n\t\t\tisExpanded @client\r\n\t\t}\r\n\t}\r\n\t${enquiryFragmentBasic}\r\n\t${modelFragmentWithDrawings}\r\n\t${orderFragmentBasic}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\nexport const enquiryDetails = gql`\r\n\tquery EnquiryDetails ($id: ID!) {\r\n\t\tenquiry (id: $id) {\r\n\t\t\t...EnquiryFragmentBasic\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel { ...ModelFragmentBasic }\r\n\t\t\tqty\r\n\t\t\tevents {\r\n\t\t\t\tid\r\n\t\t\t\tdatetimeLocal\r\n\t\t\t\thtmlText\r\n\t\t\t\ttype\r\n\t\t\t\tuser {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tperson {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t\tfName\r\n\t\t\t\t\t\tlName \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstatus { ...StatusFragment }\r\n\t\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t\t}\r\n\t\t}\r\n\t\tstatuses {\r\n\t\t\tid\r\n\t\t\tstage\r\n\t\t\tname\r\n\t\t\tprev {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t\tnext {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${enquiryFragmentBasic}\r\n\t${modelFragmentBasic}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\nexport const enquiryLocal = gql`\r\n\tquery EnquiryLocal ($id: ID!) {\r\n\t\tenquiryLocal (id: $id) {\r\n\t\t\t...EnquiryFragmentBasic\r\n\t\t\tdocs { ...DocFragmentBasic }\r\n\t\t}\r\n\t}\r\n\t${enquiryFragmentBasic}\r\n\t${docFragmentBasic}\r\n`\r\nexport const newEnquiry = gql`\r\n\tquery {\r\n\t\tnewEnquiry @client {\r\n\t\t\tid\r\n\t\t}\r\n\t\tstatuses {\r\n\t\t\tid\r\n\t\t\tstage\r\n\t\t\tname\r\n\t\t\tprev {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t\tnext {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\nexport const createEnquiry = gql`\r\n\tmutation createEnquiry($dateLocal: String!, $orgId: ID!, $modelId: ID!, $qty: Int!) {\r\n\t\tcreateEnquiry(dateLocal: $dateLocal, orgId: $orgId, modelId: $modelId, qty: $qty) {\r\n\t\t\t...EnquiryFragmentBasic\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel { ...ModelFragmentWithDrawings }\r\n\t\t\tqty\r\n\t\t\tstatus { ...StatusFragment }\r\n\t\t\tdocs { ...DocFragmentBasic }\r\n\t\t\tevents {\r\n\t\t\t\tid\r\n\t\t\t\tdatetimeLocal\r\n\t\t\t\thtmlText\r\n\t\t\t\ttype\r\n\t\t\t\tuser {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tperson {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t\tfName\r\n\t\t\t\t\t\tlName \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstatus { ...StatusFragment }\r\n\t\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t\t}\r\n\t\t\torders {\r\n\t\t\t\tid\r\n\t\t\t\tfullnum\r\n\t\t\t\tdateLocal\r\n\t\t\t\tqty\r\n\t\t\t\tamount\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${enquiryFragmentBasic}\r\n\t${modelFragmentWithDrawings}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\nexport const updateEnquiry = gql`\r\n\tmutation UpdateEnquiry($input: EnquiryInput!) {\r\n\t\tupdateEnquiry(input: $input) {\r\n\t\t\t...EnquiryFragmentBasic\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel { ...ModelFragmentWithDrawings }\r\n\t\t\tqty\r\n\t\t\tevents {\r\n\t\t\t\tid\r\n\t\t\t\tdatetimeLocal\r\n\t\t\t\thtmlText\r\n\t\t\t\ttype\r\n\t\t\t\tuser {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tperson {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t\tfName\r\n\t\t\t\t\t\tlName\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstatus { ...StatusFragment }\r\n\t\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${enquiryFragmentBasic}\r\n\t${modelFragmentWithDrawings}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\n\r\nexport const createEnquiryEvent = gql`\r\n\tmutation CreateEnquiryEvent($enquiryId: ID!, $htmlText: String, $statusId: ID, $doc: DocCreateInput) {\r\n\t\tcreateEnquiryEvent(enquiryId: $enquiryId, htmlText: $htmlText, statusId: $statusId, doc: $doc) {\r\n\t\t\tid\r\n\t\t\tdatetimeLocal\r\n\t\t\thtmlText\r\n\t\t\ttype\r\n\t\t\tuser {\r\n\t\t\t\tid\r\n\t\t\t\tperson {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tfName\r\n\t\t\t\t\tlName\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus { ...StatusFragment }\r\n\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t}\r\n\t}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\n\r\nexport const enquiryFragment = gql`\r\n\tfragment myEnquiry on Enquiry {\r\n\t\tid\r\n\t\tnum\r\n\t\tdateLocal\r\n\t\thtmlNote\r\n\t\tisExpanded\r\n\t\torg {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t\tmodel { ...ModelFragmentBasic }\r\n\t\tqty\r\n\t\tevents {\r\n\t\t\tid\r\n\t\t\tdatetimeLocal\r\n\t\t\thtmlText\r\n\t\t\ttype\r\n\t\t\tuser {\r\n\t\t\t\tid\r\n\t\t\t\tperson {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tfName\r\n\t\t\t\t\tlName \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\tstage \r\n\t\t\t}\r\n\t\t\tdoc {\r\n\t\t\t\tid\r\n\t\t\t\tdateLocal\r\n\t\t\t\tamount\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${modelFragmentBasic}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const getLists = gql`\r\n\tquery getLists {\r\n\t\tlists @client {\r\n\t\t\tselectedProdIds\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const getListsOptions = ({\r\n\tprops: ({ data: { lists } }) => ({\r\n    lists: lists || {}\r\n\t})\r\n})\r\n\r\nexport const setList = gql`\r\n\tmutation SetList($name: String!, $value: [ID!]) {\r\n\t\tsetList(name: $name, value: $value) @client {\r\n\t\t\tresult\r\n\t\t}\r\n\t}\r\n`","import { getLayout } from '../graphql/layout'\r\nimport { allEnquiries } from '../graphql/enquiry'\r\nimport { getLists } from '../graphql/lists'\r\nimport { cloneDeep } from 'apollo-utilities'\r\n\r\nconst resolvers = {\r\n\tEnquiry: {\r\n\t\tisExpanded: () => false\r\n\t},\r\n\tMutation: {\r\n\t\tsetLayout: (_, { input }, { cache }) => {\r\n\t\t\tconst query = getLayout\r\n\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\tdata.layout = {\r\n\t\t\t\t...data.layout,\r\n\t\t\t\t...cloneDeep(input)\r\n\t\t\t}\r\n\t\t\tcache.writeQuery({ query, data })\r\n\t\t\treturn null\r\n\t\t},\r\n\t\tsetExpanded: (_, { args: { id: enquiryId, value } }, { cache }) => {\r\n\t\t\tconst query = allEnquiries\r\n\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\tconst enquiry = data.enquiries.find(e => e.id === enquiryId)\r\n\t\t\tenquiry.isExpanded = value\r\n\t\t\tcache.writeQuery({ query, data })\r\n\t\t\treturn null\r\n\t\t},\r\n\t\tsetList: (_, { name, value }, { cache }) => {\r\n\t\t\tconst query = getLists\r\n\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\tdata.lists[name] = value\r\n\t\t\tcache.writeQuery({ query, data })\r\n\t\t\treturn null\r\n\t\t},\r\n\t}\r\n}\r\n\r\nexport default resolvers","import { ApolloClient } from 'apollo-client'\r\n// import { HttpLink } from 'apollo-link-http'\r\nimport { createUploadLink } from 'apollo-upload-client'\r\nimport { ApolloLink } from 'apollo-link'\r\n// import { ApolloLink, Observable, split } from 'apollo-link'\r\nimport { withClientState } from 'apollo-link-state'\r\nimport { onError } from 'apollo-link-error'\r\nimport { InMemoryCache, defaultDataIdFromObject } from 'apollo-cache-inmemory'\r\n// import { WebSocketLink } from 'apollo-link-ws'\r\nimport { AUTH_TOKEN } from '../constants'\r\n\r\nimport defaults from './defaults'\r\nimport resolvers from './resolvers'\r\n// import typeDefs from './typeDefs'\r\n\r\n// init with Apollo Client:\r\nconst cache = new InMemoryCache({\r\n\tdataIdFromObject: object => {\r\n\t\tswitch (object.__typename) {\r\n\t\t\tcase 'NewEnquiry': return 'NewEnquiry'\r\n\t\t\tdefault: return defaultDataIdFromObject(object)\r\n\t\t}\r\n\t},\r\n\tcacheRedirects: {\r\n\t\tQuery: {\r\n\t\t\torgLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\tgetCacheKey({ __typename: 'Org', id: args.id }),\r\n\t\t\tenquiryLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\tgetCacheKey({ __typename: 'Enquiry', id: args.id }),\r\n\t\t\torderLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\tgetCacheKey({ __typename: 'Order', id: args.id }),\r\n\t\t\tmodelLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\tgetCacheKey({ __typename: 'Model', id: args.id }),\r\n\t\t\tprodsLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\targs.ids.map(id =>\r\n\t\t\t\t\tgetCacheKey({ __typename: 'Prod', id: id }))\r\n\t\t}\r\n\t}\r\n})\r\n\r\nconst authMiddleware = new ApolloLink((operation, forward) => {\r\n\tconst token = localStorage.getItem(AUTH_TOKEN) || null\r\n  operation.setContext(({ headers = {} }) => ({\r\n    headers: {\r\n      ...headers,\r\n      Authorization: token ? `Bearer ${token}` : '',\r\n    }\r\n  }))\r\n  return forward(operation)\r\n})\r\n\r\n// NOT WORKING!!! TODO find solution to redirect to Login page when token has expired\r\nconst refreshToken = (token) => {\r\n\tif (token) {\r\n\t\tlocalStorage.setItem(AUTH_TOKEN, token)\r\n\t} else {\r\n\t\tlocalStorage.removeItem(AUTH_TOKEN)\r\n\t\tclient.resetStore()\r\n\t}\r\n}\r\n\r\n// @ts-ignore\r\nexport const client = new ApolloClient({\r\n\tlink: ApolloLink.from([\r\n\t\tonError(({ graphQLErrors, networkError }) => {\r\n\t\t\tif (graphQLErrors) {\r\n\t\t\t\tconsole.log('graphQLErrors!!! > ', graphQLErrors)\r\n\t\t\t}\r\n\t\t\tif (networkError) {\r\n\t\t\t\tconsole.log('networkError!!! > ', networkError)\r\n\t\t\t\tconsole.log('networkError.name > ', networkError.name)\r\n\t\t\t\tconsole.log('networkError.message > ', networkError.message)\r\n\t\t\t\tconsole.log(networkError.message === 'Unexpected token I in JSON at position 0')\r\n\t\t\t\tif (networkError.message === 'Unexpected token I in JSON at position 0') refreshToken(null)\r\n\t\t\t\t// logoutUser();\r\n\t\t\t}\r\n\t\t}),\r\n\t\tauthMiddleware,\r\n\t\twithClientState({\r\n      defaults,\r\n\t\t\tresolvers,\r\n\t\t\t// typeDefs,\r\n      cache\r\n\t\t}),\r\n\t\t// new HttpLink({ uri: 'http://localhost:4000' })\r\n\t\tcreateUploadLink({\r\n\t\t\t// uri: 'http://localhost:4000',\r\n\t\t\t// uri: 'https://now-advanced.now.sh',\r\n\t\t\turi: 'https://env-1542080.mircloud.ru',\r\n\t\t})\r\n\t]),\r\n\tcache\r\n})\r\n\r\n// const httpLink = new HttpLink({ uri: 'https://now-advanced.now.sh' })\r\n\r\n// // authenticated httplink\r\n// const httpLinkAuth = middlewareAuthLink.concat(httpLink)\r\n\r\n// const wsLink = new WebSocketLink({\r\n//     uri: `ws://now-advanced.now.sh`,\r\n//     options: {\r\n//         reconnect: true,\r\n//         connectionParams: {\r\n//         Authorization: `Bearer ${localStorage.getItem(AUTH_TOKEN)}`,\r\n//         },\r\n//     },\r\n// })\r\n  \r\n// const link = split(\r\n//     // split based on operation type\r\n//     ({ query }) => {\r\n//         const { kind, operation } = getMainDefinition(query)\r\n//         return kind === 'OperationDefinition' && operation === 'subscription'\r\n//     },\r\n//     wsLink,\r\n//     httpLinkAuth,\r\n// )\r\n\r\n// const client = new ApolloClient({\r\n//     cache,\r\n//     link: ApolloLink.from([\r\n//         stateLink,\r\n//         httpLinkAuth\r\n//     ]),\r\n//     connectToDevTools: true,\r\n// })\r\n\r\n// client.cache.reset()\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\n\r\n// S prefix is used throughout the App just to have flexebility (two names for each component)\r\n// N prefix stands for NativeCssImplementation of a component (When html element is styled instead of semantic ui component) \r\n\r\nimport {\r\n    Header as SHeader,\r\n    // Label as SLabel,\r\n    Icon as SIcon,\r\n    Button as SButton,\r\n    Message as SMessage,\r\n    Popup as SPopup,\r\n    Input as SInput,\r\n    Dropdown as SDropdown,\r\n    Form as SForm,\r\n    Ref\r\n} from 'semantic-ui-react';\r\n\r\nexport const theme = {\r\n\twidths: {\r\n\t\tformLabel: '122px', //required calc(110px + 0.857143em)\r\n\t\tdetailsPL: '55px',\r\n\t\textraSidebar: '250px'\r\n\t},\r\n\tcolors: {\r\n\t\tgreen: '#016936',\r\n\t\tblue: '#0E6EB8',\r\n\t\terror: '#9f3a38',\r\n\t\terrorBorder: '#e0b4b4'\r\n\t}\r\n}\r\nconst getThemeColor = (color) => theme.colors[color] || color\r\nconst baseSet = ({ theme, bt, bb, bc, bs, c, d, fs, fw, h, lh, mw, minw, m, mb, mt, ml, mr, o, ox, oy, p, pe, pl, pr, pt, ta, va, w, ws }) => {\r\n\treturn `\r\n\t\t${bt \t? `border-top: ${bt};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${bb \t? `border-bottom: ${bb};`\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${bc \t? `background-color: ${bc};`\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${bs \t? `box-sizing: ${bs};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${c \t? `color: ${c};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${d \t? `display: ${d};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${fs \t? `font-size: ${fs};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${fw \t? `font-weight: ${fw};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${h \t? `height: ${h};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${lh \t? `line-height: ${lh};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${mw \t? `max-width: ${mw};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${minw? `min-width: ${minw};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${m \t? `margin: ${m};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${mb \t? `margin-bottom: ${mb};`\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${mt \t? `margin-top: ${mt};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${ml \t? `margin-left: ${ml};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${mr \t? `margin-right: ${mr};`\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${o  \t? `opacity: ${o};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${ox  ? `overflow-x: ${ox};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${oy  ? `overflow-y: ${oy};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${p \t? `padding: ${p};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${pl \t? `padding-left: ${pl};`\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${pe \t? `pointer-events: ${pe};`\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${pr \t? `padding-right: ${pr};`\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${pt \t? `padding-top: ${pt};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${ta \t? `text-align: ${ta};`\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${va \t? `vertical-align: ${va};`\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t\t${w \t? `width: ${(theme.widths && theme.widths[w]) || w};`\t\t: ''}\r\n\t\t${ws \t? `word-spacing: ${ws};`\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\r\n\t`\r\n}\r\n\r\nconst DivPropFilter = ({ ml, w, inline, ...rest }) => (\r\n\t<div {...rest} />\r\n)\r\nexport const Div = styled(DivPropFilter)`\r\n\t${props => props.inline && `display: inline-block;`}\r\n\t${props => baseSet(props)}\r\n`\r\n\r\nconst PPropFilter = ({ ...rest }) => (\r\n\t<p {...rest} />\r\n)\r\nexport const P = styled(PPropFilter)`\r\n\t${props => baseSet(props)}\r\n`\r\n\r\nconst SpanPropFilter = ({ ml, ...rest }) => (\r\n\t<span {...rest} />\r\n)\r\nexport const Span = styled(SpanPropFilter)`\r\n\t${props => baseSet(props)}\r\n`\r\n\r\nexport const A = styled.a`\r\n\tcursor: pointer;\r\n\t${props => props.cancel && `{\r\n\t\tpadding-left: 15px;\r\n\t\tcolor: rgba(0,0,0,.87);\r\n\t\t&:hover {\r\n\t\t\tcolor: #B03060;\r\n\t\t}\r\n\t}`}\r\n`\r\n\r\nconst HeaderPropFilter = ({ inline, c, ...rest }) => (\r\n\t<SHeader {...rest} />\r\n)\r\nexport const Header = styled(HeaderPropFilter)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n\t&&& {\r\n\t\t${props => props.inline && `{\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0 1rem;\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nconst IconPropFilter = ({\r\n\tactive,\r\n\tactiveColor,\r\n\tselectMode,\r\n\t...rest\r\n}) => (\r\n\t<SIcon {...rest} />\r\n)\r\nexport const Icon = styled(IconPropFilter)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n\t&&& {\r\n\t\t${props => props.activeColor && `{\r\n\t\t\t&:hover {\r\n\t\t\t\tcolor: ${getThemeColor(props.activeColor)} !important;\r\n\t\t\t}\r\n\t\t\t&.active {\r\n\t\t\t\tcolor: ${getThemeColor(props.activeColor)} !important;\r\n\t\t\t}\r\n\t\t\t${props.active && `color: ${getThemeColor(props.activeColor)} !important;`}\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nconst DropdownIcon = ({active, disabled, ...rest}) => (\r\n\t<SIcon {...rest}\r\n\t\tname='dropdown'\r\n\t/>\r\n)\r\nexport const Caret = styled(DropdownIcon)`\r\n\ttransform: ${\r\n\t\tprops => !props.active && (\r\n\t\t\tprops.size === 'large'\r\n\t\t\t? 'translateX(0) translateY(0) rotate(-90deg) !important'\r\n\t\t\t: 'translateX(-3px) translateY(3px) rotate(-90deg) !important'\r\n\t\t)\r\n\t};\r\n\t&&& {\r\n\t\t${props => props.disabled && `{\r\n\t\t\tcolor: rgba(0,0,0,.6);\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nconst ButtonPropFilter = ({ activeColor, menu, ...rest }) => (\r\n\t<SButton {...rest} />\r\n)\r\nexport const Button = styled(ButtonPropFilter)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n\t&&& {\r\n\t\t&.compact {\r\n\t\t\tpadding: .5rem 1rem;\r\n\t\t}\r\n\t\t${props => props.activeColor && `{\r\n\t\t\t&:hover {\r\n\t\t\t\tcolor: ${getThemeColor(props.activeColor)} !important;\r\n\t\t\t}\r\n\t\t\t&.active {\r\n\t\t\t\tcolor: ${getThemeColor(props.activeColor)} !important;\r\n        \t}\r\n\t\t}`}\r\n\t\t${props => props.menu && `{\r\n\t\t\tmargin: .25rem 0 .25rem 0.5rem;\r\n\t\t\tz-index: 3;\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nconst MessagePropFilter = ({\r\n\tsection,\r\n\t...rest\r\n}) => (\r\n\t<SMessage {...rest} />\r\n)\r\nexport const Message = styled(MessagePropFilter)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n\t&&& {\r\n\t\t${props => props.section && `\r\n\t\t\tmargin-top: 0;\r\n\t\t\tpadding-left: ${props.theme.widths.detailsPL};\r\n\t\t\tbox-shadow: 0 0 0 1px #e0b4b4, 0 0 0 0 transparent;\r\n\t\t\tborder-radius: 0;\r\n\t\t`}\r\n\t}\r\n`\r\n\r\nconst SectionPropFiltered = React.forwardRef(({\r\n\thead,\r\n\tminor,\r\n\tsmall,\r\n\tsecondary,\r\n\tnoP,\r\n\tnoLP,\r\n\tnoIndent,\r\n\ttopBorder,\r\n\tbottomBorder,\r\n\tchildren,\r\n\tonClick,\r\n\t...rest\r\n}, ref) => (\r\n\t\t<div\r\n\t\t\tref={ref}\r\n\t\t\t{...rest}\r\n\t\t\tonClick={onClick || undefined}\r\n\t\t>\r\n\t\t\t{children}\r\n\t\t</div>\r\n))\r\nexport const Section = styled(SectionPropFiltered)`\r\n\twidth: 100%;\r\n\tpadding: 1em 1em 1em 55px;\r\n\t${props => baseSet(props)}\r\n\t${props => props.head && `{\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding-top: 0;\r\n\t\tpadding-bottom: 0;\r\n\t}`}\r\n\t${props => props.onClick && `{\r\n\t\tcursor: pointer;\r\n\t}`}\r\n\t${props => props.minor && `{\r\n\t\tmin-height: 3.5em;\r\n\t}`}\r\n\t${props => !props.size && props.head && `{\r\n\t\tmin-height: 3.5em;\r\n\t}`}\r\n\t${props => props.size === 'small' && `{\r\n\t\tmin-height: 2.5em;\r\n\t}`}\r\n\t${props => props.secondary && `{\r\n\t\tbackground: #f3f4f5;\r\n\t\tcolor: rgba(0,0,0,.6);\r\n\t}`}\r\n\t${props => props.noLP && `{\r\n\t\tpadding-left: 0;\r\n\t}`}\r\n\t${props => props.noIndent && `{\r\n\t\tpadding-left: 1em;\r\n\t}`}\r\n\t${props => props.topBorder && `{\r\n\t\tborder-top: 1px solid ${props.topBorder === 'dark' ? 'rgba(152, 153, 154, 1)' : 'rgba(34,36,38,.15)'};\r\n\t}`}\r\n\t${props => props.bottomBorder && `{\r\n\t\tborder-bottom: 1px solid ${props.bottomBorder === 'dark' ? 'rgba(126, 127, 129, 1)' : 'rgba(34,36,38,.1)'};\r\n\t}`}\r\n`\r\n\r\nconst PopupPropFilter = ({ showIf, ...rest }) => (\r\n\t<SPopup {...rest} />\r\n)\r\nexport const Popup = styled(PopupPropFilter)`\r\n\t&&& {\r\n\t\t${props => !props.showIf && `{\r\n\t\t\topacity: 0;\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nexport const Label = styled.label`\r\n\t${props => baseSet(props)}\r\n\twidth: ${props => props.theme.widths.formLabel} !important;\r\n\tmargin-right: 0 !important;\r\n`\r\n\r\nconst InputPropFilter = React.forwardRef(({ w, ...rest }, ref) => (\r\n\t<Ref innerRef={ref}>\r\n\t\t<SInput {...rest} />\r\n\t</Ref>\r\n))\r\nexport const Input = styled(InputPropFilter)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n`\r\n\r\nexport const Dropdown = styled(SDropdown)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n`\r\n\r\nconst FormFieldPropFilter = ({ w, ...rest }) => (\r\n\t<SForm.Field {...rest} />\r\n)\r\nexport const FormField = styled(FormFieldPropFilter)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n`","import React, { Component } from 'react'\r\nimport produce from 'immer'\r\nimport cuid from 'cuid'\r\n\r\nconst NotificationsContext = React.createContext()\r\nexport default NotificationsContext\r\n\r\nexport class NotificationsProvider extends Component {\r\n  state = {\r\n    messages: []\r\n  }\r\n  create = message => {\r\n    message.id = cuid()\r\n    // notification will auto dismiss\r\n    message.timerId = setTimeout(() => {\r\n      this.dismiss(message.id)\r\n    }, 5000)\r\n    this.setState(produce(draft => {\r\n      draft.messages.push(message)\r\n    }))\r\n  }\r\n  dismiss = messageId => this.setState(produce(draft => {\r\n    draft.messages = draft.messages.filter(m => m.id !== messageId)\r\n  }))\r\n  cancelAutoDismiss = messageId => this.setState(produce(draft => {\r\n    const message = draft.messages.find(m => m.id === messageId)\r\n    clearTimeout(message.timerId)\r\n    delete message.timerId\r\n  }))\r\n  render() {\r\n    return (\r\n      <NotificationsContext.Provider\r\n        value={{\r\n          state: this.state,\r\n          create: this.create,\r\n          dismiss: this.dismiss,\r\n          cancelAutoDismiss: this.cancelAutoDismiss\r\n        }}\r\n      >\r\n        {this.props.children}\r\n      </NotificationsContext.Provider>\r\n    )\r\n  }\r\n}\r\n\r\nexport const NotificationsConsumer = ({ children }) => (\r\n  <NotificationsContext.Consumer>\r\n    {({ create: notify }) =>\r\n      <PureChild notify={notify} >\r\n        {children}\r\n      </PureChild>\r\n    }\r\n  </NotificationsContext.Consumer>\r\n)\r\n\r\nconst PureChild = React.memo(({ notify, children }) => children({ notify }))\r\n\r\n\r\n","import React from 'react'\r\nimport { Message } from '../styled/styled-semantic'\r\n\r\nexport default ({\r\n\tmessage: { id, type, title, content, timerId },\r\n\tdismissNotification,\r\n\tcancelAutoDismiss\r\n}) => {\r\n  return (\r\n\t\t<Message\r\n\t\t\tm='0 0 2rem 2rem'\r\n\t\t\tw='unset'\r\n\t\t\tmw='550px'\r\n\t\t\tpr='4em'\r\n\t\t\tpe='all'\r\n\t\t\tcompact\r\n\t\t\tsize='large'\r\n\t\t\ticon={\r\n\t\t\t\ttype === 'error' ? 'exclamation' :\r\n\t\t\t\ttype === 'warning' ? 'info' :\r\n\t\t\t\ttype === 'success' ? 'check' :\r\n\t\t\t\tundefined\r\n\t\t\t}\r\n\t\t\theader={title}\r\n\t\t\tcontent={content}\r\n\t\t\terror={type === 'error'}\r\n\t\t\tinfo={type === 'info'}\r\n\t\t\tsuccess={type === 'success'}\r\n\t\t\twarning={type === 'warning'}\r\n\t\t\tonDismiss={timerId ? undefined : (() => dismissNotification(id))}\r\n\t\t\tonMouseEnter={timerId ? (() => cancelAutoDismiss(id)) : undefined}\r\n\t\t/>\r\n\t)\r\n}","import React from \"react\"\r\nimport reactDom from 'react-dom'\r\n\r\nimport styled from 'styled-components'\r\nimport posed, { PoseGroup } from 'react-pose'\r\nimport Notification from \"./Notification\"\r\n\r\nconst NotificationsHolder = styled.div`\r\n\tposition: fixed;\r\n  bottom: 0;\r\n\ttop: 0;\r\n\tleft: 0;\r\n  width: 100%;\r\n\theight: 100%;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tjustify-content: flex-end;\r\n\tpointer-events: none;\r\n  z-index: 1;\r\n`\r\n\r\nconst PosedItem = posed.div({\r\n  boobl: {\r\n\t\ty: 200,\r\n\t\topacity: 0,\r\n\t},\r\n  enter: {\r\n\t\ty: 0,\r\n\t\topacity: 1,\r\n\t},\r\n\texit: {\r\n\t\tx: -400,\r\n\t\topacity: 0,\r\n\t},\r\n})\r\n\r\nexport default ({\r\n\tmessages,\r\n\tdismissNotification,\r\n\tcancelAutoDismiss\r\n}) => {\r\n\t// this Portal is never unmounted\r\n  return reactDom.createPortal(\r\n\t\t<NotificationsHolder>\r\n\t\t\t<PoseGroup\r\n\t\t\t\tanimateOnMount\r\n\t\t\t\tpreEnterPose='boobl'\r\n\t\t\t>\r\n\t\t\t\t{messages.map(m =>\r\n\t\t\t\t\t<PosedItem\r\n\t\t\t\t\t\tkey={m.id}\r\n\t\t\t\t\t\tinitialPose=\"boobl\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Notification\r\n\t\t\t\t\t\t\tmessage={m}\r\n\t\t\t\t\t\t\tdismissNotification={dismissNotification}\r\n\t\t\t\t\t\t\tcancelAutoDismiss={cancelAutoDismiss}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</PosedItem>\r\n\t\t\t\t)}\r\n\t\t\t</PoseGroup>\r\n\t\t</NotificationsHolder>,\r\n\t\tdocument.getElementById('kolmech-notifications')\r\n\t)\r\n}","import React from 'react'\r\n\r\nimport NotificationsContext from './NotificationsContext'\r\nimport Notifications from './Notifications'\r\n\r\nexport default () => {\r\n  return (\r\n\t\t<NotificationsContext.Consumer>\r\n\t\t\t{({\r\n\t\t\t\tstate: { messages },\r\n\t\t\t\tdismiss,\r\n\t\t\t\tcancelAutoDismiss,\r\n\t\t\t}) =>\r\n\t\t\t\t<Notifications\r\n\t\t\t\t\tmessages={messages}\r\n\t\t\t\t\tdismissNotification={dismiss}\r\n\t\t\t\t\tcancelAutoDismiss={cancelAutoDismiss}\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t</NotificationsContext.Consumer>\r\n\t)\r\n}","import decode from 'jwt-decode'\r\n\r\nexport function getTokenExpirationDate(token) {\r\n  const decoded = decode(token)\r\n  if (!decoded.exp) {\r\n    return null\r\n  }\r\n  const date = new Date(0) // The 0 here is the key, which sets the date to the epoch\r\n  date.setUTCSeconds(decoded.exp)\r\n  return date\r\n}\r\n\r\nexport function isTokenExpired(token) {\r\n  const date = getTokenExpirationDate(token)\r\n  const offsetSeconds = 0\r\n  if (date === null) {\r\n    return false\r\n  }\r\n  return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000)\r\n}\r\n","import gql from 'graphql-tag'\r\n\r\nexport const me = gql`\r\n\tquery Me {\r\n\t\tme {\r\n\t\t\tid\r\n\t\t\temail\r\n\t\t\tperson {\r\n\t\t\t\tfName\r\n\t\t\t\tlName\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const meLocal = gql`\r\n\tquery MeLocal {\r\n\t\tme @client {\r\n\t\t\tperson {\r\n\t\t\t\tfName\r\n\t\t\t\tlName\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const login = gql`\r\n\tmutation Login($email: String!, $password: String!) {\r\n\t\tlogin(email: $email, password: $password) {\r\n\t\t\ttoken\r\n\t\t}\r\n\t}\r\n`","import React, { Component, Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Header, Form, Message, Button, Segment } from 'semantic-ui-react'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { login } from '../graphql/user'\r\n\r\nconst MenuDiv = styled.div`\r\n\tborder-bottom: 1px solid #7e7e81;\r\n\t// height: 35px;\r\n`\r\n\r\nconst MenuHeader = styled(Header)`\r\n\tdisplay: inline;\r\n\tpadding: 0 1rem !important;\r\n`\r\n\r\nconst SSegment = styled(Segment)`\r\n\tmax-width: 350px !important;\r\n\tmargin: auto !important;\r\n`\r\n\r\nclass LoginPage extends Component {\r\n\tstate = {\r\n\t\temail: '',\r\n\t\tpassword: '',\r\n\t\tsendingRequest: false,\r\n\t\terror: ''\r\n\t}\r\n\thandleInputChange = (attr) => {\r\n\t\tthis.setState({ [attr]: this[attr].value })\r\n\t}\r\n\tsubmit = async () => {\r\n\t\ttry {\r\n\t\t\tconst { email, password } = this.state\r\n\t\t\tthis.setState({ sendingRequest: true })\r\n\t\t\tconst result = await this.props.login({\r\n\t\t\t\tvariables: {\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tpassword\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconst token = result.data.login.token\r\n\t\t\tthis.setState({ sendingRequest: false })\r\n\t\t\tthis.props.refreshToken(token)\r\n\t\t} catch (err) {\r\n\t\t\tthis.setState({ error: err.message, sendingRequest: false })\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\tconst { email, password, sendingRequest, error } = this.state\r\n\t\treturn (\r\n\t\t\t<Fragment>\r\n\t\t\t\t<MenuDiv>\r\n\t\t\t\t\t<MenuHeader size='large'>\r\n\t\t\t\t\t\t<i>Колмех</i>\r\n\t\t\t\t\t</MenuHeader>\r\n\t\t\t\t</MenuDiv>\r\n\t\t\t\t<SSegment basic>\r\n\t\t\t\t\t<Form error={!!error}>\r\n\t\t\t\t\t\t<Form.Field>\r\n\t\t\t\t\t\t\t<label>E-mail</label>\r\n\t\t\t\t\t\t\t<input \r\n\t\t\t\t\t\t\t\ttype=\"email\" \r\n\t\t\t\t\t\t\t\tplaceholder='E-mail'\r\n\t\t\t\t\t\t\t\tref={ref => this.email = ref} \r\n\t\t\t\t\t\t\t\tonChange={() => this.handleInputChange('email')} />\r\n\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t<Form.Field>\r\n\t\t\t\t\t\t\t<label>Пароль</label>\r\n\t\t\t\t\t\t\t<input \r\n\t\t\t\t\t\t\t\ttype=\"password\" \r\n\t\t\t\t\t\t\t\tplaceholder='Пароль'\r\n\t\t\t\t\t\t\t\tref={ref => this.password = ref} \r\n\t\t\t\t\t\t\t\tonChange={() => this.handleInputChange('password')} />\r\n\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\theader='Войти не удалось..'\r\n\t\t\t\t\t\t\tcontent={error} />\r\n\t\t\t\t\t\t<Button \r\n\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\ttype='submit'\r\n\t\t\t\t\t\t\tfloated='right'\r\n\t\t\t\t\t\t\tdisabled={!email || !password || sendingRequest}\r\n\t\t\t\t\t\t\tloading={sendingRequest}\r\n\t\t\t\t\t\t\tonClick={this.submit} >\r\n\t\t\t\t\t\t\tВойти\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Form>\r\n\t\t\t\t</SSegment>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(login, {\r\n\t\tname: 'login',\r\n\t\toptions: {\r\n\t\t\tfetchPolicy: 'no-cache'\r\n\t\t}\r\n\t})\r\n)(LoginPage)","import { compose, graphql } from 'react-apollo'\r\nimport { getLayout, getLayoutOptions, setLayout, setExpanded } from '../../graphql/layout'\r\nimport { getLists, getListsOptions, setList } from '../../graphql/lists'\r\n\r\n// const GlobalContext = React.createContext()\r\n\r\n// class GlobalContextProvider extends Component {\r\n// \t// setDetails = (details) => {\r\n// \t// \tthis.props.setLayout({variables: { details }})\r\n// \t// }\r\n// \trender() {\r\n// \t\tconst { children, getLayout: { details }, setLayout } = this.props\r\n// \t\treturn (\r\n// \t\t\t<GlobalContext.Provider \r\n// \t\t\t\tvalue={{\r\n// \t\t\t\t\tdetails,\r\n// \t\t\t\t\tsetDetails: (details) => setLayout({variables: { details }})\r\n// \t\t\t\t}}\r\n// \t\t\t>\r\n// \t\t\t\t{children}\r\n// \t\t\t</GlobalContext.Provider>\r\n// \t\t)\r\n// \t}\r\n// }\r\n\r\nconst GlobalContext = ({\r\n\t\tchildren,\r\n\t\tlayout: { details, extra, bottomPanel },\r\n\t\tsetLayout,\r\n\t\tsetExpanded,\r\n\t\tlists: { selectedProdIds },\r\n\t\tsetList\r\n}) => {\r\n\t// setLayout({ variables: { \r\n\t// \tdetails: {\"type\":\"Order\",\"id\":\"cjmzkpstb00170983jkb7bcbq\"},\r\n\t// \textra: {\"type\":\"Store\",\"modelId\":\"cjcfy68q55d3x0149fcpq7l63\",\"orderId\":\"cjmzkpstb00170983jkb7bcbq\"}\r\n\t// } })\r\n  return children({\r\n\t\tdetails,\r\n\t\textra,\r\n\t\tbottomPanel,\r\n\t\tsetDetails: (details) => setLayout({ variables: { input: { details, extra: null } }}),\r\n\t\tsetExtra: (extra) => setLayout({ variables: { input: { extra } } }),\r\n\t\tsetBottomPanel: (bottomPanel) => setLayout({ variables: { input: { bottomPanel } } }),\r\n\t\tsetExpanded: (args) => setExpanded({variables: { args }}),\r\n\t\tselectedProdIds,\r\n\t\tsetSelectedProdIds: (value) => \r\n\t\t\tsetList({variables: { name: 'selectedProdIds', value }}),\r\n\t})\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(getLayout, getLayoutOptions),\r\n\tgraphql(setLayout, { name: 'setLayout' }),\r\n\tgraphql(setExpanded, { name: 'setExpanded' }),\r\n\tgraphql(getLists, getListsOptions),\r\n\tgraphql(setList, { name: 'setList' }),\r\n)(GlobalContext)\r\n\t\r\n// export default GlobalContextProvider\r\n// export const GlobalContextConsumer = GlobalContext.Consumer","import React from 'react'\r\n\r\nimport { Icon, Popup as SPopup } from 'semantic-ui-react'\r\nimport { Div, Header, Button, Popup } from './styled/styled-semantic'\r\nimport styled from 'styled-components'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { getLayout, getLayoutOptions, setLayout } from '../graphql/layout'\r\nimport { enquiryLocal } from '../graphql/enquiry'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nconst SubmenuDiv = styled.div`\r\n\talign-self: stretch;\r\n\tposition: relative;\r\n\tmargin-left: 10px;\r\n\tpadding: 0 1em;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tbackground-color: #f5f6f7;\r\n\tborder-top-right-radius: .35rem;\r\n\tborder-bottom-right-radius: .35rem;\r\n\t::before {\r\n\t\tposition: absolute;\r\n\t\tz-index: 2;\r\n\t\tcontent: '';\r\n\t\ttop: 50%;\r\n\t\tleft: 0;\r\n\t\tbackground-color: #fff;\r\n\t\twidth: 1.74em;\r\n\t\theight: 1.74em;\r\n\t\ttransform: translateY(-50%) translateX(-50%) rotate(-45deg);\r\n\t}\r\n\t/* ::after {\r\n\t\tposition: absolute;\r\n\t\tz-index: 2;\r\n\t\tcontent: '';\r\n\t\ttop: 50%;\r\n\t\tright: 0;\r\n\t\tbackground-color: #f3f4f5;\r\n\t\twidth: 1.74em;\r\n\t\theight: 1.74em;\r\n\t\ttransform: translateY(-50%) translateX(50%) rotate(-45deg);\r\n\t} */\r\n`\r\n\r\n// const EnquiriesSubmenu = ({ item, addNewOrder, setLayout, layout: { details } }) => {\r\nconst EnquiriesSubmenu = () => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details: { type, id, enquiryId }, setDetails }) => (\r\n\t\t\t\t<Query \r\n\t\t\t\t\tquery={enquiryLocal}\r\n\t\t\t\t\tvariables={{ \r\n\t\t\t\t\t\tid: type === 'Enquiry' \r\n\t\t\t\t\t\t\t? id\r\n\t\t\t\t\t\t\t: enquiryId\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{({ data }) => {\r\n\t\t\t\t\t\tif (data && data.enquiryLocal) {\r\n\t\t\t\t\t\t\tconst { num, docs } = data.enquiryLocal\r\n\t\t\t\t\t\t\tconst addNewOrderForbidden = !docs.some(d => d.type === 'CO')\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<SubmenuDiv>\r\n\t\t\t\t\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\t\t\t\t\tc='rgba(0,0,0,.68)'\r\n\t\t\t\t\t\t\t\t\t\tsize='medium'\r\n\t\t\t\t\t\t\t\t\t\tcontent={`Заявка №${num}`}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<Popup \r\n\t\t\t\t\t\t\t\t\t\tposition='bottom left'\r\n\t\t\t\t\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t\t\t\t\t\tflowing\r\n\t\t\t\t\t\t\t\t\t\tshowIf={addNewOrderForbidden}\r\n\t\t\t\t\t\t\t\t\t\ttrigger={\r\n\t\t\t\t\t\t\t\t\t\t\t<Div inline>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tml='0'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactiveColor='green'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon='plus'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent='Заказ'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype === 'Order'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& id === 'new'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={addNewOrderForbidden}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Order',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: 'new',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenquiryId: id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<SPopup.Header content='Не все условия выполнены' />\r\n\t\t\t\t\t\t\t\t\t\t<SPopup.Content>\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon name='cancel' color='red' />\r\n\t\t\t\t\t\t\t\t\t\t\tВыставлено КП\r\n\t\t\t\t\t\t\t\t\t\t</SPopup.Content>\r\n\t\t\t\t\t\t\t\t\t</Popup>\r\n\t\t\t\t\t\t\t\t</SubmenuDiv>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t} else return null\r\n\t\t\t\t\t}}\r\n\t\t\t\t</Query>\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(setLayout, { name: 'setLayout' }),\r\n\tgraphql(getLayout, getLayoutOptions),\r\n)(EnquiriesSubmenu)\r\n","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Header, Button } from './styled/styled-semantic'\r\n\r\nimport EnquiriesSubmenu from './EnquiriesSubmenu'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { meLocal } from '../graphql/user'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nconst MenuDiv = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tborder-bottom: 1px solid #7e7e81;\r\n`\r\n\r\nconst EnquiriesMenu = ({\r\n\trefetchEnquiries,\r\n\tenquiriesAreLoading,\r\n\trefreshToken\r\n}) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details, setDetails }) => (\r\n\t\t\t\t<MenuDiv>\r\n\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\tsize='medium'\r\n\t\t\t\t\t\tcontent='Заявки и заказы'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\tw='118.5px'\r\n\t\t\t\t\t\tml='0'\r\n\t\t\t\t\t\tta='left'\r\n\t\t\t\t\t\tactiveColor='blue' \r\n\t\t\t\t\t\tonClick={refetchEnquiries}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon \r\n\t\t\t\t\t\t\tname='refresh'\r\n\t\t\t\t\t\t\tcolor={enquiriesAreLoading ? 'blue' : undefined} \r\n\t\t\t\t\t\t\tloading={enquiriesAreLoading}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{enquiriesAreLoading ? 'Загрузка' : 'Обновить'}\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\tactiveColor='green'\r\n\t\t\t\t\t\ticon='plus'\r\n\t\t\t\t\t\tcontent='Заявка'\r\n\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\tdetails\r\n\t\t\t\t\t\t\t&& details.type === 'Enquiry'\r\n\t\t\t\t\t\t\t&& details.id === 'new'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tonClick={() => setDetails({type: 'Enquiry', id: 'new'})}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{details && (\r\n\t\t\t\t\t\t(details.type === 'Enquiry' && details.id !== 'new')\r\n\t\t\t\t\t\t|| (details.type === 'Order' && details.id === 'new')\r\n\t\t\t\t\t) &&\r\n\t\t\t\t\t\t<EnquiriesSubmenu />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Query query={meLocal}>\r\n\t\t\t\t\t\t{ ({ data }) => {\r\n\t\t\t\t\t\t\tif (data && data.me) {\r\n\t\t\t\t\t\t\t\tconst { fName, lName } = data.me.person\r\n\t\t\t\t\t\t\t\tconst menuNameTitle = fName + ' ' + (lName ? `${lName.slice(0,1)}.` : '')\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\t\t\t\t\tml='auto'\r\n\t\t\t\t\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t\t\t\t\t\tcontent={menuNameTitle} \r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t)} else return null\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t</Query>\r\n\t\t\t\t\t<Icon link\r\n\t\t\t\t\t\tname='log out'\r\n\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\tonClick={() => refreshToken(null)} \r\n\t\t\t\t\t/>\r\n\t\t\t\t</MenuDiv>\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default EnquiriesMenu\r\n","import React, { Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\n\r\nconst STable = styled.table`\r\n\ttable-layout: fixed;\r\n\twidth: 100%;\r\n\tborder-collapse: collapse;\r\n\t/* TODO Make this table with scrollable tbody (Not trivial css trick) */\r\n\t/* thead, tbody, tr {\r\n\t\tdisplay: block;\r\n\t} */\r\n`\r\n\r\nconst TableHeaderRow = styled.tr`\r\n\tcolor: rgba(0,0,0,.8);\r\n\tline-height: 1.5em;\r\n\tbackground: rgb(233, 234, 235);\r\n\tborder-top: 1px solid #d4d4d5;\r\n\t/* ${props => props.noTopBorder ? '' : 'border-top: 1px solid #d4d4d5;'} */\r\n\tborder-bottom: 1px solid #d4d4d5;\r\n\tfont-weight: bold;\r\n`\r\n\r\nconst Td = styled.td`\r\n\tpadding-right: 4px;\r\n\t// @ts-ignore\r\n\t${props => props.w && `width: ${props.w};`}\r\n`\r\n\r\nconst TBody = styled.tbody`\r\n\t/* overflow-y: auto;\r\n  overflow-x: hidden; */\r\n`\r\n\r\nconst Table = ({\r\n\tchildren,\r\n\tfields,\r\n\tindent,\r\n\tnoTopBorder,\r\n\tselect,\r\n\texpand\r\n}) => {\r\n\tconst modes =  {\r\n\t\tindent: !!indent,\r\n\t\tselect: !!select,\r\n\t\texpand: !!expand,\r\n\t}\r\n\tconst fieldsExtended = [\r\n\t\t...modes['indent'] ? [{\r\n\t\t\tname: 'indent',\r\n\t\t\twidth: indent\r\n\t\t}] : [],\r\n\t\t{\r\n\t\t\tname: 'service',\r\n\t\t\twidth: '28px'\r\n\t\t},\r\n\t\t...modes['select'] ? [{\r\n\t\t\tname: 'select',\r\n\t\t\twidth: '28px'\r\n\t\t}]: [],\r\n\t\t...fields,\r\n\t\t// lastField is needed to take remaining width in fixed table-layout\r\n\t\t{ name: 'lastField' }\r\n\t]\r\n\treturn (\r\n\t\t<STable>\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<TableHeaderRow\r\n\t\t\t\t\t\tclassName='fz-tableHeaderRow'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{fieldsExtended.map(f =>{\r\n\t\t\t\t\t\t\t// console.log(f)\r\n\t\t\t\t\t\t\treturn <Td\r\n\t\t\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\t\tw={f.width}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{f.title}\r\n\t\t\t\t\t\t\t</Td>\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</TableHeaderRow>\r\n\t\t\t\t</thead>\r\n\t\t\t<TBody>\r\n\t\t\t\t<Fragment>\r\n\t\t\t\t\t{children({\r\n\t\t\t\t\t\ttableFields: fieldsExtended.map(f => {\r\n\t\t\t\t\t\t\tconst field = { ...f }\r\n\t\t\t\t\t\t\tdelete field.width\r\n\t\t\t\t\t\t\tdelete field.title\r\n\t\t\t\t\t\t\treturn field\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t})}\r\n\t\t\t\t</Fragment>\r\n\t\t\t</TBody>\r\n\t\t</STable>\r\n\t)\r\n}\r\n\r\nexport default Table","import { conformToMask } from 'react-text-mask'\r\n\r\nexport const formatTel = ({ number, country }) => {\r\n\treturn country === 'rus'\r\n\t\t? '+7 ' + conformToMask(\r\n\t\t\t\tnumber,\r\n\t\t\t\t['(', /\\d/, /\\d/, /\\d/, ')', ' ', /\\d/, /\\d/, /\\d/, '-', /\\d/, /\\d/, '-', /\\d/, /\\d/],\r\n\t\t\t\t{guide: false}\r\n\t\t\t).conformedValue\r\n\t\t: '+ ' + number\r\n}\r\n\r\nexport const currency = (num, trailing) => {\r\n\tlet curNum = (num).toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, '$& ').replace(/\\./, ',')\r\n\tif (!trailing) curNum = curNum.slice(0,-3)\r\n\treturn curNum + ' ₽'\r\n}\r\nexport const isNaN = Number.isNaN || function(value) {\r\n\treturn value !== value;\r\n}\r\n","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Caret } from '../styled/styled-semantic'\r\n\r\nimport { getObjProp } from '../../utils/object'\r\nimport { currency } from '../../utils/format'\r\n\r\nconst Row = styled.tr`\r\n\tfont-size: 1rem;\r\n\tcursor: pointer;\r\n\tborder-bottom: 1px solid rgba(34, 36, 38, 0.15);\r\n\t:hover {\r\n\t\tbackground: rgb(242, 242, 242);\r\n\t\tcolor: rgba(0,0,0,.95);\r\n\t}\r\n\t${props => props.lineHeight && `\r\n\t\tline-height: ${props.lineHeight};\r\n\t`}\r\n\t${props => props.secondary && `\r\n\t\tbackground: rgba(0,0,50,.02);\r\n\t\t${!props.lastSecondaryRow ? 'border-bottom: none;' : ''}\r\n\t`}\r\n\t${props => props.active && `\r\n\t\tbackground: rgba(0,0,0,.05);\r\n\t\tfont-weight: bold;\r\n\t\tborder-top: 1px solid rgba(34, 36, 38, 0.15);\r\n\t\tborder-bottom: 1px solid rgba(34, 36, 38, 0.15);\r\n\t`}\r\n\t${props => props.bold && `\r\n\t\tfont-weight: bold;\r\n\t`}\r\n`\r\n\r\nconst tdActiveStyle = `\r\n\tbackground: rgba(0,0,0,.12);\r\n\topacity: 1 !important;\r\n\t.icon {\r\n\t\topacity: 1 !important;\r\n\t}\r\n`\r\n\r\nconst Td = styled.td`\r\n\tpadding-right: 4px;\r\n\twhite-space: nowrap;\r\n  text-overflow: ellipsis;\r\n\t${props => !props.truncated && `overflow: hidden;`}\r\n\t${props => props.service && `padding-left: 3px;`}\r\n\t${Row}:not(:hover) & {\r\n\t\t${props => props.hoverable\r\n\t\t\t&& props.hideUnhovered\r\n\t\t\t&& !props.active\r\n\t\t\t&& !props.hasEntries && `\r\n\t\t\topacity: 0 !important;\r\n\t\t`}\r\n\t}\r\n\t${props => props.color && `color: ${props.color};`}\r\n\t${props => props.truncated && `position: relative`}\r\n\t${props => props.hoverable && `\r\n\t\ttransition: background .3s ease;\r\n\t\t${props.hideUnhovered && `\r\n\t\t\topacity: 0.8;\r\n\t\t\tpadding-left: ${props.hasEntries ? '5px' : '7.5px'};\r\n\t\t`};\r\n\t\t:hover {\r\n\t\t\t${tdActiveStyle}\r\n\t\t}\r\n\t\t${props.active ? tdActiveStyle : ''}\r\n\t`}\r\n`\r\n\r\nconst Untruncated = styled.div`\r\n\ttext-overflow: ellipsis;\r\n\toverflow: hidden;\r\n\tbox-sizing: content-box;\r\n\t/*\r\n\t// horizontal overlay\r\n\t:hover {\r\n\t\twidth: max-content;\r\n\t\toverflow: unset;\r\n\t\tbackground-color: white;\r\n\t} */\r\n\t/* vertical overlay */\r\n\t:hover {\r\n\t\tposition: absolute;\r\n\t\ttop: 1px;\r\n\t\tleft: -4px;\r\n\t\twidth: 100%;\r\n\t\tz-index: 1;\r\n\t\toverflow: unset;\r\n\t\twhite-space: normal;\r\n\t\tbackground-color: white;\r\n\t\tborder: 5px solid rgb(242,242,242);\r\n    border-top: none;\r\n\t}\r\n`\r\n\r\nconst TableRow = props => {\r\n\tconst {\r\n\t\ttableFields,\r\n\t\trowFields = [],\r\n\t\tentity,\r\n\t\texpandFor,\r\n\t\texpanded,\r\n\t\texpand,\r\n\t\tselect,\r\n\t\t...rest \r\n\t} = props\r\n\t// rowFields are merged into tableFields\r\n\tconst fields = tableFields.map(f => {\r\n\t\tconst rowField = rowFields.find(rf => rf.name === f.name)\r\n\t\treturn rowField ? { ...f, ...rowField } : f\r\n\t})\r\n\tconst { selected, disabled } = entity\r\n\treturn (\r\n\t\t<Row\r\n\t\t\t{...rest}\r\n\t\t>\r\n\t\t\t{fields.map(f => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tf.name === 'service'\r\n\t\t\t\t\t&& typeof expanded !== 'undefined'\r\n\t\t\t\t\t&& entity[expandFor].length\r\n\t\t\t\t) return (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tservice\r\n\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\texpand()\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Caret\r\n\t\t\t\t\t\t\tactive={expanded ? 1 : 0}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t\tif (\r\n\t\t\t\t\tf.name === 'select'\r\n\t\t\t\t\t&& typeof select !== 'undefined'\r\n\t\t\t\t) return (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t\tservice\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\tselect()\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tname={\r\n\t\t\t\t\t\t\t\tselected === 'partly' ? 'square' :\r\n\t\t\t\t\t\t\t\tselected \r\n\t\t\t\t\t\t\t\t\t? 'check square outline'\r\n\t\t\t\t\t\t\t\t\t: 'square outline'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t\tconst {\r\n\t\t\t\t\tcomponent,\r\n\t\t\t\t\tcontent,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tvalue,\r\n\t\t\t\t\tpath,\r\n\t\t\t\t\tonClick,\r\n\t\t\t\t\ticon,\r\n\t\t\t\t\ticonColor,\r\n\t\t\t\t\t...rest\r\n\t\t\t\t} = f\r\n\t\t\t\tif (component || content) return (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tkey={name}\r\n\t\t\t\t\t\t{...rest}\r\n\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t!!onClick\r\n\t\t\t\t\t\t\t? e => {\r\n\t\t\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\t\t\tonClick()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{component ? props[component] : null}\r\n\t\t\t\t\t\t{content ? content : null}\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t\tlet val = value || (path ? getObjProp(entity, path) : null)\r\n\t\t\t\tif (val && name === 'amount') val = currency(val)\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tkey={name}\r\n\t\t\t\t\t\t{...rest}\r\n\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t!!onClick\r\n\t\t\t\t\t\t\t? e => {\r\n\t\t\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\t\t\tonClick()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{val && icon &&\r\n\t\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\t\tlink={!!onClick}\r\n\t\t\t\t\t\t\t\tname={icon}\r\n\t\t\t\t\t\t\t\tcolor={iconColor || undefined}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t{f.truncated\r\n\t\t\t\t\t\t\t? <Untruncated>\r\n\t\t\t\t\t\t\t\t\t{val}\r\n\t\t\t\t\t\t\t\t</Untruncated>\r\n\t\t\t\t\t\t\t: val\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t})}\r\n\t\t</Row>\r\n\t)\r\n}\r\n\r\nexport default TableRow","export const getObjProp = function(obj, path){\r\n  const pathArr = path.split('.')\r\n  for (let i=0; i<pathArr.length; i++){\r\n      obj = obj[pathArr[i]]\r\n      if (!obj) return undefined\r\n  }\r\n  return obj\r\n}","import React, { Fragment } from 'react'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nimport Table from './common/Table'\r\nimport TableRow from './common/TableRow'\r\nimport { Div, Icon } from './styled/styled-semantic'\r\n\r\nconst fields = [{\r\n\tname: 'num',\r\n\tpath: 'num',\r\n\ttitle: '№',\r\n\twidth: '45px'\r\n},{\r\n\tname: 'date',\r\n\tpath: 'dateLocal',\r\n\ttitle: 'Дата',\r\n\twidth: '110px'\r\n},{\r\n\tname: 'org',\r\n\tpath: 'org.name',\r\n\ttitle: 'Организация',\r\n\twidth: '225px'\r\n},{\r\n\tname: 'emps',\r\n\tpath: 'org.name',\r\n\twidth: '50px'\r\n},{\r\n\tname: 'model',\r\n\tpath: 'model.name',\r\n\ttitle: 'Изделие',\r\n\twidth: '250px'\r\n},{\r\n\tname: 'qty',\r\n\tpath: 'qty',\r\n\ttitle: 'Кол.',\r\n\twidth: '50px'\r\n},{\r\n\tname: 'reserved',\r\n\ttitle: 'Рез.',\r\n\twidth: '50px'\r\n},{\r\n\tname: 'amount',\r\n\ttitle: 'Сумма',\r\n\twidth: '105px'\r\n},{\r\n\tname: 'status',\r\n\tpath: 'status.name',\r\n\ttitle: 'Статус',\r\n\twidth: '130px'\r\n}]\r\n\r\nconst EnquiriesTable = ({ enquiries }) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details,extra, setDetails, bottomPanel, setBottomPanel, setExpanded }) =>\r\n\t\t\t\t<Table\r\n\t\t\t\t\tfields={fields}\r\n\t\t\t\t>\r\n\t\t\t\t\t{({ tableFields }) => \r\n\t\t\t\t\t\tenquiries.map(enquiry => {\r\n\t\t\t\t\t\t\tconst { id, org, docs, isExpanded, model, orders } = enquiry\r\n\t\t\t\t\t\t\tconst active = details\r\n\t\t\t\t\t\t\t\t&& details.type === 'Enquiry'\r\n\t\t\t\t\t\t\t\t&& id === details.id\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Fragment key={id} >\r\n\t\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\t\tlineHeight='21px'\r\n\t\t\t\t\t\t\t\t\t\tentity={enquiry}\r\n\t\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\t\trowFields={[{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'amount',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: docs.length && docs[docs.length - 1].amount\r\n\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'emps',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: org.employees.length ? 'user' : 'user plus',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'grey',\r\n\t\t\t\t\t\t\t\t\t\t\thoverable: true,\r\n\t\t\t\t\t\t\t\t\t\t\thideUnhovered: true,\r\n\t\t\t\t\t\t\t\t\t\t\thasEntries: !!org.employees.length,\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: org.employees.length || ' ',\r\n\t\t\t\t\t\t\t\t\t\t\tonClick: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetBottomPanel({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Employees',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\torgId: org.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tactive: bottomPanel\r\n\t\t\t\t\t\t\t\t\t\t\t\t&& bottomPanel.type === 'Employees'\r\n\t\t\t\t\t\t\t\t\t\t\t\t&& bottomPanel.orgId === org.id\r\n\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'model',\r\n\t\t\t\t\t\t\t\t\t\t\tcomponent: 'modelComponent',\r\n\t\t\t\t\t\t\t\t\t\t\thoverable: true,\r\n\t\t\t\t\t\t\t\t\t\t\tonClick: () => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Model',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: model.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tactive: details\r\n\t\t\t\t\t\t\t\t\t\t\t\t&& details.type === 'Model'\r\n\t\t\t\t\t\t\t\t\t\t\t\t&& details.id === model.id\r\n\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'reserved',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: orders.reduce((res, o) => res += o.prods.length, 0),\r\n\t\t\t\t\t\t\t\t\t\t}]}\r\n\t\t\t\t\t\t\t\t\t\texpandFor='orders'\r\n\t\t\t\t\t\t\t\t\t\texpanded={isExpanded}\r\n\t\t\t\t\t\t\t\t\t\texpand={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetExpanded({\r\n\t\t\t\t\t\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: !isExpanded\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t)}}\r\n\t\t\t\t\t\t\t\t\t\tactive={active}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\tsetExpanded({\r\n\t\t\t\t\t\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: !active ? true : !isExpanded\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\tmodelComponent={\r\n\t\t\t\t\t\t\t\t\t\t\t<Div\r\n\t\t\t\t\t\t\t\t\t\t\t\td='flex'\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Div\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tminw='215px'\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{model.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{!!model.drawings.length &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmr='5px'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\to='.6'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='image outline'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcolor='grey'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t</TableRow>\r\n\t\t\t\t\t\t\t\t\t{\tisExpanded && orders.map((order, i) => {\r\n\t\t\t\t\t\t\t\t\t\tconst { id, prods } = order\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t\t\t\t\tsecondary={1}\r\n\t\t\t\t\t\t\t\t\t\t\t\tlastSecondaryRow={i === enquiry.orders.length - 1 ? 1 : 0}\r\n\t\t\t\t\t\t\t\t\t\t\t\tentity={order}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\t\t\t\trowFields={[{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'num',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'fullnum'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'org',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: enquiry.org.name\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'model',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: enquiry.model && enquiry.model.name //check only for migration from aws\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'reserved',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: prods.length\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'amount',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'amount'\r\n\t\t\t\t\t\t\t\t\t\t\t\t}]}\r\n\t\t\t\t\t\t\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdetails\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t&& details.type === 'Order'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t&& id === details.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Order',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)}\r\n\t\t\t\t</Table>\r\n\t\t\t}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default EnquiriesTable","import { compose, graphql } from 'react-apollo'\r\n\r\nimport { enquiryDetails, enquiryLocal } from '../graphql/enquiry'\r\nimport { orderDetails, orderLocal } from '../graphql/order'\r\nimport { modelDetails, modelLocal } from '../graphql/model'\r\n\r\nconst DetailsDataProvider = ({\r\n  children,\r\n  type,\r\n  id,\r\n  query1,\r\n  query2,\r\n  query3,\r\n  localQuery1,\r\n  localQuery2,\r\n  localQuery3,\r\n}) => {\r\n  const query = query1 || query2 || query3\r\n  const { loading, error, refetch } = query\r\n  const entity =\r\n    type === 'Enquiry' ? query.enquiry :\r\n    type === 'Order' ? query.order :\r\n    type === 'Model' ? query.model\r\n    : null\r\n  const localQuery = localQuery1 || localQuery2 || localQuery3\r\n  const localEntity =\r\n    id === 'new' ? null :\r\n    type === 'Enquiry' ? localQuery.enquiryLocal :\r\n    type === 'Order' ? localQuery.orderLocal :\r\n    type === 'Model' ? localQuery.modelLocal\r\n    : null\r\n  return children({\r\n    loading,\r\n    error,\r\n    refetch,\r\n    entity,\r\n    localEntity\r\n  })\r\n}\r\n\r\nexport default compose(\r\n  graphql(enquiryDetails, {\r\n    name: 'query1',\r\n    skip: ({ type }) => type !== 'Enquiry'\r\n  }),\r\n  graphql(orderDetails, {\r\n    name: 'query2',\r\n    skip: ({ type }) => type !== 'Order'\r\n  }),\r\n  graphql(modelDetails, {\r\n    name: 'query3',\r\n    skip: ({ type }) => type !== 'Model'\r\n  }),\r\n  graphql(enquiryLocal, {\r\n    name: 'localQuery1',\r\n    skip: ({ type, id }) => type !== 'Enquiry' || id === 'new',\r\n  }),\r\n  graphql(orderLocal, {\r\n    name: 'localQuery2',\r\n    skip: ({ type, id }) => type !== 'Order' || id === 'new',\r\n  }),\r\n  graphql(modelLocal, {\r\n    name: 'localQuery3',\r\n    skip: ({ type, id }) => type !== 'Model' || id === 'new',\r\n  }),\r\n)(DetailsDataProvider)","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Section, Caret } from './styled/styled-semantic'\r\n\r\nconst SIcon = styled(Icon)`\r\n\t&&& {\r\n\t\tbox-sizing: content-box;\r\n\t\twidth: calc(55px - 1em);\r\n\t\tmargin: 0 0.5em;\r\n\t}\r\n`\r\nconst SCaret = styled(Caret)`\r\n\t&&& {\r\n\t\tbox-sizing: content-box;\r\n\t\twidth: calc(55px - 1em);\r\n\t\tmargin: 0 0.5em;\r\n\t}\r\n`\r\n\r\nconst DetailsHeaderContainer = ({\r\n\tchildren,\r\n\t// style\r\n\tsize,\r\n\tbottomBorder,\r\n\tclose,\r\n\texpanded,\r\n\tdisabled,\r\n\tonClick,\r\n\tnoIndent,\r\n}) => {\r\n\tconst modes = {\r\n\t\t...close && { close: true },\r\n\t\t...(typeof expanded !== 'undefined') && { expand: true },\r\n\t}\r\n\treturn (\r\n\t\t<Section\r\n\t\t\tbc='white'\r\n\t\t\thead\r\n\t\t\tnoLP\r\n\t\t\tnoIndent={noIndent}\r\n\t\t\tbottomBorder={bottomBorder || true}\r\n\t\t\tsize={size || undefined}\r\n\t\t\tonClick={onClick}\r\n\t\t>\r\n\t\t\t{ modes['close']\r\n\t\t\t\t?\t<SIcon link\r\n\t\t\t\t\t\tsize='big'\r\n\t\t\t\t\t\tname='cancel'\r\n\t\t\t\t\t\tonClick={close}\r\n\t\t\t\t\t/> :\r\n\t\t\t\t// TODO make disabled work (grey out color)\r\n\t\t\t\tmodes['expand']\r\n\t\t\t\t? <SCaret\r\n\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\tactive={expanded ? 1 : 0}\r\n\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t/> : null\r\n\t\t\t}\r\n\t\t\t{children}\r\n\t\t</Section>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderContainer\r\n","import React from 'react'\r\n\r\nimport { Span } from './styled/styled-semantic'\r\n\r\nconst DetailsHeaderSubitle = ({ content }) => {\r\n\treturn (\r\n\t\t<Span\r\n\t\t\tml='10px'\r\n\t\t\tfs='1rem'\r\n\t\t\tc='rgba(0,0,0,.6)'\r\n\t\t\tws='0.5em'\r\n\t\t>\r\n\t\t\t{content}\r\n\t\t</Span>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderSubitle\r\n","import React from 'react'\r\n\r\nimport { Header } from './styled/styled-semantic'\r\nimport DetailsHeaderSubitle from './DetailsHeaderSubitle'\r\n\r\nconst DetailsHeaderTitle = ({\r\n\ttitle,\r\n\tsubtitle,\r\n\tsize\r\n}) => {\r\n\treturn (\r\n\t\t<Header\r\n\t\t\tm='0'\r\n\t\t\tsize={size || 'medium'}\r\n\t\t>\r\n\t\t\t{title}\r\n\t\t\t{(subtitle || subtitle === 0) &&\r\n\t\t\t\t<DetailsHeaderSubitle\r\n\t\t\t\t\tcontent={subtitle}\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t</Header>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderTitle\r\n","import React from 'react'\r\n\r\nimport { Div } from './styled/styled-semantic'\r\n\r\nconst DetailsHeaderButtons = ({ children }) => {\r\n\treturn (\r\n\t\t<Div\r\n\t\t\tml='auto'\r\n\t\t>\r\n\t\t\t{children}\r\n\t\t</Div>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderButtons\r\n","import React from 'react'\r\n\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Button } from '../styled/styled-semantic'\r\nimport styled from 'styled-components'\r\n\r\nconst SButton = styled(Button)`\r\n\tpadding: .78571429em !important;\r\n\t&>i {\r\n\t\topacity: .9 !important;\r\n\t\tmargin: 0 !important;\r\n\t}\r\n`\r\n\r\nconst RefreshButton = ({ loading, onClick }) => {\r\n\treturn (\r\n\t\t<SButton\r\n\t\t\tactiveColor='blue'\r\n\t\t\tactive={loading}\r\n\t\t\tonClick={onClick} >\r\n\t\t\t<Icon \r\n\t\t\t\tname='refresh'\r\n\t\t\t\tloading={loading} \r\n\t\t\t/>\r\n\t\t</SButton>\r\n\t)\r\n}\r\n\r\nexport default RefreshButton\r\n","import React, { Fragment } from 'react'\r\n\r\nimport { Button } from './styled/styled-semantic'\r\n\r\nimport DetailsHeaderContainer from './DetailsHeaderContainer'\r\nimport DetailsHeaderTitle from './DetailsHeaderTitle'\r\nimport DetailsHeaderButtons from './DetailsHeaderButtons'\r\nimport RefreshButton from './common/RefreshButton'\r\n\r\nconst settings = {\r\n\tEnquiry: {\r\n\t\ttitleNew: 'Новая заявка',\r\n\t\ttitleExisting: 'Заявка №',\r\n\t},\r\n\tOrder: {\r\n\t\ttitleNew: 'Новый заказ',\r\n\t\ttitleExisting: 'Заказ №',\r\n\t},\r\n\tModel: {\r\n\t\ttitleNew: 'Новое изделие',\r\n\t\ttitleExisting: '',\r\n\t}\r\n}\r\n\r\nconst DetailsMainHeader = ({\r\n\ttype,\r\n\tcloseDetails,\r\n\tloading,\r\n\trefresh,\r\n\tsetDetails,\r\n\teditMode,\r\n\tlocalEntity\r\n}) => {\r\n\tconst { id, num, fullnum, name, article, dateLocal } = localEntity || {}\r\n\treturn (\r\n\t\t<DetailsHeaderContainer\r\n\t\t\tclose={closeDetails}\r\n\t\t>\r\n\t\t\t{ !id && // new entity\r\n\t\t\t\t<DetailsHeaderTitle\r\n\t\t\t\t\ttitle={settings[type].titleNew}\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t\t{ id && // existing entity\r\n\t\t\t\t<Fragment>\r\n\t\t\t\t\t<DetailsHeaderTitle\r\n\t\t\t\t\t\ttitle={type === 'Model'\r\n\t\t\t\t\t\t\t? name\r\n\t\t\t\t\t\t\t: settings[type].titleExisting + ' ' + (num || fullnum)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubtitle={type === 'Model'\r\n\t\t\t\t\t\t\t? (article ? `Артикул: ${article}` : '')\r\n\t\t\t\t\t\t\t: 'от ' + dateLocal\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<DetailsHeaderButtons>\r\n\t\t\t\t\t\t<RefreshButton\r\n\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\tonClick={refresh}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\ticon='edit'\r\n\t\t\t\t\t\t\tactiveColor='blue'\r\n\t\t\t\t\t\t\tactive={editMode || false}\r\n\t\t\t\t\t\t\tonClick={() => setDetails({\r\n\t\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\t\tid: localEntity.id,\r\n\t\t\t\t\t\t\t\teditMode: true\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t/> \r\n\t\t\t\t\t</DetailsHeaderButtons>\r\n\t\t\t\t</Fragment>\r\n\t\t\t}\r\n\t\t</DetailsHeaderContainer>\r\n\t)\r\n}\r\n\r\nexport default DetailsMainHeader\r\n","import styled from 'styled-components'\r\n\r\nexport const Table = styled.table`\r\n\t/* table-layout: fixed; */\r\n\twidth: 100%;\r\n\tborder-collapse: collapse;\r\n`\r\n\r\nexport const Tr = styled.tr`\r\n  margin: 0 0 1em;\r\n  line-height: 1.4285em;\r\n  color: rgba(0,0,0,.87);\r\n`\r\n\r\nexport const Td = styled.td`\r\n  :nth-child(1) {\r\n\t\twidth: ${props => props.theme.widths.formLabel};\r\n\t// color: rgba(0,0,0,.87);\r\n\t/* font-size: .92857143em; */\r\n\t/* line-height: 32px; */\r\n\t\tline-height: 1.21428571em;\r\n\t\tpadding: .67857143em 0;\r\n\t\tvertical-align: top;\r\n  }\r\n  :nth-child(2) {\r\n\t\t// width: 100px;\r\n\t\tfont-size: 1em;\r\n\t\tfont-weight: bold;\r\n\t\tline-height: 1.21428571em;\r\n\t\tpadding: .67857143em 0;\r\n  }\r\n`\r\nexport const InputTd = styled(Td)`\r\n\tpadding-top: 0 !important;\r\n`\r\n\r\nexport const EditorTd = styled(InputTd)`\r\n\tfont-weight: unset !important;\r\n\t/* padding-bottom: 0 !important; */\r\n`","import React from 'react'\r\nimport {\r\n\tEditor,\r\n\tEditorState,\r\n\tContentState,\r\n\tRichUtils,\r\n\tconvertFromHTML,\r\n\tgetDefaultKeyBinding,\r\n\tKeyBindingUtil\r\n} from 'draft-js'\r\nimport 'draft-js/dist/Draft.css'\r\nimport {stateToHTML} from 'draft-js-export-html'\r\n\r\nclass DraftEditor extends React.Component {\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tlet editorState\r\n\t\tif (props.initFromHtml) {\r\n\t\t\tconst blocksFromHTML = convertFromHTML(props.initFromHtml)\r\n\t\t\teditorState = EditorState.createWithContent(\r\n\t\t\t\tContentState.createFromBlockArray(\r\n\t\t\t\t\tblocksFromHTML.contentBlocks,\r\n\t\t\t\t\tblocksFromHTML.entityMap\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t} else {\r\n\t\t\teditorState = EditorState.createEmpty()\r\n\t\t}\r\n\t\tthis.state = { \r\n\t\t\teditorState,\r\n\t\t\toriContent: editorState.getCurrentContent()\r\n\t\t}\r\n\t}\r\n\tonChange = (editorState) => {\r\n\t\tthis.setState({ editorState })\r\n\t\tconst newContent = editorState.getCurrentContent()\r\n\t\tconst { setEditorHasText, setEditorDiff, setHasFocus } = this.props\r\n\t\tif (editorState && setEditorHasText) setEditorHasText(newContent.hasText())\r\n\t\tif (setEditorDiff) setEditorDiff(newContent !== this.state.oriContent)\r\n\t\tif (setHasFocus) setHasFocus(editorState.getSelection().getHasFocus())\r\n\t}\r\n\tkolmechKeyBindingFn = (e) => {\r\n\t\t// catch Ctrl + Enter event\r\n\t\tif (e.keyCode === 13 && KeyBindingUtil.hasCommandModifier(e)) {\r\n\t\t  return 'ctrlEnter'\r\n\t\t}\r\n\t\treturn getDefaultKeyBinding(e)\r\n\t}\r\n\thandleKeyCommand = (command, editorState) => {\r\n\t\t// handle Ctrl + Enter command\r\n\t\tif (command === 'ctrlEnter') {\r\n\t\t\tthis.props.onCtrlEnter()\r\n\t\t\treturn 'handled'\r\n\t\t}\r\n\t\tconst newState = RichUtils.handleKeyCommand(editorState, command);\r\n\t\tif (newState) {\r\n\t\t\tthis.onChange(newState);\r\n\t\t\treturn 'handled'\r\n\t\t}\r\n\t\treturn 'not-handled'\r\n\t}\r\n\tclear = () => this.setState({ \r\n\t\teditorState: EditorState.push(this.state.editorState, ContentState.createFromText(''), 'remove-range')\r\n\t})\r\n\texportHtml = () => {\r\n\t\tconst html = stateToHTML(this.state.editorState.getCurrentContent())\r\n\t\tif (!convertFromHTML(html).contentBlocks) return null\r\n\t\treturn html\r\n\t}\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Editor\r\n\t\t\t\teditorState={this.state.editorState}\r\n\t\t\t\tonChange={this.onChange}\r\n\t\t\t\thandleKeyCommand={this.handleKeyCommand}\r\n\t\t\t\tkeyBindingFn={this.kolmechKeyBindingFn}\r\n\t\t\t\treadOnly={this.props.readOnly}\r\n\t\t\t/>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default DraftEditor","import React, { Component } from 'react'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport DraftEditor from './DraftEditor'\r\n\r\nconst EditorWrapper = styled.div`\r\n\tpadding: calc(0.678571em - 1px) 1em;\r\n\tline-height: 1.4285em;\r\n\tborder: 1px solid rgba(34,36,38,.15);\r\n\tborder-radius: .28571429rem;\r\n\ttransition: all .1s ease;\r\n\t${({ borderless, hasFocus, diff }) =>\r\n\t\tborderless\r\n\t\t&& !hasFocus\r\n\t\t&& !diff && `\r\n\t\t\tmargin-left: -1em;\r\n\t\t\tborder: 1px solid white;\r\n\t\t\t:hover {\r\n\t\t\t\tbackground: rgba(0,0,0,.05);\r\n\t\t\t\tcolor: rgba(0,0,0,.65);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\t\t`\r\n\t}\r\n`\r\n\r\nclass WrappedDraftEditor extends Component {\r\n\tstate = {\r\n\t\thasFocus: false\r\n\t}\r\n\tsetHasFocus = (hasFocus) => this.setState({ hasFocus })\r\n\trender() {\r\n\t\tconst { hasFocus } = this.state\r\n\t\tconst {\r\n\t\t\tborderless,\r\n\t\t\tdiff,\r\n\t\t\tforwardedRef,\r\n\t\t\t...rest\r\n\t\t} = this.props\r\n\t\treturn (\r\n\t\t\t<EditorWrapper\r\n\t\t\t\tborderless={borderless}\r\n\t\t\t\thasFocus={hasFocus}\r\n\t\t\t\tdiff={diff}\r\n\t\t\t>\r\n\t\t\t\t<DraftEditor\r\n\t\t\t\t\tref={forwardedRef}\r\n\t\t\t\t\tsetHasFocus={this.setHasFocus}\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t/>\r\n\t\t\t</EditorWrapper>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default React.forwardRef((props, ref) =>\r\n\t<WrappedDraftEditor\r\n\t\tforwardedRef={ref}\r\n\t\t{...props}\r\n\t/>\r\n)","const validateInn = (inn, error) => {\r\n    var result = false;\r\n\tif (typeof inn === 'number') {\r\n        inn = inn.toString();\r\n\t} else if (typeof inn !== 'string') {\r\n        inn = '';\r\n\t}\r\n\tif (!inn.length) {\r\n        error.code = 1;\r\n\t\terror.message = 'ИНН пуст';\r\n\t} else if (/[^0-9]/.test(inn)) {\r\n        error.code = 2;\r\n\t\terror.message = 'ИНН может состоять только из цифр';\r\n\t} else if ([10, 12].indexOf(inn.length) === -1) {\r\n        error.code = 3;\r\n\t\terror.message = 'ИНН может состоять только из 10 или 12 цифр';\r\n\t} else {\r\n        var checkDigit = function (inn, coefficients) {\r\n            var n = 0;\r\n\t\t\tfor (var i in coefficients) {\r\n                n += coefficients[i] * inn[i];\r\n\t\t\t}\r\n            // eslint-disable-next-line\r\n\t\t\treturn parseInt(n % 11 % 10);\r\n\t\t};\r\n        // eslint-disable-next-line\r\n\t\tswitch (inn.length) {\r\n            case 10:\r\n            var n10 = checkDigit(inn, [2, 4, 10, 3, 5, 9, 4, 6, 8]);\r\n            // eslint-disable-next-line\r\n            if (n10 === parseInt(inn[9])) {\r\n                result = true;\r\n            }\r\n            break;\r\n\t\t\tcase 12:\r\n            var n11 = checkDigit(inn, [7, 2, 4, 10, 3, 5, 9, 4, 6, 8]);\r\n            var n12 = checkDigit(inn, [3, 7, 2, 4, 10, 3, 5, 9, 4, 6, 8]);\r\n            // eslint-disable-next-line\r\n            if ((n11 === parseInt(inn[10])) && (n12 === parseInt(inn[11]))) {\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (!result) {\r\n\t\t\terror.code = 4;\r\n\t\t\terror.message = 'Неправильное контрольное число ИНН';\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport default validateInn","export const isValidDate = (date) => date instanceof Date && !isNaN(date.valueOf())\r\nexport const tz = new Date().getTimezoneOffset() * 60000\r\nexport const toLocalISOString = (date) => new Date(date.getTime() - tz).toISOString()\r\nexport const fromLocalISOString = (string) => new Date(Date.parse(string) + tz)\r\n// util to split array into chunks\r\nexport const toChunks = (arr, size) => {\r\n    let chunks = []\r\n    for (let i = 0; i < arr.length; i += size) {\r\n        chunks.push(arr.slice(i, i + size))\r\n    }\r\n    return chunks\r\n}\r\n\r\n// groupBy = (xs, key) => xs.reduce((rv, x) => {\r\n//     (rv[x[key]] = rv[x[key]] || []).push(x)\r\n//     return rv\r\n//   }, {})\r\n// groupByArray(xs, key) => xs.reduce( (rv, x) => {\r\n//   let v = key instanceof Function ? key(x) : x[key];\r\n//   let el = rv.find((r) => r && r.key === v);\r\n//   if (el) { el.values.push(x); } else { rv.push({ key: v, values: [x] }); }\r\n//   return rv;\r\n// }, [])\r\n// const splitBy = (xs, key) => xs.reduce( (rv, x) => {\r\n//   let el = rv.find(r => r[0][key] === x[key])\r\n//   if (el) { el.push(x); } else { rv.push([x]); }\r\n// }, [])\r\n","import gql from 'graphql-tag'\r\n\r\nexport const orgFragmentBasic = gql`\r\n\tfragment OrgFragmentBasic on Org {\r\n\t\tid\r\n\t\tinn\r\n\t\tname\r\n\t}\r\n`\r\n\r\nexport const org = gql`\r\n\tquery org ($id: ID!) {\r\n\t\torg (id: $id) {\r\n\t\t\t...OrgFragmentBasic\r\n\t\t}\r\n\t}\r\n\t${orgFragmentBasic}\r\n`\r\n\r\nexport const allOrgs = gql`\r\n\tquery allOrgs {\r\n\t\torgs {\r\n\t\t\t...OrgFragmentBasic\r\n\t\t}\r\n\t}\r\n\t${orgFragmentBasic}\r\n`\r\n\r\nexport const createOrg = gql`\r\n\tmutation createOrg($inn: String!) {\r\n\t\tcreateOrg(inn: $inn) {\r\n\t\t\t...OrgFragmentBasic\r\n\t\t}\r\n\t}\r\n\t${orgFragmentBasic}\r\n`\r\n\r\nexport const orgLocal = gql`\r\n\tquery OrgLocal ($id: ID!) {\r\n\t\torgLocal (id: $id) {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const allOrgsAndModels = gql`\r\n    query AllOrgsAndModels {\r\n        orgs {\r\n            id\r\n            inn\r\n            name\r\n        }\r\n        models {\r\n            id\r\n            article\r\n            name\r\n        }\r\n    }\r\n`","import React from 'react'\r\n\r\nimport DayPickerInput from 'react-day-picker/DayPickerInput'\r\nimport 'react-day-picker/lib/style.css'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport { toLocalISOString } from '../../utils/dates'\r\n\r\nconst PickerDiv = styled.div`\r\n\tdisplay: inline-block;\r\n\twidth: 180px;\r\n\t${props => props.err && `\r\n\t\tinput {\r\n\t\t\tcolor: #9f3a38 !important;\r\n\t\t\tbackground-color: #fff6f6 !important;\r\n\t\t\tborder-color: #e0b4b4 !important;\r\n\t\t}`\r\n\t}\r\n\tinput {\r\n\t\tcursor: pointer;\r\n\t\tvertical-align: unset !important;\r\n\t\tpadding-left: 3.5rem !important;\r\n\t\t&:focus {\r\n\t\t\tcursor: text;\r\n\t\t}\r\n\t}\r\n`\r\n\r\n// TODO logic may be deprecated (check with enremkol-dev)\r\nconst DatePicker = ({ selectedDate, selectDay, error }) => {\r\n\treturn (\r\n\t\t<PickerDiv error={error}>\r\n\t\t\t<DayPickerInput\r\n\t\t\t\tvalue={toLocalISOString(selectedDate).slice(0, 10)}\r\n\t\t\t\tonDayChange={selectDay}\r\n\t\t\t\tdayPickerProps={{\r\n\t\t\t\t\tfirstDayOfWeek: 1,\r\n\t\t\t\t\tmonth: selectedDate\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</PickerDiv>\r\n\t)\r\n}\r\n\r\nexport default DatePicker\r\n","import React from 'react'\r\nimport { Section, Header, Div, Icon } from '../styled/styled-semantic';\r\n\r\nexport default ({\r\n  title,\r\n  content,\r\n  onClose\r\n}) => {\r\n  return (\r\n    <Div\r\n      m='0 -1em 1em -55px'\r\n    >\r\n      <Section\r\n        head\r\n        minor\r\n        secondary\r\n        topBorder\r\n        bottomBorder\r\n        noLP={!!onClose}\r\n      >\r\n        {!!onClose &&\r\n          <Icon\r\n            bs='content-box'\r\n            w='calc(55px - 1em)'\r\n            m='0 0.5em'\r\n            link\r\n            size='large'\r\n            name='close'\r\n            // onClick={() => onClose()}\r\n            onClick={onClose}\r\n          />\r\n        }\r\n        <Header\r\n          m='0'\r\n        >\r\n          {title}\r\n        </Header>\r\n      </Section>\r\n      <Section\r\n        secondary\r\n        bottomBorder\r\n      >\r\n        {content}\r\n      </Section>\r\n    </Div>\r\n  )\r\n}\r\n","export const projectEntity = (entity, schema) => {\r\n\tlet result = {}\r\n\thandleObj(schema, entity, result)\r\n\treturn result\r\n}\r\n\r\nexport const preparePayload = (values, initialValues, schema) => {\r\n\tlet result = {}\r\n\thandlePayloadObj(schema, initialValues, values, result)\r\n\treturn result\r\n}\r\n\r\nconst handleObj = (objSchema, obj = {}, result) => {\r\n\t// preserve ids of entity objects\r\n\tif (obj.id) result.id = obj.id\r\n\tObject.keys(objSchema).forEach(k => {\r\n\t\tconst type = typeof objSchema[k]\r\n\t\t// NOTE form schema should contain only non-empty nested objects\r\n\t\tif (type === 'object' && Array.isArray(objSchema[k]))\r\n\t\t\treturn handleArr(objSchema[k], obj[k], result[k] = [])\r\n\t\tif (type === 'object')\r\n\t\t\treturn handleObj(objSchema[k], obj[k], result[k] = {})\r\n\t\tif (k.endsWith('Id') && !!obj[k.slice(0, -2)])\r\n\t\t\treturn result[k] = obj[k.slice(0, -2)].id\r\n\t\tresult[k] = obj[k] || objSchema[k]\r\n\t})\r\n}\r\n\r\nconst handleArr = (arrSchema, arr = [], resultArr) => {\r\n\t// NOTE schema array should contain one element only just to define schema\r\n\tconst type = typeof arrSchema[0]\r\n\t// TODO handle array of primitives (now only collections)\r\n\tif (type === 'object') {\r\n\t\treturn arr.length\r\n\t\t\t? arr.forEach((obj, i) => handleObj(arrSchema[0], obj, resultArr[i] = {}))\r\n\t\t\t: handleObj(arrSchema[0], {}, resultArr[0] = {})\r\n\t}\r\n}\r\n\r\nconst handlePayloadObj = (objSchema, initialObj, obj, result) => {\r\n\t// preserve ids of entity objects\r\n\tif (obj.id) result.id = obj.id\r\n\tObject.keys(objSchema).forEach(k => {\r\n\t\t// console.log('k > ', k)\r\n\t\t// console.log('objSchema[k] > ', objSchema[k])\r\n\t\t// preserve any db entities' Ids\r\n\t\t// if (k.endsWith('Id')) return result[k] = obj[k] || objSchema[k]\r\n\t\t// if (k.endsWith('Id') && !!obj[k]) return result[k] = obj[k]\r\n\t\tconst type = typeof objSchema[k]\r\n\t\t// NOTE form schema should contain only non-empty nested objects\r\n\t\tif (type === 'object' && Array.isArray(objSchema[k]))\r\n\t\t\treturn handlePayloadArr(objSchema[k], initialObj[k], obj[k], result[k] = [])\r\n\t\tif (type === 'object')\r\n\t\t\treturn handlePayloadObj(objSchema[k], initialObj[k], obj[k], result[k] = {})\r\n\t\t// result includes changed values\r\n\t\t// console.log('obj[k] !== initialObj[k] > ', obj[k] !== initialObj[k])\r\n\t\tif (obj[k] !== initialObj[k]) return result[k] = obj[k]\r\n\t\t// and non-empty schema values\r\n\t\t// console.log('!!objSchema[k] > ', !!objSchema[k])\r\n\t\tif (!obj[k] && !!objSchema[k]) return result[k] = objSchema[k]\r\n\t})\r\n}\r\n\r\nconst handlePayloadArr = (arrSchema, initialArr, arr, resultArr) => {\r\n\t// NOTE schema array should contain one element only just to define schema\r\n\tconst type = typeof arrSchema[0]\r\n\t// TODO handle array of primitives (now only collections)\r\n\tif (type === 'object') {\r\n\t\t// arr should contain at least one element\r\n\t\treturn arr.forEach((obj, i) =>\r\n\t\t\thandlePayloadObj(arrSchema[0], initialArr[i], obj, resultArr[i] = {})\r\n\t\t)\r\n\t}\r\n}\r\n","import { string } from 'yup'\r\n\r\nexport const idValidationType = string().matches(/^[a-z0-9]{25}$/)","import { object, string } from 'yup'\r\n\r\nimport { idValidationType } from './commonTypes'\r\n\r\nexport const validationSchema = object().shape({\r\n  id: idValidationType.notRequired(),\r\n  // orgId: idValidationType\r\n\t// \t.when('id', (id, schema) => id\r\n\t// \t\t? schema.notRequired()\r\n\t// \t\t: schema.required('Организация не указана')\r\n\t// \t),\r\n  name: string().trim().min(4).max(255)\r\n    .when('id', (id, schema) => id\r\n      ? schema.notRequired()\r\n      : schema.required()\r\n    ),\r\n  article: string().trim().min(4).max(10).notRequired(),\r\n})\r\n\r\nexport const formikSchema = {\r\n  name: '',\r\n  article: ''\r\n}\r\n\r\nexport const listSchema = {\r\n  name: {\r\n    label: 'Наименование'\r\n  },\r\n  article: {\r\n    label: 'Артикул'\r\n  }\r\n}\r\n","import React from 'react'\r\n\r\nimport NumberFormat from 'react-number-format'\r\n\r\nimport { Input } from 'semantic-ui-react'\r\nimport { Span } from '../styled/styled-semantic'\r\n// import CurrencyInput from './CurrencyInput'\r\n\r\nexport default ({\r\n\tplaceholder,\r\n\tname,\r\n\tvalue,\r\n\tsetField\r\n}) => {\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<NumberFormat\r\n\t\t\t\tcustomInput={Input}\r\n\t\t\t\t// customInput={CurrencyInput}\r\n\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\tvalue={value}\r\n\t\t\t\tdecimalSeparator=','\r\n\t\t\t\tthousandSeparator=' '\r\n\t\t\t\tdecimalScale={2}\r\n\t\t\t\tallowNegative={false}\r\n\t\t\t\tonValueChange={values => setField(name, values.floatValue)} />\r\n\t\t\t<Span\r\n\t\t\t\tpl='6px'\r\n\t\t\t\tfs='1.3rem'\r\n\t\t\t\tc='rgba(0,0,0,.6)'\r\n\t\t\t>\r\n\t\t\t\t₽\r\n\t\t\t</Span>\r\n\t\t\t{/* <Span pl='9px' fs='1.1rem' ws='0.1em'>с НДС</Span> */}\r\n\t\t</>\r\n\t)\r\n}\r\n","import React, { Component } from 'react'\r\nimport { connect, getIn } from 'formik'\r\n\r\nimport FormikCurrency from './FormikCurrency'\r\nimport { Input } from '../styled/styled-semantic'\r\nimport { Dropdown } from 'semantic-ui-react'\r\n\r\nclass FormikInput extends Component {\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tformik,\r\n\t\t\tname,\r\n\t\t\ttype,\r\n\t\t\toptions,\r\n\t\t\t...rest\r\n\t\t} = this.props\r\n\t\tconst value = getIn(formik.values, name)\r\n\t\tif (options) return (\r\n\t\t\t<Dropdown\r\n\t\t\t\t{...rest}\r\n\t\t\t\tselection\r\n\t\t\t\tfluid\r\n\t\t\t\tsearch\r\n\t\t\t\tnoResultsMessage='Ничего не найдено'\r\n\t\t\t\tvalue={value}\r\n\t\t\t\toptions={options}\r\n\t\t\t\tonChange={(e, {value}) => formik.setFieldValue(name, value)}\r\n\t\t\t/>\r\n\t\t)\r\n\t\tif (name.endsWith('amount')) return (\r\n\t\t\t<FormikCurrency\r\n\t\t\t\tname={name}\r\n\t\t\t\tvalue={value}\r\n\t\t\t\tsetField={formik.setFieldValue}\r\n\t\t\t/>\r\n\t\t)\r\n\t\treturn (\r\n\t\t\t<Input\r\n\t\t\t\t{...rest}\r\n\t\t\t\tw='100%'\r\n\t\t\t\tname={name}\r\n\t\t\t\tvalue={type === 'date' ? value.slice(0,16) : value}\r\n\t\t\t\terror={getIn(formik.touched, name) && !!getIn(formik.errors, name)}\r\n\t\t\t\tonChange={formik.handleChange}\r\n\t\t\t\tonBlur={formik.handleBlur}\r\n\t\t\t/>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default connect(FormikInput)","import React, { Component } from 'react'\r\nimport { connect, getIn } from 'formik'\r\nimport InputMask from 'react-input-mask'\r\nimport styled from 'styled-components'\r\nimport { Dropdown as SDropdown } from 'semantic-ui-react';\r\nimport { Input } from '../styled/styled-semantic';\r\nimport FormikInput from './FormikInput.js';\r\n\r\nconst countryOtions = [\r\n  { key: 'rus', text: '+7', value: 'rus' },\r\n  { key: 'notRus', text: '+', value: 'notRus' },\r\n]\r\n\r\nconst DropdownPropFilter = ({ inputError, ...rest }) => (\r\n\t<SDropdown {...rest} />\r\n)\r\nexport const Dropdown = styled(DropdownPropFilter)`\r\n\t&&&&&& {\r\n    ${props => props.inputError && `\r\n      border: 1px solid ${props.theme.colors.errorBorder};\r\n      border-right-color: transparent;\r\n    `}\r\n\t}\r\n`\r\n\r\nconst Error = styled.div`\r\n  color: ${props => props.theme.colors.error};\r\n`\r\n\r\nclass Tel extends Component {\r\n  render() {\r\n    const {\r\n      baseName,\r\n      formik,\r\n      ...rest\r\n    } = this.props\r\n    const number = getIn(formik.values, baseName + '.number')\r\n    const country = getIn(formik.values, baseName + '.country')\r\n    const touched = getIn(formik.touched, baseName + '.number')\r\n    const error = getIn(formik.errors, baseName)\r\n    const renderDropdown =() => (\r\n      <Dropdown\r\n        tabIndex={-1}\r\n        name={baseName + '.country'}\r\n        value={country}\r\n        options={countryOtions}\r\n        inputError={touched && !!error}\r\n        onChange={(e, { name, value }) => formik.setFieldValue( name, value )}\r\n      />\r\n    )\r\n    return <>\r\n      {country === 'rus'\r\n        ? <InputMask\r\n            name={baseName + '.number'}\r\n            mask='( 999 ) 999-99-99'\r\n            maskChar=''\r\n            value={number}\r\n            onBlur={formik.handleBlur}\r\n            onChange={formik.handleChange}\r\n          >\r\n            {(inputProps) =>\r\n              <Input\r\n                w='240px !important'\r\n                // placeholder='Номер телефона'\r\n                error={touched && !!error}\r\n                label={renderDropdown()}\r\n                {...rest}\r\n                {...inputProps}\r\n              />\r\n            }\r\n          </InputMask>\r\n        : <FormikInput\r\n            w='240px !important'\r\n            name={baseName + '.number'}\r\n            error={touched && !!error}\r\n            // placeholder='Телефон с кодом страны'\r\n            label={renderDropdown()}\r\n            {...rest}\r\n          />\r\n      }\r\n      <Error>\r\n        {touched && error && error.number}\r\n      </Error>\r\n    </>\r\n  }\r\n}\r\n\r\nexport default connect(Tel)\r\n","import React, { Fragment } from 'react'\r\nimport { getIn, connect, FieldArray } from 'formik'\r\nimport styled from 'styled-components'\r\n\r\nimport FormikInput from './FormikInput'\r\nimport FormikTel from './FormikTel'\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin-bottom: .67857143rem;\r\n`\r\n\r\nconst Label = styled.div`\r\n  flex: 0 0 122px;\r\n  padding-top: calc(10.5rem/14);\r\n  font-size: calc(13rem/14);\r\n  font-weight: bold;\r\n  line-height: 1.21428571rem;\r\n  ${props => props.required && `\r\n    ::after {\r\n      content: '*';\r\n      display: inline-block;\r\n      margin: -.2em 0 0 .2em;\r\n      vertical-align: top;\r\n      color: #db2828;\r\n    }\r\n  `}\r\n`\r\n\r\nconst Content = styled.div`\r\n  flex: 1 1 auto;\r\n  max-width: calc(100% - 122px);\r\n`\r\n\r\nconst InputContainer = styled.div`\r\n  max-width: 240px;\r\n`\r\n\r\nconst Error = styled.div`\r\n  color: ${props => props.theme.colors.error};\r\n`\r\n\r\nconst Field = ({\r\n  label,\r\n  required,\r\n  name,\r\n  type,\r\n  formik,\r\n  inputLabel,\r\n  ...rest\r\n}) => {\r\n  const isArray = name === 'person.tels'\r\n  // const component = data =>\r\n  //   type === 'string' ? data :\r\n  //   type === 'tel' ? <FormikTel tel={data} />\r\n  //   : null\r\n  return (\r\n    <Container>\r\n      <Label\r\n        className='fz-formFieldLabel'\r\n        required={required}\r\n      >\r\n        {label}\r\n      </Label>\r\n      <Content>\r\n        {isArray\r\n          ? <FieldArray\r\n              name={name}\r\n              render={arrayHelpers => (\r\n                <>\r\n                  {getIn(formik.values, name).map((_, i) => \r\n                    <Fragment\r\n                      key={i}\r\n                    >\r\n                      <FormikTel\r\n                        baseName={`${name}.${i}`}\r\n                      />\r\n                    </Fragment>\r\n                  )}\r\n                </>\r\n              )}\r\n            />\r\n          : <>\r\n              <InputContainer>\r\n                <FormikInput\r\n                  {...rest}\r\n                  name={name}\r\n                  type={type}\r\n                />\r\n              </InputContainer>\r\n              <Error>\r\n                {getIn(formik.touched, name) ? getIn(formik.errors, name) : ''}\r\n              </Error>\r\n            </>\r\n        }\r\n      </Content>\r\n    </Container>\r\n  )\r\n}\r\n\r\nexport default connect(Field)","import React, { Component } from 'react'\r\n\r\nimport { Mutation } from 'react-apollo'\r\nimport { upsertModel } from '../../graphql/model'\r\n\r\nimport { Formik } from 'formik'\r\nimport { projectEntity, preparePayload } from '../form/utils'\r\nimport { formikSchema, validationSchema } from '../../schema/model'\r\nimport Field from '../form/Field'\r\n\r\nimport { Button, A, Message } from '../styled/styled-semantic'\r\n\r\nexport default class ModelForm extends Component {\r\n  didMount = false\r\n  componentDidMount() { this.didMount = true }\r\n  componentWillUnmount() { this.didMount = false }\r\n  render() {\r\n    const {\r\n      model,\r\n      orgId,\r\n      toggleEditMode,\r\n      refetchQueries,\r\n      onSubmit,\r\n    } = this.props\r\n    let schema = model ? formikSchema : {...formikSchema, orgId}\r\n    const initialValues = model ? projectEntity(model, schema) : schema\r\n    return (\r\n      <Mutation\r\n        mutation={upsertModel}\r\n        onCompleted={() => refetchQueries()}\r\n      >\r\n        {(upsertModel, { loading, error }) =>\r\n          <Formik\r\n            initialValues={initialValues}\r\n            validationSchema={validationSchema}\r\n            onSubmit={async (values, { resetForm }) => {\r\n              // console.log('values > ', values)\r\n              // console.log('initialValues > ', initialValues)\r\n              const input = preparePayload(values, initialValues, schema)\r\n              // console.log('upsertModel input > ', input)\r\n              const upserted = await upsertModel({ variables: { input } })\r\n              // console.log('upserted > ', upserted)\r\n              return model\r\n                ? toggleEditMode()\r\n                : this.didMount && onSubmit(upserted.data.upsertModel.id)\r\n            }}\r\n          >\r\n            {({\r\n              handleSubmit,\r\n              handleReset,\r\n            }) =>\r\n              <>\r\n                <Field\r\n                  label='Наименование'\r\n                  name='name'\r\n                  required\r\n                />\r\n                <Field\r\n                  label='Артикул'\r\n                  name='article'\r\n                />\r\n                {!!error &&\r\n                  <Message\r\n                    d='block !important'\r\n                    error\r\n                    header='Не удалось добавить..'\r\n                    content={error && error.message}\r\n                  />\r\n                }\r\n                <Button\r\n                  ml='122px'\r\n                  type='button'\r\n                  primary\r\n                  content={model ? 'Сохранить' : 'Добавить'}\r\n                  loading={loading}\r\n                  onClick={handleSubmit}\r\n                />\r\n                <A cancel\r\n                  onClick={ model ? toggleEditMode : handleReset}\r\n                >\r\n                  {model ? 'Отмена' : 'Очистить'}\r\n                </A>\r\n              </>\r\n            }\r\n          </Formik>\r\n        }\r\n      </Mutation>\r\n    )\r\n  }\r\n}\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport cloneDeep from 'lodash/cloneDeep'\r\nimport validateInn from '../../utils/validateInn'\r\nimport { isValidDate, toLocalISOString, fromLocalISOString }from '../../utils/dates'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { allEnquiries, createEnquiry, updateEnquiry } from '../../graphql/enquiry'\r\nimport { createOrg } from '../../graphql/org'\r\nimport { allOrgsAndModels } from '../../graphql/combinedQueries'\r\n\r\nimport styled from 'styled-components'\r\nimport { Form, Input, Message, Dropdown as SDropdown } from 'semantic-ui-react'\r\nimport { Div, Span, A, Label, Button, Section } from '../styled/styled-semantic.js'\r\nimport DatePicker from '../common/DatePicker'\r\nimport SecondarySection from '../presentational/SecondarySection'\r\nimport ModelForm from '../Model/Form'\r\n\r\nconst Dropdown = styled(SDropdown)`\r\n\t&&&&&& {\r\n\t\twidth: 350px;\r\n\t\t&:hover {\r\n\t\t\tborder-color: rgba(34, 36, 38, 0.15);\r\n\t\t}\r\n\t}\r\n`\r\n\r\nclass EnquiryEdit extends Component {\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tthis.componentIsMounted = true\r\n\t\tthis.isNewEnquiry = props.id === 'new'\r\n\t\tconst isNewEnquiry = this.isNewEnquiry\r\n\t\tthis.state = {\r\n\t\t\tloading: false,\r\n\t\t\t// if any of the form fields has error, the following err prop should always contain non empty string error message with explanaition \r\n\t\t\terr: {\r\n\t\t\t\tmessage: ''\r\n\t\t\t},\r\n\t\t\torgDdn: {\r\n\t\t\t\tsearch: '',\r\n\t\t\t\tloading: false\r\n\t\t\t},\r\n\t\t\tmodelDdn: {\r\n\t\t\t\tsearch: '',\r\n\t\t\t\tloading: false\r\n\t\t\t},\r\n\t\t\tnewModelMode: false\r\n\t\t}\r\n\t\t// gather form fields on oriEnquiry object\r\n\t\tconst oriEnquiry = cloneDeep(props.enquiry)\r\n\t\t// console.log('props.enquiry > ', props.enquiry)\r\n\t\tif (isNewEnquiry) oriEnquiry.dateLocal = toLocalISOString(new Date()).slice(0, 10)\r\n\t\tdelete oriEnquiry.events\r\n\t\toriEnquiry.orgId = oriEnquiry.org ? oriEnquiry.org.id : null\r\n\t\toriEnquiry.modelId = oriEnquiry.model ? oriEnquiry.model.id : null\r\n\t\toriEnquiry.qty = oriEnquiry.qty ? oriEnquiry.qty : ''\r\n\t\t// console.log('oriEnquiry > ', oriEnquiry)\r\n\t\tthis.fields = Object.keys(oriEnquiry)\r\n\t\t\t.filter(key => !['__typename', 'id', 'num', 'org', 'model'].includes(key))\r\n\t\t// console.log('this.fields > ', this.fields)\r\n\t\tthis.requiredFields = ['dateLocal', 'orgId', 'modelId', 'qty']\r\n\t\t// map through form fields and write helper props\r\n\t\tthis.fields.forEach(key => {\r\n\t\t\t// console.log(key, oriEnquiry[key])\r\n\t\t\tthis.state[key] = {\r\n\t\t\t\tcurVal: oriEnquiry[key],\r\n\t\t\t\t// err bool controls weather the field is heighlighted with error (red) style\r\n\t\t\t\terr: false,\r\n\t\t\t\t...this.requiredFields.includes(key) && { required: true },\r\n\t\t\t\t...!isNewEnquiry && {\r\n\t\t\t\t\toriVal: oriEnquiry[key],\r\n\t\t\t\t\tdiff: false,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (!isNewEnquiry) this.state.diff = false\r\n\t\t// console.log(this.state)\r\n\t}\r\n\tcloseNewModelSection = () => this.setState({ newModelMode: false })\r\n\tchangeFieldValue = (field, newVal) => {\r\n\t\tconsole.log('change ', field, ' to value > ', newVal)\r\n\t\tconst fieldObj = cloneDeep(this.state[field])\r\n\t\tfieldObj.curVal = newVal\r\n\t\tfieldObj.err = false\r\n\t\tif (!this.isNewEnquiry) fieldObj.diff = fieldObj.curVal !== fieldObj.oriVal\r\n\t\tconst diff = this.fields.filter(f => f !== field).map(f => this.state[f].diff).includes(true) || fieldObj.diff\r\n\t\tthis.setState({ [field]: fieldObj, diff, err: { message: '' } })\r\n\t}\r\n\tselectDay = (pickedDate) => {\r\n\t\tif (!isValidDate(pickedDate)) return this.setState({ \r\n\t\t\tdateLocal: { ...this.state.dateLocal, err: true },\r\n\t\t\terr: { title: 'Ошибка ввода даты', message: 'Дата заявки не соответствует формату дат' } \r\n\t\t})\r\n\t\tthis.changeFieldValue('dateLocal', toLocalISOString(pickedDate).slice(0, 10))\r\n\t}\r\n\thandleOrgDropdownSearchChange = (e, { searchQuery }) => {\r\n\t\tthis.setState({ \r\n\t\t\torgDdn: { search: searchQuery, err: false },\r\n\t\t})\r\n\t}\r\n\thandleModelDropdownSearchChange = (e, { searchQuery }) => {\r\n\t\tthis.setState({ \r\n\t\t\tmodelDdn: { search: searchQuery, err: false },\r\n\t\t})\r\n\t}\r\n\thandleQtyInputChange = ( e, { value } ) => {\r\n\t\tconst newVal = parseInt(value, 10) || ''\r\n\t\tthis.changeFieldValue('qty', newVal)\r\n\t}\r\n\tselectOrg = (e, { value }) => {\r\n\t\tthis.setState({ orgDdn: { search: '', loading: false } })\r\n\t\tthis.changeFieldValue('orgId', value)\r\n\t}\r\n\tselectModel = (e, { value }) => {\r\n\t\tthis.setState({ modelDdn: { search: '', loading: false } })\r\n\t\tthis.changeFieldValue('modelId', value)\r\n\t}\r\n\tsubmitNewModel = (modelId) => {\r\n\t\tthis.changeFieldValue('modelId', modelId)\r\n\t\tthis.closeNewModelSection()\r\n\t}\r\n\tcreateOrg = async (e, { value: inn }) => {\r\n\t\ttry {\r\n\t\t\tlet err = {}\r\n\t\t\tconst isValidInn = validateInn(inn, err)\r\n\t\t\tif (!isValidInn) throw new Error(err.message)\r\n\t\t\tthis.setState({ orgDdn: { search: inn, loading: true} })\r\n\t\t\tconst data = await this.props.createOrg({ variables: { inn } })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.selectOrg(null, { value: data.data.createOrg.id } )\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Добавить организацию по ИНН не удалось..',\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t},\r\n\t\t\t\torgDdn: {\r\n\t\t\t\t\tsearch: inn,\r\n\t\t\t\t\tloading: false\r\n\t\t\t\t},\r\n\t\t\t\torgId: {\r\n\t\t\t\t\t...this.state.orgId,\r\n\t\t\t\t\terr: true\r\n\t\t\t\t}\r\n\t\t\t })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tsubmit = () => {\r\n\t\tconst enquiry = {}\r\n\t\t// take out only changed fields for update\r\n\t\tthis.fields.forEach(f => {\r\n\t\t\tif (this.isNewEnquiry || this.state[f].diff) enquiry[f] = this.state[f].curVal\r\n\t\t})\r\n\t\tconst variables = { ...enquiry }\r\n\t\tif (this.isNewEnquiry) return this.createEnquiry(variables)\r\n\t\tvariables.id = this.props.id\r\n\t\tthis.updateEnquiry(variables)\r\n\t}\r\n\tcreateEnquiry = async (variables) => {\r\n\t\ttry {\r\n\t\t\tthis.setState({ loading: true })\r\n\t\t\tconst res = await this.props.createEnquiry({ variables })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ loading: false, err: '' })\r\n\t\t\tthis.props.setDetails({\r\n\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\tid: res.data.createEnquiry.id\r\n\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tloading: false,\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Создать не удалось..',\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tupdateEnquiry = async (variables) => {\r\n\t\tconst { id, updateEnquiry, setDetails } = this.props\r\n\t\ttry {\r\n\t\t\tthis.setState({ loading: true })\r\n\t\t\tawait updateEnquiry({ variables: { input: variables } })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ loading: false, err: '' })\r\n\t\t\tsetDetails({\r\n\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\tid\r\n\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ \r\n\t\t\t\tloading: false,\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Сохранить не удалось..',\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tthis.componentIsMounted = false\r\n\t}\r\n\trender() {\r\n\t\tconst { dateLocal, orgId, orgDdn, modelId, modelDdn, qty, diff, loading, err, newModelMode } = this.state\r\n\t\tconst { id, setDetails, allOrgsAndModels } = this.props\r\n\t\tconst selectedDate = fromLocalISOString(dateLocal.curVal)\r\n\t\tconst orgs = allOrgsAndModels.orgs\r\n\t\tconst models = allOrgsAndModels.models\r\n\t\tconst requiredIsEmpty = this.requiredFields.some(f => !this.state[f].curVal)\r\n\t\tconst someFieldHasError = this.fields.some(f => !!this.state[f].err)\r\n\t\treturn (\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<Section\r\n\t\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t\t\t<Form.Field inline>\r\n\t\t\t\t\t\t\t\t\t<Label>Дата</Label>\r\n\t\t\t\t\t\t\t\t\t<DatePicker\r\n\t\t\t\t\t\t\t\t\t\terror={dateLocal.err}\r\n\t\t\t\t\t\t\t\t\t\tselectedDate={selectedDate}\r\n\t\t\t\t\t\t\t\t\t\tselectDay={this.selectDay} />\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t\t<Form.Field inline error={orgId.err} required>\r\n\t\t\t\t\t\t\t\t\t<Label>Организация</Label>\r\n\t\t\t\t\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\t\t\t\t\tloading={!orgs || orgDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={id !== 'new' || !orgs || orgDdn.loading} //org cannot be changed when editing existing enquiry\r\n\t\t\t\t\t\t\t\t\t\tselection //render as a formControl\r\n\t\t\t\t\t\t\t\t\t\tplaceholder='Поиск по наименованию или ИНН'\r\n\t\t\t\t\t\t\t\t\t\toptions={ orgs ? orgs.map(o => ({key:o.id, value: o.id, text: o.name})) : [] }\r\n\t\t\t\t\t\t\t\t\t\tvalue={orgId.curVal}\r\n\t\t\t\t\t\t\t\t\t\tonChange={this.selectOrg}\r\n\t\t\t\t\t\t\t\t\t\tselectOnBlur={false}\r\n\t\t\t\t\t\t\t\t\t\tselectOnNavigation={false}\r\n\t\t\t\t\t\t\t\t\t\tsearch\r\n\t\t\t\t\t\t\t\t\t\tsearchQuery={orgDdn.search}\r\n\t\t\t\t\t\t\t\t\t\tonSearchChange={this.handleOrgDropdownSearchChange}\r\n\t\t\t\t\t\t\t\t\t\tnoResultsMessage='Если не найдено, введите ИНН, чтобы добавить.'\r\n\t\t\t\t\t\t\t\t\t\tallowAdditions\r\n\t\t\t\t\t\t\t\t\t\tadditionLabel='Добавить по ИНН: '\r\n\t\t\t\t\t\t\t\t\t\tonAddItem={this.createOrg}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t\t{!newModelMode\r\n\t\t\t\t\t\t\t\t\t? <Form.Field\r\n\t\t\t\t\t\t\t\t\t\t\tinline\r\n\t\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\t\terror={modelId.err}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<Label>Изделие</Label>\r\n\t\t\t\t\t\t\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\t\t\t\t\t\t\tloading={!models || modelDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!models || modelDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\t\t\tselection //render as a formControl\r\n\t\t\t\t\t\t\t\t\t\t\t\tplaceholder='Поиск по наименованию или артикулу'\r\n\t\t\t\t\t\t\t\t\t\t\t\toptions={ models ? models.map(m => ({key:m.id, value: m.id, text: m.name})) : [] }\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={modelId.curVal}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.selectModel}\r\n\t\t\t\t\t\t\t\t\t\t\t\tselectOnBlur={false}\r\n\t\t\t\t\t\t\t\t\t\t\t\tselectOnNavigation={false}\r\n\t\t\t\t\t\t\t\t\t\t\t\tsearch\r\n\t\t\t\t\t\t\t\t\t\t\t\tsearchQuery={modelDdn.search}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonSearchChange={this.handleModelDropdownSearchChange}\r\n\t\t\t\t\t\t\t\t\t\t\t\tnoResultsMessage='Если не найдено, выберите \"Нет в списке\"'\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\tml='5px'\r\n\t\t\t\t\t\t\t\t\t\t\t\ticon='plus'\r\n\t\t\t\t\t\t\t\t\t\t\t\tactiveColor='green'\r\n\t\t\t\t\t\t\t\t\t\t\t\tactive={newModelMode}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => this.setState({ newModelMode: true })}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t\t\t: <SecondarySection\r\n\t\t\t\t\t\t\t\t\t\t\ttitle='Новое изделие'\r\n\t\t\t\t\t\t\t\t\t\t\tonClose={this.closeNewModelSection}\r\n\t\t\t\t\t\t\t\t\t\t\tcontent={\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ModelForm\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodel={undefined}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\torgId={orgId.curVal || undefined}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trefetchQueries={allOrgsAndModels.refetch}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSubmit={this.submitNewModel}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t\t<Label>Кол-во</Label>\r\n\t\t\t\t\t\t\t\t\t<Input type='number'\r\n\t\t\t\t\t\t\t\t\t\tplaceholder='Введите кол-во шт.' \r\n\t\t\t\t\t\t\t\t\t\tvalue={qty.curVal}\r\n\t\t\t\t\t\t\t\t\t\tonChange={this.handleQtyInputChange} />\r\n\t\t\t\t\t\t\t\t\t<Span pl='6px'>шт.</Span>\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t\t</Section>\r\n\t\t\t\t\t\t<Section>\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\thidden={!err.message}\r\n\t\t\t\t\t\t\t\theader={err.title}\r\n\t\t\t\t\t\t\t\tcontent={err.message} />\r\n\t\t\t\t\t\t\t<Div inline w='formLabel' />\r\n\t\t\t\t\t\t\t<Button \r\n\t\t\t\t\t\t\t\tprimary \r\n\t\t\t\t\t\t\t\tcontent={this.isNewEnquiry ? 'Создать' : 'Сохранить'}\r\n\t\t\t\t\t\t\t\tdisabled={(!this.isNewEnquiry && !diff) || !!err.message || someFieldHasError || !!orgId.loading || requiredIsEmpty}\r\n\t\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\t\tonClick={this.submit} />\r\n\t\t\t\t\t\t\t<A cancel \r\n\t\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\t\tid === 'new'\r\n\t\t\t\t\t\t\t\t\t? () => setDetails(null)\r\n\t\t\t\t\t\t\t\t\t: () => setDetails({\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tОтмена\r\n\t\t\t\t\t\t\t</A>\r\n\t\t\t\t\t\t</Section>\r\n\t\t\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(createOrg, { \r\n\t\tname: 'createOrg',\r\n\t\toptions: {\r\n\t\t\tupdate: (cache, {data: { createOrg }}) => {\r\n\t\t\t\tconst query = allOrgsAndModels\r\n\t\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\t\tdata.orgs.push(createOrg)\r\n\t\t\t\tdata.orgs.sort((a, b) => a.name > b.name)\r\n\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t}\r\n\t\t}\r\n\t}),\r\n\tgraphql(allOrgsAndModels, { name: 'allOrgsAndModels' }),\r\n\tgraphql(updateEnquiry, { name: 'updateEnquiry' }),\r\n\tgraphql(createEnquiry, { \r\n\t\tname: 'createEnquiry',\r\n\t\toptions: {\r\n\t\t\tupdate: (cache, {data: { createEnquiry }}) => {\r\n\t\t\t\tconst query = allEnquiries\r\n\t\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\t\tcreateEnquiry.isExpanded = false\r\n\t\t\t\tdata.enquiries.unshift(createEnquiry)\r\n\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t}\r\n\t\t}\r\n\t}),\r\n)(EnquiryEdit)","import React, { Component } from 'react'\r\n\r\nimport DayPickerInput from 'react-day-picker/DayPickerInput'\r\nimport 'react-day-picker/lib/style.css'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport { isValidDate, toLocalISOString, fromLocalISOString }from '../../utils/dates'\r\n\r\nconst PickerDiv = styled.div`\r\n\tdisplay: inline-block;\r\n\twidth: 180px;\r\n\t${props => props.err && `\r\n\t\tinput {\r\n\t\t\tcolor: #9f3a38 !important;\r\n\t\t\tbackground-color: #fff6f6 !important;\r\n\t\t\tborder-color: #e0b4b4 !important;\r\n\t\t}`\r\n\t}\r\n\tinput {\r\n\t\tcursor: pointer;\r\n\t\tvertical-align: unset !important;\r\n\t\tpadding-left: 3.5rem !important;\r\n\t\t&:focus {\r\n\t\t\tcursor: text;\r\n\t\t}\r\n\t}\r\n`\r\n\r\n// TODO logic may be deprecated (check with enremkol-dev)\r\nclass LocalDatePicker extends Component {\r\n\thandleDayChange = (pickedDate) => {\r\n\t\t// console.log('pickedDate > ', pickedDate)\r\n\t\tconst { setField, field: { name }} = this.props\r\n\t\tif (!isValidDate(pickedDate)) {\r\n\t\t\tsetField(name, {\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Ошибка ввода даты', \r\n\t\t\t\t\tmessage: 'Дата не соответствует формату ГГГГ-ММ-ДД'\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tsetField(name, {\r\n\t\t\tvalue: toLocalISOString(pickedDate).slice(0, 10)\r\n\t\t})\r\n\t}\r\n\trender() {\r\n\t\tconst { field: {curVal: value, err} } = this.props\r\n\t\treturn (\r\n\t\t\t<PickerDiv err={!!err}>\r\n\t\t\t\t<DayPickerInput\r\n\t\t\t\t\tvalue={value}\r\n\t\t\t\t\tonDayChange={this.handleDayChange}\r\n\t\t\t\t\tdayPickerProps={{\r\n\t\t\t\t\t\tfirstDayOfWeek: 1,\r\n\t\t\t\t\t\tmonth: fromLocalISOString(value)\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t</PickerDiv>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default LocalDatePicker\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport NumberFormat from 'react-number-format'\r\n\r\nimport { Input } from 'semantic-ui-react'\r\nimport { Span } from '../styled/styled-semantic'\r\n\r\nclass CurrencyInput extends Component {\r\n\trender() {\r\n\t\tconst { placeholder, field: {name, curVal: value}, setField } = this.props\r\n\t\treturn (\r\n\t\t\t<Fragment>\r\n\t\t\t\t<NumberFormat\r\n\t\t\t\t\tcustomInput={Input}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tvalue={value}\r\n\t\t\t\t\tdecimalSeparator=','\r\n\t\t\t\t\tthousandSeparator=' '\r\n\t\t\t\t\tdecimalScale={2}\r\n\t\t\t\t\tallowNegative={false}\r\n\t\t\t\t\tonValueChange={values => setField(name, {value: values.floatValue})}\r\n\t\t\t\t/>\r\n\t\t\t\t<Span pl='6px' fs='1.1rem' c='rgba(0,0,0,.87)'>₽</Span>\r\n\t\t\t\t<Span pl='9px' fs='1.1rem' ws='0.1em'>с НДС</Span>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default CurrencyInput\r\n","import { Component } from 'react'\r\n\r\nclass SmartForm extends Component {\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tthis.componentIsMounted = true\r\n\t\tthis.isNewEntity = props.isNewEntity\r\n\t\t// gather original form fields' values from provided object\r\n\t\tconst oriEntity = props.entity\r\n\t\tthis.fields = Object.keys(oriEntity)\r\n\t\tthis.requiredFields = props.requiredFields\r\n\t\t// map through form fields and write helper props\r\n\t\tthis.state = {}\r\n\t\tthis.fields.forEach(key => {\r\n\t\t\tthis.state[key] = {\r\n\t\t\t\tname: key,\r\n\t\t\t\tcurVal: oriEntity[key],\r\n\t\t\t\terr: null,\r\n\t\t\t\t...this.requiredFields.includes(key) && { required: true },\r\n\t\t\t\t...!this.isNewEntity && {\r\n\t\t\t\t\toriVal: oriEntity[key],\r\n\t\t\t\t\tdiff: false,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t// console.log(this.state)\r\n\t}\r\n\tsetField = (field, {value, err}) => {\r\n\t\t// console.log('field, value, err > ', field, value, err)\r\n\t\tthis.setState({\r\n\t\t\t[field]: {\r\n\t\t\t\t...this.state[field],\r\n\t\t\t\t...value && {\r\n\t\t\t\t\tcurVal: value,\r\n\t\t\t\t\t...!this.isNewEntity && { diff: value !== this.state[field].oriVal },\r\n\t\t\t\t},\r\n\t\t\t\terr: err || null,\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tsubmit = () => {\r\n\t\tconst entity = this.fields.reduce((entity, f) => {\r\n\t\t\tentity[f] = this.state[f].curVal\r\n\t\t\treturn entity\r\n\t\t}, {})\r\n\t\tthis.props.submit(entity)\r\n\t}\r\n\trender() {\r\n\t\tconst { children } = this.props\r\n\t\tconst requiredIsEmpty = this.requiredFields.some(f => !this.state[f].curVal)\r\n\t\tconst diff = this.isNewEntity ? null : this.fields.map(f => this.state[f].diff).includes(true)\r\n\t\tconst err = this.fields.map(f => this.state[f].err).find(err => !!err)\r\n\t\tconst state = {\r\n\t\t\tdisabled: (!this.isNewEntity && !diff) || requiredIsEmpty || !!err,\r\n\t\t\terr: err || this.props.err,\r\n\t\t\tsetField: this.setField,\r\n\t\t\tsubmit: this.submit,\r\n\t\t\tformState: this.state\r\n\t\t}\r\n\t\t// @ts-ignore\r\n\t\treturn children(state)\r\n\t}\r\n}\r\n\r\nexport default SmartForm","import React, { Component, Fragment } from 'react'\r\n\r\nimport { Header, Form, Message, Button, Divider } from 'semantic-ui-react'\r\nimport { Div, A, Label, Section } from './styled/styled-semantic'\r\n\r\nimport LocalDatePicker from './common/LocalDatePicker'\r\nimport CurrencyInput from './common/CurrencyInput'\r\nimport SmartForm from './common/SmartForm'\r\n\r\nimport { toLocalISOString } from '../utils/dates'\r\n\r\nclass EnquiryCommercialOffer extends Component {\r\n\trender() {\r\n\t\tconst { cancel, submit, loading } = this.props\r\n\t\tconst isNewCO = this.props.id === 'new'\r\n\t\tconst co = isNewCO\r\n\t\t?   {\r\n\t\t\t\tdateLocal: toLocalISOString(new Date()).slice(0, 10),\r\n\t\t\t\tamount: ''\r\n\t\t\t} \r\n\t\t:   {\r\n\t\t\t\tdateLocal: this.props.co.dateLocal,\r\n\t\t\t\tamount: this.props.co.amount\r\n\t\t\t}\r\n\t\treturn (\r\n\t\t\t<SmartForm\r\n\t\t\t\tisNewEntity={isNewCO}\r\n\t\t\t\tentity={co}\r\n\t\t\t\trequiredFields={['dateLocal', 'amount']}\r\n\t\t\t\tsubmit={submit}\r\n\t\t\t>\r\n\t\t\t\t{({\r\n\t\t\t\t\tdisabled,\r\n\t\t\t\t\terr,\r\n\t\t\t\t\tsetField,\r\n\t\t\t\t\tsubmit,\r\n\t\t\t\t\tformState: { dateLocal, amount }\r\n\t\t\t\t}) => <Fragment>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\thead\r\n\t\t\t\t\t\tminor\r\n\t\t\t\t\t\tsecondary\r\n\t\t\t\t\t\ttopBorder\r\n\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Header>\r\n\t\t\t\t\t\t\tКоммерческое предложение\r\n\t\t\t\t\t\t</Header>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\tsecondary\r\n\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t\t<Form.Field inline>\r\n\t\t\t\t\t\t\t\t<Label>Дата</Label>\r\n\t\t\t\t\t\t\t\t<LocalDatePicker\r\n\t\t\t\t\t\t\t\t\tfield={dateLocal}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t<Label>Сумма</Label>\r\n\t\t\t\t\t\t\t\t<CurrencyInput\r\n\t\t\t\t\t\t\t\t\tfield={amount}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t\tplaceholder='Введите сумму КП'\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\tsecondary\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{err &&\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\theader={err.title}\r\n\t\t\t\t\t\t\t\tcontent={err.message} \r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<Div inline w='formLabel' />\r\n\t\t\t\t\t\t<Button \r\n\t\t\t\t\t\t\tprimary \r\n\t\t\t\t\t\t\tcontent={'Создать'}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\tonClick={submit} />\r\n\t\t\t\t\t\t<A cancel onClick={cancel}>Отмена</A>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Divider fitted/>\r\n\t\t\t\t</Fragment>}\r\n\t\t\t</SmartForm>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default EnquiryCommercialOffer","import React, { Component, Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\n// TODO use List instead of entity-table\r\nimport { Table, Tr, Td, InputTd, EditorTd } from './styled/entity-table'\r\nimport { Header as SHeader, Icon, Label, Form, Comment, \r\n\tMessage, Dropdown } from 'semantic-ui-react'\r\nimport { P, Div, Button, Section } from './styled/styled-semantic'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { enquiryDetails, newEnquiry, createEnquiryEvent, \r\n\tenquiryFragment, allEnquiries, updateEnquiry } from '../graphql/enquiry'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nimport WrappedDraftEditor from './common/WrappedDraftEditor'\r\nimport { sanitize } from 'dompurify'\r\nimport { currency } from '../utils/format'\r\n\r\nimport EnquiryEdit from './Enquiry/Edit'\r\nimport EnquiryCommercialOffer from './EnquiryCommercialOffer'\r\n\r\nconst SDropdown = styled(Dropdown)`\r\n\t& .active.item {\r\n\t\tdisplay: none !important;\r\n\t}\r\n\t& .selected.item {\r\n\t\tbackground: none !important;\r\n\t}\r\n`\r\n\r\nconst Comments = styled(Comment.Group)`\r\n\tmargin: 1.5em 1.5em 1.5em 55px !important;\r\n\t/* margin: 1.5em 1.5em 1.5em 0 !important; */\r\n`\r\n\r\nconst CIcon = styled(Icon)`\r\n\t// apply horizontal offset correction for different icons to be vertically alined\r\n  width: ${props => (props.type === 'CREATE') ? '1.73em' : '1.4em' } !important;\r\n\t${props => (props.type === 'CREATE') && 'margin-left: -0.33em !important;'}\r\n  margin-top: .15em !important;\r\n\tfloat: left;\r\n\topacity: 0.6 !important;\r\n`\r\n\r\nconst UserLabel = styled(Label)`\r\n  width: 2em;\r\n  height: 2em;\r\n  margin-left: 0 !important;\r\n  padding: .4em 0em !important;\r\n  float: left;\r\n\ttext-align: center;\r\n\t${props => props.indent && 'margin-left: 42.69px !important;'}\r\n\t// ${props => props.indent && 'margin-left: calc(1.4em + 0.25rem) !important;'}\r\n`\r\n\r\nconst CContent = styled(Comment.Content)`\r\n  margin-left: 6.5em !important;\r\n`\r\n\r\nconst CMetadata = styled(Comment.Metadata)`\r\n\tmargin-left: 0 !important;\r\n  color: rgba(0,0,0,.6) !important;\r\n`\r\n\r\nconst CText = styled(Comment.Text)`\r\n\t& p { margin: 0 !important; }\r\n\t&>table { \r\n\t\twidth: 100%;\r\n\t\tborder-collapse: collapse; \r\n\t}\r\n\t&>table>tbody>tr>td {\r\n\t\tpadding-left: 4px;\r\n\t\tvertical-align: top;\r\n\t}\r\n\t&>table>tbody>tr>td:nth-child(1) {\r\n\t\twidth: 5px;\r\n\t}\r\n\t&>table>tbody>tr>td:nth-child(2) {\r\n\t\twidth: 25px;\r\n\t\tmin-width: 90px;\r\n\t}\r\n\t&>table>tbody>tr>td:nth-child(3) {\r\n\t\tpadding-left: 10px;\r\n\t\twidth: 1000px;\r\n\t\tmin-width: 240px;\r\n\t}\r\n\t&>table>tbody>tr>td>span {\r\n\t\tmargin-right: 5px;\r\n\t}\r\n`\r\n\r\nconst CMessage = styled(Message)`\r\n\tmargin-left: 6.35em !important;\r\n`\r\n\t\r\nclass EnquiryDetails extends Component {\r\n\tisNewEnquiry = this.props.id === 'new'\r\n\teditorRef = React.createRef()\r\n\tnoteEditorRef = React.createRef()\r\n\tcomponentIsMounted = true\r\n  state = {\r\n\teditMode: this.isNewEnquiry ? true : false,\r\n\t\teditorHasText: false,\r\n\t\tnoteEditorDiff: false,\r\n\t\tnoteKey: 1,\r\n\t\tactiveCO: '',\r\n\t\tloading: false,\r\n\t\tcreatingComment: false,\r\n\t\tchangingStatus: false,\r\n\t\tstatusPending: false,\r\n\t\tsavingNote: false,\r\n\t\terror: ''\r\n\t}\r\n\t// refetchEnquiry = async () => {\r\n\t// \tthis.setState({ loading: true })\r\n\t// \tconst res = await this.props.enquiryQuery.refetch()\r\n\t// \tthis.setState({ loading: false })\r\n\t// }\r\n\tenableEditMode = () => this.setState({ editMode: true })\r\n\texitEditMode = () => this.setState({ editMode: false })\r\n\tsetEditorHasText = (bool) => this.setState({ editorHasText: bool })\r\n\tsetNoteEditorDiff = (bool) => this.setState({ noteEditorDiff: bool })\r\n\tcancelEdit = () => {\r\n\t\tif (this.isNewEnquiry) return this.props.closeDetails()\r\n\t\tthis.exitEditMode()\r\n  }\r\n  createComment = async () => {\r\n\t\ttry {\r\n\t\t\tconst htmlText = this.editorRef.current.exportHtml()\r\n\t\t\t// if (htmlText === '<p><br></p>') return\r\n\t\t\tif (htmlText === null) return\r\n\t\t\tthis.setState({creatingComment: true})\r\n\t\t\tawait this.props.createEnquiryEvent({\r\n\t\t\t\tvariables: {\r\n\t\t\t\t\tenquiryId: this.props.id,\r\n\t\t\t\t\thtmlText\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.setState({ creatingComment: false, editorHasText: false, error: '' })\r\n\t\t\tthis.editorRef.current.clear()\r\n\t\t} catch(err) {\r\n\t\t\tthis.setState({ creatingComment: false, error: err.message })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tchangeStatus = async (e, { value, co }) => {\r\n\t\tconst coStatusId = this.props.enquiryQuery.statuses.find(s => s.name === 'Выставлено КП').id\r\n\t\tif (value === coStatusId) {\r\n\t\t\tif (!this.state.statusPending) return this.setState({ statusPending: true, activeCO: 'new' })\r\n\t\t\telse this.setState({ statusPending: false })\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tthis.setState({ changingStatus: true })\r\n\t\t\tawait this.props.createEnquiryEvent({\r\n\t\t\t\tvariables: {\r\n\t\t\t\t\tenquiryId: this.props.id,\r\n\t\t\t\t\tstatusId: value,\r\n\t\t\t\t\t...(co && { doc: { ...co } })\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.setState({ changingStatus: false, activeCO: '' })\r\n\t\t} catch (err) {\r\n\t\t\tthis.setState({ changingStatus: false, error: err.message })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tcancelPendingStatusChange = () => {\r\n\t\tthis.setState({ statusPending: false, activeCO: '' })\r\n\t}\r\n\tsaveNote = async () => {\r\n\t\ttry {\r\n\t\t\tlet htmlNote = this.noteEditorRef.current.exportHtml()\r\n\t\t\tif (htmlNote === this.props.enquiryQuery.enquiry.htmlNote) {\r\n\t\t\t\treturn this.setState({ noteKey: this.state.noteKey + 1, noteEditorDiff: false })\r\n\t\t\t}\r\n\t\t\tthis.setState({ savingNote: true })\r\n\t\t\tawait this.props.updateEnquiry({ \r\n\t\t\t\tvariables: { input: { id: this.props.id, htmlNote } } })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ savingNote: false, error: '', noteKey: this.state.noteKey + 1, noteEditorDiff: false })\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ savingNote: false, error: err.message })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n  render() { \r\n\t\tconst { editorHasText, creatingComment, changingStatus, statusPending, \r\n\t\t\t\terror, noteEditorDiff, noteKey, savingNote, activeCO } = this.state\r\n\t\tconst { enquiryQuery } = this.props\r\n\t\tconst isNewEnquiry = this.isNewEnquiry\r\n\t\tif (enquiryQuery.loading) return <Section>Загрузка...</Section>\r\n\t\tif (enquiryQuery.error) return <Section>Ошибка {enquiryQuery.error.message}</Section>\r\n\t\tconst enquiry = isNewEnquiry ? enquiryQuery.newEnquiry : enquiryQuery.enquiry\r\n\t\tconst { org, model, qty, htmlNote, events } = enquiry\r\n\t\tconst coEvents = events && events.filter(e => e.doc)\r\n\t\tconst curStatus = events && events.filter(e => e.status).pop().status\r\n\t\t// rawStatuses - received from server\r\n\t\tconst rawStatuses = enquiryQuery.statuses.slice()\r\n\t\tconst coStatusId = rawStatuses.find(s => s.name === 'Выставлено КП').id\r\n\t\tconst orderStatusId = rawStatuses.find(s => s.name === 'Заказ').id\r\n\t\tconst refusalStatusIds = rawStatuses.filter(s => ['Нет возможности', 'Отказ'].includes(s.name)).map(s => s.id)\r\n\t\t// sort statuses so that refusal statuses are at the end of their stage block\r\n\t\tconst statuses = rawStatuses.sort((a, b) => a.stage === b.stage && refusalStatusIds.includes(a.id))\r\n\t\tlet stage = 0\r\n\t\tconst eventStatusPresentationHelpers = events && events.reduce((res, e, i) => {\r\n\t\t\tif (!e.status || i === 0) return res = [...res, null]\r\n\t\t\tif (refusalStatusIds.includes(e.status.id)) return [...res, 'refuse']\r\n\t\t\tif (e.status.id === orderStatusId) return [...res, 'order']\r\n\t\t\tres.push(e.status.stage - stage > 0 ? 'up' : 'down')\r\n\t\t\tstage = e.status.stage\r\n\t\t\treturn res\r\n\t\t}, [])\r\n\t\treturn (\r\n\t\t\t<GlobalContext>\r\n\t\t\t\t{({ details, setDetails }) => {\r\n\t\t\t\t\tconst { id, editMode } = details\r\n\t\t\t\t\tconst isNewEnquiry = id === 'new'\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t{ (editMode || isNewEnquiry) &&\r\n\t\t\t\t\t\t\t\t<EnquiryEdit\r\n\t\t\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t\t\t\tenquiry={enquiry}\r\n\t\t\t\t\t\t\t\t\tsetDetails={setDetails}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{ !(editMode || isNewEnquiry) && <Fragment>\r\n\t\t\t\t\t\t\t\t<Section>\r\n\t\t\t\t\t\t\t\t\t<Table><tbody>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Организация</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>{org && org.name}</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Изделие</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>{model && model.name}</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Кол-во, шт.</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>{qty}</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t{ !!coEvents.length &&\r\n\t\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Td>КП</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{coEvents.map(({ doc: { id, dateLocal, amount } }) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<P key={id} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfw='normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlh='1.21428571em' >\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>{currency(amount)} </b> ( от {dateLocal} )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</P>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t\t</Tr> }\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Примечания</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<EditorTd>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<WrappedDraftEditor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={noteKey}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tborderless\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tref={this.noteEditorRef}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tinitFromHtml={htmlNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetEditorDiff={this.setNoteEditorDiff}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdiff={noteEditorDiff}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCtrlEnter={this.saveNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{noteEditorDiff &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmt='.67857143em'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent='Сохранить примечание'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabelPosition='left'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon='save'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfloated='left'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.saveNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={savingNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tloading={savingNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t</EditorTd>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Статус</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<InputTd>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<SDropdown labeled button className='icon'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tloading={changingStatus}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={changingStatus || statusPending}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={curStatus.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={curStatus.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toptions={statuses\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter(s => (s.id === curStatus.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|| Math.abs(s.stage - curStatus.stage) === 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& !(s.stage === 0 && curStatus.stage !== 0))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// && !(s.name === 'Выставлено КП'))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map(s => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey: s.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: s.name,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: s.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: { \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbasic: true, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: 'ст', \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdetail: s.stage, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon:   refusalStatusIds.includes(s.id) ? 'minus circle' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.id === orderStatusId ? 'checkmark' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`long arrow alternate ${(s.stage - curStatus.stage) > 0 ? 'up' : 'down' }`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.changeStatus} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectOnBlur={false}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectOnNavigation={false} >\r\n\t\t\t\t\t\t\t\t\t\t\t\t</SDropdown>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Label basic size='large' content='стадия' detail={ curStatus.stage} />\r\n\t\t\t\t\t\t\t\t\t\t\t</InputTd>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t</tbody></Table>\r\n\t\t\t\t\t\t\t\t</Section>\r\n\t\t\t\t\t\t\t\t{ activeCO && \r\n\t\t\t\t\t\t\t\t\t<EnquiryCommercialOffer \r\n\t\t\t\t\t\t\t\t\t\tid={activeCO} \r\n\t\t\t\t\t\t\t\t\t\tsubmit={(co) => this.changeStatus(null, { value: coStatusId, co })}\r\n\t\t\t\t\t\t\t\t\t\tcancel={this.cancelPendingStatusChange} />}\r\n\t\t\t\t\t\t\t\t<Comments minimal>\r\n\t\t\t\t\t\t\t\t\t<SHeader as='h3' dividing content='Комментарии и события' />\r\n\t\t\t\t\t\t\t\t\t{ events.map((e, i) => {\r\n\t\t\t\t\t\t\t\t\t\tconst { fName, lName } = e.user.person\r\n\t\t\t\t\t\t\t\t\t\tconst userInitials = (lName ? fName.slice(0,1) : fName.slice(0,2)) + (lName ? lName.slice(0,1) : '')\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t<Comment key={e.id}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ e.type && (e.type !== 'COMMENT') &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CIcon \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize='big' type={e.type}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor={ e.type === 'CREATE' ? 'green' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'UPDATE' ? 'blue' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'up' ? 'yellow' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'down' ? 'brown' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'refuse' ? 'red' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'order' ? 'green' : 'grey'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname ={ e.type === 'CREATE' ? 'plus' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'UPDATE' ? 'write square' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'refuse' ? 'minus circle' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'order' ? 'checkmark' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' ? `long arrow alternate ${eventStatusPresentationHelpers[i]}` : 'question'} /> }\r\n\t\t\t\t\t\t\t\t\t\t\t\t<UserLabel \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize='big' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={userInitials}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tindent={!e.type || e.type === 'COMMENT' ? 1 : 0} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t{/* <Comment.Avatar src='https://react.semantic-ui.com/images/avatar/small/matt.jpg' /> */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CContent>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* <Comment.Author \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tas='span' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={fName + ' ' + lName} /> */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CMetadata\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={e.datetimeLocal.slice(0,16)} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CText dangerouslySetInnerHTML={{__html: sanitize(e.htmlText)}} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* <Comment.Actions\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={( <a>Reply</a> )} /> */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</CContent>\r\n\t\t\t\t\t\t\t\t\t\t\t</Comment>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t<Form reply error={!!error}>\r\n\t\t\t\t\t\t\t\t\t\t<Div m='0 0 1em 6.35em'>\r\n\t\t\t\t\t\t\t\t\t\t\t<WrappedDraftEditor\r\n\t\t\t\t\t\t\t\t\t\t\t\tref={this.editorRef} \r\n\t\t\t\t\t\t\t\t\t\t\t\tsetEditorHasText={this.setEditorHasText}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonSave={this.createComment}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t\t\t\t<CMessage\r\n\t\t\t\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\t\t\t\theader='Коммент добавить не удалось..'\r\n\t\t\t\t\t\t\t\t\t\t\tcontent={error}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<Button content='Добавить коммент' labelPosition='left' icon='edit' primary floated='right' \r\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.createComment}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={!editorHasText}\r\n\t\t\t\t\t\t\t\t\t\t\tloading={creatingComment}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t\t\t\t</Comments>\r\n\t\t\t\t\t\t\t</Fragment> }\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t)\r\n\t\t\t\t}}\r\n\t\t\t</GlobalContext>\r\n\t\t)\r\n  }\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(updateEnquiry, { name: 'updateEnquiry' }),\r\n\tgraphql(createEnquiryEvent, { \r\n\t\tname: 'createEnquiryEvent',\r\n\t\toptions: (props) => ({\r\n\t\t\tupdate: (cache, {data: reponseData}) => {\r\n\t\t\t\tconst newEvent = reponseData.createEnquiryEvent\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tconst id = `Enquiry:${props.id}`\r\n\t\t\t\tconst fragment = enquiryFragment\r\n\t\t\t\tlet data = cache.readFragment({\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tfragment\r\n\t\t\t\t})\r\n\t\t\t\tdata.events.push(newEvent)\r\n\t\t\t\tcache.writeFragment({\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tfragment,\r\n\t\t\t\t\tdata\r\n\t\t\t\t})\r\n\t\t\t\t// also update allEnquiries if status changed (for EnquiryTable view update)\r\n\t\t\t\tif (! newEvent.status) return\r\n\t\t\t\tconst query = allEnquiries\r\n\t\t\t\tdata = cache.readQuery({ query })\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tconst enquiry = data.enquiries.find(e => e.id === props.id)\r\n\t\t\t\tenquiry.status = newEvent.status\r\n\t\t\t\tif (newEvent.doc) enquiry.docs.push(newEvent.doc)\r\n\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t},\r\n\t\t\t// refetchQueries:[ 'allEnquiries' ]\r\n\t\t})\r\n  }),\r\n\tgraphql(newEnquiry, { name: 'enquiryQuery', skip: (props) => props.id !== 'new' }),\r\n\tgraphql(enquiryDetails, { name: 'enquiryQuery', skip: (props) => props.id === 'new' })\r\n)(EnquiryDetails)","import React, { Component, createRef } from 'react'\r\nimport debounce from 'lodash/debounce'\r\nimport { Input } from '../styled/styled-semantic'\r\nimport { isNaN } from '../../utils/format'\r\n\r\n// INFO built-in handling of 'int' number type\r\n// TODO think about integrating other input types (currency, etc..)\r\nclass SmartInput extends Component {\r\n\tstate = {\r\n\t\tvalue: this.props.field.curVal || ''\r\n\t}\r\n\tinput = createRef()\r\n\tdebouncedSetField = debounce(value => {\r\n    const { field: { name }, setField } = this.props\r\n    setField(name, { value })\r\n\t}, 250)\r\n\twriteVal = (value) => {\r\n\t\tthis.setState({ value })\r\n\t\tthis.debouncedSetField(value)\r\n\t}\r\n\thandleInputChange = ( e, { value } ) => {\r\n\t\tif (value === '') return this.writeVal('')\r\n\t\tconst { type } = this.props\r\n\t\t// block/parse invalid integer input for 'int' input type\r\n\t\tif (type === 'int') {\r\n\t\t\tconst intVal = parseInt(value, 10)\r\n\t\t\treturn intVal && this.writeVal(intVal)\r\n\t\t}\r\n\t\treturn this.writeVal(value)\r\n\t}\r\n\t// onChanged isn't fired on input with type[\"number\"]\r\n\t// when user mixes numbers with symbols -,. for ex -> '234234,,,,,,,234'\r\n\t// so I check valueAsNumber html input attr onBlur and set error\r\n\tonBlur = () => {\r\n\t\tconst { field: { name }, setField } = this.props\r\n\t\tconst { type, valueAsNumber } = this.input.current.children[0] || {}\r\n\t\tif (type === 'number' && isNaN(valueAsNumber)) {\r\n\t\t\tsetField(name, { err: {\r\n\t\t\t\ttitle: 'Ошибка в поле \"Количество\"',\r\n\t\t\t\tmessage: 'Недопустимое значение'\r\n\t\t\t} })\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\tconst { field, setField, type, ...rest } = this.props\r\n\t\tconst { value } = this.state\r\n\t\treturn (\r\n\t\t\t<Input\r\n\t\t\t\t{...rest}\r\n\t\t\t\ttype={type === 'int' ? 'number' : (type || 'text')}\r\n\t\t\t\tvalue={value}\r\n\t\t\t\tonChange={this.handleInputChange}\r\n\t\t\t\tonBlur={this.onBlur}\r\n\t\t\t\tref={this.input}\r\n\t\t\t/>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default SmartInput\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport { Form, Button, Message } from 'semantic-ui-react'\r\nimport { Div, Span, A, Label, Section } from './styled/styled-semantic.js'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { orderLocal, upsertOrder } from '../graphql/order'\r\nimport { allEnquiries } from '../graphql/enquiry'\r\n\r\nimport { toLocalISOString } from '../utils/dates'\r\n\r\nimport LocalDatePicker from './common/LocalDatePicker'\r\nimport CurrencyInput from './common/CurrencyInput'\r\nimport SmartForm from './common/SmartForm'\r\nimport SmartInput from './common/SmartInput'\r\n\r\nclass OrderEdit extends Component {\r\n\tcomponentIsMounted = true\r\n\tisNewEntity = this.props.id === 'new'\r\n\tstate = {\r\n\t\tloading: false,\r\n\t\terr: null\r\n\t}\r\n\tsubmit = (entity) => {\r\n\t\tthis.upsertOrder({\r\n\t\t\t...entity,\r\n\t\t\t...this.isNewEntity && {\r\n\t\t\t\tenquiryId: this.props.enquiryId,\r\n\t\t\t},\r\n\t\t\t...!this.isNewEntity && {\r\n\t\t\t\tid: this.props.id,\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tupsertOrder = async (variables) => {\r\n\t\ttry {\r\n\t\t\tthis.setState({ loading: true })\r\n\t\t\tconst res = await this.props.upsertOrder({ variables })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ loading: false, err: null })\r\n\t\t\tthis.props.setDetails({\r\n\t\t\t\ttype: 'Order',\r\n\t\t\t\tid: res.data.upsertOrder.id\r\n\t\t\t})\r\n\t\t\tthis.props.setExpanded({\r\n\t\t\t\tid: res.data.upsertOrder.enquiry.id,\r\n\t\t\t\tvalue: true\r\n\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tloading: false,\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: `${this.isNewEntity ? 'Создать' : 'Сохранить'} не удалось..`,\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tthis.componentIsMounted = false\r\n\t}\r\n\trender() {\r\n\t\tconst { loading } = this.state\r\n\t\tconst { id, closeDetails, setDetails } = this.props\r\n\t\tconst isNewEntity = id === 'new'\r\n\t\tconst order = isNewEntity\r\n\t\t\t? {\r\n\t\t\t\tdateLocal: toLocalISOString(new Date()).slice(0, 10),\r\n\t\t\t\tqty: '',\r\n\t\t\t\tamount: ''\r\n\t\t\t}\r\n\t\t\t: this.props.orderLocal.orderLocal\r\n\t\treturn (\r\n\t\t\t<SmartForm\r\n\t\t\t\tisNewEntity={isNewEntity}\r\n\t\t\t\tentity={order}\r\n\t\t\t\trequiredFields={['dateLocal', 'qty', 'amount']}\r\n\t\t\t\tsubmit={this.submit}\r\n\t\t\t\terr={this.state.err}\r\n\t\t\t>\r\n\t\t\t\t{({\r\n\t\t\t\t\tdisabled,\r\n\t\t\t\t\terr,\r\n\t\t\t\t\tsetField,\r\n\t\t\t\t\tsubmit,\r\n\t\t\t\t\tformState: { dateLocal, qty, amount }\r\n\t\t\t\t}) => <Fragment>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t\t<Form.Field inline>\r\n\t\t\t\t\t\t\t\t<Label>Дата</Label>\r\n\t\t\t\t\t\t\t\t<LocalDatePicker\r\n\t\t\t\t\t\t\t\t\tfield={dateLocal}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t<Label>Кол-во</Label>\r\n\t\t\t\t\t\t\t\t<SmartInput\r\n\t\t\t\t\t\t\t\t\ttype='number'\r\n\t\t\t\t\t\t\t\t\tplaceholder='Введите кол-во шт.'\r\n\t\t\t\t\t\t\t\t\tfield={qty}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<Span pl='6px'>шт.</Span>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t<Label>Сумма</Label>\r\n\t\t\t\t\t\t\t\t<CurrencyInput\r\n\t\t\t\t\t\t\t\t\tfield={amount}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t\tplaceholder='Введите сумму заказа'\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Section>\r\n\t\t\t\t\t\t{err &&\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\theader={err.title}\r\n\t\t\t\t\t\t\t\tcontent={err.message}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<Div inline w='formLabel' />\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\tcontent={this.isNewEntity ? 'Создать' : 'Сохранить'}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\tonClick={submit}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<A cancel\r\n\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\tid === 'new'\r\n\t\t\t\t\t\t\t\t\t? closeDetails\r\n\t\t\t\t\t\t\t\t\t: () => setDetails({\r\n\t\t\t\t\t\t\t\t\t\ttype: 'Order',\r\n\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tОтмена\r\n\t\t\t\t\t\t</A>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t</Fragment>}\r\n\t\t\t</SmartForm>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(upsertOrder, {\r\n\t\t\tname: 'upsertOrder',\r\n\t\t\toptions: {\r\n\t\t\t\tupdate: (cache, { data: responseData }) => {\r\n\t\t\t\t\tconst upsertedOrder = responseData.upsertOrder\r\n\t\t\t\t\tconst query = allEnquiries\r\n\t\t\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\t\t\tconst enquiry = data.enquiries.find(e => e.id === upsertedOrder.enquiry.id)\r\n\t\t\t\t\tenquiry.orders = [\r\n\t\t\t\t\t\t...enquiry.orders.filter(o => o.id !== upsertedOrder.id),\r\n\t\t\t\t\t\tupsertedOrder\r\n\t\t\t\t\t].sort((a, b) => a.fullnum > b.fullnum ? 1 : -1)\r\n\t\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}),\r\n\tgraphql(orderLocal, {\r\n\t\tname: 'orderLocal',\r\n\t\tskip: (props) => props.id === 'new'\r\n\t}),\r\n)(OrderEdit)","import React, { Component } from 'react'\r\n\r\nimport DetailsHeaderContainer from './DetailsHeaderContainer'\r\nimport DetailsHeaderTitle from './DetailsHeaderTitle'\r\nimport DetailsHeaderButtons from './DetailsHeaderButtons'\r\n\r\nclass DetailsHeader extends Component {\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tbuttons,\r\n\t\t\tsize,\r\n\t\t\tnoIndent,\r\n\t\t\tbottomBorder,\r\n\t\t\ttitle,\r\n\t\t\tsubtitle,\r\n\t\t\ttitleSize,\r\n\t\t\tonClick,\r\n\t\t\t// expandable\r\n\t\t\texpanded,\r\n\t\t} = this.props\r\n\t\treturn (\r\n\t\t\t<DetailsHeaderContainer\r\n\t\t\t\texpanded={expanded}\r\n\t\t\t\tonClick={onClick}\r\n\t\t\t\tsize={size}\r\n\t\t\t\tnoIndent={noIndent}\r\n\t\t\t\tbottomBorder={bottomBorder}\r\n\t\t\t>\r\n\t\t\t\t<DetailsHeaderTitle\r\n\t\t\t\t\ttitle={title}\r\n\t\t\t\t\tsubtitle={subtitle}\r\n\t\t\t\t\tsize={titleSize || size}\r\n\t\t\t\t/>\r\n\t\t\t\t{ buttons &&\r\n\t\t\t\t\t<DetailsHeaderButtons>\r\n\t\t\t\t\t\t{buttons}\r\n\t\t\t\t\t</DetailsHeaderButtons>\r\n\t\t\t\t}\r\n\t\t\t</DetailsHeaderContainer>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default DetailsHeader\r\n","import React, { Component } from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Section, Div } from './styled/styled-semantic';\r\n\r\nimport DetailsHeader from './DetailsHeader'\r\nimport posed, { PoseGroup } from 'react-pose'\r\n\r\nconst OuterSection = styled(Section)`\r\n  & {\r\n    width: 100%;\r\n    padding: 0;\r\n    ${props => props.expanded && `{\r\n      margin-top: -1px;\r\n      border-bottom-color: rgba(34, 36, 38, 0.15);\r\n    }`}\r\n  }\r\n`\r\n\r\nconst InnerSection = styled(posed(Section)({\r\n  enter: { y: 0 },\r\n  exit: { y: '-100%' },\r\n}))`\r\n  & {\r\n    z-index: -1;\r\n    width: 100%;\r\n    padding: 0;\r\n    margin-bottom: -1px;\r\n  }\r\n`\r\n\r\nclass CollapsableSection extends Component {\r\n  state = {\r\n    expanded: !!this.props.initiallyExpanded\r\n  }\r\n  expand = () => this.setState({ expanded: true })\r\n  render() {\r\n    const {\r\n\r\n      children,\r\n      disabled,\r\n      forceExpanded,\r\n      ...headerProps\r\n    } = this.props\r\n    const expanded = !disabled && (forceExpanded || this.state.expanded)\r\n    return (\r\n      <OuterSection\r\n        expanded={expanded ? 1 : 0}\r\n        topBorder={expanded}\r\n        bottomBorder={expanded}\r\n      >\r\n        <DetailsHeader\r\n          {...headerProps}\r\n          expanded={expanded}\r\n          bottomBorder={expanded && 'dark'}\r\n          disabled={forceExpanded}\r\n          titleSize='small'\r\n          onClick={\r\n            !forceExpanded\r\n            && (() => this.setState({ expanded: !this.state.expanded }))\r\n          }\r\n        />\r\n        <Div\r\n          oy='hidden'\r\n        >\r\n          <PoseGroup>\r\n            {expanded &&\r\n              <InnerSection\r\n                key={1}\r\n              >\r\n                {children}\r\n              </InnerSection>\r\n            }\r\n          </PoseGroup>\r\n        </Div>\r\n      </OuterSection>\r\n    )\r\n  }\r\n}\r\n\r\nexport default CollapsableSection\r\n","import _ from 'lodash'\r\n\r\nconst ProdsByDept = ({\r\n    children,\r\n    prods: oriProds,\r\n    // extra\r\n    selectedIds,\r\n    orderId,\r\n    selectLimit,\r\n    // order\r\n    selectedProds = [],\r\n    orderProdsQty,\r\n    diff, //diff mode\r\n    // epxpand\r\n    expandedIds,\r\n    expanded\r\n}) => {\r\n  const modes = {\r\n    ...orderId && { extra: true },\r\n    ...orderId && selectLimit === selectedIds.length && { limitReached: true },\r\n    ...!orderId && { order: true },\r\n    ...diff && { diff: true },\r\n    ...expandedIds && { expand: true },\r\n    ...expanded && { expanded: true },\r\n  }\r\n  const allProds =\r\n    modes['extra'] ? oriProds :\r\n    modes['order'] ? _.unionBy(oriProds, selectedProds, 'id') : []\r\n  const depts = _(allProds)\r\n    .sortBy('dept.type')\r\n    .groupBy('dept.name')\r\n    .reduce(function(depts, prods) {\r\n      let dept = { ...prods[0].dept }\r\n      dept = {\r\n        ...dept,\r\n        count: prods.length,\r\n        readyCount: prods.filter(p => p.progress === 100).length,\r\n        hasDefect: prods.filter(p => p.hasDefect).length,\r\n        isSpoiled: prods.filter(p => p.isSpoiled).length,\r\n        ...modes['expand'] && {\r\n          expanded: expandedIds.some(id => id === dept.id)\r\n        },\r\n        ...modes['expanded'] && {\r\n          expanded: true\r\n        },\r\n        prods: prods.map(p => {\r\n          let prod = {\r\n            ...p,\r\n            ...modes['extra'] && {\r\n              selected: selectedIds.includes(p.id),\r\n              ordered: !!p.order && p.order.id !== orderId\r\n            },\r\n            ...modes['order'] && modes['diff'] && {\r\n              added: !oriProds.some(op => op.id === p.id),\r\n              removed: !selectedProds.some(sp => sp.id === p.id),\r\n            },\r\n          }\r\n          if (modes['extra']) {\r\n            prod = {\r\n              ...prod,\r\n              disabled:\r\n                prod.ordered\r\n                || (modes['limitReached'] && !prod.selected)\r\n            }\r\n          }\r\n          return prod\r\n        }),\r\n      }\r\n      if (modes['extra']) {\r\n        const orderedCount = dept.prods.filter(p => p.ordered).length || 0\r\n        dept = {\r\n          ...dept,\r\n          selectedCount: dept.prods.filter(p => p.selected).length || 0,\r\n          orderedCount,\r\n          availCount: dept.count - orderedCount\r\n        }\r\n        dept = {\r\n          ...dept,\r\n          selected:\r\n            dept.selectedCount === dept.availCount ? true :\r\n            dept.selectedCount === 0 ? false :\r\n            'partly'\r\n        }\r\n        dept = {\r\n          ...dept,\r\n          disabled:\r\n            dept.prods.every(p => p.disabled)\r\n            || (modes['limitReached'] && [false].includes(dept.selected))\r\n        }\r\n      }\r\n      depts.push(dept)\r\n      return depts\r\n    }, [])\r\n  if (modes['order']) {\r\n    const unreservedProdsCount = diff\r\n      ? orderProdsQty - selectedProds.length\r\n      : orderProdsQty - oriProds.length\r\n    if (unreservedProdsCount) {\r\n      depts.unshift({\r\n        id: 'unreserved',\r\n        name: 'Без резерва',\r\n        count: unreservedProdsCount,\r\n        prods: []\r\n      })\r\n    }\r\n  }\r\n  const xor = !!_.xorBy(oriProds, selectedProds, 'id').length\r\n  // console.log('depts > ', depts)\r\n  return children({ depts, xor })\r\n}\r\n\r\nexport default ProdsByDept\r\n","import React, { Fragment } from 'react'\r\n\r\nimport cloneDeep from 'lodash/cloneDeep'\r\n\r\nimport Table from './common/Table'\r\nimport TableRow from './common/TableRow'\r\n\r\nconst defaultFields = [{\r\n\tname: 'name',\r\n\tpath: 'name',\r\n\ttitle: 'Участок / № Изделия',\r\n\twidth: '170px'\r\n},{\r\n\tname: 'progress',\r\n\tpath: 'progress',\r\n\ttitle: 'Заверш.',\r\n\twidth: '65px'\r\n},{\r\n\tname: 'hasDefect',\r\n\tpath: 'hasDefect',\r\n\ttitle: 'Отклон.',\r\n\twidth: '65px'\r\n},{\r\n\tname: 'isSpoiled',\r\n\tpath: 'isSpoiled',\r\n\ttitle: 'Брак',\r\n\twidth: '55px'\r\n},{\r\n\tname: 'reserve',\r\n\ttitle: 'Резерв',\r\n\twidth: '75px'\r\n}]\r\n\r\nconst DeptProdTable = ({\r\n\t// data\r\n\tdepts,\r\n\tskipFields = [],\r\n\t// methods\r\n\tselect,\r\n\texpand,\r\n\t// visual\r\n\tindent,\r\n\tnameFieldWidth\r\n}) => {\r\n\tconst fields = cloneDeep(defaultFields)\r\n\tif (nameFieldWidth) fields.find(f => f.name === 'name').width = nameFieldWidth\r\n\treturn (\r\n\t\t<Table\r\n\t\t\tfields={fields.filter(f => !skipFields.includes(f.name))}\r\n\t\t\tindent={indent}\r\n\t\t\tselect={select}\r\n\t\t\texpand={expand}\r\n\t\t>\r\n\t\t\t{({ tableFields }) => <Fragment>\r\n\t\t\t\t{depts.map(dept => {\r\n\t\t\t\t\t\tconst { id, expanded } = dept\r\n\t\t\t\t\t\tif (id === 'unreserved') return (\r\n\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t// bold\r\n\t\t\t\t\t\t\t\tentity={dept}\r\n\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\trowFields={[\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tname: 'name',\r\n\t\t\t\t\t\t\t\t\t\tvalue: dept.name + ' ('+ dept.count + ')'\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<Fragment\r\n\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\tentity={dept}\r\n\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\texpandFor='prods'\r\n\t\t\t\t\t\t\t\t\texpanded={expanded}\r\n\t\t\t\t\t\t\t\t\texpand={() => expand(id)}\r\n\t\t\t\t\t\t\t\t\tonClick={() => expand(id)}\r\n\t\t\t\t\t\t\t\t\tselect={() => select(id)}\r\n\t\t\t\t\t\t\t\t\trowFields={[\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'name',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: dept.name + ' ('+ dept.count + ')'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'progress',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'readyCount',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'checkmark',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'green'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'warning sign',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'orange'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'broken chain',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'red'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'reserve',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'orderedCount',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'gavel',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'brown'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t{\texpanded && dept.prods.map((prod, i) => {\r\n\t\t\t\t\t\t\t\t\tconst { id, progress, order, added, removed } = prod\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\t\t\tsecondary={1}\r\n\t\t\t\t\t\t\t\t\t\t\tlastSecondaryRow={i === dept.prods.length - 1 ? 1 : 0}\r\n\t\t\t\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t\t\t\tentity={prod}\r\n\t\t\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\t\t\tselect={() => select(id)}\r\n\t\t\t\t\t\t\t\t\t\t\trowFields={[\r\n\t\t\t\t\t\t\t\t\t\t\t\t...(added || removed) ? [{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'service',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: added ? 'plus' : 'minus',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonColor: added ? 'green' : 'red'\r\n\t\t\t\t\t\t\t\t\t\t\t\t}] : [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'name',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'fullnumber'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'progress',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: progress && progress + '%'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: 'warning sign',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonColor: 'orange'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: 'broken chain',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonColor: 'red'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'reserve',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: order && order.fullnum,\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t\t\t\t// active={}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={select && (() => select(id))}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t})}\r\n\t\t\t</Fragment>}\r\n\t\t</Table>\r\n\t\t// {/* {name} <ProdQtyLabel color='grey' basic content={`${prods.length}шт`} /> */}\r\n\t)\r\n}\r\n\r\nexport default DeptProdTable","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Button } from './styled/styled-semantic'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nconst IconRight = styled(Icon)`\r\n  &&&& { margin: 0 -.42857143em 0 .42857143em; }\r\n`\r\n\r\nconst ReserveProdsButton = ({ modelId, orderId, prodIds }) => {\r\n  return (\r\n    <GlobalContext>\r\n      {({ extra, setExtra, setSelectedProdIds }) => (\r\n        <Button compact circular menu\r\n          activeColor='green'\r\n          active={!!extra}\r\n          onClick={e => {\r\n            e.stopPropagation()\r\n            setSelectedProdIds(prodIds)\r\n            setExtra({\r\n              type: 'Store',\r\n              modelId,\r\n              orderId\r\n            })\r\n          }}\r\n        >\r\n          <Icon name='gavel' />\r\n          Резервирование\r\n          <IconRight name='angle right' />\r\n        </Button>\r\n      )}\r\n    </GlobalContext>\r\n  )\r\n}\r\n\r\nexport default ReserveProdsButton","import gql from 'graphql-tag'\r\n\r\nexport const modelProds = gql`\r\n\tquery ModelProds ($modelId: ID!) {\r\n\t\tmodelProds (modelId: $modelId) {\r\n\t\t\tid\r\n\t\t\tfullnumber,\r\n      hasDefect,\r\n      isSpoiled,\r\n      progress,\r\n\t\t\tdept {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\ttype\r\n\t\t\t}\r\n\t\t\torder {\r\n\t\t\t\tid\r\n\t\t\t\tfullnum\r\n\t\t\t\tenquiry {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tnum\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\nexport const prodsLocal = gql`\r\n\tquery ProdsLocal ($ids: [ID!]!) {\r\n\t\tprodsLocal (ids: $ids) {\r\n\t\t\tid\r\n\t\t\tfullnumber,\r\n      hasDefect,\r\n      isSpoiled,\r\n      progress,\r\n\t\t\tdept {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\ttype\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n","import { compose, graphql } from 'react-apollo'\r\nimport { prodsLocal } from '../../graphql/prod'\r\n\r\nconst ProdContext = ({\r\n\tchildren,\r\n\tprodsLocal: { prodsLocal }\r\n}) => {\r\n  return children({\r\n\t\tprodsLocal: prodsLocal || [],\r\n\t})\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(prodsLocal, { name: 'prodsLocal' }),\r\n)(ProdContext)\r\n","import React, { Fragment } from 'react'\r\n\r\nimport { Mutation } from 'react-apollo'\r\nimport { reserveProds } from '../graphql/order'\r\n\r\nimport { Section, Button, Message } from './styled/styled-semantic'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\nimport CollapsableSection from './CollapsableSection'\r\nimport ProdsByDept from './ProdsByDept';\r\nimport DeptProdTable from './DeptProdTable';\r\nimport ReserveProdsButton from './ReserveProdsButton'\r\n// import ListProvider from './special/ListProvider'\r\nimport ProdContext from './special/ProdContext'\r\n\r\nconst ModelProdsSection = ({\r\n  order: { id, model, qty, prods }\r\n}) => {\r\n  return (\r\n    <GlobalContext>\r\n      {({ extra, setExtra, selectedProdIds }) => (\r\n        <CollapsableSection\r\n          forceExpanded={!!extra}\r\n          title={model.name}\r\n          subtitle={qty + 'шт'}\r\n          buttons={\r\n            <ReserveProdsButton\r\n              modelId={model.id}\r\n              orderId={id}\r\n              prodIds={prods.map(p => p.id)}\r\n            />\r\n          }\r\n        >\r\n            <ProdContext\r\n              ids={selectedProdIds}\r\n            >\r\n              {({ prodsLocal: selectedProds }) =>\r\n                <ProdsByDept\r\n                  prods={prods}\r\n                  selectedProds={selectedProds}\r\n                  orderProdsQty={qty}\r\n                  expanded\r\n                  diff={!!extra}\r\n                >\r\n                  {({ depts, xor }) =>\r\n                    <Fragment>\r\n                      <DeptProdTable\r\n                        depts={depts}\r\n                        skipFields={['reserve']}\r\n                        expand={() => null}\r\n                        indent='32px'\r\n                        nameFieldWidth='200px'\r\n                      />\r\n                      {extra && \r\n                      <Mutation\r\n                        mutation={reserveProds}\r\n                        variables={{\r\n                          orderId: id,\r\n                          prodIds: selectedProdIds\r\n                        }}\r\n                      >\r\n                        {( reserveProds, { loading, error }) => \r\n                          <Fragment>\r\n                            <Section\r\n                              minor\r\n                              head\r\n                              topBorder='dark'\r\n                            >\r\n                              <Button\r\n                                primary\r\n                                compact\r\n                                circular\r\n                                menu\r\n                                ml='0'\r\n                                content='Резервировать'\r\n                                icon='gavel'\r\n                                loading={loading}\r\n                                disabled={!xor}\r\n                                onClick={() => {\r\n                                  reserveProds()\r\n                                  setExtra(null)\r\n                                }}\r\n                              />\r\n                            </Section>\r\n                            {error &&\r\n                              <Message\r\n                                section\r\n                                error\r\n                                header='Зарезервировать не удалось..'\r\n                                content={error.message}\r\n                              />\r\n                            }\r\n                          </Fragment>\r\n                        }\r\n                      </Mutation>\r\n                      }\r\n                    </Fragment>\r\n                  }\r\n                </ProdsByDept>\r\n              }\r\n            </ProdContext>\r\n          {/* {!extra && \r\n            <ListProvider>\r\n              {({ list: selectedIds, setList: setSelectedProdIds}) =>\r\n                <ProdsByDept\r\n                  prods={prods}\r\n                  selectedIds={selectedIds}\r\n                  orderProdsQty={qty}\r\n                >\r\n                  {({ depts }) =>\r\n                    <DeptProdTable\r\n                      depts={depts}\r\n                      setSelectedProdIds={setSelectedProdIds}\r\n                      skipFields={['reserve']}\r\n                    />\r\n                  }\r\n                </ProdsByDept>\r\n              }\r\n            </ListProvider>\r\n          } */}\r\n        </CollapsableSection>\r\n      )}\r\n    </GlobalContext>\r\n  )\r\n}\r\n\r\nexport default ModelProdsSection\r\n","import React from 'react'\r\n\r\nimport ModelProdsSection from './ModelProdsSection'\r\n\r\nconst OrderDetails = ({ order }) => {\r\n  return (\r\n    <ModelProdsSection\r\n      order={order}\r\n    />\r\n  )\r\n}\r\n\r\nexport default OrderDetails","import React from 'react'\r\n\r\nimport { SortableElement } from 'react-sortable-hoc'\r\n\r\nimport styled from 'styled-components'\r\nimport posed from 'react-pose'\r\nimport { Icon } from '../../../styled/styled-semantic';\r\n\r\nconst AspectRatioDiv = styled.div`\r\n  position: relative;\r\n  width: 100%;\r\n  padding-top: ${props => 100/props.proportion}%;\r\n  margin-bottom: 3px;\r\n`\r\n\r\nconst Container = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: rgba(0,0,50,.03);\r\n`\r\n\r\nconst ImgSpacer = posed.div({\r\n  shrinked: {\r\n    width:  'calc(100% - 60px)',\r\n    height: ({ proportion }) => `calc(100% - 60px/${proportion})`,\r\n  },\r\n  fullsize: {\r\n    width: '100%',\r\n    height: '100%',\r\n  }\r\n})\r\n\r\nconst Image = styled.img`\r\n  width: 100%;\r\n  height: 100%;\r\n`\r\n\r\nconst Mask = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  cursor: pointer;\r\n  transition: background-image .135s cubic-bezier(0.0,0.0,0.2,1);\r\n  :hover {\r\n    background-image: linear-gradient(to bottom,rgba(0,0,0,0.26),transparent 56px,transparent);\r\n  }\r\n  ${props => props.hide && `\r\n    background-image: unset !important;\r\n  `}\r\n  ${props => props.off && `\r\n    display: none;\r\n  `}\r\n`\r\n\r\nconst CheckBox = styled(Icon)`\r\n  position: absolute;\r\n  top: 7px;\r\n  left: 10px;\r\n  color: white;\r\n  &&& {\r\n    opacity: ${props => \r\n      props.active ? '1 !important' :\r\n      props.selectMode ? '.5 !important' : '0'};\r\n  }\r\n  ${Mask}:hover && {\r\n    opacity: ${props => props.selectMode ? '1 !important' : '.5'};\r\n  }\r\n`\r\n\r\nconst Check = styled(Icon)`\r\n  position: absolute;\r\n  left: 5px;\r\n  top: 4px;\r\n  &&& {\r\n    opacity: ${props => props.active ? '.9 !important' : '0'};\r\n    :hover {\r\n      opacity: .5 !important;\r\n    }\r\n  }\r\n  ${Mask}:hover && {\r\n    opacity: ${props => \r\n      props.active ? '.9 !important' :\r\n      props.selectMode ? '.5 !important' : '.2'};\r\n  }\r\n`\r\n\r\nexport default SortableElement(({\r\n  drawing: { id, files },\r\n  toggleSelection,\r\n  selected,\r\n  selectMode,\r\n  sortMode\r\n}) => {\r\n  const oriImage = files.find(f => f.imgFor === 'ORIGINAL')\r\n  const image = files.find(f => f.imgFor === 'FEED_792') || oriImage\r\n  const { path, width, height} = image\r\n  const proportion = width/height\r\n  return (<div>\r\n    <AspectRatioDiv\r\n      proportion={proportion}\r\n    >\r\n      <Container>\r\n        <Mask\r\n          hide={selected}\r\n          off={sortMode}\r\n          onClick={() => {\r\n            // deselect drawing if selected, select if in the selectMode\r\n            if (selected || selectMode) return toggleSelection(id)\r\n            // otherwise open fullsize image in new tab\r\n            const win = window.open(oriImage.path, '_blank')\r\n            win.focus()\r\n          }}\r\n        >\r\n          <CheckBox\r\n            link\r\n            name='square'\r\n            size='big'\r\n            fs='2.2em'\r\n            active={selected}\r\n            d={sortMode ? 'none !important' : undefined}\r\n            selectMode={selectMode}\r\n            color={selected ? 'grey' : undefined}\r\n          >\r\n            <Check\r\n              link\r\n              name='check'\r\n              size='small'\r\n              color='black'\r\n              c={selected ? '#fff !important' : undefined}\r\n              active={selected}\r\n              selectMode={selectMode}\r\n              onClick={e => {\r\n                e.stopPropagation()\r\n                toggleSelection(id)\r\n              }}\r\n            />\r\n          </CheckBox>\r\n        </Mask>\r\n        <ImgSpacer\r\n          pose={(selected || sortMode) ? 'shrinked' : 'fullsize'}\r\n          proportion={proportion}\r\n          onClick={() => selected && toggleSelection(id)}\r\n        >\r\n          <Image\r\n            src={path}\r\n            width={width}\r\n            height={height}\r\n          />\r\n        </ImgSpacer>\r\n      </Container>\r\n    </AspectRatioDiv></div>\r\n  )\r\n})\r\n","import React from 'react'\r\nimport { SortableContainer } from 'react-sortable-hoc'\r\nimport Drawing from './Drawing'\r\n\r\nexport default SortableContainer(({\r\n  drawings,\r\n  toggleDrawingSelection,\r\n  selectedDrawings,\r\n  sortMode\r\n}) => {\r\n  return (\r\n    <div>\r\n      {drawings.map((drw, i) =>\r\n        <Drawing\r\n          key={drw.id}\r\n          index={i}\r\n          drawing={drw}\r\n          toggleSelection={toggleDrawingSelection}\r\n          selected={!!selectedDrawings.includes(drw.id)}\r\n          selectMode={!!selectedDrawings.length}\r\n          sortMode={sortMode}\r\n          disabled={!sortMode}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n})\r\n\r\n","import { Component } from 'react'\r\nimport produce from 'immer'\r\n// import memoize from 'memoize-one'\r\n\r\nexport default class SortedCollectionProvider extends Component {\r\n  // sort = () => {\r\n  //   const { collection, sortBy } = this.props\r\n  //   return collection.sort((a, b) => a[sortBy] < b[sortBy] ? -1 : 1)\r\n  // }\r\n  // sort = memoize(watchedVar => {\r\n  //   const { collection, sortBy } = this.props\r\n  //   return this.setState({\r\n  //     sortedCollection: collection.sort((a, b) => a[sortBy] < b[sortBy] ? -1 : 1)\r\n  //   })\r\n  // })\r\n  state = {\r\n    sortedCollection: []\r\n  }\r\n  static getDerivedStateFromProps(props, state) {\r\n    if( props.collection !== state.prevPropsCollection) {\r\n      console.log(' > getDerivedStateFromProps')\r\n      const { collection, sortBy } = props\r\n      return {\r\n        prevPropsCollection: collection,\r\n        sortedCollection: collection.sort((a, b) => a[sortBy] < b[sortBy] ? -1 : 1)\r\n      }\r\n    }\r\n    return null\r\n  }\r\n  move = ( oldIndex, newIndex ) => {\r\n    this.setState(produce(draft => {\r\n      const [ removed ] = draft.sortedCollection.splice(oldIndex, 1)\r\n      draft.sortedCollection.splice(newIndex, 0, removed)\r\n    }))\r\n  }\r\n  render() {\r\n    const { children } = this.props\r\n    const { sortedCollection } = this.state\r\n    return children({\r\n      sortedCollection,\r\n      move: this.move\r\n    })\r\n  }\r\n}\r\n","import { Component } from 'react'\r\nimport { produce } from 'immer'\r\n\r\nexport default class StatefulList extends Component {\r\n  state = {\r\n    list: []\r\n  }\r\n  toggle = item => {\r\n    this.setState(produce(draft => {\r\n      console.log('draft > ', draft)\r\n      const index = draft.list.indexOf(item)\r\n      if (index !== -1) draft.list.splice(index, 1)\r\n        else draft.list.push(item)\r\n    }))\r\n  }\r\n  clear = () => this.setState({ list: [] })\r\n  removeMany = items => {\r\n    this.setState(({ list }) => ({\r\n      list: [ ...list.filter(i => !items.includes(i)) ]\r\n    }))\r\n  }\r\n  render() {\r\n    return this.props.children({\r\n      list: this.state.list,\r\n      toggle: this.toggle,\r\n      clear: this.clear,\r\n      removeMany: this.removeMany,\r\n    })\r\n  }\r\n}","import { Component } from 'react'\r\n\r\nexport default class StatefulBool extends Component {\r\n  state = {\r\n    bool: false\r\n  }\r\n  toggle = () => {\r\n    this.setState(({ bool }) => ({ bool: !bool }))\r\n  }\r\n  enable = () => this.setState({ bool: true })\r\n  disable = () => this.setState({ bool: false })\r\n  render() {\r\n    return this.props.children({\r\n      bool: this.state.bool,\r\n      toggle: this.toggle,\r\n      enable: this.enable,\r\n      disable: this.disable,\r\n    })\r\n  }\r\n}","import React, { Component } from 'react'\r\n\r\nimport { Mutation } from 'react-apollo'\r\nimport { createDrawings, deleteDrawings, setDrawingsSortOrder } from '../../../graphql/drawing'\r\n\r\nimport { NotificationsConsumer } from '../../notifications/NotificationsContext'\r\n\r\nimport Dropzone from 'react-dropzone'\r\n\r\nimport styled from 'styled-components'\r\nimport posed, { PoseGroup } from 'react-pose'\r\nimport { Loader } from 'semantic-ui-react'\r\nimport { Icon, Button, Span } from '../../styled/styled-semantic'\r\nimport CollapsableSection from '../../CollapsableSection'\r\nimport SortableDrawingsList from './Drawings/Sortable'\r\nimport SortedCollectionProvider from './Drawings/SortedCollectionProvider'\r\nimport StatefulList from '../../special/StatefulList'\r\nimport StatefulBool from '../../special/StatefulBool'\r\n\r\nconst DropzoneArea = styled.div`\r\n  position: relative;\r\n  :focus {\r\n    outline: none;\r\n  }\r\n`\r\n\r\nconst DropzoneOverlay = styled(posed.div({\r\n  enter: { opacity: 1 },\r\n  exit: { opacity: 0 },\r\n}))`\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  z-index: 2;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: rgba(0,0,0,.65);\r\n`\r\n\r\nconst MenuOverlay = styled(posed.div({\r\n  enter: { opacity: 1 },\r\n  exit: { opacity: 0 },\r\n}))`\r\n  position: absolute;\r\n  z-index: 1;\r\n  top: 1px;\r\n  right: 0;\r\n  left: 0;\r\n  height: 48px;\r\n  display: flex;\r\n  align-items: center;\r\n  background-color: rgba(255,255,255,1);\r\n`\r\n\r\nconst MenuLeftIcon = styled(Icon)`\r\n  &&& {\r\n\t\tbox-sizing: content-box;\r\n\t\twidth: calc(55px - 1em);\r\n\t\tmargin: 0 0.5em;\r\n\t}\r\n`\r\n\r\nexport default class Drawings extends Component {\r\n  render() {\r\n    console.log('> Drawings render')\r\n    const { model, sidebarRef } = this.props\r\n    const { id: modelId, drawings } = model\r\n    return (\r\n      <NotificationsConsumer>\r\n        {({ notify }) =>\r\n          <Mutation\r\n            mutation={createDrawings}\r\n            onCompleted={() => notify({\r\n              type: 'success',\r\n              title: 'Файлы успешно загружены'\r\n            })}\r\n            onError={err => notify({\r\n              type: 'error',\r\n              title: 'Ошибка загрузки файлов',\r\n              content: err.message,\r\n            })}\r\n          >\r\n            {(createDrawings, { loading: creating, client }) =>\r\n              <Mutation\r\n                mutation={deleteDrawings}\r\n                onCompleted={() => notify({\r\n                  type: 'success',\r\n                  title: 'Файлы удалены'\r\n                })}\r\n                onError={err => notify({\r\n                  type: 'error',\r\n                  title: 'Ошибка удаления файлов',\r\n                  content: err.message,\r\n                })}\r\n              >\r\n                {(deleteDrawings, { loading: deleting }) =>\r\n                  <Mutation\r\n                    mutation={setDrawingsSortOrder}\r\n                    onCompleted={() => notify({\r\n                      type: 'success',\r\n                      content: 'Новый порядок чертежей установлен'\r\n                    })}\r\n                    onError={err => notify({\r\n                      type: 'error',\r\n                      title: 'Ошибка сортировки',\r\n                      content: err.message,\r\n                    })}\r\n                  >\r\n                    {(setDrawingsSortOrder, { loading: sorting }) =>\r\n                      <SortedCollectionProvider\r\n                        collection={drawings}\r\n                        sortBy='sortOrder'\r\n                      >\r\n                        {({ sortedCollection: drawings, move: moveDrawing }) =>\r\n                          <StatefulList>\r\n                            {({\r\n                              list: selectedDrawings,\r\n                              toggle: toggleDrawingSelection,\r\n                              clear: deselectAllDrawings,\r\n                              removeMany: deselectManyDrawings\r\n                            }) =>\r\n                              <StatefulBool>\r\n                                {({\r\n                                  bool: sortMode,\r\n                                  enable: enableSortMode,\r\n                                  disable: disableSortMode\r\n                                }) =>\r\n                                  <Dropzone\r\n                                    disabled={sortMode}\r\n                                    onDrop={async (acceptedFiles) => {\r\n                                      console.log('acceptedFiles > ', acceptedFiles)\r\n                                      if (!acceptedFiles.length) return\r\n                                      const res = await createDrawings({\r\n                                        variables: {\r\n                                          modelId,\r\n                                          files: acceptedFiles\r\n                                        }\r\n                                      })\r\n                                      if (!res) return\r\n                                      const { data } = res\r\n                                      client.writeData({\r\n                                        id: `Model:${modelId}`,\r\n                                        data: {\r\n                                          ...model,\r\n                                          drawings: [\r\n                                            ...drawings,\r\n                                            ...data.createDrawings\r\n                                          ]\r\n                                        }\r\n                                      })\r\n                                      this.collapsableSection.expand()\r\n                                    }}\r\n                                    disableClick\r\n                                    accept='image/jpeg, image/png'\r\n                                    onDropRejected={() => notify({\r\n                                      type: 'error',\r\n                                      title: 'Недопустимый формат файла',\r\n                                      content: 'Поддерживаются только изображения .jpeg или .png',\r\n                                    })}\r\n                                  >\r\n                                    {({\r\n                                      getRootProps,\r\n                                      getInputProps,\r\n                                      open: openFileDialog,\r\n                                      isDragActive,\r\n                                    }) =>\r\n                                      <DropzoneArea\r\n                                        isDragActive={isDragActive}\r\n                                        {...getRootProps()}\r\n                                      >\r\n                                        <input {...getInputProps()} />\r\n                                        <PoseGroup>\r\n                                          {isDragActive &&\r\n                                            <DropzoneOverlay key='1'>\r\n                                              <Icon\r\n                                                name='download'\r\n                                                size='large'\r\n                                                c='white'\r\n                                              />\r\n                                            </DropzoneOverlay>\r\n                                          }\r\n                                          {selectedDrawings.length &&\r\n                                            <MenuOverlay key='2' >\r\n                                              <MenuLeftIcon\r\n                                                link\r\n                                                size='large'\r\n                                                name='cancel'\r\n                                                onClick={() => deselectAllDrawings()}\r\n                                              />\r\n                                              <Span\r\n                                                fs='1.1em'\r\n                                                c='rgba(0,0,0,.75)'\r\n                                                fw='700'\r\n                                              >\r\n                                                Выбрано чертежей: {selectedDrawings.length}\r\n                                              </Span>\r\n                                              <Span\r\n                                                m='0 23px 0 auto'\r\n                                              >\r\n                                                <Icon\r\n                                                  link\r\n                                                  d={deleting ? 'none' : undefined}\r\n                                                  activeColor='#db2828'\r\n                                                  name='trash alternate outline'\r\n                                                  size='large'\r\n                                                  onClick={async () => {\r\n                                                    const ids = selectedDrawings\r\n                                                    const res = await deleteDrawings({ variables: { ids }})\r\n                                                    if (!res) return\r\n                                                    client.writeData({\r\n                                                      id: `Model:${modelId}`,\r\n                                                      data: {\r\n                                                        ...model,\r\n                                                        drawings: [ ...drawings.filter(drw => !ids.includes(drw.id)) ]\r\n                                                      }\r\n                                                    })\r\n                                                    deselectManyDrawings(ids)\r\n                                                    console.log('deleted!')\r\n                                                  }}\r\n                                                />\r\n                                                <Loader\r\n                                                  inline\r\n                                                  size='small'\r\n                                                  active={deleting}\r\n                                                />\r\n                                              </Span>\r\n                                              \r\n                                            </MenuOverlay>\r\n                                          }\r\n                                          {sortMode &&\r\n                                            <MenuOverlay key='3' >\r\n                                              <MenuLeftIcon\r\n                                                link\r\n                                                name='check'\r\n                                                size='large'\r\n                                                c='#016936'\r\n                                                onClick={async () => {\r\n                                                  let reordered = false\r\n                                                  drawings.forEach((drw, i) => {\r\n                                                    if (drw.sortOrder !== i) {\r\n                                                      reordered = true\r\n                                                      client.writeData({\r\n                                                        id: `Drawing:${drw.id}`,\r\n                                                        data: {\r\n                                                          ...drw,\r\n                                                          sortOrder: i\r\n                                                        }\r\n                                                      })\r\n                                                    }\r\n                                                  })\r\n                                                  if (reordered) await setDrawingsSortOrder({ variables: {\r\n                                                    ids: drawings.map(drw => drw.id)\r\n                                                  }})\r\n                                                  disableSortMode()\r\n                                                }}\r\n                                              />\r\n                                              <Span\r\n                                                fs='1.1em'\r\n                                                c='rgba(0,0,0,.75)'\r\n                                                fw='700'\r\n                                              >\r\n                                                Сортировка\r\n                                              </Span>\r\n                                              <Span\r\n                                                m='0 23px 0 auto'\r\n                                              >\r\n                                                <Loader\r\n                                                  inline\r\n                                                  size='small'\r\n                                                  active={sorting}\r\n                                                />\r\n                                              </Span>\r\n                                            </MenuOverlay>\r\n                                          }\r\n                                        </PoseGroup>\r\n                                        <CollapsableSection\r\n                                          ref={component => this.collapsableSection = component}\r\n                                          initiallyExpanded={!!drawings.length}\r\n                                          disabled={!drawings.length}\r\n                                          title='Чертеж '\r\n                                          subtitle={\r\n                                            <Span\r\n                                              fs='1.2em'\r\n                                            >\r\n                                              <Icon\r\n                                                name='file image outline'\r\n                                                mr='4px'\r\n                                              />\r\n                                              {drawings.length}\r\n                                            </Span>\r\n                                          }\r\n                                          buttons={<>\r\n                                            <Button compact circular menu\r\n                                              activeColor='green'\r\n                                              icon='plus'\r\n                                              onClick={e => {\r\n                                                e.stopPropagation()\r\n                                                notify({\r\n                                                  type: 'warning',\r\n                                                  content: 'Чтобы загрузить файлы, перетащите их в раздел',\r\n                                                })\r\n                                                openFileDialog()\r\n                                              }}\r\n                                              loading={creating}\r\n                                            />\r\n                                            <Button compact circular menu\r\n                                              icon='sort'\r\n                                              onClick={e => {\r\n                                                e.stopPropagation()\r\n                                                notify({\r\n                                                  type: 'warning',\r\n                                                  content: 'Чтобы изменить порядок, выберите и перетащите нужные чертежи',\r\n                                                })\r\n                                                enableSortMode()\r\n                                              }}\r\n                                            />\r\n                                          </>}\r\n                                        >\r\n                                          <SortableDrawingsList\r\n                                            drawings={drawings}\r\n                                            toggleDrawingSelection={toggleDrawingSelection}\r\n                                            selectedDrawings={selectedDrawings}\r\n                                            sortMode={sortMode}\r\n                                            onSortEnd={({ oldIndex, newIndex }) => moveDrawing( oldIndex, newIndex )}\r\n                                            getContainer={() => sidebarRef}\r\n                                          />\r\n                                        </CollapsableSection>\r\n                                      </DropzoneArea>\r\n                                    }\r\n                                  </Dropzone>\r\n                                }\r\n                              </StatefulBool>\r\n                            }\r\n                          </StatefulList>\r\n                        }\r\n                      </SortedCollectionProvider>\r\n                    }\r\n                  </Mutation>\r\n                }\r\n              </Mutation>\r\n            }\r\n          </Mutation>\r\n        }\r\n      </NotificationsConsumer>\r\n    )\r\n  }\r\n}\r\n","import React from 'react'\r\n\r\nimport Drawings from './Details/Drawings'\r\n\r\nexport default ({\r\n  model,\r\n  sidebarRef\r\n}) => {\r\n  return <>\r\n    <Drawings\r\n      model={model}\r\n      sidebarRef={sidebarRef}\r\n    />\r\n  </>\r\n}\r\n","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\nimport DetailsDataProvider from './DetailsDataProvider'\r\nimport DetailsMainHeader from './DetailsMainHeader'\r\nimport EnquiryDetails from './EnquiryDetails'\r\nimport OrderEdit from './OrderEdit'\r\nimport OrderDetails from './OrderDetails'\r\nimport ModelDetails from './Model/Details'\r\n\r\nconst Container = styled.div`\r\n\t/* flex-grow: 1; */\r\n\twidth: 60%;  // evaluates to 792px\r\n`\r\n\r\nconst Details = ({ closeDetails, sidebarRef }) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details: { type, id, enquiryId, editMode }, setDetails, setExpanded }) => (\r\n\t\t\t\t<Container>\r\n\t\t\t\t\t{/* Should I get rid of Details' components unification? */}\r\n\t\t\t\t\t\t<DetailsDataProvider\r\n\t\t\t\t\t\t\ttype={type}\r\n\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{({ loading, error, refetch, entity, localEntity }) =>\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<DetailsMainHeader\r\n\t\t\t\t\t\t\t\t\t\ttype={type}\r\n\t\t\t\t\t\t\t\t\t\tlocalEntity={localEntity}\r\n\t\t\t\t\t\t\t\t\t\tcloseDetails={closeDetails}\r\n\t\t\t\t\t\t\t\t\t\tsetDetails={setDetails}\r\n\t\t\t\t\t\t\t\t\t\teditMode={editMode}\r\n\t\t\t\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\t\t\t\trefresh={() => refetch()}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t{type === 'Enquiry'\r\n\t\t\t\t\t\t\t\t\t\t? <EnquiryDetails\r\n\t\t\t\t\t\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t\t\t\t\t\t\tcloseDetails={closeDetails}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t:\tnull\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t{type === 'Order' &&\r\n\t\t\t\t\t\t\t\t\t\t(id === 'new' || editMode\r\n\t\t\t\t\t\t\t\t\t\t\t? <OrderEdit\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tenquiryId={enquiryId}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcloseDetails={closeDetails}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetDetails={setDetails}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetExpanded={setExpanded}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t: (entity &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<OrderDetails\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\torder={entity}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t{type === 'Model' &&\r\n\t\t\t\t\t\t\t\t\t\t(id === 'new' || editMode\r\n\t\t\t\t\t\t\t\t\t\t\t? <div></div>\r\n\t\t\t\t\t\t\t\t\t\t\t: (entity &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ModelDetails\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel={entity}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsidebarRef={sidebarRef}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</DetailsDataProvider>\r\n\t\t\t\t</Container>\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default Details\r\n","import { Component } from 'react'\r\n\r\nimport cloneDeep from 'lodash/cloneDeep'\r\nimport without from 'lodash/without'\r\nimport take from 'lodash/take'\r\nimport union from 'lodash/union'\r\nimport difference from 'lodash/difference'\r\nimport find from 'lodash/fp/find'\r\n\r\nclass ProdTableUtils extends Component {\r\n\tselect = (id) => {\r\n\t\tconst {\r\n\t\t\tdepts: propDepts,\r\n\t\t\tsetList,\r\n\t\t\tselectLimit\r\n\t\t} = this.props\r\n\t\tconst depts = cloneDeep(propDepts)\r\n\t\tconst selectedProdIds =\r\n\t\t\tdepts.reduce((list, d) =>\r\n\t\t\t\t[\r\n\t\t\t\t\t...list,\r\n\t\t\t\t\t...d.prods.filter(p => p.selected).map(p => p.id)\r\n\t\t\t\t]\r\n\t\t\t, [])\r\n\t\tconst dept =\r\n\t\t\tfind({ id }, depts)\r\n\t\t\t|| find({ prods: [ { id } ]}, depts)\r\n\t\tconst { prods } = dept\r\n\t\tconst entity =\r\n\t\t\tdept.id === id\r\n\t\t\t\t? dept\r\n\t\t\t\t: find({ id }, prods)\r\n\t\tif (entity.disabled) return null\r\n\t\tlet newList = []\r\n\t\tif (entity.__typename === 'Prod') {\r\n\t\t\tnewList =\r\n\t\t\t\tselectedProdIds.includes(id)\r\n\t\t\t\t\t? without(selectedProdIds, id)\r\n\t\t\t\t\t: [...selectedProdIds, id]\r\n\t\t}\r\n\t\tif (entity.__typename === 'Dept') {\r\n\t\t\tif ([ 'partly', true ].includes(entity.selected))\r\n\t\t\t\tnewList = difference(selectedProdIds, prods.map(p => p.id))\r\n\t\t\tif (entity.selected === false) {\r\n\t\t\t\tconst idsWithinLimit = take(\r\n\t\t\t\t\tprods.filter(p => !p.disabled).map(p => p.id),\r\n\t\t\t\t\tselectLimit - selectedProdIds.length\r\n\t\t\t\t)\r\n\t\t\t\tnewList = union(selectedProdIds, idsWithinLimit)\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetList(newList)\r\n\t}\r\n\trender () {\r\n\t\tconst { children } = this.props\r\n\t\treturn children({\r\n\t\t\tselect: this.select\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport default ProdTableUtils","import { Component } from 'react'\r\n\r\n// deprecated, use SelectableListProvider\r\nexport default class ListProvider extends Component {\r\n\tstate = {\r\n\t\tlist: []\r\n\t}\r\n\tsetList = (list) => this.setState({ list })\r\n\ttoggle = (item) => {\r\n\t\tconst { list } = this.state\r\n\t\tconst newList = \r\n\t\t\tlist.includes(item)\r\n\t\t\t? [ ...list.filter(i => i !== item) ]\r\n\t\t\t: [ ...list, item ]\r\n\t\tthis.setState({ list: newList })\r\n\t}\r\n\trender() {\r\n\t\treturn this.props.children({\r\n\t\t\tlist: this.state.list,\r\n\t\t\tsetList: this.setList,\r\n\t\t\ttoggle: this.toggle,\r\n\t\t})\r\n\t}\r\n}\r\n","import { compose, graphql } from 'react-apollo'\r\nimport { orderLocal } from '../../graphql/order'\r\n\r\nconst OrderContext = ({\r\n\tchildren,\r\n\torderLocal: { orderLocal }\r\n}) => {\r\n  return children({\r\n\t\torderLocal: orderLocal || [],\r\n\t})\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(orderLocal, { name: 'orderLocal' }),\r\n)(OrderContext)\r\n","import React, { Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Section } from '../components/styled/styled-semantic'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { modelLocal } from '../graphql/model'\r\nimport { modelProds } from '../graphql/prod'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\nimport DetailsHeader from './DetailsHeader'\r\nimport ProdsByDept from './ProdsByDept'\r\nimport ProdTableUtils from './ProdTableUtils'\r\nimport DeptProdTable from './DeptProdTable'\r\nimport ListProvider from './special/ListProvider';\r\nimport OrderContext from './special/OrderContext';\r\n\r\nconst Container = styled.div`\r\n\twidth: 40%;\r\n\tmin-height: calc(100vh - 36px);\r\n\theight: fit-content;\r\n\t/* border-left: 1px solid rgb(126, 126, 129); */\r\n\tborder-left: 1px solid rgb(156, 156, 159);\r\n`\r\n\r\nconst DetailsExtra = ({ closeExtra }) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ extra, selectedProdIds, setSelectedProdIds }) => (\r\n\t\t\t\t<Container>\r\n\t\t\t\t\t{!!extra && \r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t<Query\r\n\t\t\t\t\t\t\t\tquery={modelLocal}\r\n\t\t\t\t\t\t\t\tvariables={{ id: extra.modelId }}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{({ data: { modelLocal } }) =>\r\n\t\t\t\t\t\t\t\t\t<DetailsHeader\r\n\t\t\t\t\t\t\t\t\t\ttitle={modelLocal.name + ' в наличии'}\r\n\t\t\t\t\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t\t\t\t\t\tnoIndent\r\n\t\t\t\t\t\t\t\t\t\tbottomBorder='dark'\r\n\t\t\t\t\t\t\t\t\t\tbuttons={\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon link\r\n\t\t\t\t\t\t\t\t\t\t\t\tname='cancel'\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={closeExtra}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</Query>\r\n\t\t\t\t\t\t\t<Query\r\n\t\t\t\t\t\t\t\tquery={modelProds}\r\n\t\t\t\t\t\t\t\tvariables={{ modelId: extra.modelId }}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{({ loading, error, data }) => {\r\n\t\t\t\t\t\t\t\t\tif (loading) return <Section noIndent >Загрузка...</Section>\r\n\t\t\t\t\t\t\t\t\tif (error) return <Section noIndent >Ошибка {error.message}</Section>\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<OrderContext\r\n\t\t\t\t\t\t\t\t\t\t\tid={extra.orderId}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{({ orderLocal }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ListProvider>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{({ list: expandedIds, toggle: toggleExpanded }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ProdsByDept\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprods={data.modelProds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedIds={selectedProdIds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torderId={extra.orderId}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectLimit={orderLocal.qty}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpandedIds={expandedIds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{({ depts }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ProdTableUtils\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdepts={depts}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetList={setSelectedProdIds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectLimit={orderLocal.qty}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{({ select }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DeptProdTable\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdepts={depts}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselect={select}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand={toggleExpanded}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ProdTableUtils>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ProdsByDept>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</ListProvider>\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t</OrderContext>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t</Query>\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t}\r\n\t\t\t\t</Container>\r\n\t\t\t\t\t\t\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default DetailsExtra\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { getLayout, getLayoutOptions, setLayout } from '../graphql/layout'\r\n\r\nimport styled from 'styled-components'\r\nimport { Sidebar, Ref } from 'semantic-ui-react';\r\nimport Details from './Details'\r\nimport DetailsExtra from './DetailsExtra'\r\n\r\nconst SSidebar = styled(Sidebar)`\r\n\t&&&& {\r\n\t\tdisplay: flex;\r\n\t\twidth: 120%;\r\n\t\tbackground-color: white;\r\n\t\ttransition: all .5s ease;\r\n\t\tmax-width: ${props => \r\n\t\t\tprops.type === 'Enquiry'\r\n\t\t\t? '1000px'\r\n\t\t\t: '1320px'\r\n\t\t};\r\n\t\t${props => !props.extra && `\r\n\t\t\t&.ui.visible.right.overlay.sidebar {\r\n\t\t\t\ttransform: translate3d(40%,0,0);\r\n\t\t\t}\r\n\t\t`}\r\n\t\t${props => props.extra && `\r\n\t\t\twidth: 86%;\r\n\t\t`}\r\n\t}\r\n`\r\n\r\nclass DetailsSidebar extends Component {\r\n\tstate = { detailsClosing: false }\r\n\tcloseDetails = () => {\r\n\t\tthis.setState({ detailsClosing: true })\r\n\t\t// set timeout for sidebar to finish animation\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.setLayout({variables: { input: { details: null, extra: null } }})\r\n\t\t\tthis.setState({ detailsClosing: false })\r\n\t\t}, 300)\r\n\t}\r\n\tcloseExtra = () => {\r\n\t\tthis.props.setLayout({variables: { input: { extra: null } }})\r\n\t}\r\n\trender() {\r\n\t\tconst { detailsClosing } = this.state\r\n\t\tconst { layout: { details, extra } } = this.props\r\n\t\treturn (\r\n\t\t\t<Ref innerRef={node => this.sidebarRef = node}>\r\n\t\t\t\t<SSidebar\r\n\t\t\t\t\tvisible={!!details && !detailsClosing}\r\n\t\t\t\t\textra={!!extra ? 1: 0}\r\n\t\t\t\t\ttype={details && details.type}\r\n\t\t\t\t\tanimation='overlay'\r\n\t\t\t\t\tdirection='right'\r\n\t\t\t\t>\r\n\t\t\t\t\t{details &&\r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t<Details\r\n\t\t\t\t\t\t\t\tkey={details.type + details.id}\r\n\t\t\t\t\t\t\t\tcloseDetails={this.closeDetails}\r\n\t\t\t\t\t\t\t\tsidebarRef={this.sidebarRef}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<DetailsExtra\r\n\t\t\t\t\t\t\t\textra={extra}\r\n\t\t\t\t\t\t\t\tcloseExtra={this.closeExtra}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t}\r\n\t\t\t\t</SSidebar>\r\n\t\t\t</Ref>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(getLayout, getLayoutOptions),\r\n\tgraphql(setLayout, { name: 'setLayout' })\r\n)(DetailsSidebar)","import React, { Component } from 'react'\r\nimport styled from 'styled-components'\r\n\r\nconst Container = styled.div`\r\n  height: calc(100vh - 36px) !important;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n`\r\n\r\nconst Main = styled.div`\r\n  flex: 1 0 50px;\r\n  min-height: 50px;\r\n  overflow-y: auto;\r\n  overflow-x: hidden;\r\n`\r\n\r\nconst Panel = styled.div`\r\n  flex: 0 0 0;\r\n  min-height: 387px;\r\n  background: #fff;\r\n  z-index: 10;\r\n  /* box-shadow: 0 0 20px rgba(34,36,38,.15); shadow of semantic-ui Sidebar*/\r\n  box-shadow: 0 0 20px 5px #fff;\r\n  transition: min-height .4s ease-out;\r\n  ${props => !props.panelVisible && `\r\n    min-height: 0;\r\n  `}\r\n`\r\n\r\nexport default class PanelPusher extends Component {\r\n  render() {\r\n    const {\r\n      children,\r\n      panel,\r\n      panelVisible,\r\n      panelRendered\r\n    } = this.props\r\n    return (\r\n      <Container>\r\n        <Main\r\n          panelVisible={panelVisible}\r\n        >\r\n          {children}\r\n        </Main>\r\n        <Panel\r\n          panelVisible={panelVisible}\r\n        >\r\n          { panelRendered &&\r\n            panel\r\n          }\r\n        </Panel>\r\n      </Container>\r\n    )\r\n  }\r\n}\r\n","import gql from 'graphql-tag'\r\n\r\nexport const telFragment = gql`\r\n\tfragment TelFragment on Tel {\r\n\t\tid\r\n\t\tnumber\r\n\t\ttype\r\n\t\tcountry\r\n\t\tnote\r\n\t\tdefault\r\n\t}\r\n`","import gql from 'graphql-tag'\r\nimport { telFragment } from './tel'\r\n\r\n// TODO switch to using only amoName in the app\r\nexport const personFragmentBasic = gql`\r\n\tfragment PersonFragmentBasic on Person {\r\n\t\tid\r\n\t\tamoId\r\n\t\tfName\r\n\t\tlName\r\n\t\tmName\r\n\t\tamoName\r\n\t}\r\n`\r\n\r\nexport const personContactsFragment = gql`\r\n\tfragment PersonContactsFragment on Person {\r\n\t\t...PersonFragmentBasic\r\n\t\thtmlNote\r\n\t\ttels { ...TelFragment }\r\n\t\tuser {\r\n\t\t\temail\r\n\t\t\tconfirmed\r\n\t\t}\r\n\t}\r\n\t${telFragment}\r\n\t${personFragmentBasic}\r\n`\r\n\r\nexport const persons = gql`\r\n\tquery Persons {\r\n\t\tpersons { ...PersonFragmentBasic }\r\n\t}\r\n\t${personFragmentBasic}\r\n`\r\n","import gql from 'graphql-tag'\r\nimport { personContactsFragment } from './person'\r\n\r\nexport const orgEmployees = gql`\r\n\tquery OrgEmployees ($orgId: ID!) {\r\n\t\torgEmployees (orgId: $orgId) {\r\n\t\t\tid\r\n\t\t\tposition\r\n\t\t\tperson { ...PersonContactsFragment }\r\n\t\t}\r\n\t}\r\n\t${personContactsFragment}\r\n`\r\n\r\nexport const upsertEmployee = gql`\r\n\tmutation UpsertEmployee(\r\n\t\t$input: EmployeeInput!\r\n\t) {\r\n\t\tupsertEmployee(\r\n\t\t\tinput: $input\r\n\t\t) {\r\n\t\t\tid\r\n\t\t}\r\n\t}\r\n`","import React from 'react'\r\nimport produce from 'immer'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { orgLocal } from '../../graphql/org'\r\n\r\nimport styled from 'styled-components'\r\nimport { Header, Button, Icon } from '../styled/styled-semantic'\r\n\r\nimport GlobalContext from '../special/GlobalContext'\r\n\r\nconst MenuDiv = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tborder-bottom: 1px solid #7e7e81;\r\n\t/* border-top: 1px solid rgb(180, 181, 182); color of Chrome address section bottom border */\r\n\tborder-top: 1px solid rgb(160, 161, 162);\r\n`\r\n\r\nexport default ({\r\n\tclosePanel\r\n}) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ bottomPanel, setBottomPanel }) =>\r\n\t\t\t\t<MenuDiv>\r\n\t\t\t\t\t<Icon\r\n\t\t\t\t\t\tw='30px'\r\n\t\t\t\t\t\tm='0 10px'\r\n\t\t\t\t\t\tlink\r\n\t\t\t\t\t\tname='cancel'\r\n\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\tonClick={closePanel}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Query\r\n\t\t\t\t\t\tquery={orgLocal}\r\n\t\t\t\t\t\tvariables={{id: bottomPanel.orgId}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{({ data }) => {\r\n\t\t\t\t\t\t\tif (data && data.orgLocal) return (\r\n\t\t\t\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\t\t\t\tpl='0 !important'\r\n\t\t\t\t\t\t\t\t\tsize='medium'\r\n\t\t\t\t\t\t\t\t\tcontent={`Представители \\u00A0 ${data.orgLocal.name}`}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\treturn null\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t</Query>\r\n\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\tactiveColor='green'\r\n\t\t\t\t\t\ticon='plus'\r\n\t\t\t\t\t\t// content=''\r\n\t\t\t\t\t\tactive={ !bottomPanel.id }\r\n\t\t\t\t\t\tonClick={() => setBottomPanel(\r\n\t\t\t\t\t\t\tproduce(bottomPanel, draft => { delete draft.id })\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t\r\n\t\t\t\t</MenuDiv>\r\n\t\t\t}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n","import React from 'react'\r\nimport { formatTel } from '../../utils/format'\r\n\r\nexport default ({\r\n  tel\r\n}) => {\r\n  return (\r\n    <div>\r\n      {formatTel(tel)}\r\n    </div>\r\n  )\r\n}\r\n","import React, { Fragment } from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport Tel from './Tel'\r\n\r\nconst Container = styled.div`\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin-bottom: .67857143rem;\r\n`\r\n\r\nconst Label = styled.div`\r\n  flex: 0 0 122px;\r\n  color: rgba(0,0,0,.87);\r\n  line-height: 1.21428571rem;\r\n  padding-top: .67857143rem;\r\n  vertical-align: top;\r\n`\r\n\r\nconst Content = styled.div`\r\n  flex: 1 1 auto;\r\n  min-width: 210px;\r\n  font-size: calc(15rem/14);\r\n  font-weight: bold;\r\n  line-height: 1.21428571rem;\r\n  padding-top: .67857143rem;\r\n`\r\n\r\nexport default ({\r\n  type,\r\n  label,\r\n  content\r\n}) => {\r\n  const component = data =>\r\n    type === 'string' ? data :\r\n    type === 'tel' ? <Tel tel={data} />\r\n    : null\r\n  return (\r\n    <Container>\r\n      <Label>\r\n        {label}\r\n      </Label>\r\n      <Content>\r\n        {Array.isArray(content)\r\n          ? content.map((item, i) => \r\n              <Fragment key={i}>\r\n                {component(item)}\r\n              </Fragment>\r\n            )\r\n          : component(content)\r\n        }\r\n      </Content>\r\n    </Container>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport Field from './Field'\r\n\r\nconst renderObj = (obj, objSchema, key) => {\r\n  // obj may be any value\r\n  // objSchema should be either Object or Array with only one schema object element\r\n  const isArray = Array.isArray(objSchema)\r\n  const schema = isArray ? objSchema[0] : objSchema\r\n  const schemaKeys = Object.keys(schema)\r\n  // if objSchema contains 'label' than that's a field\r\n  const isField = schemaKeys.includes('label')\r\n  if (isField) {\r\n    // default type is 'string\r\n    const type = schema.type || 'string'\r\n    return (\r\n      <Field\r\n        key={key}\r\n        type={type}\r\n        label={schema.label}\r\n        content={obj}\r\n      />\r\n    )\r\n  }\r\n  else {\r\n    // when traversing, take only obj keys that are non-empty arrays/values\r\n    return schemaKeys\r\n      .filter(k => Array.isArray(obj[k]) ? obj[k].length : !!obj[k])\r\n      .map((k, i)=> renderObj(obj[k], objSchema[k], i))\r\n  }\r\n}\r\n\r\nexport default ({\r\n  entity,\r\n  schema\r\n}) => renderObj(entity, schema, '0')\r\n","import { lazy, object, string } from 'yup'\r\n\r\nimport { idValidationType } from './commonTypes'\r\n\r\nexport const validationSchema = object().shape({\r\n\tid: idValidationType.notRequired(),\r\n\tcountry: string()\r\n\t\t.oneOf(['rus', 'notRus'])\r\n\t\t.when('id', (id, schema) => id\r\n\t\t\t? schema.notRequired()\r\n\t\t\t: schema.default('rus')\r\n\t\t),\r\n\tnumber: lazy(val => !val\r\n\t\t? string()\r\n\t\t: string()\r\n\t\t\t.transform(val => val.match(/.*\\d.*/) //if value contains digits\r\n\t\t\t\t? val.match(/\\d+/g).join('') // extract and join digits\r\n\t\t\t\t: val // else pass value through\r\n\t\t\t)\r\n\t\t\t.when('country', {\r\n\t\t\t\tis: 'rus',\r\n\t\t\t\tthen: string().matches(/\\d{10}/, 'российский телефонный номер должен содержать 10 цифр'), \t\t\t\t\t\t\t\t\t// check number of digits for russia (10)\r\n\t\t\t\totherwise: string().matches(/\\d{7,25}/, 'международный телефонный номер должен содержать от 7 до 25 цифр')\t// from 7 to 25 for notRus numbers\r\n\t\t\t})\r\n\t)\r\n})","import { lazy, array, object, string } from 'yup'\r\n\r\nimport { validationSchema as telValidationSchema } from './tel'\r\nimport { idValidationType } from './commonTypes'\r\n\r\nexport const validationSchema = object().shape({\r\n\tid: idValidationType.notRequired(),\r\n\tlName: lazy(val => !val\r\n\t\t? string()\r\n\t\t: string().trim().min(2).max(255)\r\n\t),\r\n\tfName: string().trim().min(2).max(255)\r\n\t\t.when('id', (id, schema) => id\r\n\t\t\t? schema.notRequired()\r\n\t\t\t: schema.required('Пропущено обязательное поле Имя')\r\n\t\t)\r\n  ,\r\n\tmName: lazy(val => !val\r\n\t\t? string()\r\n\t\t: string().trim().min(2).max(255)\r\n\t),\r\n\ttels: array().of(telValidationSchema)\r\n})","import { object } from 'yup'\r\n\r\nimport { validationSchema as personValidationSchema } from './person'\r\nimport { idValidationType } from './commonTypes'\r\n\r\nexport const validationSchema = object().shape({\r\n  id: idValidationType.notRequired(),\r\n  orgId: idValidationType\r\n\t\t.when('id', (id, schema) => id\r\n\t\t\t? schema.notRequired()\r\n\t\t\t: schema.required()\r\n\t\t),\r\n  person: personValidationSchema\r\n})\r\n\r\nexport const formikSchema = {\r\n  person: {\r\n    lName: '',\r\n    fName: '',\r\n    mName: '',\r\n    tels: [{\r\n      number: '',\r\n      country: 'rus',\r\n    }]\r\n  }\r\n}\r\n\r\nexport const listSchema = {\r\n  person: {\r\n    lName: {\r\n      label: 'Фамилия'\r\n    },\r\n    fName: {\r\n      label: 'Имя'\r\n    },\r\n    mName: {\r\n      label: 'Отчество'\r\n    },\r\n    tels: [{\r\n      label: 'Телефон',\r\n      type: 'tel'\r\n    }]\r\n  }\r\n}\r\n","import React from 'react'\r\n\r\nimport { Div, Icon } from '../styled/styled-semantic'\r\nimport DetailsHeader from '../DetailsHeader'\r\nimport List from '../list/List'\r\nimport { listSchema } from '../../schema/employee'\r\n\r\nexport default ({\r\n  emp,\r\n  toggleEditMode\r\n}) => {\r\n  return <>\r\n    <DetailsHeader\r\n      title={emp.person.fullname}\r\n      size='small'\r\n      noIndent\r\n      bottomBorder='dark'\r\n      buttons={<>\r\n        <Icon\r\n          link\r\n          name='edit'\r\n          activeColor='blue'\r\n          onClick={toggleEditMode}\r\n        />\r\n      </>}\r\n    />\r\n    <Div\r\n      p='1em'\r\n    >\r\n      <List\r\n        entity={emp}\r\n        schema={listSchema}\r\n      />\r\n    </Div>\r\n  </>\r\n}\r\n","import React, { Component } from 'react'\r\n\r\nimport { Mutation } from 'react-apollo'\r\nimport { upsertEmployee } from '../../graphql/employee'\r\n\r\nimport { Formik } from 'formik'\r\nimport { projectEntity, preparePayload } from '../form/utils'\r\nimport { formikSchema, validationSchema } from '../../schema/employee'\r\nimport Field from '../form/Field'\r\n\r\nimport { Button, A, Message } from '../styled/styled-semantic'\r\n\r\n// position\r\n// fName\r\n// lName\r\n// mName\r\n// htmlNote\r\n// tels { ...TelFragment }\r\n// user {\r\n//   email\r\n//   confirmed\r\n// }\r\n\r\nexport default class EmployeeForm extends Component {\r\n  didMount = false\r\n  componentDidMount() { this.didMount = true }\r\n  componentWillUnmount() { this.didMount = false }\r\n  render() {\r\n    const {\r\n      emp,\r\n      orgId,\r\n      toggleEditMode,\r\n      refetchQueries\r\n    } = this.props\r\n    let schema = emp ? formikSchema : {...formikSchema, orgId}\r\n    const initialValues = emp ? projectEntity(emp, schema) : schema\r\n    return (\r\n      <Mutation\r\n        mutation={upsertEmployee}\r\n        onCompleted={() => refetchQueries()}\r\n      >\r\n        {(upsertEmployee, { loading, error }) =>\r\n          <Formik\r\n            initialValues={initialValues}\r\n            validationSchema={validationSchema}\r\n            onSubmit={async (values, { resetForm }) => {\r\n              // console.log('values > ', values)\r\n              // console.log('initialValues > ', initialValues)\r\n              const input = preparePayload(values, initialValues, schema)\r\n              // console.log('input > ', input)\r\n              await upsertEmployee({ variables: { input } })\r\n              // const upserted = await upsertEmployee({ variables: { input } })\r\n              // console.log('upserted > ', upserted)\r\n              return emp\r\n                ? toggleEditMode()\r\n                : this.didMount && resetForm()\r\n            }}\r\n          >\r\n            {({\r\n              values,\r\n              handleChange,\r\n              handleSubmit,\r\n              handleReset,\r\n              setFieldValue\r\n            }) =>\r\n              <>\r\n                <Field\r\n                  label='Фамилия'\r\n                  name='person.lName'\r\n                />\r\n                <Field\r\n                  label='Имя'\r\n                  required\r\n                  name='person.fName'\r\n                />\r\n                <Field\r\n                  label='Отчество'\r\n                  name='person.mName'\r\n                />\r\n                <Field\r\n                  label='Телефон'\r\n                  name='person.tels'\r\n                />\r\n                {/* TODO add email input */}\r\n                {/* <Field\r\n                  label='E-mail'\r\n                  name='person.email'\r\n                /> */}\r\n                {!!error &&\r\n                  <Message\r\n                    error\r\n                    header='Не удалось добавить..'\r\n                    content={error && error.message}\r\n                  />\r\n                }\r\n                <Button\r\n                  ml='122px'\r\n                  // type=\"submit\"\r\n                  type='button'\r\n                  primary\r\n                  content={emp ? 'Сохранить' : 'Добавить'}\r\n                  loading={loading}\r\n                  onClick={handleSubmit}\r\n                />\r\n                <A cancel\r\n                  onClick={ emp ? toggleEditMode : handleReset}\r\n                >\r\n                  {emp ? 'Отмена' : 'Очистить'}\r\n                </A>\r\n              </>\r\n            }\r\n          </Formik>\r\n        }\r\n      </Mutation>\r\n    )\r\n  }\r\n}\r\n","import React, { Component } from 'react'\r\n\r\nimport DetailsHeader from '../DetailsHeader'\r\nimport EmployeeForm from './Form'\r\nimport { Div } from '../styled/styled-semantic'\r\n\r\nexport default class EmployeeEdit extends Component {\r\n  render() {\r\n    const { \r\n      emp,\r\n      orgId,\r\n      toggleEditMode,\r\n      refetchQueries\r\n    } = this.props\r\n    return <>\r\n      <DetailsHeader\r\n        title={\r\n          emp\r\n          ? 'Редактировать'\r\n          : 'Добавить представителя'\r\n        }\r\n        size='small'\r\n        noIndent\r\n        bottomBorder='dark'\r\n        buttons={<>\r\n          {/* <Icon\r\n            link\r\n            name='save'\r\n            color='blue'\r\n            onClick={(emp) => console.log('upsert emp -> ', emp)}\r\n          /> */}\r\n        </>}\r\n      />\r\n      <Div\r\n        p='1em'\r\n        oy='auto'\r\n        h='315px'\r\n      >\r\n        <EmployeeForm\r\n          emp={emp}\r\n          orgId={orgId}\r\n          toggleEditMode={toggleEditMode}\r\n          refetchQueries={refetchQueries}\r\n        />\r\n      </Div>\r\n    </>\r\n  }\r\n}\r\n","import React from 'react'\r\nimport { formatTel } from '../../utils/format'\r\n\r\nimport GlobalContext from '../special/GlobalContext'\r\n\r\nimport Table from '../common/Table'\r\nimport TableRow from '../common/TableRow'\r\n\r\nconst fields = [{\r\n\tname: 'fullname',\r\n\ttitle: 'ФИО',\r\n\twidth: '250px'\r\n},{\r\n  name: 'tel',\r\n  title: 'Телефон',\r\n  width: '140px'\r\n}]\r\n\r\nexport default ({\r\n  emps\r\n}) => {\r\n  return (\r\n    <GlobalContext>\r\n\t\t\t{({ bottomPanel, setBottomPanel }) =>\r\n\t\t\t\t<Table\r\n          fields={fields}\r\n          indent='27px'\r\n\t\t\t\t>\r\n\t\t\t\t\t{({ tableFields }) => \r\n\t\t\t\t\t\temps.map(emp => {\r\n              const { id, person } = emp\r\n              const { lName, fName, mName, tels } = person || {}\r\n\t\t\t\t\t\t\tconst active = bottomPanel.id === id\r\n\t\t\t\t\t\t\treturn (\r\n                <TableRow\r\n                  key={id}\r\n                  entity={emp}\r\n                  tableFields={tableFields}\r\n                  rowFields={[{\r\n                    name: 'fullname',\r\n                    value: person\r\n                      ? [lName, fName, mName].join(' ')\r\n                      : 'Персональные данные удалены'\r\n                  },{\r\n                    name: 'tel',\r\n                    value: (tels && tels.length && formatTel(tels[0])) || ''\r\n                  }\r\n                  // ,{\r\n                  //   name: 'emps',\r\n                  //   icon: org.employees.length ? 'user' : 'user plus',\r\n                  //   iconColor: 'grey',\r\n                  //   type: 'onHover',\r\n                  //   styles: ['center'],\r\n                  //   value: org.employees.length || ' ',\r\n                  //   onClick: () => {\r\n                  //     setBottomPanel({\r\n                  //       type: 'Employees',\r\n                  //       orgId: org.id\r\n                  //     })\r\n                  //   },\r\n                  //   active: bottomPanel\r\n                  //     && bottomPanel.type === 'Employees'\r\n                  //     && bottomPanel.orgId === org.id\r\n                  // }\r\n                  ]}\r\n                  active={active}\r\n                  onClick={() => {\r\n                    setBottomPanel({\r\n                      ...bottomPanel,\r\n                      editMode: false,\r\n                      id\r\n                    })\r\n                  }}\r\n                />\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)}\r\n\t\t\t\t</Table>\r\n\t\t\t}\r\n\t\t</GlobalContext>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport produce from 'immer'\r\nimport { Query } from 'react-apollo'\r\nimport { orgEmployees } from '../graphql/employee'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport { Message } from './styled/styled-semantic';\r\nimport GlobalContext from './special/GlobalContext'\r\nimport EmployeesPanelHeader from './Employee/PanelHeader'\r\nimport EmployeeDetails from './Employee/Details'\r\nimport EmployeeEdit from './Employee/Edit'\r\nimport EmployeesTable from './Employee/Table';\r\n\r\nconst EmployeesPanelBody = styled.div`\r\n  display: flex;\r\n  height: calc(100% - 37px);\r\n`\r\n\r\nconst EmployeesPanelTableSection = styled.div`\r\n  flex: 0 0 600px;\r\n`\r\n\r\nconst EmployeeDetailsSection = styled.div`\r\n  flex: 0 0 480px;\r\n  border: solid rgb(156,156,159);\r\n  border-width: 0 1px;\r\n  min-height: 100%;\r\n`\r\n\r\nconst processEmp = emp =>\r\n  produce(emp, draft => {\r\n    const { lName, fName, mName } = draft.person\r\n    draft.person.fullname = [lName, fName, mName].join(' ')\r\n  })\r\n\r\nexport default ({\r\n  closePanel\r\n}) => {\r\n  return (\r\n    <GlobalContext>\r\n      {({ bottomPanel, setBottomPanel }) => <>\r\n        <EmployeesPanelHeader \r\n          closePanel={closePanel}\r\n        />\r\n        <Query\r\n          query={orgEmployees}\r\n          variables={{ orgId: bottomPanel.orgId }}\r\n        >\r\n          {({ loading, error, data, refetch }) => {\r\n            if (loading) return 'Загрузка..'\r\n            if (error) return `Ошибка ${error.message}`\r\n            const emps = data.orgEmployees\r\n            const activeEmp = bottomPanel.id && data.orgEmployees.find(e => e.id === bottomPanel.id)\r\n            return (\r\n              <EmployeesPanelBody>\r\n                <EmployeesPanelTableSection>\r\n                  {emps.length\r\n                    ? <EmployeesTable\r\n                        emps={emps}\r\n                      />\r\n                    : <Message\r\n                        m='1em'\r\n                        content={<>\r\n                          Добавьте первого представителя<br/>\r\n                          👉\r\n                        </>}\r\n                      />\r\n                  }\r\n                </EmployeesPanelTableSection>\r\n                <EmployeeDetailsSection>\r\n                  {!bottomPanel.id\r\n                    ? <EmployeeEdit \r\n                        orgId={bottomPanel.orgId}\r\n                        refetchQueries={refetch}\r\n                      /> :\r\n                    !activeEmp.person ?\r\n                      null :\r\n                    bottomPanel.editMode\r\n                    ? <EmployeeEdit\r\n                        emp={activeEmp}\r\n                        orgId={bottomPanel.orgId}\r\n                        toggleEditMode={() => setBottomPanel(\r\n                          produce(bottomPanel, draft => { delete draft.editMode })\r\n                        )}\r\n                        refetchQueries={refetch}\r\n                      />\r\n                    : <EmployeeDetails\r\n                        emp={processEmp(activeEmp)}\r\n                        toggleEditMode={() => setBottomPanel({ ...bottomPanel, editMode: true })}\r\n                      />\r\n                  }\r\n                </EmployeeDetailsSection>\r\n              </EmployeesPanelBody>\r\n            )\r\n          }}\r\n        </Query>\r\n      </>}\r\n    </GlobalContext>\r\n  )\r\n}\r\n","import React, { Component } from 'react'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { allEnquiries } from '../graphql/enquiry'\r\nimport { setLayout } from '../graphql/layout'\r\n\r\nimport styled from 'styled-components'\r\nimport { Sidebar } from 'semantic-ui-react'\r\n\r\nimport EnquiriesMenu from './EnquiriesMenu'\r\nimport EnquiriesTable from './EnquiriesTable'\r\nimport DetailsSidebar from './DetailsSidebar'\r\nimport PanelPusher from './common/PanelPusher';\r\nimport EnquiriesBottomPanel from './EnquiriesBottomPanel';\r\nimport GlobalContext from './special/GlobalContext';\r\n\r\nconst Pushable = styled(Sidebar.Pushable)`\r\n\tmin-height: calc(100vh - 36px) !important;\r\n`\r\n\r\nexport class EnquiriesPage extends Component {\r\n\t// TODO refactor -> move bottomPanel logic to PanelProvider, switch to Apollo Query components\r\n\tstate = { panelClosing: false }\r\n\tclosePanel = () => {\r\n\t\tthis.setState({ panelClosing: true })\r\n\t\t// set timeout for panel to finish animation\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.setLayout({variables: { input: { bottomPanel: null } } })\r\n\t\t\tthis.setState({ panelClosing: false })\r\n\t\t}, 430)\r\n\t}\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tallEnquiries: { loading, error, refetch, enquiries },\r\n\t\t\trefreshToken\r\n\t\t} = this.props\r\n\t\tconst { panelClosing } = this.state\r\n\t\treturn <>\r\n\t\t\t<EnquiriesMenu\r\n\t\t\t\trefetchEnquiries={() => refetch()}\r\n\t\t\t\tenquiriesAreLoading={loading}\r\n\t\t\t\trefreshToken={refreshToken}\r\n\t\t\t/>\r\n\t\t\t{loading && \"Загрузка...\"}\r\n\t\t\t{error && `Ошибка ${error.message}`}\r\n\t\t\t{enquiries &&\r\n\t\t\t\t<GlobalContext>\r\n\t\t\t\t\t{({ bottomPanel }) =>\r\n\t\t\t\t\t\t<Pushable>\r\n\t\t\t\t\t\t\t<DetailsSidebar />\r\n\t\t\t\t\t\t\t<Sidebar.Pusher>\r\n\t\t\t\t\t\t\t\t<PanelPusher\r\n\t\t\t\t\t\t\t\t\tpanel={\r\n\t\t\t\t\t\t\t\t\t\t<EnquiriesBottomPanel\r\n\t\t\t\t\t\t\t\t\t\t\tclosePanel={this.closePanel}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tpanelRendered={!!bottomPanel}\r\n\t\t\t\t\t\t\t\t\tpanelVisible={!!bottomPanel && !panelClosing}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<EnquiriesTable\r\n\t\t\t\t\t\t\t\t\t\tenquiries={enquiries}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</PanelPusher>\r\n\t\t\t\t\t\t\t</Sidebar.Pusher>\r\n\t\t\t\t\t\t</Pushable>\r\n\t\t\t\t\t}\r\n\t\t\t\t</GlobalContext>\r\n\t\t\t}\r\n\t\t</>\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(allEnquiries, {\r\n\t\tname: 'allEnquiries',\r\n\t\talias: 'allEnquiriesQuery'\r\n\t}),\r\n\tgraphql(setLayout, { name: 'setLayout' })\r\n)(EnquiriesPage)","import gql from 'graphql-tag'\r\n\r\nexport const articleFragmentBasic = gql`\r\n\tfragment ArticleFragmentBasic on Article {\r\n\t\tid\r\n\t\trusName\r\n\t\tisIncome\r\n\t\tisLoan\r\n\t}\r\n`\r\n\r\nexport const articleFragmentFull = gql`\r\n\tfragment ArticleFragmentFull on Article {\r\n\t\t...ArticleFragmentBasic\r\n\t\trelations\r\n\t}\r\n\t${articleFragmentBasic}\r\n`\r\n","import gql from 'graphql-tag'\r\n\r\nexport const accountFragmentBasic = gql`\r\n\tfragment AccountFragmentBasic on Account {\r\n\t\tid\r\n\t}\r\n`\r\n\r\nexport const accountFragmentFull = gql`\r\n\tfragment AccountFragmentFull on Account {\r\n\t\t...AccountFragmentBasic\r\n\t\tname\r\n\t\tnumber\r\n\t}\r\n\t${accountFragmentBasic}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const equipmentFragmentBasic = gql`\r\n\tfragment EquipmentFragmentBasic on Equipment {\r\n\t\tid\r\n\t\tname\r\n\t}\r\n`\r\n\r\nexport const equipmentFragmentFull = gql`\r\n\tfragment EquipmentFragmentFull on Equipment {\r\n\t\t...EquipmentFragmentBasic\r\n\t}\r\n\t${equipmentFragmentBasic}\r\n`","import gql from 'graphql-tag'\r\nimport { articleFragmentBasic, articleFragmentFull } from './article'\r\nimport { personFragmentBasic } from './person'\r\nimport { accountFragmentBasic, accountFragmentFull } from './account'\r\nimport { equipmentFragmentBasic } from './equipment'\r\nimport { orgFragmentBasic } from './org';\r\n\r\nexport const paymentFragmentBasic = gql`\r\n\tfragment PaymentFragmentBasic on Payment {\r\n\t\tid\r\n\t\tdateLocal\r\n\t\tamount\r\n\t\tpurpose\r\n\t\taccount { ...AccountFragmentBasic }\r\n\t\tarticle { ...ArticleFragmentBasic }\r\n\t\tequipment { ...EquipmentFragmentBasic }\r\n\t\torg { ...OrgFragmentBasic }\r\n\t\tperson { ...PersonFragmentBasic }\r\n\t}\r\n\t${accountFragmentBasic}\r\n\t${articleFragmentBasic}\r\n\t${equipmentFragmentBasic}\r\n\t${orgFragmentBasic}\r\n\t${personFragmentBasic}\r\n`\r\n\r\nexport const payments = gql`\r\n\tquery Payments {\r\n\t\tpayments { ...PaymentFragmentBasic }\r\n\t}\r\n\t${paymentFragmentBasic}\r\n`\r\n\r\nexport const paymentsPage = gql`\r\n\tquery PaymentsPage {\r\n\t\taccounts { ...AccountFragmentFull }\r\n\t\tarticles { ...ArticleFragmentFull }\r\n\t\tequipments { ...EquipmentFragmentBasic }\r\n\t\tpayments { ...PaymentFragmentBasic }\r\n\t}\r\n\t${accountFragmentFull}\r\n\t${articleFragmentFull}\r\n\t${equipmentFragmentBasic}\r\n\t${paymentFragmentBasic}\r\n`\r\n\r\nexport const upsertPayment = gql`\r\n\tmutation UpsertPayment(\r\n\t\t$input: PaymentInput!\r\n\t) {\r\n\t\tupsertPayment(\r\n\t\t\tinput: $input\r\n\t\t) {\r\n\t\t\t...PaymentFragmentBasic\r\n\t\t}\r\n\t}\r\n\t${paymentFragmentBasic}\r\n`\r\n","import React from 'react'\r\n\r\nimport { XAxis, YAxis, HorizontalGridLines, LineSeries, VerticalBarSeries, FlexibleWidthXYPlot } from 'react-vis'\r\n\r\nimport styled from 'styled-components'\r\n\r\nconst Container = styled.div`\r\n  width: 100%;\r\n`\r\n\r\nexport default ({\r\n  payments: allPayments\r\n}) => {\r\n  const payments = allPayments.filter(p => !p.article || !p.article.isLoan)\r\n  // const startDate = payments[payments.length - 1].dateLocal.slice(0, 10)\r\n  // const endDate = payments[0].dateLocal.slice(0, 10)\r\n  // console.log('startDate > ', startDate)\r\n  // console.log('endDate > ', endDate)\r\n  // console.log('payments > ', payments)\r\n  const data = payments.map(p => {\r\n    const isIncome = p.article ? p.article.isIncome : p.isIncome\r\n    return {\r\n      x: new Date(p.dateLocal.slice(0, 10)).getTime(),\r\n      y: (!!isIncome ? 1 : -1) * p.amount\r\n    }\r\n  })\r\n  const [positive, negative, total] = data.reduce((arrs, p) => {\r\n    let length = arrs[0].length\r\n    if (!length || arrs[0][length - 1].x !== p.x) {\r\n      arrs.forEach(arr => arr.push({ x: p.x, y: 0, y0: 0 }))\r\n      length = arrs[0].length\r\n    }\r\n    if (p.y > 0) arrs[0][length - 1].y += p.y\r\n    if (p.y < 0) {\r\n      arrs[1][length - 1].y0 += p.y\r\n    }\r\n    arrs[2][length - 1].y += p.y\r\n    return arrs\r\n  }, [[], [], []])\r\n  // console.log('positive, negative, total > ', positive, negative, total)\r\n  let sum = 0\r\n  const lineData = total.reverse().reduce((lineData, p) => {\r\n    const pointIndex = (\r\n      lineData.findIndex(({ x }) => x === p.x) + 1\r\n      || lineData.push({ x: p.x, y: sum }) && lineData.push({ x: p.x, y: 0 })\r\n    ) - 1\r\n    lineData[pointIndex].y = sum += p.y\r\n    return lineData\r\n  }, [])\r\n  const negativeValues = negative.map(p => ({\r\n    ...p,\r\n    y: 0,\r\n    y0: p.y < 0 ? p.y : 0\r\n  }))\r\n  return (\r\n    <Container>\r\n      <FlexibleWidthXYPlot\r\n        height={400}\r\n        margin={{\r\n          left: 60\r\n        }}\r\n        stackBy=\"y\"\r\n      >\r\n        <HorizontalGridLines />\r\n        <XAxis \r\n          tickFormat={(d) => new Date(d).toLocaleDateString()}\r\n        />\r\n        <YAxis />\r\n        <LineSeries\r\n          data={lineData}\r\n        />\r\n        <VerticalBarSeries\r\n          stack={true}\r\n          // cluster='1'\r\n          data={negative}\r\n          color='rgb(255, 152, 51)'\r\n        />\r\n        <VerticalBarSeries\r\n          stack={true}\r\n          // cluster='0'\r\n          data={positive}\r\n          color='#4fb79b'\r\n        />\r\n      </FlexibleWidthXYPlot>\r\n    </Container>\r\n  )\r\n}\r\n","import gql from 'graphql-tag'\r\n\r\nexport const syncWithAmoContacts = gql`\r\n\tmutation SyncWithAmoContacts {\r\n\t\tsyncWithAmoContacts {\r\n\t\t\tcount\r\n\t\t}\r\n\t}\r\n`\r\n","import { object, number, string, date } from 'yup'\r\nimport { idValidationType } from './commonTypes'\r\nimport { toLocalISOString } from '../utils/dates';\r\n\r\nexport const validationSchema = object().shape({\r\n  id: idValidationType.notRequired(),\r\n  amount: number()\r\n    .positive('зачение должно быть положительным')\r\n    .when('id', (id, schema) => id\r\n      ? schema.notRequired()\r\n      : schema.required('введите сумму платежа'),\r\n    ),\r\n  articleId: idValidationType\r\n    .when('id', (id, schema) => id\r\n      ? schema.notRequired()\r\n      : schema.required('выберите основание платежа')\r\n    ),\r\n  dateLocal: date('неверный формат даты')\r\n    .when('id', (id, schema) => id\r\n      ? schema.notRequired()\r\n      : schema.required('введите дату и время в формате ГГГГ-ММ-ДДTЧЧ:ММ'),\r\n    ),\r\n    // TODO create proper isValidISODate function to check date\r\n    // .transform(function(value, originalValue) {\r\n    //   return isValidISODate(value) ? value : new Date('');\r\n    // }),\r\n  equipmentId: idValidationType\r\n    .notRequired(),\r\n    // TODO proper conditional validation of equipmentId\r\n    // equipmentId: idValidationType\r\n    //   .when('articleId', (articleId, schema) => \r\n    //     articles.find(a => a.id === articleId).relations.includes('EQUIPMENT')\r\n    //     ? schema.required('выберите оборудование')\r\n    //     : schema.strip()\r\n    //   ),\r\n  personId: idValidationType\r\n    .when('id', (id, schema) => id\r\n      ? schema.notRequired()\r\n      : schema.required('выберите контрагента')\r\n    ),\r\n  purpose: string()\r\n    .max(250, 'превышено максимальное число символов (250)')\r\n    .notRequired(),\r\n})\r\n\r\nexport const formikSchema = date => ({\r\n  dateLocal: toLocalISOString(date),\r\n  articleId: '',\r\n  equipmentId: '',\r\n  personId: '',\r\n  purpose: '',\r\n  amount: ''\r\n})\r\n","import React from 'react'\r\n\r\nimport { Mutation, Query } from 'react-apollo'\r\nimport { upsertPayment, paymentsPage } from '../../graphql/payment'\r\nimport { syncWithAmoContacts } from '../../graphql/amo'\r\n\r\nimport { Formik } from 'formik'\r\nimport { projectEntity, preparePayload } from '../form/utils'\r\nimport { formikSchema, validationSchema } from '../../schema/payment'\r\nimport Field from '../form/Field'\r\n\r\nimport { NotificationsConsumer } from '../notifications/NotificationsContext'\r\n\r\nimport styled from 'styled-components'\r\nimport { Button, A, Div } from '../styled/styled-semantic'\r\nimport { persons } from '../../graphql/person';\r\nimport produce from 'immer';\r\n\r\nconst Container = styled.div`\r\n\tmin-height: content;\r\n\tmax-width: 50%;\r\n\tmin-width: 430px;\r\n\tflex: 0 0 430px;\r\n\tbox-shadow: 0 2px 4px 0 rgba(34,36,38,.12), 0 2px 10px 0 rgba(34,36,38,.15);\r\n\tborder: 1px solid rgba(34,36,38,.15);\r\n\tborder-radius: .28571429rem;\r\n`\r\n\r\nconst Header = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\theight: 52px;\r\n\tpadding: 0 2rem;\r\n\tfont-size: 1.28571429rem;\r\n\tline-height: 1.28571429em;\r\n\tfont-weight: bold;\r\n\tborder-bottom: 1px solid rgba(34,36,38,.15);\r\n`\r\n\r\nconst Fields = styled.div`\r\n\t.fz-formFieldLabel {\r\n\t\t${({ labelWidth }) => labelWidth ? `flex-basis: ${labelWidth} !important;` : ''}\r\n\t}\r\n`\r\n\r\nexport default ({\r\n\tpayment,\r\n\treset,\r\n\tarticles,\r\n\tequipment\r\n}) => {\r\n\tlet schema = formikSchema(new Date())\r\n\tlet initialValues = payment ? projectEntity(payment, schema) : schema\r\n\tconst formLabelWidth = '110px'\r\n\tconst articleOptions = articles.map(a => \r\n\t\t({ key: a.id, text: a.rusName, value: a.id })\r\n\t)\r\n\tconst bankPayment = payment && payment.org\r\n\treturn (\r\n\t\t<NotificationsConsumer>\r\n\t\t\t{({ notify }) =>\r\n\t\t\t\t<Container>\r\n\t\t\t\t\t<Query\r\n\t\t\t\t\t\tquery={persons}\r\n\t\t\t\t\t\tonError={err => notify({\r\n\t\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\t\ttitle: 'Ошибка загрузки контактов',\r\n\t\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{({ loading: personsLoading,\r\n\t\t\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\t\t\trefetch: refetchPersons\r\n\t\t\t\t\t\t\t}) => <>\r\n\t\t\t\t\t\t\t<Mutation\r\n\t\t\t\t\t\t\t\tmutation={syncWithAmoContacts}\r\n\t\t\t\t\t\t\t\tonCompleted={() => {\r\n\t\t\t\t\t\t\t\t\trefetchPersons()\r\n\t\t\t\t\t\t\t\t\tnotify({\r\n\t\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Контакты синхронизированы'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tonError={err => notify({\r\n\t\t\t\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\t\t\t\ttitle: 'Ошибка синхронизации с Амо',\r\n\t\t\t\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{(syncWithAmoContacts, { loading }) => \r\n\t\t\t\t\t\t\t\t\t<Header>\r\n\t\t\t\t\t\t\t\t\t\t{(payment ? 'Изменить' : 'Добавить') + ' платеж'}\r\n\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\tml='auto'\r\n\t\t\t\t\t\t\t\t\t\t\ticon='sync alternate'\r\n\t\t\t\t\t\t\t\t\t\t\tcontent='Контакты AmoCRM'\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => syncWithAmoContacts()}\r\n\t\t\t\t\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</Header>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</Mutation>\r\n\t\t\t\t\t\t\t<Div\r\n\t\t\t\t\t\t\t\tp='1rem 2rem'\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Mutation\r\n\t\t\t\t\t\t\t\t\tmutation={upsertPayment}\r\n\t\t\t\t\t\t\t\t\tonCompleted={() => notify({\r\n\t\t\t\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Платеж сохранен'\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\tonError={err => notify({\r\n\t\t\t\t\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\t\t\t\t\ttitle: 'Ошибка сохранения',\r\n\t\t\t\t\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\tupdate={(cache, { data: { upsertPayment } }) => {\r\n\t\t\t\t\t\t\t\t\t\tconst { payments } = cache.readQuery({ query: paymentsPage })\r\n\t\t\t\t\t\t\t\t\t\tcache.writeQuery({\r\n\t\t\t\t\t\t\t\t\t\t\tquery: paymentsPage,\r\n\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tpayments: produce(payments, draft => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst foundIndex = draft.findIndex(p => p.id === upsertPayment.id)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn foundIndex\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? draft.splice(foundIndex, 1, upsertPayment)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: draft.unshift(upsertPayment)\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{(upsertPayment, { loading }) =>\r\n\t\t\t\t\t\t\t\t\t\t<Formik\r\n\t\t\t\t\t\t\t\t\t\t\tinitialValues={initialValues}\r\n\t\t\t\t\t\t\t\t\t\t\tenableReinitialize={true}\r\n\t\t\t\t\t\t\t\t\t\t\tvalidationSchema={validationSchema}\r\n\t\t\t\t\t\t\t\t\t\t\tonSubmit={async (values, { resetForm }) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t// console.log('values > ', values)\r\n\t\t\t\t\t\t\t\t\t\t\t\t// console.log('initialValues > ', initialValues)\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst input = preparePayload(values, initialValues, schema)\r\n\t\t\t\t\t\t\t\t\t\t\t\t// console.log('input > ', input)\r\n\t\t\t\t\t\t\t\t\t\t\t\tawait upsertPayment({ variables: { input } })\r\n\t\t\t\t\t\t\t\t\t\t\t\t// const upserted = await upsertPayment({ variables: { input } })\r\n\t\t\t\t\t\t\t\t\t\t\t\t// console.log('upserted > ', upserted)\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn payment ? reset() : resetForm()\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{({\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalues,\r\n\t\t\t\t\t\t\t\t\t\t\t\thandleSubmit,\r\n\t\t\t\t\t\t\t\t\t\t\t\thandleReset,\r\n\t\t\t\t\t\t\t\t\t\t\t}) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Fields\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabelWidth={formLabelWidth}\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{!bankPayment &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Field\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel='Дата'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='dateLocal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype='date'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Field\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel='Статья'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='articleId'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\toptions={articleOptions}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{!bankPayment &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Field\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel='Контрагент'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='personId'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toptions={data.persons\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? data.persons.map(p => \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t({ key: p.id, text: p.amoName || p.fName, value: p.id })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: undefined\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tloading={personsLoading}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={personsLoading}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{values.articleId \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& articles.find(a => a.id === values.articleId).relations\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& articles.find(a => a.id === values.articleId).relations.includes('EQUIPMENT') &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Field\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel='Оборудование'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='equipmentId'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\toptions={equipment.map(e => \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t({ key: e.id, text: e.name, value: e.id })\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{!bankPayment && <>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Field\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel='Назначение'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='purpose'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Field\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel='Сумма'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname='amount'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</>}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tml={formLabelWidth}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype='button'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={payment ? 'Сохранить' : 'Добавить'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleSubmit}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<A cancel\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={payment ? () => reset() : handleReset}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{payment ? 'Отмена' : 'Очистить'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</A>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Fields>\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t</Formik>\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</Mutation>\r\n\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t</>}\r\n\t\t\t\t\t</Query>\r\n\t\t\t\t</Container>\r\n\t\t\t}\r\n\t\t</NotificationsConsumer>\r\n\t)\r\n}\r\n\r\n","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Div } from '../styled/styled-semantic'\r\nimport { Statistic } from 'semantic-ui-react'\r\nimport { currency } from '../../utils/format';\r\n\r\nconst Container = styled.div`\r\n\tflex-grow: 1;\r\n\theight: 100%;\r\n\tmargin-left: 30px;\r\n  overflow-y: auto;\r\n\t>div {\r\n\t\twidth: 100%;\r\n\t}\r\n`\r\n\r\nconst SStatistic = styled(Statistic)`\r\n\t&&&&>.value {\r\n\t\t${({ color }) => color && `\r\n\t\t\tcolor: ${\r\n\t\t\t\tcolor === 'green' ? '#016936' :\r\n\t\t\t\tcolor === 'red' ? '#9f3a38' :\r\n\t\t\t\tcolor === 'purple' ? '#9924bf' :\r\n\t\t\t\t// color === 'violet' ? '#5d31bb' :\r\n\t\t\t\tcolor === 'blue' ? '#2185d0' :\r\n\t\t\t\tcolor\r\n\t\t\t};\r\n\t\t`}\r\n\t\ttext-align: unset;\r\n\t}\r\n\t&&&&>.label {\r\n\t\tpadding-left: 2em;\r\n\t\ttext-align: unset;\r\n\t}\r\n`\r\n\r\nexport default ({\r\n\tpayments,\r\n\taccounts,\r\n}) => {\r\n\t// TODO make postgres aggregation query on server side instead of reduce here\r\n\tconst accountsStats = payments\r\n\t\t.reduce((accounts, p) => {\r\n\t\t\tconst account = accounts.find(a => a.id === p.account.id)\r\n\t\t\tconst isIncome = p.article ? p.article.isIncome : p.isIncome\r\n\t\t\taccount.total += (isIncome ? 1 : -1) * p.amount\r\n\t\t\treturn accounts\r\n\t\t}, accounts.map(a => ({ ...a, total: 0 })))\r\n\tconst persons = payments\r\n\t\t.filter(p => !!p.person)\r\n\t\t.map(p => p.person)\r\n\t\t.reduce((uniquePersons, p) => {\r\n\t\t\tif (!uniquePersons.find(up => up.id === p.id))\r\n\t\t\t\tuniquePersons.push(p)\r\n\t\t\treturn uniquePersons\r\n\t\t}, [])\r\n\tconst deptsAndLoans = payments\r\n\t\t.filter(p => !!p.article)\r\n\t\t.filter(p => p.article.isLoan)\r\n\t\t.reduce((depts, p) => {\r\n\t\t\tconst person = depts.find(d => d.id === p.person.id)\r\n\t\t\tperson.total += (p.article.isIncome ? 1 : -1) * p.amount\r\n\t\t\treturn depts\r\n\t\t}, persons.map(a => ({ ...a, total: 0 })))\r\n\t\t.reduce((split, d) => {\r\n\t\t\tif (d.total > 0) split[1].push(d)\r\n\t\t\telse if (d.total < 0) split[0].push({ ...d, total: -1*d.total})\r\n\t\t\treturn split\r\n\t\t}, [[],[]])\r\n\treturn (\r\n\t\t<Container>\r\n\t\t\t<Statistic.Group>\r\n\t\t\t\t<SStatistic\r\n\t\t\t\t\tcolor='green'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Statistic.Value\r\n\t\t\t\t\t\tcontent={currency(accountsStats\r\n\t\t\t\t\t\t\t.filter(a => !a.number) // only cache accounts\r\n\t\t\t\t\t\t\t.reduce((sum, a) => sum + a.total, 0))}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Label\r\n\t\t\t\t\t\tcontent='Касса, в т.ч.'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Group\r\n\t\t\t\t\t\thorizontal\r\n\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{accountsStats\r\n\t\t\t\t\t\t\t.filter(a => !a.number)\r\n\t\t\t\t\t\t\t.map(({ id, name, total }) =>\r\n\t\t\t\t\t\t\t\t<Statistic\r\n\t\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t\tlabel={name}\r\n\t\t\t\t\t\t\t\t\tvalue={currency(total)} \r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Statistic.Group>\r\n\t\t\t\t</SStatistic>\r\n\t\t\t\t<SStatistic\r\n\t\t\t\t\tcolor='blue'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Statistic.Value\r\n\t\t\t\t\t\tcontent={currency(accountsStats\r\n\t\t\t\t\t\t\t.filter(a => !!a.number) // only bank accounts\r\n\t\t\t\t\t\t\t.reduce((sum, a) => sum + a.total, 0))}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Label\r\n\t\t\t\t\t\tcontent='Счета, в т.ч.'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Group\r\n\t\t\t\t\t\thorizontal\r\n\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{accountsStats\r\n\t\t\t\t\t\t\t.filter(a => !!a.number)\r\n\t\t\t\t\t\t\t.map(({ id, name, total }) =>\r\n\t\t\t\t\t\t\t\t<Statistic\r\n\t\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t\tlabel={name}\r\n\t\t\t\t\t\t\t\t\tvalue={currency(total)} \r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Statistic.Group>\r\n\t\t\t\t</SStatistic>\r\n\t\t\t\t<SStatistic\r\n\t\t\t\t\tcolor='purple'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Statistic.Value\r\n\t\t\t\t\t\tcontent={currency(deptsAndLoans[0].reduce((sum, l) => sum + l.total, 0))}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Label\r\n\t\t\t\t\t\tcontent='Нам должны, в т.ч.'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Group\r\n\t\t\t\t\t\thorizontal\r\n\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{deptsAndLoans[0].map(({ id, amoName, total }) =>\r\n\t\t\t\t\t\t\t<Statistic\r\n\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\tlabel={amoName.slice(0, amoName.lastIndexOf(' ') + 2) + '.'}\r\n\t\t\t\t\t\t\t\tvalue={currency(total)} \r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Statistic.Group>\r\n\t\t\t\t</SStatistic>\r\n\t\t\t\t<SStatistic\r\n\t\t\t\t\tcolor='red'\r\n\t\t\t\t>\r\n\t\t\t\t\t<Statistic.Value\r\n\t\t\t\t\t\tcontent={currency(-deptsAndLoans[1].reduce((sum, d) => sum + d.total, 0))}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Label\r\n\t\t\t\t\t\tcontent='Мы должны, в т.ч.'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Statistic.Group\r\n\t\t\t\t\t\thorizontal\r\n\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{deptsAndLoans[1].map(({ id, amoName, total }) =>\r\n\t\t\t\t\t\t\t<Statistic\r\n\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\tlabel={amoName.slice(0, amoName.lastIndexOf(' ') + 2) + '.'}\r\n\t\t\t\t\t\t\t\tvalue={currency(total)}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</Statistic.Group>\r\n\t\t\t\t</SStatistic>\r\n\t\t\t</Statistic.Group>\r\n\t\t</Container>\r\n\t)\r\n}\r\n\r\n","import React from 'react'\r\n\r\nimport Table from '../common/Table'\r\nimport TableRow from '../common/TableRow'\r\n\r\nimport styled from 'styled-components'\r\n\r\nconst Container = styled.div`\r\n  margin-top: 1rem;\r\n  max-height: 100%;\r\n  border: 1px solid rgba(34,36,38,.15);\r\n  border-radius: 0.285714rem;\r\n  .fz-tableHeaderRow {\r\n    border-top: none !important;\r\n  }\r\n`\r\n\r\nconst fields = [{\r\n  name: 'dateLocal',\r\n  path: 'dateLocal',\r\n\ttitle: 'Дата и время',\r\n\twidth: '145px'\r\n},{\r\n  name: 'article',\r\n  path: 'article.rusName',\r\n\ttitle: 'Статья',\r\n\twidth: '180px'\r\n},{\r\n  name: 'counterparty',\r\n  title: 'Контрагент',\r\n  width: '200px'\r\n},{\r\n  name: 'equipment',\r\n  path: 'equipment.name',\r\n  title: 'Оборудование',\r\n  width: '170px'\r\n},{\r\n  name: 'purpose',\r\n  path: 'purpose',\r\n  title: 'Назначение',\r\n  width: '270px',\r\n  truncated: true\r\n},{\r\n  name: 'amount',\r\n  path: 'amount',\r\n  title: 'Сумма',\r\n  width: '140px'\r\n}]\r\n\r\nexport default ({\r\n  payments,\r\n  onClickRow\r\n}) => {\r\n  //  TODO add CollectionUtils to support sorting\r\n  return (\r\n    <Container>\r\n      <Table\r\n        fields={fields}\r\n      >\r\n        {({ tableFields }) => \r\n          payments.map(payment => {\r\n            const { id, dateLocal, amount, person } = payment\r\n            const isIncome = payment.article ? payment.article.isIncome : payment.isIncome\r\n            return (\r\n              <TableRow\r\n                key={id}\r\n                entity={payment}\r\n                tableFields={tableFields}\r\n                rowFields={[\r\n                  {\r\n                    name: 'dateLocal',\r\n                    value: dateLocal.slice(0,16).replace('T', ' '),\r\n                  },\r\n                  {\r\n                    name: 'counterparty',\r\n                    path: person ? 'person.amoName' : 'org.name',\r\n                  },\r\n                  {\r\n                    name: 'amount',\r\n                    value: isIncome ? amount : -amount,\r\n                    color: isIncome ? '#016936' : '#9f3a38'\r\n                  }\r\n                ]}\r\n                onClick={() => onClickRow(id)}\r\n              />\r\n            )\r\n          }\r\n        )}\r\n      </Table>\r\n    </Container>\r\n  )\r\n}\r\n","import gql from 'graphql-tag'\r\n\r\nexport const syncWithTochkaPayments = gql`\r\n\tmutation SyncWithTochkaPayments {\r\n\t\tsyncWithTochkaPayments {\r\n\t\t\tcount\r\n\t\t}\r\n\t}\r\n`\r\n","import React, { useState } from 'react'\r\n\r\nimport { Query, Mutation } from 'react-apollo'\r\nimport { paymentsPage } from '../../graphql/payment'\r\n\r\nimport styled from 'styled-components'\r\nimport PaymentChart from './Chart'\r\nimport PaymentForm from './Form'\r\nimport PaymentStats from './Stats'\r\nimport PaymentTable from './Table'\r\nimport { syncWithTochkaPayments } from '../../graphql/tochka'\r\nimport { NotificationsConsumer } from '../notifications/NotificationsContext'\r\nimport { Button, Icon, Div } from '../styled/styled-semantic'\r\nimport { Route, Link, matchPath } from 'react-router-dom';\r\n\r\nconst Header = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\theight: 52px;\r\n\tpadding: 0 2rem;\r\n\tfont-size: 1.28571429rem;\r\n\tline-height: 1.28571429em;\r\n\tfont-weight: bold;\r\n\tborder-bottom: 1px solid rgba(34,36,38,.15);\r\n`\r\n\r\nconst SLink = styled(Link)`\r\n  color: rgba(0,0,0,.87) !important;\r\n`\r\n\r\nconst Container = styled.div`\r\n  height: calc(100% - 52px);\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 1rem;\r\n`\r\n\r\nconst TopSection = styled.div`\r\n  flex: 1 0 content;\r\n  min-height: ${308 + 47.5*2}px;\r\n  display: flex;\r\n  \r\n`\r\n\r\nconst BottomSection = styled.div`\r\n  flex: 1 1 2000px;\r\n  margin-top: 1rem;\r\n`\r\n\r\nexport default () => {\r\n  const [activePayment, setActivePayment] = useState(null)\r\n  return (\r\n    <NotificationsConsumer>\r\n\t\t\t{({ notify }) =>\r\n        <Query\r\n          query={paymentsPage}\r\n          onError={err => notify({\r\n            type: 'error',\r\n            title: 'Ошибка загрузки платежей',\r\n            content: err.message,\r\n          })}\r\n        >\r\n          {({ loading: paymentsLoading,\r\n              error,\r\n              data: {\r\n                payments,\r\n                articles,\r\n                accounts,\r\n                equipments: equipment\r\n              },\r\n              refetch: refetchPayments\r\n            }) => <>\r\n              <Mutation\r\n                mutation={syncWithTochkaPayments}\r\n                onCompleted={() => {\r\n                  refetchPayments()\r\n                  notify({\r\n                    type: 'success',\r\n                    title: 'Платежи синхронизированы с банком'\r\n                  })\r\n                }}\r\n                onError={err => notify({\r\n                  type: 'error',\r\n                  title: 'Ошибка синхронизации с Точкой',\r\n                  content: err.message,\r\n                })}\r\n              >\r\n                {(syncWithTochkaPayments, { loading }) => \r\n                  <Header>\r\n                    <SLink to=\"/pay\">Платежи</SLink>\r\n                    <Div\r\n                      ml='40px'\r\n                    >\r\n                      <SLink to=\"/pay/chart\">\r\n                        <Icon\r\n                          link\r\n                          name='chart bar outline'\r\n                          size='large'\r\n                          active={!!matchPath(\r\n                            window.location.href.replace(/.*#/, ''),\r\n                            '/pay/chart'\r\n                          )}\r\n                          activeColor='blue'\r\n                        />\r\n                      </SLink>\r\n                    </Div>\r\n                    <Button\r\n                      ml='auto'\r\n                      icon='sync alternate'\r\n                      content='Точка Банк'\r\n                      onClick={() => syncWithTochkaPayments()}\r\n                      loading={loading}\r\n                    />\r\n                  </Header>\r\n                }\r\n              </Mutation>\r\n              <Container>\r\n                { paymentsLoading ? 'Загрузка...' :\r\n                  error ? `Ошибка ${error.message}` : <>\r\n                    <TopSection>\r\n                      <Route\r\n                        exact\r\n                        path=\"/pay\"\r\n                        render={() => (<>\r\n                          <PaymentForm\r\n                            payment={activePayment}\r\n                            reset={() => setActivePayment(null)}\r\n                            articles={articles}\r\n                            equipment={equipment}\r\n                          />\r\n                          <PaymentStats\r\n                            payments={payments}\r\n                            accounts={accounts}\r\n                          />\r\n                        </>)}\r\n                      />\r\n                      <Route\r\n                        exact\r\n                        path=\"/pay/chart\"\r\n                        render={() => (\r\n                          <PaymentChart\r\n                            payments={payments}\r\n                          />\r\n                        )}\r\n                      />\r\n                    </TopSection>\r\n                    <BottomSection>\r\n                      <PaymentTable\r\n                        payments={payments}\r\n                        onClickRow={id => setActivePayment(payments.find(p => p.id === id))}\r\n                      />\r\n                    </BottomSection>\r\n                  </>\r\n                }\r\n              </Container>\r\n            </>\r\n          }\r\n        </Query>\r\n      }\r\n    </NotificationsConsumer>\r\n  )\r\n}\r\n\r\n","import React, { Component } from 'react'\r\nimport { HashRouter as Router, Switch, Route, Redirect } from 'react-router-dom'\r\n\r\nimport { AUTH_TOKEN } from '../constants'\r\nimport { isTokenExpired } from '../utils/jwtHelper'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { me } from '../graphql/user'\r\n\r\nimport LoginPage from './LoginPage'\r\nimport EnquiriesPage from './EnquiriesPage'\r\nimport PaymentsPage from './Payments/Page'\r\n\r\nclass Root extends Component {\r\n\tstate = {\r\n\t\ttoken: this.props.token\r\n\t}\r\n\t //verify localStorage check\r\n\tcomponentDidMount() {\r\n\t\tthis.bootStrapData()\r\n\t}\r\n\tbootStrapData = () => {\r\n\t\ttry {\r\n\t\t\tconst token = localStorage.getItem(AUTH_TOKEN)\r\n\t\t\tif (token !== null && token !== undefined) {\r\n\t\t\t\tconst expired = isTokenExpired(token)\r\n\t\t\t\tif (!expired) {\r\n\t\t\t\t\tthis.setState({ token: token })\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.refreshToken(null)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// maybe TODO - provide fatal error message\r\n\t\t \t console.log('')\r\n\t\t}\r\n\t}\r\n\trefreshToken = (token) => {\r\n\t\tif (token) {\r\n\t\t\tlocalStorage.setItem(AUTH_TOKEN, token)\r\n\t\t} else {\r\n\t\t\tlocalStorage.removeItem(AUTH_TOKEN)\r\n\t\t\tthis.props.client.resetStore()\r\n\t\t}\r\n\t\tthis.setState({ token })\r\n\t}\r\n\trender() {\r\n\t\tconst { token } = this.state\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t{ !token\r\n\t\t\t\t  ?\t<LoginPage refreshToken={this.refreshToken} />\r\n\t\t\t\t\t: <Query\r\n\t\t\t\t\t\t\tquery={me}\r\n\t\t\t\t\t\t\tdisplayName='meQuery'\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{({ loading, error, data }) => {\r\n\t\t\t\t\t\t\t\tif (loading) return null\r\n\t\t\t\t\t\t\t\tif (error) return `Error!: ${error.message}`\r\n\t\t\t\t\t\t\t\treturn <Switch>\r\n\t\t\t\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\t\t\t\texact\r\n\t\t\t\t\t\t\t\t\t\tpath=\"/\"\r\n\t\t\t\t\t\t\t\t\t\trender={() => (\r\n\t\t\t\t\t\t\t\t\t\t\t<EnquiriesPage\r\n\t\t\t\t\t\t\t\t\t\t\t\trefreshToken={this.refreshToken}\r\n\t\t\t\t\t\t\t\t\t\t\t\tme={data.me}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\t\t\t\tpath=\"/pay\"\r\n\t\t\t\t\t\t\t\t\t\trender={() => (\r\n\t\t\t\t\t\t\t\t\t\t\t<PaymentsPage\r\n\t\t\t\t\t\t\t\t\t\t\t\trefreshToken={this.refreshToken}\r\n\t\t\t\t\t\t\t\t\t\t\t\tme={data.me}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<Redirect to=\"/\" />\r\n\t\t\t\t\t\t\t\t</Switch>\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t</Query>\r\n\t\t\t\t}\r\n\t\t\t</Router>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default Root\r\n","import React from 'react'\r\n\r\nimport { ThemeProvider } from 'styled-components'\r\nimport { theme } from './components/styled/styled-semantic'\r\n\r\nimport { NotificationsProvider } from './components/notifications/NotificationsContext'\r\nimport NotificationsViewer from './components/notifications/NotificationsViewer'\r\nimport Root from './components/Root'\r\n\r\nconst App = ({ client }) => (\r\n\t<NotificationsProvider>\r\n\t\t<NotificationsViewer />\r\n\t\t<ThemeProvider theme={theme}>\r\n\t\t\t<Root client={client} />\r\n\t\t</ThemeProvider>\r\n\t</NotificationsProvider>\r\n)\r\n\r\nexport default App\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport 'semantic-ui-css/semantic.min.css'\r\nimport 'react-vis/dist/style.css'\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nimport { ApolloProvider } from 'react-apollo'\r\nimport { client } from './apollo/apollo'\r\n\r\nimport App from './App'\r\n\r\nReactDOM.render(\r\n\t<ApolloProvider client={client}>\r\n\t\t<App client={client}/>\r\n\t</ApolloProvider>\r\n, document.getElementById('root'))\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register()  below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister()\r\n"],"sourceRoot":""}