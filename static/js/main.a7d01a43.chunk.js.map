{"version":3,"sources":["serviceWorker.js","constants.js","apollo/defaults.js","graphql/layout.js","graphql/order.js","graphql/doc.js","graphql/status.js","graphql/enquiry.js","graphql/lists.js","apollo/resolvers.js","components/styled-semantic/styled-semantic.js","utils/jwtHelper.js","graphql/user.js","components/LoginPage.js","components/special/GlobalContext.js","components/EnquiriesSubmenu.js","components/EnquiriesMenu.js","components/common/Table.js","utils/format.js","components/common/TableRow.js","utils/object.js","components/EnquiriesTable.js","components/DetailsHeaderContainer.js","components/DetailsHeaderSubitle.js","components/DetailsHeaderTitle.js","components/DetailsHeaderButtons.js","components/common/RefreshButton.js","components/DetailsMainHeader.js","components/common/DraftEditor.js","components/common/WrappedDraftEditor.js","utils/dates.js","components/common/DatePicker.js","graphql/org.js","graphql/combinedQueries.js","utils/validateInn.js","components/EnquiryEdit.js","components/common/LocalDatePicker.js","components/common/CurrencyInput.js","components/common/SmartForm.js","components/EnquiryCommercialOffer.js","components/EnquiryDetails.js","components/common/SmartInput.js","components/OrderEdit.js","components/DetailsHeader.js","components/CollapsableSection.js","components/ProdsByDept.js","components/DeptProdTable.js","components/ReserveProdsButton.js","graphql/prod.js","components/special/ProdContext.js","components/ModelProdsSection.js","components/OrderDetails.js","components/DetailsDataProvider.js","components/Details.js","graphql/model.js","components/ProdTableUtils.js","components/special/ListProvider.js","components/special/OrderContext.js","components/DetailsExtra.js","components/DetailsSidebar.js","components/EnquiriesPage.js","components/Root.js","App.js","index.js","apollo/typeDefs.js"],"names":["Boolean","window","location","hostname","match","AUTH_TOKEN","defaults","newEnquiry","__typename","id","layout","details","extra","lists","selectedProdIds","getLayout","gql","_templateObject","getLayoutOptions","props","_ref","data","setLayout","_templateObject2","setExpanded","_templateObject3","orderFragmentBasic","order_templateObject","orderFragmentFull","order_templateObject2","upsertOrder","order_templateObject3","orderLocal","_templateObject4","orderDetails","_templateObject5","reserveProds","_templateObject6","docFragmentBasic","doc_templateObject","statusFragment","status_templateObject","allEnquiries","enquiry_templateObject","enquiryDetails","enquiry_templateObject2","enquiryLocal","enquiry_templateObject3","enquiry_templateObject4","createEnquiry","enquiry_templateObject5","updateEnquiry","enquiry_templateObject6","createEnquiryEvent","_templateObject7","enquiryFragment","_templateObject8","getLists","lists_templateObject","setList","lists_templateObject2","resolvers","Enquiry","isExpanded","Mutation","_","input","cache","query","readQuery","Object","objectSpread","writeQuery","_ref2","_ref3","_ref2$args","args","enquiryId","value","enquiries","find","e","_ref4","_ref5","name","theme","widths","formLabel","detailsPL","extraSidebar","colors","green","blue","getThemeColor","color","baseSet","w","m","mt","ml","pl","fs","fw","c","lh","ta","ws","concat","Div","styled","inline","rest","objectWithoutProperties","react_default","a","createElement","styled_semantic_templateObject","P","esm_extends","styled_semantic_templateObject2","Span","styled_semantic_templateObject3","A","styled_semantic_templateObject4","cancel","Header","styled_semantic_templateObject5","Label","label","styled_semantic_templateObject6","Caret","_ref6","active","disabled","Icon","assign","styled_semantic_templateObject7","size","Button","_ref7","activeColor","menu","styled_semantic_templateObject8","Message","_ref8","section","_templateObject9","Section","_ref9","head","minor","small","secondary","noP","noLP","noIndent","topBorder","bottomBorder","children","onClick","undefined","_templateObject10","Popup","_ref10","showIf","_templateObject11","Dropdown","SDropdown","_templateObject12","isTokenExpired","token","date","decoded","decode","exp","Date","setUTCSeconds","getTokenExpirationDate","valueOf","offsetSeconds","me","user_templateObject","meLocal","user_templateObject2","login","user_templateObject3","MenuDiv","div","LoginPage_templateObject","MenuHeader","LoginPage_templateObject2","SSegment","Segment","LoginPage_templateObject3","LoginPage","state","email","password","sendingRequest","error","handleInputChange","attr","_this","setState","defineProperty","submit","_callee","_this$state","result","regenerator_default","wrap","_context","prev","next","variables","sent","refreshToken","t0","message","stop","this","_this2","_this$state2","react","basic","Form","Field","type","placeholder","ref","onChange","header","content","primary","floated","loading","Component","compose","graphql","options","fetchPolicy","_ref$layout","setDetails","setExtra","setSelectedProdIds","SubmenuDiv","EnquiriesSubmenu_templateObject","special_GlobalContext","_ref$details","react_apollo_browser_umd","_data$enquiryLocal","num","addNewOrderForbidden","docs","some","d","styled_semantic_Header","styled_semantic_Popup","position","flowing","trigger","styled_semantic_Button","compact","circular","icon","Content","EnquiriesMenu_templateObject","EnquiriesMenu","refetchEnquiries","enquiriesAreLoading","EnquiriesMenu_MenuDiv","components_EnquiriesSubmenu","_data$me$person","person","fName","lName","menuNameTitle","slice","link","STable","table","Table_templateObject","TableHeader","tr","Table_templateObject2","Td","td","Table_templateObject3","Table","fields","indent","modes","select","fieldsExtended","expand","toConsumableArray","width","map","f","key","title","tableFields","path","currency","trailing","curNum","toFixed","replace","Row","TableRow_templateObject","lastSecondaryRow","bold","TableRow_templateObject2","service","TableRow","_ref$rowFields","rowFields","entity","expandFor","expanded","rf","selected","length","TableRow_Td","stopPropagation","val","obj","pathArr","split","i","getObjProp","iconColor","EnquiriesTable","common_Table","enquiry","common_TableRow","amount","orders","order","prods","org","model","SIcon","DetailsHeaderContainer_templateObject","SCaret","DetailsHeaderContainer_templateObject2","DetailsHeaderContainer","close","DetailsHeaderSubitle","text","DetailsHeaderTitle","subtitle","components_DetailsHeaderSubitle","DetailsHeaderButtons","SButton","RefreshButton_templateObject","RefreshButton","settings","titleNew","titleExisting","Order","DetailsMainHeader","closeDetails","refresh","editMode","_ref$localEntity","localEntity","dateLocal","components_DetailsHeaderContainer","components_DetailsHeaderTitle","components_DetailsHeaderButtons","common_RefreshButton","DraftEditor","editorState","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","newContent","getCurrentContent","_this$props","setEditorHasText","setEditorDiff","setHasFocus","hasText","oriContent","getSelection","getHasFocus","kolmechKeyBindingFn","keyCode","KeyBindingUtil","hasCommandModifier","getDefaultKeyBinding","handleKeyCommand","command","onSave","newState","RichUtils","clear","EditorState","push","ContentState","createFromText","exportHtml","html","stateToHTML","convertFromHTML","contentBlocks","initFromHtml","blocksFromHTML","createWithContent","createFromBlockArray","entityMap","createEmpty","Draft","keyBindingFn","readOnly","React","EditorWrapper","WrappedDraftEditor_templateObject","borderless","hasFocus","diff","WrappedDraftEditor","forwardedRef","common_DraftEditor","forwardRef","WrappedDraftEditor_WrappedDraftEditor","isValidDate","isNaN","tz","getTimezoneOffset","toLocalISOString","getTime","toISOString","fromLocalISOString","string","parse","PickerDiv","DatePicker_templateObject","DatePicker","selectedDate","selectDay","DayPickerInput_default","onDayChange","dayPickerProps","firstDayOfWeek","month","org_templateObject","org_templateObject2","createOrg","org_templateObject3","allOrgsAndModels","combinedQueries_templateObject","validateInn","inn","toString","test","code","indexOf","checkDigit","coefficients","n","parseInt","n11","n12","EnquiryEdit","changeFieldValue","field","newVal","_this$setState","console","log","fieldObj","cloneDeep","curVal","err","isNewEnquiry","oriVal","filter","includes","pickedDate","handleOrgDropdownSearchChange","searchQuery","orgDdn","search","handleModelDropdownSearchChange","modelDdn","handleQtyInputChange","selectOrg","selectModel","asyncToGenerator","mark","Error","componentIsMounted","abrupt","orgId","_x","_x2","apply","arguments","forEach","_callee2","res","_context2","_x3","_callee3","_context3","_x4","oriEnquiry","events","modelId","qty","keys","requiredFields","required","_this$props2","orgs","models","requiredIsEmpty","someFieldHasError","common_DatePicker","styled_semantic_Dropdown","selection","o","selectOnBlur","selectOnNavigation","onSearchChange","noResultsMessage","allowAdditions","additionLabel","onAddItem","Input","hidden","update","sort","b","_ref11","unshift","LocalDatePicker_templateObject","LocalDatePicker","handleDayChange","setField","_this$props$field","LocalDatePicker_PickerDiv","CurrencyInput","number_format_default","customInput","decimalSeparator","thousandSeparator","decimalScale","allowNegative","onValueChange","values","floatValue","SmartForm","isNewEntity","reduce","oriEntity","formState","EnquiryCommercialOffer","isNewCO","co","common_SmartForm","_ref$formState","common_LocalDatePicker","common_CurrencyInput","Divider","fitted","EnquiryDetails_templateObject","Tr","EnquiryDetails_templateObject2","EnquiryDetails_templateObject3","InputTd","extend","EnquiryDetails_templateObject4","EditorTd","EnquiryDetails_templateObject5","EnquiryDetails_templateObject6","Comments","Comment","Group","EnquiryDetails_templateObject7","CIcon","EnquiryDetails_templateObject8","UserLabel","EnquiryDetails_templateObject9","CContent","EnquiryDetails_templateObject10","CMetadata","Metadata","EnquiryDetails_templateObject11","CText","Text","EnquiryDetails_templateObject12","CMessage","_templateObject13","EnquiryDetails","editorRef","createRef","noteEditorRef","editorHasText","noteEditorDiff","noteKey","activeCO","creatingComment","changingStatus","statusPending","savingNote","enableEditMode","exitEditMode","bool","setNoteEditorDiff","cancelEdit","createComment","htmlText","current","changeStatus","coStatusId","enquiryQuery","statuses","s","statusId","doc","cancelPendingStatusChange","saveNote","htmlNote","coEvents","curStatus","status","pop","rawStatuses","orderStatusId","refusalStatusIds","stage","eventStatusPresentationHelpers","components_EnquiryEdit","EnquiryDetails_Table","EnquiryDetails_Td","_ref6$doc","common_WrappedDraftEditor","labelPosition","labeled","button","className","Math","abs","detail","Label_Label","components_EnquiryCommercialOffer","minimal","as","dividing","_e$user$person","user","userInitials","datetimeLocal","dangerouslySetInnerHTML","__html","sanitize","reply","newEvent","fragment","readFragment","writeFragment","skip","OrderEdit","_ref2$formState","SmartInput","upsertedOrder","DetailsHeader","buttons","titleSize","OuterSection","CollapsableSection_templateObject","InnerSection","CollapsableSection_templateObject2","CollapsableSection","forceExpanded","headerProps","components_DetailsHeader","ProdsByDept","oriProds","selectedIds","orderId","selectLimit","_ref$selectedProds","selectedProds","orderProdsQty","expandedIds","limitReached","allProds","unionBy","depts","sortBy","groupBy","dept","count","readyCount","p","progress","hasDefect","isSpoiled","prod","ordered","added","op","removed","sp","orderedCount","selectedCount","availCount","every","unreservedProdsCount","xor","xorBy","defaultFields","DeptProdTable","_ref$skipFields","skipFields","nameFieldWidth","IconRight","ReserveProdsButton_templateObject","ReserveProdsButton","prodIds","modelProds","prod_templateObject","prodsLocal","prod_templateObject2","ModelProdsSection","_ref$order","components_CollapsableSection","components_ReserveProdsButton","special_ProdContext","ids","components_ProdsByDept","components_DeptProdTable","mutation","styled_semantic_Message","OrderDetails","components_ModelProdsSection","query1","query2","localQuery1","localQuery2","localQuery","refetch","Container","Details_templateObject","Details","_ref2$details","components_DetailsDataProvider","components_DetailsMainHeader","components_EnquiryDetails","components_OrderEdit","components_OrderDetails","modelLocal","model_templateObject","ProdTableUtils","propDepts","list","newList","without","difference","idsWithinLimit","take","union","ListProvider","toggle","item","DetailsExtra_templateObject","DetailsExtra","closeExtra","DetailsExtra_Container","special_OrderContext","ListProvider_ListProvider","toggleExpanded","components_ProdTableUtils","SSidebar","Sidebar","DetailsSidebar_templateObject","DetailsSidebar","detailsClosing","setTimeout","_this$props$layout","visible","animation","direction","components_Details","components_DetailsExtra","Pushable","EnquiriesPage_templateObject","_ref$allEnquiries","networkStatus","components_EnquiriesMenu","components_DetailsSidebar","Pusher","components_EnquiriesTable","Root","bootStrapData","localStorage","getItem","setItem","removeItem","client","resetStore","components_EnquiriesPage","components_LoginPage","App","styled_components_browser_esm","components_Root","ApolloClient","uri","request","operation","setContext","headers","Authorization","clientState","typeDefs","InMemoryCache","dataIdFromObject","object","defaultDataIdFromObject","cacheRedirects","Query","getCacheKey","ReactDOM","render","src_App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.a7d01a43.chunk.js","sourcesContent":["// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n\r\n              // Execute callback\r\n              if (config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","export const AUTH_TOKEN = 'kolmech-token'\r\n","const defaults = {\r\n    // apolloClientDemo: {\r\n    //     __typename: ‘ApolloClientDemo’,\r\n    //     currentPageName: ‘Apollo Demo’,\r\n    // }\r\n    // alteredEnquiry: {\r\n    //     __typename: 'AlteredEnquiry',\r\n    //     // dateLocal: \r\n    //     // active: false,\r\n    // },\r\n    newEnquiry: {\r\n        __typename: 'Enquiry',\r\n        id: 'new'\r\n    },\r\n    layout: {\r\n        __typename: 'Layout',\r\n        details: null,\r\n        extra: null\r\n    },\r\n    lists: {\r\n        __typename: 'Lists',\r\n        selectedProdIds: [],\r\n    }\r\n}\r\n\r\nexport default defaults","import gql from 'graphql-tag'\r\n\r\nexport const getLayout = gql`\r\n\tquery getLayout {\r\n\t\tlayout @client {\r\n\t\t\tdetails\r\n\t\t\textra\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const getLayoutOptions = ({\r\n\tprops: ({ data: { layout } }) => {\r\n\t\treturn {\r\n\t\t\tlayout: layout || {}\r\n\t\t}\r\n\t}\r\n})\r\n\r\nexport const setLayout = gql`\r\n\tmutation SetLayout($details: json, $extra: json) {\r\n\t\tsetLayout(details: $details, extra: $extra) @client {\r\n\t\t\tresult\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const setExpanded = gql`\r\n\tmutation SetExpanded($args: json) {\r\n\t\tsetExpanded(args: $args) @client {\r\n\t\t\targs\r\n\t\t}\r\n\t}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const orderFragmentBasic = gql`\r\n\tfragment OrderFragmentBasic on Order {\r\n\t\tid\r\n\t\tnum\r\n\t\tdateLocal\r\n\t\tqty\r\n\t\tamount\r\n\t}\r\n`\r\n\r\nexport const orderFragmentFull = gql`\r\n\tfragment OrderFragmentFull on Order {\r\n\t\t...OrderFragmentBasic\r\n\t\thtmlNote\r\n\t\torg {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t\tmodel {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t\tprods {\r\n\t\t\tid\r\n\t\t\tfullnumber,\r\n\t\t\thasDefect,\r\n\t\t\tisSpoiled,\r\n\t\t\tprogress,\r\n\t\t\tdept {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\ttype\r\n\t\t\t}\r\n\t\t}\r\n\t\tevents {\r\n\t\t\tid\r\n\t\t\tdatetimeLocal\r\n\t\t\thtmlText\r\n\t\t\ttype\r\n\t\t\tuser {\r\n\t\t\t\tid\r\n\t\t\t\tperson {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tfName\r\n\t\t\t\t\tlName \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\tstage \r\n\t\t\t}\r\n\t\t\tdoc {\r\n\t\t\t\tid\r\n\t\t\t\tdateLocal\r\n\t\t\t\tamount\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${orderFragmentBasic}\r\n`\r\n\r\nexport const upsertOrder = gql`\r\n\tmutation UpsertOrder($id: ID, $enquiryId: ID, $dateLocal: String!, $qty: Int, $amount: Float) {\r\n\t\tupsertOrder(id: $id, enquiryId: $enquiryId, dateLocal: $dateLocal, qty: $qty, amount: $amount) {\r\n\t\t\t...OrderFragmentBasic\r\n\t\t\tenquiry {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${orderFragmentBasic}\r\n`\r\nexport const orderLocal = gql`\r\n\tquery OrderLocal ($id: ID!) {\r\n\t\torderLocal (id: $id) {\r\n\t\t\tid\r\n\t\t\tnum\r\n\t\t\tdateLocal\r\n\t\t\tqty\r\n\t\t\tamount\r\n\t\t}\r\n\t}\r\n`\r\nexport const orderDetails = gql`\r\n\tquery OrderDetails ($id: ID!) {\r\n\t\torder (id: $id) {\r\n\t\t\t...OrderFragmentFull\r\n\t\t}\r\n\t}\r\n\t${orderFragmentFull}\r\n`\r\nexport const reserveProds = gql`\r\n\tmutation ReserveProds ($orderId: ID!, $prodIds: [ID!]!) {\r\n\t\treserveProds (orderId: $orderId, prodIds: $prodIds) {\r\n\t\t\t...OrderFragmentFull\r\n\t\t}\r\n\t}\r\n\t${orderFragmentFull}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const docFragmentBasic = gql`\r\n\tfragment DocFragmentBasic on Doc {\r\n\t\tid\r\n\t\ttype\r\n\t\tdateLocal\r\n\t\tamount\r\n\t}\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const statusFragment = gql`\r\n\tfragment StatusFragment on Status {\r\n\t\tid\r\n    name\r\n    stage\r\n\t}\r\n`","import gql from 'graphql-tag'\r\nimport { orderFragmentBasic } from './order'\r\nimport { docFragmentBasic } from './doc'\r\nimport { statusFragment } from './status'\r\n\r\nexport const allEnquiries = gql`\r\n\tquery AllEnquiries {\r\n\t\tenquiries {\r\n\t\t\tid\r\n\t\t\tnum\r\n\t\t\tdateLocal\r\n\t\t\thtmlNote\r\n\t\t\tisExpanded @client\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel {\r\n\t\t\t\tid\r\n\t\t\t\tarticle\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tqty\r\n\t\t\torders {\r\n\t\t\t\t...OrderFragmentBasic\r\n\t\t\t\tprods {\r\n\t\t\t\t\tid\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus { ...StatusFragment }\r\n\t\t\tdocs { ...DocFragmentBasic }\r\n\t\t}\r\n\t}\r\n\t${orderFragmentBasic}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\nexport const enquiryDetails = gql`\r\n\tquery EnquiryDetails ($id: ID!) {\r\n\t\tenquiry (id: $id) {\r\n\t\t\tid\r\n\t\t\tnum\r\n\t\t\tdateLocal\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel {\r\n\t\t\t\tid\r\n\t\t\t\tarticle\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tqty\r\n\t\t\tevents {\r\n\t\t\t\tid\r\n\t\t\t\tdatetimeLocal\r\n\t\t\t\thtmlText\r\n\t\t\t\ttype\r\n\t\t\t\tuser {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tperson {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t\tfName\r\n\t\t\t\t\t\tlName \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstatus { ...StatusFragment }\r\n\t\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t\t}\r\n\t\t}\r\n\t\tstatuses {\r\n\t\t\tid\r\n\t\t\tstage\r\n\t\t\tname\r\n\t\t\tprev {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t\tnext {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\nexport const enquiryLocal = gql`\r\n\tquery EnquiryLocal ($id: ID!) {\r\n\t\tenquiryLocal (id: $id) {\r\n\t\t\tid\r\n\t\t\tnum\r\n\t\t\tdateLocal\r\n\t\t\tdocs { ...DocFragmentBasic }\r\n\t\t}\r\n\t}\r\n\t${docFragmentBasic}\r\n`\r\nexport const newEnquiry = gql`\r\n\tquery {\r\n\t\tnewEnquiry @client {\r\n\t\t\tid\r\n\t\t}\r\n\t\tstatuses {\r\n\t\t\tid\r\n\t\t\tstage\r\n\t\t\tname\r\n\t\t\tprev {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t\tnext {\r\n\t\t\t\tid\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\nexport const createEnquiry = gql`\r\n\tmutation createEnquiry($dateLocal: String!, $orgId: ID!, $modelId: ID!, $qty: Int!) {\r\n\t\tcreateEnquiry(dateLocal: $dateLocal, orgId: $orgId, modelId: $modelId, qty: $qty) {\r\n\t\t\tid\r\n\t\t\tnum\r\n\t\t\tdateLocal\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel {\r\n\t\t\t\tid\r\n\t\t\t\tarticle\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tqty\r\n\t\t\tstatus { ...StatusFragment }\r\n\t\t\tdocs { ...DocFragmentBasic }\r\n\t\t\tevents {\r\n\t\t\t\tid\r\n\t\t\t\tdatetimeLocal\r\n\t\t\t\thtmlText\r\n\t\t\t\ttype\r\n\t\t\t\tuser {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tperson {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t\tfName\r\n\t\t\t\t\t\tlName \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstatus { ...StatusFragment }\r\n\t\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t\t}\r\n\t\t\torders {\r\n\t\t\t\tid\r\n\t\t\t\tnum\r\n\t\t\t\tdateLocal\r\n\t\t\t\tqty\r\n\t\t\t\tamount\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\nexport const updateEnquiry = gql`\r\n\tmutation UpdateEnquiry($input: EnquiryInput!) {\r\n\t\tupdateEnquiry(input: $input) {\r\n\t\t\tid\r\n\t\t\tnum\r\n\t\t\tdateLocal\r\n\t\t\thtmlNote\r\n\t\t\torg {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tmodel {\r\n\t\t\t\tid\r\n\t\t\t\tarticle\r\n\t\t\t\tname\r\n\t\t\t}\r\n\t\t\tqty\r\n\t\t\tevents {\r\n\t\t\t\tid\r\n\t\t\t\tdatetimeLocal\r\n\t\t\t\thtmlText\r\n\t\t\t\ttype\r\n\t\t\t\tuser {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tperson {\r\n\t\t\t\t\t\tid\r\n\t\t\t\t\t\tfName\r\n\t\t\t\t\t\tlName\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstatus { ...StatusFragment }\r\n\t\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\n\r\nexport const createEnquiryEvent = gql`\r\n\tmutation CreateEnquiryEvent($enquiryId: ID!, $htmlText: String, $statusId: ID, $doc: DocCreateInput) {\r\n\t\tcreateEnquiryEvent(enquiryId: $enquiryId, htmlText: $htmlText, statusId: $statusId, doc: $doc) {\r\n\t\t\tid\r\n\t\t\tdatetimeLocal\r\n\t\t\thtmlText\r\n\t\t\ttype\r\n\t\t\tuser {\r\n\t\t\t\tid\r\n\t\t\t\tperson {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tfName\r\n\t\t\t\t\tlName\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus { ...StatusFragment }\r\n\t\t\tdoc { ...DocFragmentBasic }\r\n\t\t}\r\n\t}\r\n\t${docFragmentBasic}\r\n\t${statusFragment}\r\n`\r\n\r\nexport const enquiryFragment = gql`\r\n\tfragment myEnquiry on Enquiry {\r\n\t\tid\r\n\t\tnum\r\n\t\tdateLocal\r\n\t\thtmlNote\r\n\t\tisExpanded\r\n\t\torg {\r\n\t\t\tid\r\n\t\t\tname\r\n\t\t}\r\n\t\tmodel {\r\n\t\t\tid\r\n\t\t\tarticle\r\n\t\t\tname\r\n\t\t}\r\n\t\tqty\r\n\t\tevents {\r\n\t\t\tid\r\n\t\t\tdatetimeLocal\r\n\t\t\thtmlText\r\n\t\t\ttype\r\n\t\t\tuser {\r\n\t\t\t\tid\r\n\t\t\t\tperson {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tfName\r\n\t\t\t\t\tlName \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstatus {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\tstage \r\n\t\t\t}\r\n\t\t\tdoc {\r\n\t\t\t\tid\r\n\t\t\t\tdateLocal\r\n\t\t\t\tamount\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n\r\n\r\n// export const alteredEnquiry = gql`\r\n//     query AlteredEnquiry($id: ID!) {\r\n//         alteredEnquiry(id: $id) @client\r\n//     }\r\n// `\r\n\r\n// export const updateAlteredEnquiry = gql`\r\n//     mutation UpdateAlteredEnquiry($key: String!, $value: String!) {\r\n//         updateAlteredEnquiry(key: $key, value: $value) @client\r\n//     }\r\n// `","import gql from 'graphql-tag'\r\n\r\nexport const getLists = gql`\r\n\tquery getLists {\r\n\t\tlists @client {\r\n\t\t\tselectedProdIds\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const getListsOptions = ({\r\n\tprops: ({ data: { lists } }) => ({\r\n    lists: lists || {}\r\n\t})\r\n})\r\n\r\nexport const setList = gql`\r\n\tmutation SetList($name: String!, $value: [ID!]) {\r\n\t\tsetList(name: $name, value: $value) @client {\r\n\t\t\tresult\r\n\t\t}\r\n\t}\r\n`","import { getLayout } from '../graphql/layout'\r\nimport { allEnquiries } from '../graphql/enquiry'\r\nimport { getLists } from '../graphql/lists'\r\n\r\nconst resolvers = {\r\n\tEnquiry: {\r\n\t\tisExpanded: () => false\r\n\t},\r\n\tMutation: {\r\n\t\tsetLayout: (_, input, { cache }) => {\r\n\t\t\tconst query = getLayout\r\n\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\tdata.layout = {\r\n\t\t\t\t...data.layout,\r\n\t\t\t\t...input\r\n\t\t\t}\r\n\t\t\tcache.writeQuery({ query, data })\r\n\t\t\treturn null\r\n\t\t},\r\n\t\tsetExpanded: (_, { args: { id: enquiryId, value } }, { cache }) => {\r\n\t\t\tconst query = allEnquiries\r\n\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\tconst enquiry = data.enquiries.find(e => e.id === enquiryId)\r\n\t\t\tenquiry.isExpanded = value\r\n\t\t\tcache.writeQuery({ query, data })\r\n\t\t\treturn null\r\n\t\t},\r\n\t\tsetList: (_, { name, value }, { cache }) => {\r\n\t\t\tconst query = getLists\r\n\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\tdata.lists[name] = value\r\n\t\t\tcache.writeQuery({ query, data })\r\n\t\t\treturn null\r\n\t\t},\r\n\t}\r\n}\r\n\r\nexport default resolvers","import React from 'react'\r\nimport styled from 'styled-components'\r\n\r\n// S prefix is used throughout the App just to have flexebility (two names for each component)\r\n// N prefix stands for NativeCssImplementation of a component (When html element is styled instead of semantic ui component) \r\n\r\nimport { \r\n\tHeader as SHeader, \r\n\t// Label as SLabel,\r\n\tIcon as SIcon, \r\n\tButton as SButton,\r\n\tMessage as SMessage,\r\n\tPopup as SPopup,\r\n\tDropdown as SDropdown\r\n} from 'semantic-ui-react'\r\n\r\nexport const theme = {\r\n\twidths: {\r\n\t\tformLabel: '122px', //required calc(110px + 0.857143em)\r\n\t\tdetailsPL: '55px',\r\n\t\textraSidebar: '250px'\r\n\t},\r\n\tcolors: {\r\n\t\tgreen: '#016936',\r\n\t\tblue: '#0E6EB8'\r\n\t}\r\n}\r\nconst getThemeColor = (color) => theme.colors[color] || color\r\nconst baseSet = ({ theme, w, m, mt, ml, pl, fs, fw, c, lh, ta, ws }) => {\r\n\treturn `\r\n\t\t${w ? `width: ${theme.widths[w] || w};`: ''}\r\n\t\t${m ? `margin: ${m};`: ''}\r\n\t\t${mt ? `margin-top: ${mt};`: ''}\r\n\t\t${ml ? `margin-left: ${ml};`: ''}\r\n\t\t${pl ? `padding-left: ${pl};`: ''}\r\n\t\t${fs ? `font-size: ${fs};`: ''}\r\n\t\t${fw ? `font-weight: ${fw};`: ''}\r\n\t\t${c ? `color: ${c};`: ''}\r\n\t\t${lh ? `line-height: ${lh};`: ''}\r\n\t\t${ta ? `text-align: ${ta};`: ''}\r\n\t\t${ws ? `word-spacing: ${ws};`: ''}\r\n\t`\r\n}\r\n\r\nconst DivWithFilteredProps = ({ ml, inline, ...rest }) => (\r\n\t<div {...rest} />\r\n)\r\nexport const Div = styled(DivWithFilteredProps)`\r\n\t${props => props.inline && `display: inline-block;`}\r\n\t${props => baseSet(props)}\r\n`\r\n\r\nconst PWithFilteredProps = ({ ...rest }) => (\r\n\t<p {...rest} />\r\n)\r\nexport const P = styled(PWithFilteredProps)`\r\n\t${props => baseSet(props)}\r\n`\r\n\r\nconst SpanWithFilteredProps = ({ ml, ...rest }) => (\r\n\t<span {...rest} />\r\n)\r\nexport const Span = styled(SpanWithFilteredProps)`\r\n\t${props => baseSet(props)}\r\n`\r\n\r\nexport const A = styled.a`\r\n\tcursor: pointer;\r\n\t${props => props.cancel && `{\r\n\t\tpadding-left: 15px;\r\n\t\tcolor: rgba(0,0,0,.87);\r\n\t\t&:hover {\r\n\t\t\tcolor: #B03060;\r\n\t\t}\r\n\t}`}\r\n`\r\n\r\nconst HeaderWithFilteredProps = ({ inline, c, ...rest }) => (\r\n\t<SHeader {...rest} />\r\n)\r\nexport const Header = styled(HeaderWithFilteredProps)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n\t&&& {\r\n\t\t${props => props.inline && `{\r\n\t\t\tmargin: 0;\r\n\t\t\tpadding: 0 1rem;\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nexport const Label = styled.label`\r\n\twidth: ${props => props.theme.widths.formLabel} !important;\r\n\tmargin-right: 0 !important;\r\n`\r\n\r\nconst DropdownIcon = ({active, disabled, ...rest}) => (\r\n\t<SIcon {...rest}\r\n\t\tname='dropdown'\r\n\t/>\r\n)\r\nexport const Caret = styled(DropdownIcon)`\r\n\ttransform: ${\r\n\t\tprops => !props.active && (\r\n\t\t\tprops.size === 'large'\r\n\t\t\t? 'translateX(0) translateY(0) rotate(-90deg) !important'\r\n\t\t\t: 'translateX(-3px) translateY(3px) rotate(-90deg) !important'\r\n\t\t)\r\n\t};\r\n\t&&& {\r\n\t\t${props => props.disabled && `{\r\n\t\t\tcolor: rgba(0,0,0,.6);\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nconst ButtonWithFilteredProps = ({ activeColor, menu, ...rest }) => (\r\n\t<SButton {...rest} />\r\n)\r\nexport const Button = styled(ButtonWithFilteredProps)`\r\n\t&&&& {\r\n\t\t${props => baseSet(props)}\r\n\t}\r\n\t&&& {\r\n\t\t&.compact {\r\n\t\t\tpadding: .5rem 1rem;\r\n\t\t}\r\n\t\t${props => props.activeColor && `{\r\n\t\t\t&:hover {\r\n\t\t\t\tcolor: ${getThemeColor(props.activeColor)} !important;\r\n\t\t\t}\r\n\t\t\t&.active {\r\n\t\t\t\tcolor: ${getThemeColor(props.activeColor)} !important;\r\n        \t}\r\n\t\t}`}\r\n\t\t${props => props.menu && `{\r\n\t\t\tmargin: .25rem 0 .25rem 0.5rem;\r\n\t\t\tz-index: 3;\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nconst MessageWithFilteredProps = ({\r\n\tsection,\r\n\t...rest\r\n}) => (\r\n\t<SMessage {...rest} />\r\n)\r\nexport const Message = styled(MessageWithFilteredProps)`\r\n\t&&& {\r\n\t\t${props => props.section && `\r\n\t\t\tmargin-top: 0;\r\n\t\t\tpadding-left: ${props.theme.widths.detailsPL};\r\n\t\t\tbox-shadow: 0 0 0 1px #e0b4b4, 0 0 0 0 transparent;\r\n\t\t\tborder-radius: 0;\r\n\t\t`}\r\n\t}\r\n`\r\n\r\nconst SectionPropFiltered = ({\r\n\thead,\r\n\tminor,\r\n\tsmall,\r\n\tsecondary,\r\n\tnoP,\r\n\tnoLP,\r\n\tnoIndent,\r\n\ttopBorder,\r\n\tbottomBorder,\r\n\tchildren,\r\n\tonClick,\r\n\t...rest\r\n}) => (\r\n\t\t<div\r\n\t\t\t{...rest}\r\n\t\t\tonClick={onClick || undefined}\r\n\t\t>\r\n\t\t\t{children}\r\n\t\t</div>\r\n)\r\nexport const Section = styled(SectionPropFiltered)`\r\n\twidth: 100%;\r\n\tpadding: 1em 1em 1em 55px;\r\n\t${props => props.head && `{\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding-top: 0;\r\n\t\tpadding-bottom: 0;\r\n\t}`}\r\n\t${props => props.onClick && `{\r\n\t\tcursor: pointer;\r\n\t}`}\r\n\t${props => props.minor && `{\r\n\t\tmin-height: 3.5em;\r\n\t}`}\r\n\t${props => !props.size && props.head && `{\r\n\t\tmin-height: 3.5em;\r\n\t}`}\r\n\t${props => props.size === 'small' && `{\r\n\t\tmin-height: 2.5em;\r\n\t}`}\r\n\t${props => props.secondary && `{\r\n\t\tbackground: #f3f4f5;\r\n\t\tcolor: rgba(0,0,0,.6);\r\n\t}`}\r\n\t${props => props.noLP && `{\r\n\t\tpadding-left: 0;\r\n\t}`}\r\n\t${props => props.noIndent && `{\r\n\t\tpadding-left: 1em;\r\n\t}`}\r\n\t${props => props.topBorder && `{\r\n\t\tborder-top: 1px solid ${props.topBorder === 'dark' ? 'rgba(152, 153, 154, 1)' : 'rgba(34,36,38,.15)'};\r\n\t}`}\r\n\t${props => props.bottomBorder && `{\r\n\t\tborder-bottom: 1px solid ${props.bottomBorder === 'dark' ? 'rgba(126, 127, 129, 1)' : 'rgba(34,36,38,.1)'};\r\n\t}`}\r\n`\r\n\r\nconst PopupWithFilteredProps = ({ showIf, ...rest }) => (\r\n\t<SPopup {...rest} />\r\n)\r\nexport const Popup = styled(PopupWithFilteredProps)`\r\n\t&&& {\r\n\t\t${props => !props.showIf && `{\r\n\t\t\topacity: 0;\r\n\t\t}`}\r\n\t}\r\n`\r\n\r\nexport const Dropdown = styled(SDropdown)`\r\n\t&&&&&& {\r\n\t\twidth: 350px;\r\n\t\t&:hover {\r\n\t\t\tborder-color: rgba(34, 36, 38, 0.15);\r\n\t\t}\r\n\t}\r\n`\r\n","import decode from 'jwt-decode'\r\n\r\nexport function getTokenExpirationDate(token) {\r\n  const decoded = decode(token)\r\n  if (!decoded.exp) {\r\n    return null\r\n  }\r\n  const date = new Date(0) // The 0 here is the key, which sets the date to the epoch\r\n  date.setUTCSeconds(decoded.exp)\r\n  return date\r\n}\r\n\r\nexport function isTokenExpired(token) {\r\n  const date = getTokenExpirationDate(token)\r\n  const offsetSeconds = 0\r\n  if (date === null) {\r\n    return false\r\n  }\r\n  return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000)\r\n}\r\n","import gql from 'graphql-tag'\r\n\r\nexport const me = gql`\r\n\tquery Me {\r\n\t\tme {\r\n\t\t\tid\r\n\t\t\temail\r\n\t\t\tperson {\r\n\t\t\t\tfName\r\n\t\t\t\tlName\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const meLocal = gql`\r\n\tquery MeLocal {\r\n\t\tme @client {\r\n\t\t\tperson {\r\n\t\t\t\tfName\r\n\t\t\t\tlName\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n\r\nexport const login = gql`\r\n\tmutation Login($email: String!, $password: String!) {\r\n\t\tlogin(email: $email, password: $password) {\r\n\t\t\ttoken\r\n\t\t}\r\n\t}\r\n`","import React, { Component, Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Header, Form, Message, Button, Segment } from 'semantic-ui-react'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { login } from '../graphql/user'\r\n\r\nconst MenuDiv = styled.div`\r\n\tborder-bottom: 1px solid #7e7e81;\r\n\t// height: 35px;\r\n`\r\n\r\nconst MenuHeader = styled(Header)`\r\n\tdisplay: inline;\r\n\tpadding: 0 1rem !important;\r\n`\r\n\r\nconst SSegment = styled(Segment)`\r\n\tmax-width: 350px !important;\r\n\tmargin: auto !important;\r\n`\r\n\r\nclass LoginPage extends Component {\r\n\tstate = {\r\n\t\temail: '',\r\n\t\tpassword: '',\r\n\t\tsendingRequest: false,\r\n\t\terror: ''\r\n\t}\r\n\thandleInputChange = (attr) => {\r\n\t\tthis.setState({ [attr]: this[attr].value })\r\n\t}\r\n\tsubmit = async () => {\r\n\t\ttry {\r\n\t\t\tconst { email, password } = this.state\r\n\t\t\tthis.setState({ sendingRequest: true })\r\n\t\t\tconst result = await this.props.login({\r\n\t\t\t\tvariables: {\r\n\t\t\t\t\temail,\r\n\t\t\t\t\tpassword\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconst token = result.data.login.token\r\n\t\t\tthis.setState({ sendingRequest: false })\r\n\t\t\tthis.props.refreshToken(token)\r\n\t\t} catch (err) {\r\n\t\t\tthis.setState({ error: err.message, sendingRequest: false })\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\tconst { email, password, sendingRequest, error } = this.state\r\n\t\treturn (\r\n\t\t\t<Fragment>\r\n\t\t\t\t<MenuDiv>\r\n\t\t\t\t\t<MenuHeader size='large'>\r\n\t\t\t\t\t\t<i>Колмех</i>\r\n\t\t\t\t\t</MenuHeader>\r\n\t\t\t\t</MenuDiv>\r\n\t\t\t\t<SSegment basic>\r\n\t\t\t\t\t<Form error={!!error}>\r\n\t\t\t\t\t\t<Form.Field>\r\n\t\t\t\t\t\t\t<label>E-mail</label>\r\n\t\t\t\t\t\t\t<input \r\n\t\t\t\t\t\t\t\ttype=\"email\" \r\n\t\t\t\t\t\t\t\tplaceholder='E-mail'\r\n\t\t\t\t\t\t\t\tref={ref => this.email = ref} \r\n\t\t\t\t\t\t\t\tonChange={() => this.handleInputChange('email')} />\r\n\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t<Form.Field>\r\n\t\t\t\t\t\t\t<label>Пароль</label>\r\n\t\t\t\t\t\t\t<input \r\n\t\t\t\t\t\t\t\ttype=\"password\" \r\n\t\t\t\t\t\t\t\tplaceholder='Пароль'\r\n\t\t\t\t\t\t\t\tref={ref => this.password = ref} \r\n\t\t\t\t\t\t\t\tonChange={() => this.handleInputChange('password')} />\r\n\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\theader='Войти не удалось..'\r\n\t\t\t\t\t\t\tcontent={error} />\r\n\t\t\t\t\t\t<Button \r\n\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\ttype='submit'\r\n\t\t\t\t\t\t\tfloated='right'\r\n\t\t\t\t\t\t\tdisabled={!email || !password || sendingRequest}\r\n\t\t\t\t\t\t\tloading={sendingRequest}\r\n\t\t\t\t\t\t\tonClick={this.submit} >\r\n\t\t\t\t\t\t\tВойти\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Form>\r\n\t\t\t\t</SSegment>\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(login, {\r\n\t\tname: 'login',\r\n\t\toptions: {\r\n\t\t\tfetchPolicy: 'no-cache'\r\n\t\t}\r\n\t})\r\n)(LoginPage)","import { compose, graphql } from 'react-apollo'\r\nimport { getLayout, getLayoutOptions, setLayout, setExpanded } from '../../graphql/layout'\r\nimport { getLists, getListsOptions, setList } from '../../graphql/lists'\r\n\r\n// const GlobalContext = React.createContext()\r\n\r\n// class GlobalContextProvider extends Component {\r\n// \t// setDetails = (details) => {\r\n// \t// \tthis.props.setLayout({variables: { details }})\r\n// \t// }\r\n// \trender() {\r\n// \t\tconst { children, getLayout: { details }, setLayout } = this.props\r\n// \t\treturn (\r\n// \t\t\t<GlobalContext.Provider \r\n// \t\t\t\tvalue={{\r\n// \t\t\t\t\tdetails,\r\n// \t\t\t\t\tsetDetails: (details) => setLayout({variables: { details }})\r\n// \t\t\t\t}}\r\n// \t\t\t>\r\n// \t\t\t\t{children}\r\n// \t\t\t</GlobalContext.Provider>\r\n// \t\t)\r\n// \t}\r\n// }\r\n\r\nconst GlobalContext = ({\r\n\t\tchildren,\r\n\t\tlayout: { details, extra },\r\n\t\tsetLayout,\r\n\t\tsetExpanded,\r\n\t\tlists: { selectedProdIds },\r\n\t\tsetList\r\n}) => {\r\n\t// setLayout({ variables: { \r\n\t// \tdetails: {\"type\":\"Order\",\"id\":\"cjmzkpstb00170983jkb7bcbq\"},\r\n\t// \textra: {\"type\":\"Store\",\"modelId\":\"cjcfy68q55d3x0149fcpq7l63\",\"orderId\":\"cjmzkpstb00170983jkb7bcbq\"}\r\n\t// } })\r\n  return children({\r\n\t\tdetails,\r\n\t\textra,\r\n\t\tsetDetails: (details) => {\r\n\t\t\tsetLayout({ variables: { \r\n\t\t\t\tdetails,\r\n\t\t\t\textra: null\r\n\t\t\t\t// ...details.type === 'Enquiry' && { extra: null }\r\n\t\t\t}})\r\n\t\t},\r\n\t\tsetExtra: (extra) => setLayout({ variables: { extra } }),\r\n\t\tsetExpanded: (args) => setExpanded({variables: { args }}),\r\n\t\tselectedProdIds,\r\n\t\tsetSelectedProdIds: (value) => \r\n\t\t\tsetList({variables: { name: 'selectedProdIds', value }}),\r\n\t})\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(getLayout, getLayoutOptions),\r\n\tgraphql(setLayout, { name: 'setLayout' }),\r\n\tgraphql(setExpanded, { name: 'setExpanded' }),\r\n\tgraphql(getLists, getListsOptions),\r\n\tgraphql(setList, { name: 'setList' }),\r\n)(GlobalContext)\r\n\t\r\n// export default GlobalContextProvider\r\n// export const GlobalContextConsumer = GlobalContext.Consumer","import React from 'react'\r\n\r\nimport { Icon, Popup as SPopup } from 'semantic-ui-react'\r\nimport { Div, Header, Button, Popup } from './styled-semantic/styled-semantic'\r\nimport styled from 'styled-components'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { getLayout, getLayoutOptions, setLayout } from '../graphql/layout'\r\nimport { enquiryLocal } from '../graphql/enquiry'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nconst SubmenuDiv = styled.div`\r\n\talign-self: stretch;\r\n\tposition: relative;\r\n\tmargin-left: 10px;\r\n\tpadding: 0 1em;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tbackground-color: #f5f6f7;\r\n\tborder-top-right-radius: .35rem;\r\n\tborder-bottom-right-radius: .35rem;\r\n\t::before {\r\n\t\tposition: absolute;\r\n\t\tz-index: 2;\r\n\t\tcontent: '';\r\n\t\ttop: 50%;\r\n\t\tleft: 0;\r\n\t\tbackground-color: #fff;\r\n\t\twidth: 1.74em;\r\n\t\theight: 1.74em;\r\n\t\ttransform: translateY(-50%) translateX(-50%) rotate(-45deg);\r\n\t}\r\n\t/* ::after {\r\n\t\tposition: absolute;\r\n\t\tz-index: 2;\r\n\t\tcontent: '';\r\n\t\ttop: 50%;\r\n\t\tright: 0;\r\n\t\tbackground-color: #f3f4f5;\r\n\t\twidth: 1.74em;\r\n\t\theight: 1.74em;\r\n\t\ttransform: translateY(-50%) translateX(50%) rotate(-45deg);\r\n\t} */\r\n`\r\n\r\n// const EnquiriesSubmenu = ({ item, addNewOrder, setLayout, layout: { details } }) => {\r\nconst EnquiriesSubmenu = () => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details: { type, id, enquiryId }, setDetails }) => (\r\n\t\t\t\t<Query \r\n\t\t\t\t\tquery={enquiryLocal}\r\n\t\t\t\t\tvariables={{ \r\n\t\t\t\t\t\tid: type === 'Enquiry' \r\n\t\t\t\t\t\t\t? id\r\n\t\t\t\t\t\t\t: enquiryId\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t{({ data }) => {\r\n\t\t\t\t\t\tif (data && data.enquiryLocal) {\r\n\t\t\t\t\t\t\tconst { num, docs } = data.enquiryLocal\r\n\t\t\t\t\t\t\tconst addNewOrderForbidden = !docs.some(d => d.type === 'CO')\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<SubmenuDiv>\r\n\t\t\t\t\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\t\t\t\t\tc='rgba(0,0,0,.68)'\r\n\t\t\t\t\t\t\t\t\t\tsize='medium'\r\n\t\t\t\t\t\t\t\t\t\tcontent={`Заявка №${num}`}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<Popup \r\n\t\t\t\t\t\t\t\t\t\tposition='bottom left'\r\n\t\t\t\t\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t\t\t\t\t\tflowing\r\n\t\t\t\t\t\t\t\t\t\tshowIf={addNewOrderForbidden}\r\n\t\t\t\t\t\t\t\t\t\ttrigger={\r\n\t\t\t\t\t\t\t\t\t\t\t<Div inline>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tml='0'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactiveColor='green'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon='plus'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent='Заказ'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype === 'Order'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& id === 'new'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={addNewOrderForbidden}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => setDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Order',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: 'new',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenquiryId: id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<SPopup.Header content='Не все условия выполнены' />\r\n\t\t\t\t\t\t\t\t\t\t<SPopup.Content>\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon name='cancel' color='red' />\r\n\t\t\t\t\t\t\t\t\t\t\tВыставлено КП\r\n\t\t\t\t\t\t\t\t\t\t</SPopup.Content>\r\n\t\t\t\t\t\t\t\t\t</Popup>\r\n\t\t\t\t\t\t\t\t</SubmenuDiv>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t} else return null\r\n\t\t\t\t\t}}\r\n\t\t\t\t</Query>\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(setLayout, { name: 'setLayout' }),\r\n\tgraphql(getLayout, getLayoutOptions),\r\n)(EnquiriesSubmenu)\r\n","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Header, Button } from './styled-semantic/styled-semantic'\r\n\r\nimport EnquiriesSubmenu from './EnquiriesSubmenu'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { meLocal } from '../graphql/user'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nconst MenuDiv = styled.div`\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tborder-bottom: 1px solid #7e7e81;\r\n`\r\n\r\nconst EnquiriesMenu = ({\r\n\trefetchEnquiries,\r\n\tenquiriesAreLoading,\r\n\trefreshToken\r\n}) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details, setDetails }) => (\r\n\t\t\t\t<MenuDiv>\r\n\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\tsize='medium'\r\n\t\t\t\t\t\tcontent='Заявки и заказы'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\tw='118.5px'\r\n\t\t\t\t\t\tml='0'\r\n\t\t\t\t\t\tta='left'\r\n\t\t\t\t\t\tactiveColor='blue' \r\n\t\t\t\t\t\tonClick={refetchEnquiries}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon \r\n\t\t\t\t\t\t\tname='refresh'\r\n\t\t\t\t\t\t\tcolor={enquiriesAreLoading ? 'blue' : undefined} \r\n\t\t\t\t\t\t\tloading={enquiriesAreLoading}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t{enquiriesAreLoading ? 'Загрузка' : 'Обновить'}\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t\t<Button compact circular menu\r\n\t\t\t\t\t\tactiveColor='green'\r\n\t\t\t\t\t\ticon='plus'\r\n\t\t\t\t\t\tcontent='Заявка'\r\n\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\tdetails\r\n\t\t\t\t\t\t\t&& details.type === 'Enquiry'\r\n\t\t\t\t\t\t\t&& details.id === 'new'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tonClick={() => setDetails({type: 'Enquiry', id: 'new'})}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{details && (\r\n\t\t\t\t\t\t(details.type === 'Enquiry' && details.id !== 'new')\r\n\t\t\t\t\t\t|| (details.type === 'Order' && details.id === 'new')\r\n\t\t\t\t\t) &&\r\n\t\t\t\t\t\t<EnquiriesSubmenu />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t<Query query={meLocal}>\r\n\t\t\t\t\t\t{ ({ data }) => {\r\n\t\t\t\t\t\t\tif (data && data.me) {\r\n\t\t\t\t\t\t\t\tconst { fName, lName } = data.me.person\r\n\t\t\t\t\t\t\t\tconst menuNameTitle = fName + ' ' + (lName ? `${lName.slice(0,1)}.` : '')\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<Header inline\r\n\t\t\t\t\t\t\t\t\t\tml='auto'\r\n\t\t\t\t\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t\t\t\t\t\tcontent={menuNameTitle} \r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t)} else return null\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t</Query>\r\n\t\t\t\t\t<Icon link\r\n\t\t\t\t\t\tname='log out'\r\n\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\tonClick={() => refreshToken(null)} \r\n\t\t\t\t\t/>\r\n\t\t\t\t</MenuDiv>\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default EnquiriesMenu\r\n","import React, { Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\n\r\nconst STable = styled.table`\r\n\ttable-layout: fixed;\r\n\twidth: 100%;\r\n\tborder-collapse: collapse;\r\n`\r\n\r\nconst TableHeader = styled.tr`\r\n\tcolor: rgba(0,0,0,.8);\r\n\tline-height: 1.5em;\r\n\t/* background: #f3f4f5; */\r\n\tbackground: rgb(233, 234, 235);\r\n\tborder-top: 1px solid #d4d4d5;\r\n\tborder-bottom: 1px solid #d4d4d5;\r\n\tfont-weight: bold;\r\n`\r\n\r\nconst Td = styled.td`\r\n\tpadding-right: 4px;\r\n\t// @ts-ignore\r\n\t${props => props.w && `width: ${props.w};`}\r\n`\r\n\r\nconst Table = ({\r\n\tchildren,\r\n\tfields,\r\n\tindent,\r\n\tselect,\r\n\texpand\r\n}) => {\r\n\tconst modes =  {\r\n\t\tindent: !!indent,\r\n\t\tselect: !!select,\r\n\t\texpand: !!expand,\r\n\t}\r\n\tconst fieldsExtended = [\r\n\t\t...modes['indent'] ? [{\r\n\t\t\tname: 'indent',\r\n\t\t\twidth: indent\r\n\t\t}] : [],\r\n\t\t{\r\n\t\t\tname: 'service',\r\n\t\t\twidth: '23px'\r\n\t\t},\r\n\t\t...modes['select'] ? [{\r\n\t\t\tname: 'select',\r\n\t\t\twidth: '25px'\r\n\t\t}]: [],\r\n\t\t...fields,\r\n\t\t// lastField is needed to take remaining width in fixed table-layout\r\n\t\t{ name: 'lastField' }\r\n\t]\r\n\treturn (\r\n\t\t<STable>\r\n\t\t\t<tbody>\r\n\t\t\t\t<Fragment>\r\n\t\t\t\t\t<TableHeader>\r\n\t\t\t\t\t\t{fieldsExtended.map(f =>{\r\n\t\t\t\t\t\t\t// console.log(f)\r\n\t\t\t\t\t\t\treturn <Td\r\n\t\t\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\t\tw={f.width}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{f.title}\r\n\t\t\t\t\t\t\t</Td>\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</TableHeader>\r\n\t\t\t\t\t{children({\r\n\t\t\t\t\t\ttableFields: fieldsExtended.map(f => ({ name: f.name, path: f.path })),\r\n\t\t\t\t\t})}\r\n\t\t\t\t</Fragment>\r\n\t\t\t</tbody>\r\n\t\t</STable>\r\n\t)\r\n}\r\n\r\nexport default Table","export const currency = (num, trailing) => {\r\n    let curNum = (num).toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, '$& ').replace(/\\./, ',')\r\n    if (!trailing) curNum = curNum.slice(0,-3)\r\n    return curNum + ' ₽'\r\n}","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Caret } from '../styled-semantic/styled-semantic'\r\n\r\nimport { getObjProp } from '../../utils/object'\r\nimport { currency } from '../../utils/format'\r\n\r\nconst Row = styled.tr`\r\n\tfont-size: 1rem;\r\n\tcursor: pointer;\r\n\tborder-bottom: 1px solid rgba(34, 36, 38, 0.15);\r\n\t:hover {\r\n\t\tbackground: rgba(0,0,0,.05);\r\n\t\tcolor: rgba(0,0,0,.95);\r\n\t}\r\n\t${props => props.secondary && `\r\n\t\tbackground: rgba(0,0,50,.02);\r\n\t\t${!props.lastSecondaryRow ? 'border-bottom: none;' : ''}\r\n\t`}\r\n\t${props => props.active && `\r\n\t\tbackground: rgba(0,0,0,.05);\r\n\t\tfont-weight: bold;\r\n\t\tborder-top: 1px solid rgba(34, 36, 38, 0.15);\r\n\t\tborder-bottom: 1px solid rgba(34, 36, 38, 0.15);\r\n\t`}\r\n\t${props => props.bold && `\r\n\t\tfont-weight: bold;\r\n\t`}\r\n`\r\n\r\nconst Td = styled.td`\r\n\tpadding-right: 4px;\r\n\t${props => props.service && `\r\n\t\tpadding-left: 3px;\r\n\t`}\r\n`\r\n\r\nconst TableRow = ({\r\n\ttableFields,\r\n\trowFields = [],\r\n\tentity,\r\n\texpandFor,\r\n\texpanded,\r\n\texpand,\r\n\tselect,\r\n\t...rest \r\n}) => {\r\n\t// rowFields have precedence over tableFields\r\n\tconst fields = tableFields.map(f => rowFields.find(rf => rf.name === f.name) || f)\r\n\tconst { selected, disabled } = entity\r\n\treturn (\r\n\t\t<Row\r\n\t\t\t{...rest}\r\n\t\t>\r\n\t\t\t{fields.map(f => {\r\n\t\t\t\t// console.log(f)\r\n\t\t\t\tif (\r\n\t\t\t\t\tf.name === 'service'\r\n\t\t\t\t\t&& typeof expanded !== 'undefined'\r\n\t\t\t\t\t&& entity[expandFor].length\r\n\t\t\t\t) return (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tservice\r\n\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\texpand()\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Caret\r\n\t\t\t\t\t\t\tactive={expanded ? 1 : 0}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t\tif (\r\n\t\t\t\t\tf.name === 'select'\r\n\t\t\t\t\t&& typeof select !== 'undefined'\r\n\t\t\t\t) return (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t\tservice\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\te.stopPropagation()\r\n\t\t\t\t\t\t\tselect()\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tname={\r\n\t\t\t\t\t\t\t\tselected === 'partly' ? 'square' :\r\n\t\t\t\t\t\t\t\tselected \r\n\t\t\t\t\t\t\t\t\t? 'check square outline'\r\n\t\t\t\t\t\t\t\t\t: 'square outline'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t\tif (f.content) return (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{f.content}\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t\tlet val = f.value || (f.path ? getObjProp(entity, f.path) : null)\r\n\t\t\t\tif (val && f.name === 'amount') val = currency(val)\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Td\r\n\t\t\t\t\t\tkey={f.name}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{val && f.icon &&\r\n\t\t\t\t\t\t\t<Icon\r\n\t\t\t\t\t\t\t\tname={f.icon}\r\n\t\t\t\t\t\t\t\tcolor={f.iconColor || false}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{val}\r\n\t\t\t\t\t</Td>\r\n\t\t\t\t)\r\n\t\t\t})}\r\n\t\t</Row>\r\n\t)\r\n}\r\n\r\nexport default TableRow","export const getObjProp = function(obj, path){\r\n  const pathArr = path.split('.')\r\n  for (let i=0; i<pathArr.length; i++){\r\n      obj = obj[pathArr[i]]\r\n      if (!obj) return undefined\r\n  }\r\n  return obj\r\n}","import React, { Fragment } from 'react'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nimport Table from './common/Table'\r\nimport TableRow from './common/TableRow'\r\n\r\nconst fields = [{\r\n\tname: 'num',\r\n\tpath: 'num',\r\n\ttitle: '№',\r\n\twidth: '40px'\r\n},{\r\n\tname: 'date',\r\n\tpath: 'dateLocal',\r\n\ttitle: 'Дата',\r\n\twidth: '110px'\r\n},{\r\n\tname: 'org',\r\n\tpath: 'org.name',\r\n\ttitle: 'Организация',\r\n\twidth: '260px'\r\n},{\r\n\tname: 'model',\r\n\tpath: 'model.name',\r\n\ttitle: 'Изделие',\r\n\twidth: '250px'\r\n},{\r\n\tname: 'qty',\r\n\tpath: 'qty',\r\n\ttitle: 'Кол.',\r\n\twidth: '50px'\r\n},{\r\n\tname: 'reserved',\r\n\ttitle: 'Рез.',\r\n\twidth: '50px'\r\n},{\r\n\tname: 'amount',\r\n\ttitle: 'Сумма',\r\n\twidth: '105px'\r\n},{\r\n\tname: 'status',\r\n\tpath: 'status.name',\r\n\ttitle: 'Статус',\r\n\twidth: '130px'\r\n}]\r\n\r\nconst EnquiriesTable = ({ enquiries }) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details, setDetails, setExpanded }) =>\r\n\t\t\t\t<Table\r\n\t\t\t\t\tfields={fields}\r\n\t\t\t\t>\r\n\t\t\t\t\t{({ tableFields }) => \r\n\t\t\t\t\t\tenquiries.map(enquiry => {\r\n\t\t\t\t\t\t\tconst { id, isExpanded, docs } = enquiry\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Fragment key={id} >\r\n\t\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\t\tentity={enquiry}\r\n\t\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\t\trowFields={[{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'amount',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: docs.length && docs[docs.length - 1].amount\r\n\t\t\t\t\t\t\t\t\t\t}]}\r\n\t\t\t\t\t\t\t\t\t\texpandFor='orders'\r\n\t\t\t\t\t\t\t\t\t\texpanded={isExpanded}\r\n\t\t\t\t\t\t\t\t\t\t// setExpanded={setExpanded}\r\n\t\t\t\t\t\t\t\t\t\texpand={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetExpanded({\r\n\t\t\t\t\t\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: !isExpanded\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t)}}\r\n\t\t\t\t\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\t\t\t\t\tdetails\r\n\t\t\t\t\t\t\t\t\t\t\t&& details.type === 'Enquiry'\r\n\t\t\t\t\t\t\t\t\t\t\t&& id === details.id\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tsetDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\tsetExpanded({\r\n\t\t\t\t\t\t\t\t\t\t\t\tid,\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: !isExpanded\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t</TableRow>\r\n\t\t\t\t\t\t\t\t\t{\tisExpanded && enquiry.orders.map((order, i) => {\r\n\t\t\t\t\t\t\t\t\t\tconst { id, num, prods } = order\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\t\t\t\tsecondary={1}\r\n\t\t\t\t\t\t\t\t\t\t\t\tlastSecondaryRow={i === enquiry.orders.length - 1 ? 1 : 0}\r\n\t\t\t\t\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t\t\t\t\tentity={order}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\t\t\t\trowFields={[{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'num',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: enquiry.num + '-' + num\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'org',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: enquiry.org.name\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'model',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: enquiry.model && enquiry.model.name //check only for migration from aws\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'reserved',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: prods.length\r\n\t\t\t\t\t\t\t\t\t\t\t\t},{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'amount',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'amount'\r\n\t\t\t\t\t\t\t\t\t\t\t\t}]}\r\n\t\t\t\t\t\t\t\t\t\t\t\tactive={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdetails\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t&& details.type === 'Order'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t&& id === details.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetDetails({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'Order',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t</TableRow>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)}\r\n\t\t\t\t</Table>\r\n\t\t\t\t// {/* {name} <ProdQtyLabel color='grey' basic content={`${prods.length}шт`} /> */}\r\n\t\t\t}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default EnquiriesTable","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Section, Caret } from './styled-semantic/styled-semantic'\r\n\r\nconst SIcon = styled(Icon)`\r\n\t&&& {\r\n\t\tbox-sizing: content-box;\r\n\t\twidth: calc(55px - 1em);\r\n\t\tmargin: 0 0.5em;\r\n\t}\r\n`\r\nconst SCaret = styled(Caret)`\r\n\t&&& {\r\n\t\tbox-sizing: content-box;\r\n\t\twidth: calc(55px - 1em);\r\n\t\tmargin: 0 0.5em;\r\n\t}\r\n`\r\n\r\nconst DetailsHeaderContainer = ({\r\n\tchildren,\r\n\t// style\r\n\tsize,\r\n\tbottomBorder,\r\n\tclose,\r\n\texpanded,\r\n\tdisabled,\r\n\tonClick,\r\n\tnoIndent,\r\n}) => {\r\n\tconst modes = {\r\n\t\t...close && { close: true },\r\n\t\t...(typeof expanded !== 'undefined') && { expand: true },\r\n\t}\r\n\treturn (\r\n\t\t<Section\r\n\t\t\thead\r\n\t\t\tnoLP\r\n\t\t\tnoIndent={noIndent}\r\n\t\t\tbottomBorder={bottomBorder || true}\r\n\t\t\tsize={size || undefined}\r\n\t\t\tonClick={onClick}\r\n\t\t>\r\n\t\t\t{ modes['close']\r\n\t\t\t\t?\t<SIcon link\r\n\t\t\t\t\t\tsize='big'\r\n\t\t\t\t\t\tname='cancel'\r\n\t\t\t\t\t\tonClick={close}\r\n\t\t\t\t\t/> :\r\n\t\t\t\t// TODO make disabled work (grey out color)\r\n\t\t\t\tmodes['expand']\r\n\t\t\t\t? <SCaret\r\n\t\t\t\t\t\tsize='large'\r\n\t\t\t\t\t\tactive={expanded ? 1 : 0}\r\n\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t/> : null\r\n\t\t\t}\r\n\t\t\t{children}\r\n\t\t</Section>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderContainer\r\n","import React from 'react'\r\n\r\nimport { Span } from './styled-semantic/styled-semantic'\r\n\r\nconst DetailsHeaderSubitle = ({ text }) => {\r\n\treturn (\r\n\t\t<Span\r\n\t\t\tml='10px'\r\n\t\t\tfs='1rem'\r\n\t\t\tc='rgba(0,0,0,.6)'\r\n\t\t\tws='0.5em'\r\n\t\t>\r\n\t\t\t{text}\r\n\t\t</Span>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderSubitle\r\n","import React from 'react'\r\n\r\nimport { Header } from './styled-semantic/styled-semantic'\r\nimport DetailsHeaderSubitle from './DetailsHeaderSubitle'\r\n\r\nconst DetailsHeaderTitle = ({\r\n\ttitle,\r\n\tsubtitle,\r\n\tsize\r\n}) => {\r\n\treturn (\r\n\t\t<Header\r\n\t\t\tm='0'\r\n\t\t\tsize={size || 'medium'}\r\n\t\t>\r\n\t\t\t{title}\r\n\t\t\t{subtitle &&\r\n\t\t\t\t<DetailsHeaderSubitle\r\n\t\t\t\t\ttext={subtitle}\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t</Header>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderTitle\r\n","import React from 'react'\r\n\r\nimport { Div } from './styled-semantic/styled-semantic'\r\n\r\nconst DetailsHeaderButtons = ({ children }) => {\r\n\treturn (\r\n\t\t<Div\r\n\t\t\tml='auto'\r\n\t\t>\r\n\t\t\t{children}\r\n\t\t</Div>\r\n\t)\r\n}\r\n\r\nexport default DetailsHeaderButtons\r\n","import React from 'react'\r\n\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Button } from '../styled-semantic/styled-semantic'\r\nimport styled from 'styled-components'\r\n\r\nconst SButton = styled(Button)`\r\n\tpadding: .78571429em !important;\r\n\t&>i {\r\n\t\topacity: .9 !important;\r\n\t\tmargin: 0 !important;\r\n\t}\r\n`\r\n\r\nconst RefreshButton = ({ loading, onClick }) => {\r\n\treturn (\r\n\t\t<SButton\r\n\t\t\tactiveColor='blue'\r\n\t\t\tactive={loading}\r\n\t\t\tonClick={onClick} >\r\n\t\t\t<Icon \r\n\t\t\t\tname='refresh'\r\n\t\t\t\tloading={loading} \r\n\t\t\t/>\r\n\t\t</SButton>\r\n\t)\r\n}\r\n\r\nexport default RefreshButton\r\n","import React, { Fragment } from 'react'\r\n\r\nimport { Button } from './styled-semantic/styled-semantic'\r\n\r\nimport DetailsHeaderContainer from './DetailsHeaderContainer'\r\nimport DetailsHeaderTitle from './DetailsHeaderTitle'\r\nimport DetailsHeaderButtons from './DetailsHeaderButtons'\r\nimport RefreshButton from './common/RefreshButton'\r\n\r\nconst settings = {\r\n\tEnquiry: {\r\n\t\ttitleNew: 'Новая заявка',\r\n\t\ttitleExisting: 'Заявка №',\r\n\t},\r\n\tOrder: {\r\n\t\ttitleNew: 'Новый заказ',\r\n\t\ttitleExisting: 'Заказ №',\r\n\t}\r\n}\r\n\r\nconst DetailsMainHeader = ({\r\n\ttype,\r\n\tcloseDetails,\r\n\tloading,\r\n\trefresh,\r\n\tsetDetails,\r\n\teditMode,\r\n\tlocalEntity = {}\r\n}) => {\r\n\tconst { id, num, dateLocal } = localEntity\r\n\treturn (\r\n\t\t<DetailsHeaderContainer\r\n\t\t\tclose={closeDetails}\r\n\t\t>\r\n\t\t\t{ !id && // new entity\r\n\t\t\t\t<DetailsHeaderTitle\r\n\t\t\t\t\ttitle={settings[type].titleNew}\r\n\t\t\t\t/>\r\n\t\t\t}\r\n\t\t\t{ id && // existing entity\r\n\t\t\t\t<Fragment>\r\n\t\t\t\t\t<DetailsHeaderTitle\r\n\t\t\t\t\t\ttitle={settings[type].titleExisting + num}\r\n\t\t\t\t\t\tsubtitle={'от ' + dateLocal}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<DetailsHeaderButtons>\r\n\t\t\t\t\t\t<RefreshButton\r\n\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\tonClick={refresh}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\ticon='edit'\r\n\t\t\t\t\t\t\tactiveColor='blue'\r\n\t\t\t\t\t\t\tactive={editMode || false}\r\n\t\t\t\t\t\t\tonClick={() => setDetails({\r\n\t\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\t\tid: localEntity.id,\r\n\t\t\t\t\t\t\t\teditMode: true\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t/> \r\n\t\t\t\t\t</DetailsHeaderButtons>\r\n\t\t\t\t</Fragment>\r\n\t\t\t}\r\n\t\t</DetailsHeaderContainer>\r\n\t)\r\n}\r\n\r\nexport default DetailsMainHeader\r\n","import React from 'react'\r\nimport {\r\n\tEditor,\r\n\tEditorState,\r\n\tContentState,\r\n\tRichUtils,\r\n\tconvertFromHTML,\r\n\tgetDefaultKeyBinding,\r\n\tKeyBindingUtil\r\n} from 'draft-js'\r\nimport 'draft-js/dist/Draft.css'\r\nimport {stateToHTML} from 'draft-js-export-html'\r\n\r\nclass DraftEditor extends React.Component {\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tlet editorState\r\n\t\tif (props.initFromHtml) {\r\n\t\t\tconst blocksFromHTML = convertFromHTML(props.initFromHtml)\r\n\t\t\teditorState = EditorState.createWithContent(\r\n\t\t\t\tContentState.createFromBlockArray(\r\n\t\t\t\t\tblocksFromHTML.contentBlocks,\r\n\t\t\t\t\tblocksFromHTML.entityMap\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t} else {\r\n\t\t\teditorState = EditorState.createEmpty()\r\n\t\t}\r\n\t\tthis.state = { \r\n\t\t\teditorState,\r\n\t\t\toriContent: editorState.getCurrentContent()\r\n\t\t}\r\n\t}\r\n\tonChange = (editorState) => {\r\n\t\tthis.setState({ editorState })\r\n\t\tconst newContent = editorState.getCurrentContent()\r\n\t\tconst { setEditorHasText, setEditorDiff, setHasFocus } = this.props\r\n\t\tif (editorState && setEditorHasText) setEditorHasText(newContent.hasText())\r\n\t\tif (setEditorDiff) setEditorDiff(newContent !== this.state.oriContent)\r\n\t\tif (setHasFocus) setHasFocus(editorState.getSelection().getHasFocus())\r\n\t}\r\n\tkolmechKeyBindingFn = (e) => {\r\n\t\t// catch Ctrl + Enter event\r\n\t\tif (e.keyCode === 13 && KeyBindingUtil.hasCommandModifier(e)) {\r\n\t\t  return 'kolmech-enter'\r\n\t\t}\r\n\t\treturn getDefaultKeyBinding(e)\r\n\t}\r\n\thandleKeyCommand = (command, editorState) => {\r\n\t\t// handle Ctrl + Enter command\r\n\t\tif (command === 'kolmech-enter') {\r\n\t\t\tthis.props.onSave()\r\n\t\t\treturn 'handled'\r\n\t\t}\r\n\t\tconst newState = RichUtils.handleKeyCommand(editorState, command);\r\n\t\tif (newState) {\r\n\t\t\tthis.onChange(newState);\r\n\t\t\treturn 'handled'\r\n\t\t}\r\n\t\treturn 'not-handled'\r\n\t}\r\n\tclear = () => this.setState({ \r\n\t\teditorState: EditorState.push(this.state.editorState, ContentState.createFromText(''), 'remove-range')\r\n\t})\r\n\texportHtml = () => {\r\n\t\tconst html = stateToHTML(this.state.editorState.getCurrentContent())\r\n\t\tif (!convertFromHTML(html).contentBlocks) return null\r\n\t\treturn html\r\n\t}\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Editor\r\n\t\t\t\teditorState={this.state.editorState}\r\n\t\t\t\tonChange={this.onChange}\r\n\t\t\t\thandleKeyCommand={this.handleKeyCommand}\r\n\t\t\t\tkeyBindingFn={this.kolmechKeyBindingFn}\r\n\t\t\t\treadOnly={this.props.readOnly}\r\n\t\t\t/>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default DraftEditor","import React, { Component } from 'react'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport DraftEditor from './DraftEditor'\r\n\r\nconst EditorWrapper = styled.div`\r\n\tpadding: calc(0.678571em - 1px) 1em;\r\n\tline-height: 1.4285em;\r\n\tborder: 1px solid rgba(34,36,38,.15);\r\n\tborder-radius: .28571429rem;\r\n\ttransition: all .1s ease;\r\n\t${({ borderless, hasFocus, diff }) =>\r\n\t\tborderless\r\n\t\t&& !hasFocus\r\n\t\t&& !diff && `\r\n\t\t\tmargin-left: -1em;\r\n\t\t\tborder: 1px solid white;\r\n\t\t\t:hover {\r\n\t\t\t\tbackground: rgba(0,0,0,.05);\r\n\t\t\t\tcolor: rgba(0,0,0,.65);\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t}\r\n\t\t`\r\n\t}\r\n`\r\n\r\nclass WrappedDraftEditor extends Component {\r\n\tstate = {\r\n\t\thasFocus: false\r\n\t}\r\n\tsetHasFocus = (hasFocus) => this.setState({ hasFocus })\r\n\trender() {\r\n\t\tconst { hasFocus } = this.state\r\n\t\tconst {\r\n\t\t\tborderless,\r\n\t\t\tdiff,\r\n\t\t\tforwardedRef,\r\n\t\t\t...rest\r\n\t\t} = this.props\r\n\t\treturn (\r\n\t\t\t<EditorWrapper\r\n\t\t\t\tborderless={borderless}\r\n\t\t\t\thasFocus={hasFocus}\r\n\t\t\t\tdiff={diff}\r\n\t\t\t>\r\n\t\t\t\t<DraftEditor\r\n\t\t\t\t\tref={forwardedRef}\r\n\t\t\t\t\tsetHasFocus={this.setHasFocus}\r\n\t\t\t\t\t{...rest}\r\n\t\t\t\t/>\r\n\t\t\t</EditorWrapper>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default React.forwardRef((props, ref) =>\r\n\t<WrappedDraftEditor\r\n\t\tforwardedRef={ref}\r\n\t\t{...props}\r\n\t/>\r\n)","export const isValidDate = (date) => date instanceof Date && !isNaN(date.valueOf())\r\nexport const tz = new Date().getTimezoneOffset() * 60000\r\nexport const toLocalISOString = (date) => new Date(date.getTime() - tz).toISOString()\r\nexport const fromLocalISOString = (string) => new Date(Date.parse(string) + tz)\r\n// util to split array into chunks\r\nexport const toChunks = (arr, size) => {\r\n    let chunks = []\r\n    for (let i = 0; i < arr.length; i += size) {\r\n        chunks.push(arr.slice(i, i + size))\r\n    }\r\n    return chunks\r\n}\r\n\r\n// groupBy = (xs, key) => xs.reduce((rv, x) => {\r\n//     (rv[x[key]] = rv[x[key]] || []).push(x)\r\n//     return rv\r\n//   }, {})\r\n// groupByArray(xs, key) => xs.reduce( (rv, x) => {\r\n//   let v = key instanceof Function ? key(x) : x[key];\r\n//   let el = rv.find((r) => r && r.key === v);\r\n//   if (el) { el.values.push(x); } else { rv.push({ key: v, values: [x] }); }\r\n//   return rv;\r\n// }, [])\r\n// const splitBy = (xs, key) => xs.reduce( (rv, x) => {\r\n//   let el = rv.find(r => r[0][key] === x[key])\r\n//   if (el) { el.push(x); } else { rv.push([x]); }\r\n// }, [])\r\n","import React from 'react'\r\n\r\nimport DayPickerInput from 'react-day-picker/DayPickerInput'\r\nimport 'react-day-picker/lib/style.css'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport { toLocalISOString } from '../../utils/dates'\r\n\r\nconst PickerDiv = styled.div`\r\n\tdisplay: inline-block;\r\n\t${props => props.error && `\r\n\t\tinput {\r\n\t\t\tcolor: #9f3a38 !important;\r\n\t\t\tbackground-color: #fff6f6 !important;\r\n\t\t\tborder-color: #e0b4b4 !important;\r\n\t\t}`\r\n\t}\r\n`\r\n\r\nconst DatePicker = ({ selectedDate, selectDay, error }) => {\r\n\treturn (\r\n\t\t<PickerDiv error={error}>\r\n\t\t\t<DayPickerInput\r\n\t\t\t\tvalue={toLocalISOString(selectedDate).slice(0, 10)}\r\n\t\t\t\tonDayChange={selectDay}\r\n\t\t\t\tdayPickerProps={{\r\n\t\t\t\t\tfirstDayOfWeek: 1,\r\n\t\t\t\t\tmonth: selectedDate\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</PickerDiv>\r\n\t)\r\n}\r\n\r\nexport default DatePicker\r\n","import gql from 'graphql-tag'\r\n\r\nexport const org = gql`\r\n    query org ($id: ID!) {\r\n        org (id: $id) {\r\n            id\r\n            inn\r\n            name\r\n        }\r\n    }\r\n`\r\n\r\nexport const allOrgs = gql`\r\n    query allOrgs {\r\n        orgs {\r\n            id\r\n            inn\r\n            name\r\n        }\r\n    }\r\n`\r\n\r\nexport const createOrg = gql`\r\n    mutation createOrg($inn: String!) {\r\n        createOrg(inn: $inn) {\r\n            id\r\n\t\t\tinn\r\n            name\r\n        }\r\n    }\r\n`","import gql from 'graphql-tag'\r\n\r\nexport const allOrgsAndModels = gql`\r\n    query AllOrgsAndModels {\r\n        orgs {\r\n            id\r\n            inn\r\n            name\r\n        }\r\n        models {\r\n            id\r\n            article\r\n            name\r\n        }\r\n    }\r\n`","const validateInn = (inn, error) => {\r\n    var result = false;\r\n\tif (typeof inn === 'number') {\r\n        inn = inn.toString();\r\n\t} else if (typeof inn !== 'string') {\r\n        inn = '';\r\n\t}\r\n\tif (!inn.length) {\r\n        error.code = 1;\r\n\t\terror.message = 'ИНН пуст';\r\n\t} else if (/[^0-9]/.test(inn)) {\r\n        error.code = 2;\r\n\t\terror.message = 'ИНН может состоять только из цифр';\r\n\t} else if ([10, 12].indexOf(inn.length) === -1) {\r\n        error.code = 3;\r\n\t\terror.message = 'ИНН может состоять только из 10 или 12 цифр';\r\n\t} else {\r\n        var checkDigit = function (inn, coefficients) {\r\n            var n = 0;\r\n\t\t\tfor (var i in coefficients) {\r\n                n += coefficients[i] * inn[i];\r\n\t\t\t}\r\n            // eslint-disable-next-line\r\n\t\t\treturn parseInt(n % 11 % 10);\r\n\t\t};\r\n        // eslint-disable-next-line\r\n\t\tswitch (inn.length) {\r\n            case 10:\r\n            var n10 = checkDigit(inn, [2, 4, 10, 3, 5, 9, 4, 6, 8]);\r\n            // eslint-disable-next-line\r\n            if (n10 === parseInt(inn[9])) {\r\n                result = true;\r\n            }\r\n            break;\r\n\t\t\tcase 12:\r\n            var n11 = checkDigit(inn, [7, 2, 4, 10, 3, 5, 9, 4, 6, 8]);\r\n            var n12 = checkDigit(inn, [3, 7, 2, 4, 10, 3, 5, 9, 4, 6, 8]);\r\n            // eslint-disable-next-line\r\n            if ((n11 === parseInt(inn[10])) && (n12 === parseInt(inn[11]))) {\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (!result) {\r\n\t\t\terror.code = 4;\r\n\t\t\terror.message = 'Неправильное контрольное число ИНН';\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\nexport default validateInn","import React, { Component, Fragment } from 'react'\r\n\r\nimport { Form, Input, Button, Message } from 'semantic-ui-react'\r\nimport { Div, Span, A, Label, Section, Dropdown } from './styled-semantic/styled-semantic.js'\r\nimport DatePicker from './common/DatePicker'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { allEnquiries, createEnquiry, updateEnquiry } from '../graphql/enquiry'\r\nimport { createOrg } from '../graphql/org'\r\nimport { allOrgsAndModels } from '../graphql/combinedQueries'\r\n\r\nimport cloneDeep from 'lodash/cloneDeep'\r\nimport validateInn from '../utils/validateInn'\r\nimport { isValidDate, toLocalISOString, fromLocalISOString }from '../utils/dates'\r\n\r\nclass EnquiryEdit extends Component {\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tthis.componentIsMounted = true\r\n\t\tthis.isNewEnquiry = props.id === 'new'\r\n\t\tconst isNewEnquiry = this.isNewEnquiry\r\n\t\tthis.state = {\r\n\t\t\tloading: false,\r\n\t\t\t// if any of the form fields has error, the following err prop should always contain non empty string error message with explanaition \r\n\t\t\terr: {\r\n\t\t\t\tmessage: ''\r\n\t\t\t},\r\n\t\t\torgDdn: {\r\n\t\t\t\tsearch: '',\r\n\t\t\t\tloading: false\r\n\t\t\t},\r\n\t\t\tmodelDdn: {\r\n\t\t\t\tsearch: '',\r\n\t\t\t\tloading: false\r\n\t\t\t}\r\n\t\t}\r\n\t\t// gather form fields on oriEnquiry object\r\n\t\tconst oriEnquiry = cloneDeep(props.enquiry)\r\n\t\t// console.log('props.enquiry > ', props.enquiry)\r\n\t\tif (isNewEnquiry) oriEnquiry.dateLocal = toLocalISOString(new Date()).slice(0, 10)\r\n\t\tdelete oriEnquiry.events\r\n\t\toriEnquiry.orgId = oriEnquiry.org ? oriEnquiry.org.id : null\r\n\t\toriEnquiry.modelId = oriEnquiry.model ? oriEnquiry.model.id : null\r\n\t\toriEnquiry.qty = oriEnquiry.qty ? oriEnquiry.qty : ''\r\n\t\t// console.log('oriEnquiry > ', oriEnquiry)\r\n\t\tthis.fields = Object.keys(oriEnquiry)\r\n\t\t\t.filter(key => !['__typename', 'id', 'num', 'org', 'model'].includes(key))\r\n\t\t// console.log('this.fields > ', this.fields)\r\n\t\tthis.requiredFields = ['dateLocal', 'orgId', 'modelId', 'qty']\r\n\t\t// map through form fields and write helper props\r\n\t\tthis.fields.forEach(key => {\r\n\t\t\t// console.log(key, oriEnquiry[key])\r\n\t\t\tthis.state[key] = {\r\n\t\t\t\tcurVal: oriEnquiry[key],\r\n\t\t\t\t// err bool controls weather the field is heighlighted with error (red) style\r\n\t\t\t\terr: false,\r\n\t\t\t\t...this.requiredFields.includes(key) && { required: true },\r\n\t\t\t\t...!isNewEnquiry && {\r\n\t\t\t\t\toriVal: oriEnquiry[key],\r\n\t\t\t\t\tdiff: false,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (!isNewEnquiry) this.state.diff = false\r\n\t\t// console.log(this.state)\r\n\t}\r\n\tchangeFieldValue = (field, newVal) => {\r\n\t\tconsole.log('change ', field, ' to value > ', newVal)\r\n\t\tconst fieldObj = cloneDeep(this.state[field])\r\n\t\tfieldObj.curVal = newVal\r\n\t\tfieldObj.err = false\r\n\t\tif (!this.isNewEnquiry) fieldObj.diff = fieldObj.curVal !== fieldObj.oriVal\r\n\t\tconst diff = this.fields.filter(f => f !== field).map(f => this.state[f].diff).includes(true) || fieldObj.diff\r\n\t\tthis.setState({ [field]: fieldObj, diff, err: { message: '' } })\r\n\t}\r\n\tselectDay = (pickedDate) => {\r\n\t\tif (!isValidDate(pickedDate)) return this.setState({ \r\n\t\t\tdateLocal: { ...this.state.dateLocal, err: true },\r\n\t\t\terr: { title: 'Ошибка ввода даты', message: 'Дата заявки не соответствует формату дат' } \r\n\t\t})\r\n\t\tthis.changeFieldValue('dateLocal', toLocalISOString(pickedDate).slice(0, 10))\r\n\t}\r\n\thandleOrgDropdownSearchChange = (e, { searchQuery }) => {\r\n\t\tthis.setState({ \r\n\t\t\torgDdn: { search: searchQuery, err: false },\r\n\t\t})\r\n\t}\r\n\thandleModelDropdownSearchChange = (e, { searchQuery }) => {\r\n\t\tthis.setState({ \r\n\t\t\tmodelDdn: { search: searchQuery, err: false },\r\n\t\t})\r\n\t}\r\n\thandleQtyInputChange = ( e, { value } ) => {\r\n\t\tconst newVal = parseInt(value, 10) || ''\r\n\t\tthis.changeFieldValue('qty', newVal)\r\n\t}\r\n\tselectOrg = (e, { value }) => {\r\n\t\tthis.setState({ orgDdn: { search: '', loading: false } })\r\n\t\tthis.changeFieldValue('orgId', value)\r\n\t}\r\n\tselectModel = (e, { value }) => {\r\n\t\tthis.setState({ modelDdn: { search: '', loading: false } })\r\n\t\tthis.changeFieldValue('modelId', value)\r\n\t}\r\n\tcreateOrg = async (e, { value: inn }) => {\r\n\t\ttry {\r\n\t\t\tlet err = {}\r\n\t\t\tconst isValidInn = validateInn(inn, err)\r\n\t\t\tif (!isValidInn) throw new Error(err.message)\r\n\t\t\tthis.setState({ orgDdn: { search: inn, loading: true} })\r\n\t\t\tconst data = await this.props.createOrg({ variables: { inn } })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.selectOrg(null, { value: data.data.createOrg.id } )\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Добавить организацию по ИНН не удалось..',\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t},\r\n\t\t\t\torgDdn: {\r\n\t\t\t\t\tsearch: inn,\r\n\t\t\t\t\tloading: false\r\n\t\t\t\t},\r\n\t\t\t\torgId: {\r\n\t\t\t\t\t...this.state.orgId,\r\n\t\t\t\t\terr: true\r\n\t\t\t\t}\r\n\t\t\t })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tsubmit = () => {\r\n\t\tconst enquiry = {}\r\n\t\t// take out only changed fields for update\r\n\t\tthis.fields.forEach(f => {\r\n\t\t\tif (this.isNewEnquiry || this.state[f].diff) enquiry[f] = this.state[f].curVal\r\n\t\t})\r\n\t\tconst variables = { ...enquiry }\r\n\t\tif (this.isNewEnquiry) return this.createEnquiry(variables)\r\n\t\tvariables.id = this.props.id\r\n\t\tthis.updateEnquiry(variables)\r\n\t}\r\n\tcreateEnquiry = async (variables) => {\r\n\t\ttry {\r\n\t\t\tthis.setState({ loading: true })\r\n\t\t\tconst res = await this.props.createEnquiry({ variables })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ loading: false, err: '' })\r\n\t\t\tthis.props.setDetails({\r\n\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\tid: res.data.createEnquiry.id\r\n\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tloading: false,\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Создать не удалось..',\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tupdateEnquiry = async (variables) => {\r\n\t\tconst { id, updateEnquiry, setDetails } = this.props\r\n\t\ttry {\r\n\t\t\tthis.setState({ loading: true })\r\n\t\t\tawait updateEnquiry({ variables: { input: variables } })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ loading: false, err: '' })\r\n\t\t\tsetDetails({\r\n\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\tid\r\n\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ \r\n\t\t\t\tloading: false,\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: 'Сохранить не удалось..',\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tthis.componentIsMounted = false\r\n\t}\r\n\trender() {\r\n\t\tconst { dateLocal, orgId, orgDdn, modelId, modelDdn, qty, diff, loading, err } = this.state\r\n\t\tconst { id, setDetails, allOrgsAndModels } = this.props\r\n\t\tconst selectedDate = fromLocalISOString(dateLocal.curVal)\r\n\t\tconst orgs = allOrgsAndModels.orgs\r\n\t\tconst models = allOrgsAndModels.models\r\n\t\tconst requiredIsEmpty = this.requiredFields.some(f => !this.state[f].curVal)\r\n\t\tconst someFieldHasError = this.fields.some(f => !!this.state[f].err)\r\n\t\treturn (\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<Section\r\n\t\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t\t\t<Form.Field inline>\r\n\t\t\t\t\t\t\t\t\t<Label>Дата</Label>\r\n\t\t\t\t\t\t\t\t\t<DatePicker\r\n\t\t\t\t\t\t\t\t\t\terror={dateLocal.err}\r\n\t\t\t\t\t\t\t\t\t\tselectedDate={selectedDate}\r\n\t\t\t\t\t\t\t\t\t\tselectDay={this.selectDay} />\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t\t<Form.Field inline error={orgId.err} required>\r\n\t\t\t\t\t\t\t\t\t<Label>Организация</Label>\r\n\t\t\t\t\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\t\t\t\t\tloading={!orgs || orgDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={!orgs || orgDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\tselection //render as a formControl\r\n\t\t\t\t\t\t\t\t\t\tplaceholder='Поиск по наименованию или ИНН'\r\n\t\t\t\t\t\t\t\t\t\toptions={ orgs ? orgs.map(o => ({key:o.id, value: o.id, text: o.name})) : [] }\r\n\t\t\t\t\t\t\t\t\t\tvalue={orgId.curVal}\r\n\t\t\t\t\t\t\t\t\t\tonChange={this.selectOrg}\r\n\t\t\t\t\t\t\t\t\t\tselectOnBlur={false}\r\n\t\t\t\t\t\t\t\t\t\tselectOnNavigation={false}\r\n\t\t\t\t\t\t\t\t\t\tsearch\r\n\t\t\t\t\t\t\t\t\t\tsearchQuery={orgDdn.search}\r\n\t\t\t\t\t\t\t\t\t\tonSearchChange={this.handleOrgDropdownSearchChange}\r\n\t\t\t\t\t\t\t\t\t\tnoResultsMessage='Если не найдено, введите ИНН, чтобы добавить.'\r\n\t\t\t\t\t\t\t\t\t\tallowAdditions\r\n\t\t\t\t\t\t\t\t\t\tadditionLabel='Добавить по ИНН: '\r\n\t\t\t\t\t\t\t\t\t\tonAddItem={this.createOrg}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t\t<Form.Field inline error={modelId.err} required>\r\n\t\t\t\t\t\t\t\t\t<Label>Изделие</Label>\r\n\t\t\t\t\t\t\t\t\t<Dropdown\r\n\t\t\t\t\t\t\t\t\t\tloading={!models || modelDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={!models || modelDdn.loading}\r\n\t\t\t\t\t\t\t\t\t\tselection //render as a formControl\r\n\t\t\t\t\t\t\t\t\t\tplaceholder='Поиск по наименованию или артикулу'\r\n\t\t\t\t\t\t\t\t\t\toptions={ models ? models.map(m => ({key:m.id, value: m.id, text: m.name})) : [] }\r\n\t\t\t\t\t\t\t\t\t\tvalue={modelId.curVal}\r\n\t\t\t\t\t\t\t\t\t\tonChange={this.selectModel}\r\n\t\t\t\t\t\t\t\t\t\tselectOnBlur={false}\r\n\t\t\t\t\t\t\t\t\t\tselectOnNavigation={false}\r\n\t\t\t\t\t\t\t\t\t\tsearch\r\n\t\t\t\t\t\t\t\t\t\tsearchQuery={modelDdn.search}\r\n\t\t\t\t\t\t\t\t\t\tonSearchChange={this.handleModelDropdownSearchChange}\r\n\t\t\t\t\t\t\t\t\t\tnoResultsMessage='Если не найдено, выберите \"Нет в списке\"'\r\n\t\t\t\t\t\t\t\t\t\t// allowAdditions\r\n\t\t\t\t\t\t\t\t\t\t// additionLabel='Добавить по ИНН: '\r\n\t\t\t\t\t\t\t\t\t\t// onAddItem={this.createOrg}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t\t<Label>Кол-во</Label>\r\n\t\t\t\t\t\t\t\t\t<Input type='number'\r\n\t\t\t\t\t\t\t\t\t\tplaceholder='Введите кол-во шт.' \r\n\t\t\t\t\t\t\t\t\t\tvalue={qty.curVal}\r\n\t\t\t\t\t\t\t\t\t\tonChange={this.handleQtyInputChange} />\r\n\t\t\t\t\t\t\t\t\t<Span pl='6px'>шт.</Span>\r\n\t\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t\t</Section>\r\n\t\t\t\t\t\t<Section>\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\thidden={!err.message}\r\n\t\t\t\t\t\t\t\theader={err.title}\r\n\t\t\t\t\t\t\t\tcontent={err.message} />\r\n\t\t\t\t\t\t\t<Div inline w='formLabel' />\r\n\t\t\t\t\t\t\t<Button \r\n\t\t\t\t\t\t\t\tprimary \r\n\t\t\t\t\t\t\t\tcontent={this.isNewEnquiry ? 'Создать' : 'Сохранить'}\r\n\t\t\t\t\t\t\t\tdisabled={(!this.isNewEnquiry && !diff) || !!err.message || someFieldHasError || !!orgId.loading || requiredIsEmpty}\r\n\t\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\t\tonClick={this.submit} />\r\n\t\t\t\t\t\t\t<A cancel \r\n\t\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\t\tid === 'new'\r\n\t\t\t\t\t\t\t\t\t? () => setDetails(null)\r\n\t\t\t\t\t\t\t\t\t: () => setDetails({\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'Enquiry',\r\n\t\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tОтмена\r\n\t\t\t\t\t\t\t</A>\r\n\t\t\t\t\t\t</Section>\r\n\t\t\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(createOrg, { \r\n\t\tname: 'createOrg',\r\n\t\toptions: {\r\n\t\t\tupdate: (cache, {data: { createOrg }}) => {\r\n\t\t\t\tconst query = allOrgsAndModels\r\n\t\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\t\tdata.orgs.push(createOrg)\r\n\t\t\t\tdata.orgs.sort((a, b) => a.name > b.name)\r\n\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t}\r\n\t\t}\r\n\t}),\r\n\tgraphql(allOrgsAndModels, { name: 'allOrgsAndModels' }),\r\n\tgraphql(updateEnquiry, { name: 'updateEnquiry' }),\r\n\tgraphql(createEnquiry, { \r\n\t\tname: 'createEnquiry',\r\n\t\toptions: {\r\n\t\t\tupdate: (cache, {data: { createEnquiry }}) => {\r\n\t\t\t\tconst query = allEnquiries\r\n\t\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\t\tcreateEnquiry.isExpanded = false\r\n\t\t\t\tdata.enquiries.unshift(createEnquiry)\r\n\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t}\r\n\t\t}\r\n\t}),\r\n)(EnquiryEdit)","import React, { Component } from 'react'\r\n\r\nimport DayPickerInput from 'react-day-picker/DayPickerInput'\r\nimport 'react-day-picker/lib/style.css'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport { isValidDate, toLocalISOString, fromLocalISOString }from '../../utils/dates'\r\n\r\nconst PickerDiv = styled.div`\r\n\tdisplay: inline-block;\r\n\t${props => props.err && `\r\n\t\tinput {\r\n\t\t\tcolor: #9f3a38 !important;\r\n\t\t\tbackground-color: #fff6f6 !important;\r\n\t\t\tborder-color: #e0b4b4 !important;\r\n\t\t}`\r\n\t}\r\n`\r\n\r\nclass LocalDatePicker extends Component {\r\n    handleDayChange = (pickedDate) => {\r\n        // console.log('pickedDate > ', pickedDate)\r\n        const { setField, field: { name }} = this.props\r\n        if (!isValidDate(pickedDate)) {\r\n            setField(name, {\r\n                err: {\r\n                    title: 'Ошибка ввода даты', \r\n                    message: 'Дата не соответствует формату ГГГГ-ММ-ДД'\r\n                }\r\n            })\r\n            return\r\n        }\r\n        setField(name, {\r\n            value: toLocalISOString(pickedDate).slice(0, 10)\r\n        })\r\n    }\r\n    render() {\r\n        const { field: {curVal: value, err} } = this.props\r\n        return (\r\n            <PickerDiv err={!!err}>\r\n                <DayPickerInput\r\n                    value={value}\r\n                    onDayChange={this.handleDayChange}\r\n                    dayPickerProps={{\r\n                        firstDayOfWeek: 1,\r\n                        month: fromLocalISOString(value)\r\n                    }}\r\n                />\r\n            </PickerDiv>\r\n        )\r\n    }\r\n}\r\n\r\nexport default LocalDatePicker\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport NumberFormat from 'react-number-format'\r\n\r\nimport { Input } from 'semantic-ui-react'\r\nimport { Span } from '../styled-semantic/styled-semantic'\r\n\r\nclass CurrencyInput extends Component {\r\n    render() {\r\n        const { placeholder, field: {name, curVal: value}, setField } = this.props\r\n        return (\r\n            <Fragment>\r\n                <NumberFormat\r\n                    customInput={Input}\r\n                    placeholder={placeholder}\r\n                    value={value}\r\n                    decimalSeparator=','\r\n                    thousandSeparator=' '\r\n                    decimalScale={2}\r\n                    allowNegative={false}\r\n                    onValueChange={values => setField(name, {value: values.floatValue})} />\r\n                <Span pl='6px' fs='1.1rem' c='rgba(0,0,0,.87)'>₽</Span>\r\n                <Span pl='9px' fs='1.1rem' ws='0.1em'>с НДС</Span>\r\n            </Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nexport default CurrencyInput\r\n","import { Component } from 'react'\r\n\r\nclass SmartForm extends Component {\r\n\tconstructor(props){\r\n\t\tsuper(props)\r\n\t\tthis.componentIsMounted = true\r\n\t\tthis.isNewEntity = props.isNewEntity\r\n\t\t// gather original form fields' values from provided object\r\n\t\tconst oriEntity = props.entity\r\n\t\tthis.fields = Object.keys(oriEntity)\r\n\t\tthis.requiredFields = props.requiredFields\r\n\t\t// map through form fields and write helper props\r\n\t\tthis.state = {}\r\n\t\tthis.fields.forEach(key => {\r\n\t\t\tthis.state[key] = {\r\n\t\t\t\tname: key,\r\n\t\t\t\tcurVal: oriEntity[key],\r\n\t\t\t\terr: null,\r\n\t\t\t\t...this.requiredFields.includes(key) && { required: true },\r\n\t\t\t\t...!this.isNewEntity && {\r\n\t\t\t\t\toriVal: oriEntity[key],\r\n\t\t\t\t\tdiff: false,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\t// console.log(this.state)\r\n\t}\r\n\tsetField = (field, {value, err}) => {\r\n\t\t// console.log('field, value, err > ', field, value, err)\r\n\t\tthis.setState({\r\n\t\t\t[field]: {\r\n\t\t\t\t...this.state[field],\r\n\t\t\t\t...value && {\r\n\t\t\t\t\tcurVal: value,\r\n\t\t\t\t\t...!this.isNewEntity && { diff: value !== this.state[field].oriVal },\r\n\t\t\t\t},\r\n\t\t\t\terr: err || null,\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tsubmit = () => {\r\n\t\tconst entity = this.fields.reduce((entity, f) => {\r\n\t\t\tentity[f] = this.state[f].curVal\r\n\t\t\treturn entity\r\n\t\t}, {})\r\n\t\tthis.props.submit(entity)\r\n\t}\r\n\trender() {\r\n\t\tconst { children } = this.props\r\n\t\tconst requiredIsEmpty = this.requiredFields.some(f => !this.state[f].curVal)\r\n\t\tconst diff = this.isNewEntity ? null : this.fields.map(f => this.state[f].diff).includes(true)\r\n\t\tconst err = this.fields.map(f => this.state[f].err).find(err => !!err)\r\n\t\tconst state = {\r\n\t\t\tdisabled: (!this.isNewEntity && !diff) || requiredIsEmpty || !!err,\r\n\t\t\terr: err || this.props.err,\r\n\t\t\tsetField: this.setField,\r\n\t\t\tsubmit: this.submit,\r\n\t\t\tformState: this.state\r\n\t\t}\r\n\t\t// @ts-ignore\r\n\t\treturn children(state)\r\n\t}\r\n}\r\n\r\nexport default SmartForm","import React, { Component, Fragment } from 'react'\r\n\r\nimport { Header, Form, Message, Button, Divider } from 'semantic-ui-react'\r\nimport { Div, A, Label, Section } from './styled-semantic/styled-semantic'\r\n\r\nimport LocalDatePicker from './common/LocalDatePicker'\r\nimport CurrencyInput from './common/CurrencyInput'\r\nimport SmartForm from './common/SmartForm'\r\n\r\nimport { toLocalISOString } from '../utils/dates'\r\n\r\nclass EnquiryCommercialOffer extends Component {\r\n\trender() {\r\n\t\tconst { cancel, submit, loading } = this.props\r\n\t\tconst isNewCO = this.props.id === 'new'\r\n\t\tconst co = isNewCO\r\n\t\t?   {\r\n\t\t\t\tdateLocal: toLocalISOString(new Date()).slice(0, 10),\r\n\t\t\t\tamount: ''\r\n\t\t\t} \r\n\t\t:   {\r\n\t\t\t\tdateLocal: this.props.co.dateLocal,\r\n\t\t\t\tamount: this.props.co.amount\r\n\t\t\t}\r\n\t\treturn (\r\n\t\t\t<SmartForm\r\n\t\t\t\tisNewEntity={isNewCO}\r\n\t\t\t\tentity={co}\r\n\t\t\t\trequiredFields={['dateLocal', 'amount']}\r\n\t\t\t\tsubmit={submit}\r\n\t\t\t>\r\n\t\t\t\t{({\r\n\t\t\t\t\tdisabled,\r\n\t\t\t\t\terr,\r\n\t\t\t\t\tsetField,\r\n\t\t\t\t\tsubmit,\r\n\t\t\t\t\tformState: { dateLocal, amount }\r\n\t\t\t\t}) => <Fragment>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\thead\r\n\t\t\t\t\t\tminor\r\n\t\t\t\t\t\tsecondary\r\n\t\t\t\t\t\ttopBorder\r\n\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Header>\r\n\t\t\t\t\t\t\tКоммерческое предложение\r\n\t\t\t\t\t\t</Header>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\tsecondary\r\n\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t\t<Form.Field inline>\r\n\t\t\t\t\t\t\t\t<Label>Дата</Label>\r\n\t\t\t\t\t\t\t\t<LocalDatePicker\r\n\t\t\t\t\t\t\t\t\tfield={dateLocal}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t<Label>Сумма</Label>\r\n\t\t\t\t\t\t\t\t<CurrencyInput\r\n\t\t\t\t\t\t\t\t\tfield={amount}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t\tplaceholder='Введите сумму КП'\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\tsecondary\r\n\t\t\t\t\t\tsmall\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{err &&\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\theader={err.title}\r\n\t\t\t\t\t\t\t\tcontent={err.message} \r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<Div inline w='formLabel' />\r\n\t\t\t\t\t\t<Button \r\n\t\t\t\t\t\t\tprimary \r\n\t\t\t\t\t\t\tcontent={'Создать'}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\tonClick={submit} />\r\n\t\t\t\t\t\t<A cancel onClick={cancel}>Отмена</A>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Divider fitted/>\r\n\t\t\t\t</Fragment>}\r\n\t\t\t</SmartForm>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default EnquiryCommercialOffer","import React, { Component, Fragment } from 'react'\r\n\r\nimport { Header as SHeader, Icon, Label, Form, Comment, \r\n\tMessage, Dropdown } from 'semantic-ui-react'\r\nimport { P, Div, Button, Section } from './styled-semantic/styled-semantic'\r\nimport styled from 'styled-components'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { enquiryDetails, newEnquiry, createEnquiryEvent, \r\n\tenquiryFragment, allEnquiries, updateEnquiry } from '../graphql/enquiry'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nimport WrappedDraftEditor from './common/WrappedDraftEditor'\r\nimport { sanitize } from 'dompurify'\r\nimport { currency } from '../utils/format'\r\n\r\nimport EnquiryEdit from './EnquiryEdit'\r\nimport EnquiryCommercialOffer from './EnquiryCommercialOffer'\r\n\r\nconst Table = styled.table`\r\n\t/* table-layout: fixed; */\r\n\twidth: 100%;\r\n\tborder-collapse: collapse;\r\n`\r\n\r\nconst Tr = styled.tr`\r\n  margin: 0 0 1em;\r\n  line-height: 1.4285em;\r\n  color: rgba(0,0,0,.87);\r\n`\r\n\r\nconst Td = styled.td`\r\n  :nth-child(1) {\r\n\t\twidth: ${props => props.theme.widths.formLabel};\r\n\t// color: rgba(0,0,0,.87);\r\n\t/* font-size: .92857143em; */\r\n\t/* line-height: 32px; */\r\n\t\tline-height: 1.21428571em;\r\n\t\tpadding: .67857143em 0;\r\n\t\tvertical-align: top;\r\n  }\r\n  :nth-child(2) {\r\n\t\t// width: 100px;\r\n\t\tfont-size: 1em;\r\n\t\tfont-weight: bold;\r\n\t\tline-height: 1.21428571em;\r\n\t\tpadding: .67857143em 0;\r\n  }\r\n`\r\nconst InputTd = Td.extend`\r\n\tpadding-top: 0 !important;\r\n`\r\n\r\nconst EditorTd = InputTd.extend`\r\n\tfont-weight: unset !important;\r\n\t/* padding-bottom: 0 !important; */\r\n`\r\n\r\nconst SDropdown = styled(Dropdown)`\r\n\t& .active.item {\r\n\t\tdisplay: none !important;\r\n\t}\r\n\t& .selected.item {\r\n\t\tbackground: none !important;\r\n\t}\r\n`\r\n\r\n// const DarkGreenButton = styled(Button)`\r\n// \t&&&& {\r\n// \t\tcolor: #178230 !important;\r\n// \t\t&:hover {\r\n// \t\t\tcolor: #0c5a1e !important;\r\n// \t\t}\r\n// \t}\r\n// `\r\n\r\nconst Comments = styled(Comment.Group)`\r\n\tmargin: 1.5em 1.5em 1.5em 55px !important;\r\n\t/* margin: 1.5em 1.5em 1.5em 0 !important; */\r\n`\r\n\r\nconst CIcon = styled(Icon)`\r\n\t// apply horizontal offset correction for different icons to be vertically alined\r\n  width: ${props => (props.type === 'CREATE') ? '1.73em' : '1.4em' } !important;\r\n\t${props => (props.type === 'CREATE') && 'margin-left: -0.33em !important;'}\r\n  margin-top: .15em !important;\r\n\tfloat: left;\r\n\topacity: 0.6 !important;\r\n`\r\n\r\nconst UserLabel = styled(Label)`\r\n  width: 2em;\r\n  height: 2em;\r\n  margin-left: 0 !important;\r\n  padding: .4em 0em !important;\r\n  float: left;\r\n\ttext-align: center;\r\n\t${props => props.indent && 'margin-left: 42.69px !important;'}\r\n\t// ${props => props.indent && 'margin-left: calc(1.4em + 0.25rem) !important;'}\r\n`\r\n\r\nconst CContent = styled(Comment.Content)`\r\n  margin-left: 6.5em !important;\r\n`\r\n\r\nconst CMetadata = styled(Comment.Metadata)`\r\n\tmargin-left: 0 !important;\r\n  color: rgba(0,0,0,.6) !important;\r\n`\r\n\r\nconst CText = styled(Comment.Text)`\r\n\t& p { margin: 0 !important; }\r\n\t&>table { \r\n\t\twidth: 100%;\r\n\t\tborder-collapse: collapse; \r\n\t}\r\n\t&>table>tbody>tr>td {\r\n\t\tpadding-left: 4px;\r\n\t\tvertical-align: top;\r\n\t}\r\n\t&>table>tbody>tr>td:nth-child(1) {\r\n\t\twidth: 5px;\r\n\t}\r\n\t&>table>tbody>tr>td:nth-child(2) {\r\n\t\twidth: 25px;\r\n\t\tmin-width: 90px;\r\n\t}\r\n\t&>table>tbody>tr>td:nth-child(3) {\r\n\t\tpadding-left: 10px;\r\n\t\twidth: 1000px;\r\n\t\tmin-width: 240px;\r\n\t}\r\n\t&>table>tbody>tr>td>span {\r\n\t\tmargin-right: 5px;\r\n\t}\r\n`\r\n\r\nconst CMessage = styled(Message)`\r\n\tmargin-left: 6.35em !important;\r\n`\r\n\t\r\nclass EnquiryDetails extends Component {\r\n\tisNewEnquiry = this.props.id === 'new'\r\n\teditorRef = React.createRef()\r\n\tnoteEditorRef = React.createRef()\r\n\tcomponentIsMounted = true\r\n  state = {\r\n\teditMode: this.isNewEnquiry ? true : false,\r\n\t\teditorHasText: false,\r\n\t\tnoteEditorDiff: false,\r\n\t\tnoteKey: 1,\r\n\t\tactiveCO: '',\r\n\t\tloading: false,\r\n\t\tcreatingComment: false,\r\n\t\tchangingStatus: false,\r\n\t\tstatusPending: false,\r\n\t\tsavingNote: false,\r\n\t\terror: ''\r\n\t}\r\n\t// refetchEnquiry = async () => {\r\n\t// \tthis.setState({ loading: true })\r\n\t// \tconst res = await this.props.enquiryQuery.refetch()\r\n\t// \tthis.setState({ loading: false })\r\n\t// }\r\n\tenableEditMode = () => this.setState({ editMode: true })\r\n\texitEditMode = () => this.setState({ editMode: false })\r\n\tsetEditorHasText = (bool) => this.setState({ editorHasText: bool })\r\n\tsetNoteEditorDiff = (bool) => this.setState({ noteEditorDiff: bool })\r\n\tcancelEdit = () => {\r\n\t\tif (this.isNewEnquiry) return this.props.closeDetails()\r\n\t\tthis.exitEditMode()\r\n  }\r\n  createComment = async () => {\r\n\t\ttry {\r\n\t\t\tconst htmlText = this.editorRef.current.exportHtml()\r\n\t\t\t// if (htmlText === '<p><br></p>') return\r\n\t\t\tif (htmlText === null) return\r\n\t\t\tthis.setState({creatingComment: true})\r\n\t\t\tawait this.props.createEnquiryEvent({\r\n\t\t\t\tvariables: {\r\n\t\t\t\t\tenquiryId: this.props.id,\r\n\t\t\t\t\thtmlText\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.setState({ creatingComment: false, editorHasText: false, error: '' })\r\n\t\t\tthis.editorRef.current.clear()\r\n\t\t} catch(err) {\r\n\t\t\tthis.setState({ creatingComment: false, error: err.message })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tchangeStatus = async (e, { value, co }) => {\r\n\t\tconst coStatusId = this.props.enquiryQuery.statuses.find(s => s.name === 'Выставлено КП').id\r\n\t\tif (value === coStatusId) {\r\n\t\t\tif (!this.state.statusPending) return this.setState({ statusPending: true, activeCO: 'new' })\r\n\t\t\telse this.setState({ statusPending: false })\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tthis.setState({ changingStatus: true })\r\n\t\t\tawait this.props.createEnquiryEvent({\r\n\t\t\t\tvariables: {\r\n\t\t\t\t\tenquiryId: this.props.id,\r\n\t\t\t\t\tstatusId: value,\r\n\t\t\t\t\t...(co && { doc: { ...co } })\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.setState({ changingStatus: false, activeCO: '' })\r\n\t\t} catch (err) {\r\n\t\t\tthis.setState({ changingStatus: false, error: err.message })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tcancelPendingStatusChange = () => {\r\n\t\tthis.setState({ statusPending: false, activeCO: '' })\r\n\t}\r\n\tsaveNote = async () => {\r\n\t\ttry {\r\n\t\t\tlet htmlNote = this.noteEditorRef.current.exportHtml()\r\n\t\t\tif (htmlNote === this.props.enquiryQuery.enquiry.htmlNote) {\r\n\t\t\t\treturn this.setState({ noteKey: this.state.noteKey + 1, noteEditorDiff: false })\r\n\t\t\t}\r\n\t\t\tthis.setState({ savingNote: true })\r\n\t\t\tawait this.props.updateEnquiry({ \r\n\t\t\t\tvariables: { input: { id: this.props.id, htmlNote } } })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ savingNote: false, error: '', noteKey: this.state.noteKey + 1, noteEditorDiff: false })\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ savingNote: false, error: err.message })\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n  render() { \r\n\t\tconst { editorHasText, creatingComment, changingStatus, statusPending, \r\n\t\t\t\terror, noteEditorDiff, noteKey, savingNote, activeCO } = this.state\r\n\t\tconst { enquiryQuery } = this.props\r\n\t\tconst isNewEnquiry = this.isNewEnquiry\r\n\t\tif (enquiryQuery.loading) return <Section>Загрузка...</Section>\r\n\t\tif (enquiryQuery.error) return <Section>Ошибка {enquiryQuery.error.message}</Section>\r\n\t\tconst enquiry = isNewEnquiry ? enquiryQuery.newEnquiry : enquiryQuery.enquiry\r\n\t\tconst { org, model, qty, htmlNote, events } = enquiry\r\n\t\tconst coEvents = events && events.filter(e => e.doc)\r\n\t\tconst curStatus = events && events.filter(e => e.status).pop().status\r\n\t\t// rawStatuses - received from server\r\n\t\tconst rawStatuses = enquiryQuery.statuses.slice()\r\n\t\tconst coStatusId = rawStatuses.find(s => s.name === 'Выставлено КП').id\r\n\t\tconst orderStatusId = rawStatuses.find(s => s.name === 'Заказ').id\r\n\t\tconst refusalStatusIds = rawStatuses.filter(s => ['Нет возможности', 'Отказ'].includes(s.name)).map(s => s.id)\r\n\t\t// sort statuses so that refusal statuses are at the end of their stage block\r\n\t\tconst statuses = rawStatuses.sort((a, b) => a.stage === b.stage && refusalStatusIds.includes(a.id))\r\n\t\tlet stage = 0\r\n\t\tconst eventStatusPresentationHelpers = events && events.reduce((res, e, i) => {\r\n\t\t\tif (!e.status || i === 0) return res = [...res, null]\r\n\t\t\tif (refusalStatusIds.includes(e.status.id)) return [...res, 'refuse']\r\n\t\t\tif (e.status.id === orderStatusId) return [...res, 'order']\r\n\t\t\tres.push(e.status.stage - stage > 0 ? 'up' : 'down')\r\n\t\t\tstage = e.status.stage\r\n\t\t\treturn res\r\n\t\t}, [])\r\n\t\treturn (\r\n\t\t\t<GlobalContext>\r\n\t\t\t\t{({ details, setDetails }) => {\r\n\t\t\t\t\tconst { id, editMode } = details\r\n\t\t\t\t\tconst isNewEnquiry = id === 'new'\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t{ (editMode || isNewEnquiry) &&\r\n\t\t\t\t\t\t\t\t<EnquiryEdit\r\n\t\t\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t\t\t\tenquiry={enquiry}\r\n\t\t\t\t\t\t\t\t\tsetDetails={setDetails}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{ !(editMode || isNewEnquiry) && <Fragment>\r\n\t\t\t\t\t\t\t\t<Section>\r\n\t\t\t\t\t\t\t\t\t<Table><tbody>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Организация</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>{org && org.name}</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Изделие</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>{model && model.name}</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Кол-во, шт.</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>{qty}</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t{ !!coEvents.length &&\r\n\t\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Td>КП</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{coEvents.map(({ doc: { id, dateLocal, amount } }) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<P key={id} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfw='normal'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlh='1.21428571em' >\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<b>{currency(amount)} </b> ( от {dateLocal} )\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</P>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t\t</Tr> }\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Примечания</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<EditorTd>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<WrappedDraftEditor\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={noteKey}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tborderless\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tref={this.noteEditorRef}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tinitFromHtml={htmlNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetEditorDiff={this.setNoteEditorDiff}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdiff={noteEditorDiff}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSave={this.saveNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{noteEditorDiff &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmt='.67857143em'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent='Сохранить примечание'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabelPosition='left'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon='save'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfloated='left'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={this.saveNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={savingNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tloading={savingNote}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t</EditorTd>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t\t<Tr>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td>Статус</Td>\r\n\t\t\t\t\t\t\t\t\t\t\t<InputTd>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<SDropdown labeled button className='icon'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tloading={changingStatus}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={changingStatus || statusPending}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={curStatus.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext={curStatus.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toptions={statuses\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter(s => (s.id === curStatus.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|| Math.abs(s.stage - curStatus.stage) === 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t&& !(s.stage === 0 && curStatus.stage !== 0))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// && !(s.name === 'Выставлено КП'))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map(s => ({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey: s.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext: s.name,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: s.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: { \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbasic: true, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent: 'ст', \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdetail: s.stage, \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon:   refusalStatusIds.includes(s.id) ? 'minus circle' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ts.id === orderStatusId ? 'checkmark' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`long arrow alternate ${(s.stage - curStatus.stage) > 0 ? 'up' : 'down' }`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={this.changeStatus} \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectOnBlur={false}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectOnNavigation={false} >\r\n\t\t\t\t\t\t\t\t\t\t\t\t</SDropdown>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Label basic size='large' content='стадия' detail={ curStatus.stage} />\r\n\t\t\t\t\t\t\t\t\t\t\t</InputTd>\r\n\t\t\t\t\t\t\t\t\t\t\t<Td></Td>\r\n\t\t\t\t\t\t\t\t\t\t</Tr>\r\n\t\t\t\t\t\t\t\t\t</tbody></Table>\r\n\t\t\t\t\t\t\t\t</Section>\r\n\t\t\t\t\t\t\t\t{ activeCO && \r\n\t\t\t\t\t\t\t\t\t<EnquiryCommercialOffer \r\n\t\t\t\t\t\t\t\t\t\tid={activeCO} \r\n\t\t\t\t\t\t\t\t\t\tsubmit={(co) => this.changeStatus(null, { value: coStatusId, co })}\r\n\t\t\t\t\t\t\t\t\t\tcancel={this.cancelPendingStatusChange} />}\r\n\t\t\t\t\t\t\t\t<Comments minimal>\r\n\t\t\t\t\t\t\t\t\t<SHeader as='h3' dividing content='Комментарии и события' />\r\n\t\t\t\t\t\t\t\t\t{ events.map((e, i) => {\r\n\t\t\t\t\t\t\t\t\t\tconst { fName, lName } = e.user.person\r\n\t\t\t\t\t\t\t\t\t\tconst userInitials = (lName ? fName.slice(0,1) : fName.slice(0,2)) + (lName ? lName.slice(0,1) : '')\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t<Comment key={e.id}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{ e.type && (e.type !== 'COMMENT') &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CIcon \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize='big' type={e.type}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolor={ e.type === 'CREATE' ? 'green' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'UPDATE' ? 'blue' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'up' ? 'yellow' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'down' ? 'brown' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'refuse' ? 'red' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'order' ? 'green' : 'grey'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname ={ e.type === 'CREATE' ? 'plus' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'UPDATE' ? 'write square' : \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'refuse' ? 'minus circle' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' && eventStatusPresentationHelpers[i] === 'order' ? 'checkmark' :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.type === 'STATUS' ? `long arrow alternate ${eventStatusPresentationHelpers[i]}` : 'question'} /> }\r\n\t\t\t\t\t\t\t\t\t\t\t\t<UserLabel \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize='big' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={userInitials}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tindent={!e.type || e.type === 'COMMENT' ? 1 : 0} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t{/* <Comment.Avatar src='https://react.semantic-ui.com/images/avatar/small/matt.jpg' /> */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CContent>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* <Comment.Author \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tas='span' \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={fName + ' ' + lName} /> */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CMetadata\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={e.datetimeLocal.slice(0,16)} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CText dangerouslySetInnerHTML={{__html: sanitize(e.htmlText)}} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* <Comment.Actions\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={( <a>Reply</a> )} /> */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</CContent>\r\n\t\t\t\t\t\t\t\t\t\t\t</Comment>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t<Form reply error={!!error}>\r\n\t\t\t\t\t\t\t\t\t\t<Div m='0 0 1em 6.35em'>\r\n\t\t\t\t\t\t\t\t\t\t\t<WrappedDraftEditor\r\n\t\t\t\t\t\t\t\t\t\t\t\tref={this.editorRef} \r\n\t\t\t\t\t\t\t\t\t\t\t\tsetEditorHasText={this.setEditorHasText}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonSave={this.createComment}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t\t\t\t\t<CMessage\r\n\t\t\t\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\t\t\t\theader='Коммент добавить не удалось..'\r\n\t\t\t\t\t\t\t\t\t\t\tcontent={error}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<Button content='Добавить коммент' labelPosition='left' icon='edit' primary floated='right' \r\n\t\t\t\t\t\t\t\t\t\t\tonClick={this.createComment}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={!editorHasText}\r\n\t\t\t\t\t\t\t\t\t\t\tloading={creatingComment}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t\t\t\t</Comments>\r\n\t\t\t\t\t\t\t</Fragment> }\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t)\r\n\t\t\t\t}}\r\n\t\t\t</GlobalContext>\r\n\t\t)\r\n  }\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(updateEnquiry, { name: 'updateEnquiry' }),\r\n\tgraphql(createEnquiryEvent, { \r\n\t\tname: 'createEnquiryEvent',\r\n\t\toptions: (props) => ({\r\n\t\t\tupdate: (cache, {data: reponseData}) => {\r\n\t\t\t\tconst newEvent = reponseData.createEnquiryEvent\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tconst id = `Enquiry:${props.id}`\r\n\t\t\t\tconst fragment = enquiryFragment\r\n\t\t\t\tlet data = cache.readFragment({\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tfragment\r\n\t\t\t\t})\r\n\t\t\t\tdata.events.push(newEvent)\r\n\t\t\t\tcache.writeFragment({\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tfragment,\r\n\t\t\t\t\tdata\r\n\t\t\t\t})\r\n\t\t\t\t// also update allEnquiries if status changed (for EnquiryTable view update)\r\n\t\t\t\tif (! newEvent.status) return\r\n\t\t\t\tconst query = allEnquiries\r\n\t\t\t\tdata = cache.readQuery({ query })\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tconst enquiry = data.enquiries.find(e => e.id === props.id)\r\n\t\t\t\tenquiry.status = newEvent.status\r\n\t\t\t\tif (newEvent.doc) enquiry.docs.push(newEvent.doc)\r\n\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t},\r\n\t\t\t// refetchQueries:[ 'allEnquiries' ]\r\n\t\t})\r\n  }),\r\n\tgraphql(newEnquiry, { name: 'enquiryQuery', skip: (props) => props.id !== 'new' }),\r\n\tgraphql(enquiryDetails, { name: 'enquiryQuery', skip: (props) => props.id === 'new' })\r\n)(EnquiryDetails)","import React, { Component } from 'react'\r\n\r\nimport { Input } from 'semantic-ui-react'\r\n\r\nclass CurrencyInput extends Component {\r\n    handleInputChange = ( e, { value } ) => {\r\n        // TODO validate and parse according to input type\r\n        // const { type, field: { name }, setField } = this.props\r\n        const { field: { name }, setField } = this.props\r\n        const newVal = parseInt(value, 10) || ''\r\n        setField(name, {value: newVal})\r\n    }\r\n    render() {\r\n        const { field: {curVal: value}, setField , ...rest } = this.props\r\n        return (\r\n            <Input {...rest}\r\n                value={value}\r\n                onChange={this.handleInputChange} \r\n            />\r\n        )\r\n    }\r\n}\r\n\r\nexport default CurrencyInput\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport { Form, Button, Message } from 'semantic-ui-react'\r\nimport { Div, Span, A, Label, Section } from './styled-semantic/styled-semantic.js'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { orderLocal, upsertOrder } from '../graphql/order'\r\nimport { allEnquiries } from '../graphql/enquiry'\r\n\r\nimport { toLocalISOString } from '../utils/dates'\r\n\r\nimport LocalDatePicker from './common/LocalDatePicker'\r\nimport CurrencyInput from './common/CurrencyInput'\r\nimport SmartForm from './common/SmartForm'\r\nimport SmartInput from './common/SmartInput'\r\n\r\nclass OrderEdit extends Component {\r\n\tcomponentIsMounted = true\r\n\tisNewEntity = this.props.id === 'new'\r\n\tstate = {\r\n\t\tloading: false,\r\n\t\terr: null\r\n\t}\r\n\tsubmit = (entity) => {\r\n\t\tthis.upsertOrder({\r\n\t\t\t...entity,\r\n\t\t\t...this.isNewEntity && {\r\n\t\t\t\tenquiryId: this.props.enquiryId,\r\n\t\t\t},\r\n\t\t\t...!this.isNewEntity && {\r\n\t\t\t\tid: this.props.id,\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tupsertOrder = async (variables) => {\r\n\t\ttry {\r\n\t\t\tthis.setState({ loading: true })\r\n\t\t\tconst res = await this.props.upsertOrder({ variables })\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({ loading: false, err: null })\r\n\t\t\tthis.props.setDetails({\r\n\t\t\t\ttype: 'Order',\r\n\t\t\t\tid: res.data.upsertOrder.id\r\n\t\t\t})\r\n\t\t\tthis.props.setExpanded({\r\n\t\t\t\tid: res.data.upsertOrder.id,\r\n\t\t\t\tvalue: true\r\n\t\t\t})\r\n\t\t} catch (err) {\r\n\t\t\tif (!this.componentIsMounted) return\r\n\t\t\tthis.setState({\r\n\t\t\t\tloading: false,\r\n\t\t\t\terr: {\r\n\t\t\t\t\ttitle: `${this.isNewEntity ? 'Создать' : 'Сохранить'} не удалось..`,\r\n\t\t\t\t\tmessage: err.message\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log(err)\r\n\t\t}\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tthis.componentIsMounted = false\r\n\t}\r\n\trender() {\r\n\t\tconst { loading } = this.state\r\n\t\tconst { id, closeDetails, setDetails } = this.props\r\n\t\tconst isNewEntity = id === 'new'\r\n\t\tconst order = isNewEntity\r\n\t\t\t? {\r\n\t\t\t\tdateLocal: toLocalISOString(new Date()).slice(0, 10),\r\n\t\t\t\tqty: '',\r\n\t\t\t\tamount: ''\r\n\t\t\t}\r\n\t\t\t: this.props.orderLocal.orderLocal\r\n\t\treturn (\r\n\t\t\t<SmartForm\r\n\t\t\t\tisNewEntity={isNewEntity}\r\n\t\t\t\tentity={order}\r\n\t\t\t\trequiredFields={['dateLocal', 'qty', 'amount']}\r\n\t\t\t\tsubmit={this.submit}\r\n\t\t\t\terr={this.state.err}\r\n\t\t\t>\r\n\t\t\t\t{({\r\n\t\t\t\t\tdisabled,\r\n\t\t\t\t\terr,\r\n\t\t\t\t\tsetField,\r\n\t\t\t\t\tsubmit,\r\n\t\t\t\t\tformState: { dateLocal, qty, amount }\r\n\t\t\t\t}) => <Fragment>\r\n\t\t\t\t\t<Section\r\n\t\t\t\t\t\tbottomBorder\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Form>\r\n\t\t\t\t\t\t\t<Form.Field inline>\r\n\t\t\t\t\t\t\t\t<Label>Дата</Label>\r\n\t\t\t\t\t\t\t\t<LocalDatePicker\r\n\t\t\t\t\t\t\t\t\tfield={dateLocal}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t<Label>Кол-во</Label>\r\n\t\t\t\t\t\t\t\t<SmartInput\r\n\t\t\t\t\t\t\t\t\ttype='number'\r\n\t\t\t\t\t\t\t\t\tplaceholder='Введите кол-во шт.'\r\n\t\t\t\t\t\t\t\t\tfield={qty}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t<Span pl='6px'>шт.</Span>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t\t<Form.Field inline required>\r\n\t\t\t\t\t\t\t\t<Label>Сумма</Label>\r\n\t\t\t\t\t\t\t\t<CurrencyInput\r\n\t\t\t\t\t\t\t\t\tfield={amount}\r\n\t\t\t\t\t\t\t\t\tsetField={setField}\r\n\t\t\t\t\t\t\t\t\tplaceholder='Введите сумму заказа'\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Form.Field>\r\n\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t\t<Section>\r\n\t\t\t\t\t\t{err &&\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t\t\theader={err.title}\r\n\t\t\t\t\t\t\t\tcontent={err.message}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t<Div inline w='formLabel' />\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tprimary\r\n\t\t\t\t\t\t\tcontent={this.isNewEntity ? 'Создать' : 'Сохранить'}\r\n\t\t\t\t\t\t\tdisabled={disabled}\r\n\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\tonClick={submit}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<A cancel\r\n\t\t\t\t\t\t\tonClick={\r\n\t\t\t\t\t\t\t\tid === 'new'\r\n\t\t\t\t\t\t\t\t\t? closeDetails\r\n\t\t\t\t\t\t\t\t\t: () => setDetails({\r\n\t\t\t\t\t\t\t\t\t\ttype: 'Order',\r\n\t\t\t\t\t\t\t\t\t\tid\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tОтмена\r\n\t\t\t\t\t\t</A>\r\n\t\t\t\t\t</Section>\r\n\t\t\t\t</Fragment>}\r\n\t\t\t</SmartForm>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(upsertOrder, {\r\n\t\t\tname: 'upsertOrder',\r\n\t\t\toptions: {\r\n\t\t\t\tupdate: (cache, { data: responseData }) => {\r\n\t\t\t\t\tconst upsertedOrder = responseData.upsertOrder\r\n\t\t\t\t\tconsole.log('this > ', this)\r\n\t\t\t\t\tconst query = allEnquiries\r\n\t\t\t\t\tconst data = cache.readQuery({ query })\r\n\t\t\t\t\tconst enquiry = data.enquiries.find(e => e.id === upsertedOrder.enquiry.id)\r\n\t\t\t\t\tenquiry.orders = [\r\n\t\t\t\t\t\t...enquiry.orders.filter(o => o.id !== upsertedOrder.id),\r\n\t\t\t\t\t\tupsertedOrder\r\n\t\t\t\t\t].sort((a, b) => a.num > b.num)\r\n\t\t\t\t\tcache.writeQuery({ query, data })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}),\r\n\tgraphql(orderLocal, {\r\n\t\tname: 'orderLocal',\r\n\t\tskip: (props) => props.id === 'new'\r\n\t}),\r\n)(OrderEdit)","import React, { Component } from 'react'\r\n\r\nimport DetailsHeaderContainer from './DetailsHeaderContainer'\r\nimport DetailsHeaderTitle from './DetailsHeaderTitle'\r\nimport DetailsHeaderButtons from './DetailsHeaderButtons'\r\n\r\nclass DetailsHeader extends Component {\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tbuttons,\r\n\t\t\tsize,\r\n\t\t\tnoIndent,\r\n\t\t\tbottomBorder,\r\n\t\t\ttitle,\r\n\t\t\tsubtitle,\r\n\t\t\ttitleSize,\r\n\t\t\tonClick,\r\n\t\t\t// expandable\r\n\t\t\texpanded,\r\n\t\t} = this.props\r\n\t\treturn (\r\n\t\t\t<DetailsHeaderContainer\r\n\t\t\t\texpanded={expanded}\r\n\t\t\t\tonClick={onClick}\r\n\t\t\t\tsize={size}\r\n\t\t\t\tnoIndent={noIndent}\r\n\t\t\t\tbottomBorder={bottomBorder}\r\n\t\t\t>\r\n\t\t\t\t<DetailsHeaderTitle\r\n\t\t\t\t\ttitle={title}\r\n\t\t\t\t\tsubtitle={subtitle}\r\n\t\t\t\t\tsize={titleSize || size}\r\n\t\t\t\t/>\r\n\t\t\t\t{ buttons &&\r\n\t\t\t\t\t<DetailsHeaderButtons>\r\n\t\t\t\t\t\t{buttons}\r\n\t\t\t\t\t</DetailsHeaderButtons>\r\n\t\t\t\t}\r\n\t\t\t</DetailsHeaderContainer>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default DetailsHeader\r\n","import React, { Component } from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Section } from './styled-semantic/styled-semantic'\r\n\r\nimport DetailsHeader from './DetailsHeader'\r\n\r\nconst OuterSection = styled(Section)`\r\n  & { \r\n    padding: 0;\r\n    ${props => props.expanded && `{\r\n      margin-top: -1px;\r\n      border-bottom-color: rgba(34, 36, 38, 0.15);\r\n    }`}\r\n  }\r\n`\r\nconst InnerSection = styled(Section)`\r\n  & {\r\n    padding: 0;\r\n    margin-bottom: -1px;\r\n  }\r\n`\r\n\r\nclass CollapsableSection extends Component {\r\n  state = {\r\n    expanded: false\r\n  }\r\n  render() {\r\n    const {\r\n      children,\r\n      forceExpanded,\r\n      ...headerProps\r\n    } = this.props\r\n    const expanded = this.state.expanded || forceExpanded\r\n    return (\r\n      <OuterSection\r\n        expanded={expanded ? 1 : 0}\r\n        topBorder={expanded}\r\n        bottomBorder={expanded}\r\n      >\r\n        <DetailsHeader\r\n          {...headerProps}\r\n          expanded={expanded}\r\n          bottomBorder={expanded && 'dark'}\r\n          disabled={forceExpanded}\r\n          titleSize='small'\r\n          onClick={\r\n            !forceExpanded\r\n            && (() => this.setState({ expanded: !this.state.expanded }))\r\n          }\r\n        />\r\n        {expanded &&\r\n          <InnerSection>\r\n            {children}\r\n          </InnerSection>\r\n        }\r\n      </OuterSection>\r\n    )\r\n  }\r\n}\r\n\r\nexport default CollapsableSection\r\n","import _ from 'lodash'\r\n\r\nconst ProdsByDept = ({\r\n    children,\r\n    prods: oriProds,\r\n    // extra\r\n    selectedIds,\r\n    orderId,\r\n    selectLimit,\r\n    // order\r\n    selectedProds = [],\r\n    orderProdsQty,\r\n    diff, //diff mode\r\n    // epxpand\r\n    expandedIds,\r\n    expanded\r\n}) => {\r\n  const modes = {\r\n    ...orderId && { extra: true },\r\n    ...orderId && selectLimit === selectedIds.length && { limitReached: true },\r\n    ...!orderId && { order: true },\r\n    ...diff && { diff: true },\r\n    ...expandedIds && { expand: true },\r\n    ...expanded && { expanded: true },\r\n  }\r\n  const allProds =\r\n    modes['extra'] ? oriProds :\r\n    modes['order'] ? _.unionBy(oriProds, selectedProds, 'id') : []\r\n  const depts = _(allProds)\r\n    .sortBy('dept.type')\r\n    .groupBy('dept.name')\r\n    .reduce(function(depts, prods) {\r\n      let dept = { ...prods[0].dept }\r\n      dept = {\r\n        ...dept,\r\n        count: prods.length,\r\n        readyCount: prods.filter(p => p.progress === 100).length,\r\n        hasDefect: prods.filter(p => p.hasDefect).length,\r\n        isSpoiled: prods.filter(p => p.isSpoiled).length,\r\n        ...modes['expand'] && {\r\n          expanded: expandedIds.some(id => id === dept.id)\r\n        },\r\n        ...modes['expanded'] && {\r\n          expanded: true\r\n        },\r\n        prods: prods.map(p => {\r\n          let prod = {\r\n            ...p,\r\n            ...modes['extra'] && {\r\n              selected: selectedIds.includes(p.id),\r\n              ordered: !!p.order && p.order.id !== orderId\r\n            },\r\n            ...modes['order'] && modes['diff'] && {\r\n              added: !oriProds.some(op => op.id === p.id),\r\n              removed: !selectedProds.some(sp => sp.id === p.id),\r\n            },\r\n          }\r\n          if (modes['extra']) {\r\n            prod = {\r\n              ...prod,\r\n              disabled:\r\n                prod.ordered\r\n                || (modes['limitReached'] && !prod.selected)\r\n            }\r\n          }\r\n          return prod\r\n        }),\r\n      }\r\n      if (modes['extra']) {\r\n        const orderedCount = dept.prods.filter(p => p.ordered).length || 0\r\n        dept = {\r\n          ...dept,\r\n          selectedCount: dept.prods.filter(p => p.selected).length || 0,\r\n          orderedCount,\r\n          availCount: dept.count - orderedCount\r\n        }\r\n        dept = {\r\n          ...dept,\r\n          selected:\r\n            dept.selectedCount === dept.availCount ? true :\r\n            dept.selectedCount === 0 ? false :\r\n            'partly'\r\n        }\r\n        dept = {\r\n          ...dept,\r\n          disabled:\r\n            dept.prods.every(p => p.disabled)\r\n            || (modes['limitReached'] && [false].includes(dept.selected))\r\n        }\r\n      }\r\n      depts.push(dept)\r\n      return depts\r\n    }, [])\r\n  if (modes['order']) {\r\n    const unreservedProdsCount = diff\r\n      ? orderProdsQty - selectedProds.length\r\n      : orderProdsQty - oriProds.length\r\n    if (unreservedProdsCount) {\r\n      depts.unshift({\r\n        id: 'unreserved',\r\n        name: 'Без резерва',\r\n        count: unreservedProdsCount,\r\n        prods: []\r\n      })\r\n    }\r\n  }\r\n  const xor = !!_.xorBy(oriProds, selectedProds, 'id').length\r\n  // console.log('depts > ', depts)\r\n  return children({ depts, xor })\r\n}\r\n\r\nexport default ProdsByDept\r\n","import React, { Fragment } from 'react'\r\n\r\nimport cloneDeep from 'lodash/cloneDeep'\r\n\r\nimport Table from './common/Table'\r\nimport TableRow from './common/TableRow'\r\n\r\nconst defaultFields = [{\r\n\tname: 'name',\r\n\tpath: 'name',\r\n\ttitle: 'Участок / № Изделия',\r\n\twidth: '170px'\r\n},{\r\n\tname: 'progress',\r\n\tpath: 'progress',\r\n\ttitle: 'Заверш.',\r\n\twidth: '65px'\r\n},{\r\n\tname: 'hasDefect',\r\n\tpath: 'hasDefect',\r\n\ttitle: 'Отклон.',\r\n\twidth: '65px'\r\n},{\r\n\tname: 'isSpoiled',\r\n\tpath: 'isSpoiled',\r\n\ttitle: 'Брак',\r\n\twidth: '55px'\r\n},{\r\n\tname: 'reserve',\r\n\ttitle: 'Резерв',\r\n\twidth: '75px'\r\n}]\r\n\r\nconst DeptProdTable = ({\r\n\t// data\r\n\tdepts,\r\n\tskipFields = [],\r\n\t// methods\r\n\tselect,\r\n\texpand,\r\n\t// visual\r\n\tindent,\r\n\tnameFieldWidth\r\n}) => {\r\n\tconst fields = cloneDeep(defaultFields)\r\n\tif (nameFieldWidth) fields.find(f => f.name === 'name').width = nameFieldWidth\r\n\treturn (\r\n\t\t<Table\r\n\t\t\tfields={fields.filter(f => !skipFields.includes(f.name))}\r\n\t\t\tindent={indent}\r\n\t\t\tselect={select}\r\n\t\t\texpand={expand}\r\n\t\t>\r\n\t\t\t{({ tableFields }) => <Fragment>\r\n\t\t\t\t{depts.map(dept => {\r\n\t\t\t\t\t\tconst { id, expanded } = dept\r\n\t\t\t\t\t\tif (id === 'unreserved') return (\r\n\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t// bold\r\n\t\t\t\t\t\t\t\tentity={dept}\r\n\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\trowFields={[\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tname: 'name',\r\n\t\t\t\t\t\t\t\t\t\tvalue: dept.name + ' ('+ dept.count + ')'\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<Fragment\r\n\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\tentity={dept}\r\n\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\texpandFor='prods'\r\n\t\t\t\t\t\t\t\t\texpanded={expanded}\r\n\t\t\t\t\t\t\t\t\texpand={() => expand(id)}\r\n\t\t\t\t\t\t\t\t\tonClick={() => expand(id)}\r\n\t\t\t\t\t\t\t\t\tselect={() => select(id)}\r\n\t\t\t\t\t\t\t\t\trowFields={[\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'name',\r\n\t\t\t\t\t\t\t\t\t\t\tvalue: dept.name + ' ('+ dept.count + ')'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'progress',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'readyCount',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'checkmark',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'green'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'warning sign',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'orange'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'broken chain',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'red'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'reserve',\r\n\t\t\t\t\t\t\t\t\t\t\tpath: 'orderedCount',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'gavel',\r\n\t\t\t\t\t\t\t\t\t\t\ticonColor: 'brown'\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t{\texpanded && dept.prods.map((prod, i) => {\r\n\t\t\t\t\t\t\t\t\tconst { id, progress, order, added, removed } = prod\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\t\t\t\t<TableRow\r\n\t\t\t\t\t\t\t\t\t\t\tsecondary={1}\r\n\t\t\t\t\t\t\t\t\t\t\tlastSecondaryRow={i === dept.prods.length - 1 ? 1 : 0}\r\n\t\t\t\t\t\t\t\t\t\t\tkey={id}\r\n\t\t\t\t\t\t\t\t\t\t\tentity={prod}\r\n\t\t\t\t\t\t\t\t\t\t\ttableFields={tableFields}\r\n\t\t\t\t\t\t\t\t\t\t\tselect={() => select(id)}\r\n\t\t\t\t\t\t\t\t\t\t\trowFields={[\r\n\t\t\t\t\t\t\t\t\t\t\t\t...(added || removed) ? [{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'service',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: added ? 'plus' : 'minus',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonColor: added ? 'green' : 'red'\r\n\t\t\t\t\t\t\t\t\t\t\t\t}] : [],\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'name',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'fullnumber'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'progress',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: progress && progress + '%'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'hasDefect',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: 'warning sign',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonColor: 'orange'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpath: 'isSpoiled',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: 'broken chain',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonColor: 'red'\r\n\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'reserve',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue: order && order.enquiry.num + '-' + order.num,\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t]}\r\n\t\t\t\t\t\t\t\t\t\t\t// active={}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={select && (() => select(id))}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t})}\r\n\t\t\t</Fragment>}\r\n\t\t</Table>\r\n\t\t// {/* {name} <ProdQtyLabel color='grey' basic content={`${prods.length}шт`} /> */}\r\n\t)\r\n}\r\n\r\nexport default DeptProdTable","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Button } from './styled-semantic/styled-semantic'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\n\r\nconst IconRight = styled(Icon)`\r\n  &&&& { margin: 0 -.42857143em 0 .42857143em; }\r\n`\r\n\r\nconst ReserveProdsButton = ({ modelId, orderId, prodIds }) => {\r\n  return (\r\n    <GlobalContext>\r\n      {({ extra, setExtra, setSelectedProdIds }) => (\r\n        <Button compact circular menu\r\n          activeColor='green'\r\n          active={!!extra}\r\n          onClick={(e) => {\r\n            e.stopPropagation()\r\n            setSelectedProdIds(prodIds)\r\n            setExtra({\r\n              type: 'Store',\r\n              modelId,\r\n              orderId\r\n            })\r\n          }}\r\n        >\r\n          <Icon name='gavel' />\r\n          Резервирование\r\n          <IconRight name='angle right' />\r\n        </Button>\r\n      )}\r\n    </GlobalContext>\r\n  )\r\n}\r\n\r\nexport default ReserveProdsButton","import gql from 'graphql-tag'\r\n\r\nexport const modelProds = gql`\r\n\tquery ModelProds ($modelId: ID!) {\r\n\t\tmodelProds (modelId: $modelId) {\r\n\t\t\tid\r\n\t\t\tfullnumber,\r\n      hasDefect,\r\n      isSpoiled,\r\n      progress,\r\n\t\t\tdept {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\ttype\r\n\t\t\t}\r\n\t\t\torder {\r\n\t\t\t\tid\r\n\t\t\t\tnum\r\n\t\t\t\tenquiry {\r\n\t\t\t\t\tid\r\n\t\t\t\t\tnum\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\nexport const prodsLocal = gql`\r\n\tquery ProdsLocal ($ids: [ID!]!) {\r\n\t\tprodsLocal (ids: $ids) {\r\n\t\t\tid\r\n\t\t\tfullnumber,\r\n      hasDefect,\r\n      isSpoiled,\r\n      progress,\r\n\t\t\tdept {\r\n\t\t\t\tid\r\n\t\t\t\tname\r\n\t\t\t\ttype\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n`\r\n","import { compose, graphql } from 'react-apollo'\r\nimport { prodsLocal } from '../../graphql/prod'\r\n\r\nconst ProdContext = ({\r\n\tchildren,\r\n\tprodsLocal: { prodsLocal }\r\n}) => {\r\n  return children({\r\n\t\tprodsLocal: prodsLocal || [],\r\n\t})\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(prodsLocal, { name: 'prodsLocal' }),\r\n)(ProdContext)\r\n","import React, { Fragment } from 'react'\r\n\r\nimport { Mutation } from 'react-apollo'\r\nimport { reserveProds } from '../graphql/order'\r\n\r\nimport { Section, Button, Message } from './styled-semantic/styled-semantic'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\nimport CollapsableSection from './CollapsableSection'\r\nimport ProdsByDept from './ProdsByDept';\r\nimport DeptProdTable from './DeptProdTable';\r\nimport ReserveProdsButton from './ReserveProdsButton'\r\n// import ListProvider from './special/ListProvider'\r\nimport ProdContext from './special/ProdContext'\r\n\r\nconst ModelProdsSection = ({\r\n  order: { id, model, qty, prods }\r\n}) => {\r\n  console.log('id, model, qty, prods > ', id, model, qty, prods)\r\n  return (\r\n    <GlobalContext>\r\n      {({ extra, setExtra, selectedProdIds }) => (\r\n        <CollapsableSection\r\n          forceExpanded={!!extra}\r\n          title={model.name}\r\n          subtitle={qty + 'шт'}\r\n          buttons={\r\n            <ReserveProdsButton\r\n              modelId={model.id}\r\n              orderId={id}\r\n              prodIds={prods.map(p => p.id)}\r\n            />\r\n          }\r\n        >\r\n            <ProdContext\r\n              ids={selectedProdIds}\r\n            >\r\n              {({ prodsLocal: selectedProds }) =>\r\n                <ProdsByDept\r\n                  prods={prods}\r\n                  selectedProds={selectedProds}\r\n                  orderProdsQty={qty}\r\n                  expanded\r\n                  diff={!!extra}\r\n                >\r\n                  {({ depts, xor }) =>\r\n                    <Fragment>\r\n                      <DeptProdTable\r\n                        depts={depts}\r\n                        skipFields={['reserve']}\r\n                        expand={() => null}\r\n                        indent='32px'\r\n                        nameFieldWidth='200px'\r\n                      />\r\n                      {extra && \r\n                      <Mutation\r\n                        mutation={reserveProds}\r\n                        variables={{\r\n                          orderId: id,\r\n                          prodIds: selectedProdIds\r\n                        }}\r\n                      >\r\n                        {( reserveProds, { loading, error }) => \r\n                          <Fragment>\r\n                            <Section\r\n                              minor\r\n                              head\r\n                              topBorder='dark'\r\n                            >\r\n                              <Button\r\n                                primary\r\n                                compact\r\n                                circular\r\n                                menu\r\n                                ml='0'\r\n                                content='Резервировать'\r\n                                icon='gavel'\r\n                                loading={loading}\r\n                                disabled={!xor}\r\n                                onClick={() => {\r\n                                  reserveProds()\r\n                                  setExtra(null)\r\n                                }}\r\n                              />\r\n                            </Section>\r\n                            {error &&\r\n                              <Message\r\n                                section\r\n                                error\r\n                                header='Зарезервировать не удалось..'\r\n                                content={error.message}\r\n                              />\r\n                            }\r\n                          </Fragment>\r\n                        }\r\n                      </Mutation>\r\n                      }\r\n                    </Fragment>\r\n                  }\r\n                </ProdsByDept>\r\n              }\r\n            </ProdContext>\r\n          {/* {!extra && \r\n            <ListProvider>\r\n              {({ list: selectedIds, setList: setSelectedProdIds}) =>\r\n                <ProdsByDept\r\n                  prods={prods}\r\n                  selectedIds={selectedIds}\r\n                  orderProdsQty={qty}\r\n                >\r\n                  {({ depts }) =>\r\n                    <DeptProdTable\r\n                      depts={depts}\r\n                      setSelectedProdIds={setSelectedProdIds}\r\n                      skipFields={['reserve']}\r\n                    />\r\n                  }\r\n                </ProdsByDept>\r\n              }\r\n            </ListProvider>\r\n          } */}\r\n        </CollapsableSection>\r\n      )}\r\n    </GlobalContext>\r\n  )\r\n}\r\n\r\nexport default ModelProdsSection\r\n","import React from 'react'\r\n\r\nimport ModelProdsSection from './ModelProdsSection'\r\n\r\nconst OrderDetails = ({ order }) => {\r\n  return (\r\n    <ModelProdsSection\r\n      order={order}\r\n    />\r\n  )\r\n}\r\n\r\nexport default OrderDetails","import { compose, graphql } from 'react-apollo'\r\n\r\nimport { enquiryDetails, enquiryLocal } from '../graphql/enquiry'\r\nimport { orderDetails, orderLocal } from '../graphql/order'\r\n\r\nconst DetailsDataProvider = ({\r\n  children,\r\n  type,\r\n  query1,\r\n  query2,\r\n  localQuery1,\r\n  localQuery2,\r\n}) => {\r\n  const query = query1 || query2\r\n  const { loading, error, refetch } = query\r\n  const entity =\r\n    type === 'Enquiry' ? query.enquiry :\r\n    type === 'Order' ? query.order\r\n    : null\r\n  const localQuery = localQuery1 || localQuery2\r\n  const localEntity =\r\n    type === 'Enquiry' ? localQuery.enquiryLocal :\r\n    type === 'Order' ? localQuery.orderLocal\r\n    : null\r\n  return children({\r\n    loading,\r\n    error,\r\n    refetch,\r\n    entity,\r\n    localEntity\r\n  })\r\n}\r\n\r\nexport default compose(\r\n  graphql(enquiryDetails, {\r\n    name: 'query1',\r\n    skip: ({ type }) => type !== 'Enquiry'\r\n  }),\r\n  graphql(orderDetails, {\r\n    name: 'query2',\r\n    skip: ({ type }) => type !== 'Order'\r\n  }),\r\n  graphql(enquiryLocal, {\r\n    name: 'localQuery1',\r\n    skip: ({ type }) => type !== 'Enquiry',\r\n    // options: props => ({\r\n    //   variables: { id: props.id }\r\n    // })\r\n  }),\r\n  graphql(orderLocal, {\r\n    name: 'localQuery2',\r\n    skip: ({ type }) => type !== 'Order',\r\n    // options: props => ({\r\n    //   variables: { id: props.id }\r\n    // })\r\n  }),\r\n)(DetailsDataProvider)","import React from 'react'\r\n\r\nimport styled from 'styled-components'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\nimport DetailsMainHeader from './DetailsMainHeader'\r\nimport EnquiryDetails from './EnquiryDetails'\r\nimport OrderEdit from './OrderEdit'\r\nimport OrderDetails from './OrderDetails'\r\nimport DetailsDataProvider from './DetailsDataProvider';\r\n\r\nconst Container = styled.div`\r\n\t/* flex-grow: 1; */\r\n\twidth: 60%;\r\n`\r\n\r\nconst Details = ({ closeDetails }) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ details: { type, id, enquiryId, editMode}, setDetails, setExpanded }) => (\r\n\t\t\t\t<DetailsDataProvider\r\n\t\t\t\t\ttype={type}\r\n\t\t\t\t\tid={id}\r\n\t\t\t\t>\r\n\t\t\t\t\t{({ loading, error, refetch, entity, localEntity }) =>\r\n\t\t\t\t\t\t<Container>\r\n\t\t\t\t\t\t\t<DetailsMainHeader\r\n\t\t\t\t\t\t\t\ttype={type}\r\n\t\t\t\t\t\t\t\tlocalEntity={localEntity}\r\n\t\t\t\t\t\t\t\tcloseDetails={closeDetails}\r\n\t\t\t\t\t\t\t\tsetDetails={setDetails}\r\n\t\t\t\t\t\t\t\teditMode={editMode}\r\n\t\t\t\t\t\t\t\tloading={loading}\r\n\t\t\t\t\t\t\t\trefresh={() => refetch()}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t{type === 'Enquiry'\r\n\t\t\t\t\t\t\t\t? <EnquiryDetails\r\n\t\t\t\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t\t\t\t\tcloseDetails={closeDetails}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t:\tnull\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t{type === 'Order' &&\r\n\t\t\t\t\t\t\t\t(id === 'new' || editMode\r\n\t\t\t\t\t\t\t\t\t? <OrderEdit\r\n\t\t\t\t\t\t\t\t\t\t\tid={id}\r\n\t\t\t\t\t\t\t\t\t\t\tenquiryId={enquiryId}\r\n\t\t\t\t\t\t\t\t\t\t\tcloseDetails={closeDetails}\r\n\t\t\t\t\t\t\t\t\t\t\tsetDetails={setDetails}\r\n\t\t\t\t\t\t\t\t\t\t\tsetExpanded={setExpanded}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t: (entity && \r\n\t\t\t\t\t\t\t\t\t\t\t<OrderDetails\r\n\t\t\t\t\t\t\t\t\t\t\t\torder={entity}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t</Container>\r\n\t\t\t\t\t}\r\n\t\t\t\t</DetailsDataProvider>\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default Details\r\n","import gql from 'graphql-tag'\r\n\r\nexport const modelLocal = gql`\r\n\tquery ModelLocal ($id: ID!) {\r\n\t\tmodelLocal (id: $id) {\r\n\t\t\tname\r\n      article\r\n\t\t}\r\n\t}\r\n`","import { Component } from 'react'\r\n\r\nimport cloneDeep from 'lodash/cloneDeep'\r\nimport without from 'lodash/without'\r\nimport take from 'lodash/take'\r\nimport union from 'lodash/union'\r\nimport difference from 'lodash/difference'\r\nimport find from 'lodash/fp/find'\r\n\r\nclass ProdTableUtils extends Component {\r\n\tselect = (id) => {\r\n\t\tconst {\r\n\t\t\tdepts: propDepts,\r\n\t\t\tsetList,\r\n\t\t\tselectLimit\r\n\t\t} = this.props\r\n\t\tconst depts = cloneDeep(propDepts)\r\n\t\tconst selectedProdIds =\r\n\t\t\tdepts.reduce((list, d) =>\r\n\t\t\t\t[\r\n\t\t\t\t\t...list,\r\n\t\t\t\t\t...d.prods.filter(p => p.selected).map(p => p.id)\r\n\t\t\t\t]\r\n\t\t\t, [])\r\n\t\tconst dept =\r\n\t\t\tfind({ id }, depts)\r\n\t\t\t|| find({ prods: [ { id } ]}, depts)\r\n\t\tconst { prods } = dept\r\n\t\tconst entity =\r\n\t\t\tdept.id === id\r\n\t\t\t\t? dept\r\n\t\t\t\t: find({ id }, prods)\r\n\t\tif (entity.disabled) return null\r\n\t\tlet newList = []\r\n\t\tif (entity.__typename === 'Prod') {\r\n\t\t\tnewList =\r\n\t\t\t\tselectedProdIds.includes(id)\r\n\t\t\t\t\t? without(selectedProdIds, id)\r\n\t\t\t\t\t: [...selectedProdIds, id]\r\n\t\t}\r\n\t\tif (entity.__typename === 'Dept') {\r\n\t\t\tif ([ 'partly', true ].includes(entity.selected))\r\n\t\t\t\tnewList = difference(selectedProdIds, prods.map(p => p.id))\r\n\t\t\tif (entity.selected === false) {\r\n\t\t\t\tconst idsWithinLimit = take(\r\n\t\t\t\t\tprods.filter(p => !p.disabled).map(p => p.id),\r\n\t\t\t\t\tselectLimit - selectedProdIds.length\r\n\t\t\t\t)\r\n\t\t\t\tnewList = union(selectedProdIds, idsWithinLimit)\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetList(newList)\r\n\t}\r\n\trender () {\r\n\t\tconst { children } = this.props\r\n\t\treturn children({\r\n\t\t\tselect: this.select\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport default ProdTableUtils","import { Component } from 'react'\r\n\r\nexport default class ListProvider extends Component {\r\n\tstate = {\r\n\t\tlist: []\r\n\t}\r\n\tsetList = (list) => this.setState({ list })\r\n\ttoggle = (item) => {\r\n\t\tconst { list } = this.state\r\n\t\tconst newList = \r\n\t\t\tlist.includes(item)\r\n\t\t\t? [ ...list.filter(i => i !== item) ]\r\n\t\t\t: [ ...list, item ]\r\n\t\tthis.setState({ list: newList })\r\n\t}\r\n\trender() {\r\n\t\treturn this.props.children({\r\n\t\t\tlist: this.state.list,\r\n\t\t\tsetList: this.setList,\r\n\t\t\ttoggle: this.toggle,\r\n\t\t})\r\n\t}\r\n}\r\n","import { compose, graphql } from 'react-apollo'\r\nimport { orderLocal } from '../../graphql/order'\r\n\r\nconst OrderContext = ({\r\n\tchildren,\r\n\torderLocal: { orderLocal }\r\n}) => {\r\n  return children({\r\n\t\torderLocal: orderLocal || [],\r\n\t})\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(orderLocal, { name: 'orderLocal' }),\r\n)(OrderContext)\r\n","import React, { Fragment } from 'react'\r\n\r\nimport styled from 'styled-components'\r\nimport { Icon } from 'semantic-ui-react'\r\nimport { Section } from '../components/styled-semantic/styled-semantic'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { modelLocal } from '../graphql/model'\r\nimport { modelProds } from '../graphql/prod'\r\n\r\nimport GlobalContext from './special/GlobalContext'\r\nimport DetailsHeader from './DetailsHeader'\r\nimport ProdsByDept from './ProdsByDept'\r\nimport ProdTableUtils from './ProdTableUtils'\r\nimport DeptProdTable from './DeptProdTable'\r\nimport ListProvider from './special/ListProvider';\r\nimport OrderContext from './special/OrderContext';\r\n\r\nconst Container = styled.div`\r\n\twidth: 40%;\r\n\tmin-height: calc(100vh - 36px);\r\n\theight: fit-content;\r\n\t/* border-left: 1px solid rgb(126, 126, 129); */\r\n\tborder-left: 1px solid rgb(156, 156, 159);\r\n`\r\n\r\nconst DetailsExtra = ({ closeExtra }) => {\r\n\treturn (\r\n\t\t<GlobalContext>\r\n\t\t\t{({ extra, selectedProdIds, setSelectedProdIds }) => (\r\n\t\t\t\t<Container>\r\n\t\t\t\t\t{!!extra && \r\n\t\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t\t<Query\r\n\t\t\t\t\t\t\t\tquery={modelLocal}\r\n\t\t\t\t\t\t\t\tvariables={{ id: extra.modelId }}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{({ data: { modelLocal } }) =>\r\n\t\t\t\t\t\t\t\t\t<DetailsHeader\r\n\t\t\t\t\t\t\t\t\t\ttitle={modelLocal.name + ' в наличии'}\r\n\t\t\t\t\t\t\t\t\t\tsize='small'\r\n\t\t\t\t\t\t\t\t\t\tnoIndent\r\n\t\t\t\t\t\t\t\t\t\tbottomBorder='dark'\r\n\t\t\t\t\t\t\t\t\t\tbuttons={\r\n\t\t\t\t\t\t\t\t\t\t\t<Icon link\r\n\t\t\t\t\t\t\t\t\t\t\t\tname='cancel'\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={closeExtra}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</Query>\r\n\t\t\t\t\t\t\t<Query\r\n\t\t\t\t\t\t\t\tquery={modelProds}\r\n\t\t\t\t\t\t\t\tvariables={{ modelId: extra.modelId }}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{({ loading, error, data }) => {\r\n\t\t\t\t\t\t\t\t\tif (loading) return <Section noIndent >Загрузка...</Section>\r\n\t\t\t\t\t\t\t\t\tif (error) return <Section noIndent >Ошибка {error.message}</Section>\r\n\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t<OrderContext\r\n\t\t\t\t\t\t\t\t\t\t\tid={extra.orderId}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{({ orderLocal }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<ListProvider>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{({ list: expandedIds, toggle: toggleExpanded }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ProdsByDept\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprods={data.modelProds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedIds={selectedProdIds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\torderId={extra.orderId}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectLimit={orderLocal.qty}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpandedIds={expandedIds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{({ depts }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ProdTableUtils\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdepts={depts}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetList={setSelectedProdIds}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectLimit={orderLocal.qty}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{({ select }) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DeptProdTable\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdepts={depts}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselect={select}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpand={toggleExpanded}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ProdTableUtils>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ProdsByDept>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</ListProvider>\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t</OrderContext>\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t</Query>\r\n\t\t\t\t\t\t</Fragment>\r\n\t\t\t\t\t}\r\n\t\t\t\t</Container>\r\n\t\t\t\t\t\t\r\n\t\t\t)}\r\n\t\t</GlobalContext>\r\n\t)\r\n}\r\n\r\nexport default DetailsExtra\r\n","import React, { Component, Fragment } from 'react'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { getLayout, getLayoutOptions, setLayout } from '../graphql/layout'\r\n\r\nimport styled from 'styled-components'\r\nimport { Sidebar } from 'semantic-ui-react'\r\n\r\nimport Details from './Details';\r\nimport DetailsExtra from './DetailsExtra';\r\n\r\nconst SSidebar = styled(Sidebar)`\r\n\t&&&& {\r\n\t\tdisplay: flex;\r\n\t\twidth: 120%;\r\n\t\tbackground-color: white;\r\n\t\ttransition: all .5s ease;\r\n\t\tmax-width: ${props => \r\n\t\t\tprops.type === 'Enquiry'\r\n\t\t\t? '1000px'\r\n\t\t\t: '1200px'\r\n\t\t};\r\n\t\t${props => !props.extra && `\r\n\t\t\t&.ui.visible.right.overlay.sidebar {\r\n\t\t\t\ttransform: translate3d(40%,0,0);\r\n\t\t\t}\r\n\t\t`}\r\n\t\t${props => props.extra && `\r\n\t\t\twidth: 86%;\r\n\t\t`}\r\n\t}\r\n`\r\n\r\nclass DetailsSidebar extends Component {\r\n\tstate = { detailsClosing: false }\r\n\tcloseDetails = () => {\r\n\t\tthis.setState({ detailsClosing: true })\r\n\t\t// set timeout for sidebar to finish animation\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.setLayout({variables: { details: null, extra: null }})\r\n\t\t\tthis.setState({ detailsClosing: false })\r\n\t\t}, 300)\r\n\t}\r\n\tcloseExtra = () => {\r\n\t\tthis.props.setLayout({variables: { extra: null }})\r\n\t}\r\n\trender() {\r\n\t\tconst { detailsClosing } = this.state\r\n\t\tconst { layout: { details, extra } } = this.props\r\n\t\treturn (\r\n\t\t\t<SSidebar\r\n\t\t\t\tvisible={!!details && !detailsClosing}\r\n\t\t\t\textra={!!extra ? 1: 0}\r\n\t\t\t\ttype={details && details.type}\r\n\t\t\t\tanimation='overlay'\r\n\t\t\t\tdirection='right'\r\n\t\t\t>\r\n\t\t\t\t{details &&\r\n\t\t\t\t\t<Fragment>\r\n\t\t\t\t\t\t<Details\r\n\t\t\t\t\t\t\tkey={details.type + details.id}\r\n\t\t\t\t\t\t\tcloseDetails={this.closeDetails}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<DetailsExtra\r\n\t\t\t\t\t\t\textra={extra}\r\n\t\t\t\t\t\t\tcloseExtra={this.closeExtra}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Fragment>\r\n\t\t\t\t}\r\n\t\t\t</SSidebar>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(getLayout, getLayoutOptions),\r\n\tgraphql(setLayout, { name: 'setLayout' })\r\n)(DetailsSidebar)","import React, { Fragment } from 'react'\r\n\r\nimport { graphql, compose } from 'react-apollo'\r\nimport { allEnquiries } from '../graphql/enquiry'\r\n\r\nimport styled from 'styled-components'\r\nimport { Sidebar } from 'semantic-ui-react'\r\n\r\nimport EnquiriesMenu from './EnquiriesMenu'\r\nimport EnquiriesTable from './EnquiriesTable'\r\nimport DetailsSidebar from './DetailsSidebar'\r\n\r\nconst Pushable = styled(Sidebar.Pushable)`\r\n\tmin-height: calc(100vh - 36px) !important;\r\n`\r\n\r\nconst EnquiriesPage = ({ \r\n\tallEnquiries: { loading, error, refetch, networkStatus, enquiries },\r\n\trefreshToken\r\n}) => {\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t<EnquiriesMenu\r\n\t\t\t\trefetchEnquiries={() => refetch()}\r\n\t\t\t\tenquiriesAreLoading={loading}\r\n\t\t\t\trefreshToken={refreshToken}\r\n\t\t\t/>\r\n\t\t\t{loading && \"Загрузка...\"}\r\n\t\t\t{error   && `Ошибка ${error.message}`}\r\n\t\t\t{enquiries &&\r\n\t\t\t\t<Pushable>\r\n\t\t\t\t\t<DetailsSidebar />\r\n\t\t\t\t\t<Sidebar.Pusher>\r\n\t\t\t\t\t\t<EnquiriesTable \r\n\t\t\t\t\t\t\tenquiries={enquiries}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Sidebar.Pusher>\r\n\t\t\t\t</Pushable>\r\n\t\t\t}\r\n\t\t</Fragment>\r\n\t)\r\n}\r\n\r\nexport default compose(\r\n\tgraphql(allEnquiries, {\r\n\t\t\tname: 'allEnquiries'\r\n\t})\r\n)(EnquiriesPage)","import React, { Component, Fragment } from 'react'\r\n\r\nimport { AUTH_TOKEN } from '../constants'\r\nimport { isTokenExpired } from '../utils/jwtHelper'\r\n\r\nimport { Query } from 'react-apollo'\r\nimport { me } from '../graphql/user'\r\n\r\nimport LoginPage from './LoginPage'\r\nimport EnquiriesPage from './EnquiriesPage'\r\n\r\nclass Root extends Component {\r\n\tstate = {\r\n\t\ttoken: this.props.token\r\n\t}\r\n\t //verify localStorage check\r\n\tcomponentDidMount() {\r\n\t\tthis.bootStrapData()\r\n\t}\r\n\tbootStrapData = () => {\r\n\t\ttry {\r\n\t\t\tconst token = localStorage.getItem(AUTH_TOKEN)\r\n\t\t\tif (token !== null && token !== undefined) {\r\n\t\t\t\tconst expired = isTokenExpired(token)\r\n\t\t\t\tif (!expired) {\r\n\t\t\t\t\tthis.setState({ token: token })\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.refreshToken(null)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\t// maybe TODO - provide fatal error message\r\n\t\t \t console.log('')\r\n\t\t}\r\n\t}\r\n\trefreshToken = (token) => {\r\n\t\tif (token) {\r\n\t\t  \tlocalStorage.setItem(AUTH_TOKEN, token)\r\n\t\t} else {\r\n            localStorage.removeItem(AUTH_TOKEN)\r\n            this.props.client.resetStore()\r\n\t\t}\r\n\t\tthis.setState({ token })\r\n\t}\r\n\trender() {\r\n\t\tconst { token } = this.state\r\n\t\treturn (\r\n\t\t\t<Fragment>\r\n\t\t\t\t{ !token \r\n\t\t\t\t  ?\t<LoginPage refreshToken={this.refreshToken} />\r\n\t\t\t\t  : <Query query={me} >\r\n\t\t\t\t\t\t\t{({ loading, error, data }) => {\r\n\t\t\t\t\t\t\t\tif (loading) return null\r\n\t\t\t\t\t\t\t\tif (error) return `Error!: ${error.message}`\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<EnquiriesPage refreshToken={this.refreshToken} me={data.me} />\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t</Query> \r\n\t\t\t\t}\r\n\t\t\t</Fragment>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default Root\r\n","import React from 'react'\r\n\r\nimport { ThemeProvider } from 'styled-components'\r\nimport { theme } from './components/styled-semantic/styled-semantic'\r\n\r\nimport Root from './components/Root'\r\n\r\n// use stateless component for production!\r\n// class App extends Component {\r\n// \trender() {\r\n// \t\tconst {token, client} = this.props\r\n// \t\treturn (\r\n// \t\t\t<ThemeProvider>\r\n// \t\t\t\t<Root token={token} client={client} />\r\n// \t\t\t</ThemeProvider>\r\n// \t\t)\r\n// \t}\r\n// }\r\n\r\nconst App = ({ token, client }) => (\r\n\t<ThemeProvider theme={theme}>\r\n\t\t<Root token={token} client={client} />\r\n\t</ThemeProvider>\r\n)\r\n\r\nexport default App\r\n","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport 'semantic-ui-css/semantic.min.css'\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nimport ApolloClient from 'apollo-boost'\r\n// import { ApolloClient } from 'apollo-client'\r\n// import { HttpLink } from 'apollo-link-http'\r\n// import { withClientState } from 'apollo-link-state';\r\n// import { ApolloLink, split } from 'apollo-link'\r\n// import { getMainDefinition } from 'apollo-utilities'\r\n// import { WebSocketLink } from 'apollo-link-ws'\r\nimport { InMemoryCache, defaultDataIdFromObject } from 'apollo-cache-inmemory'\r\nimport { ApolloProvider } from 'react-apollo'\r\nimport { AUTH_TOKEN } from './constants'\r\n\r\nimport defaults from './apollo/defaults'\r\nimport resolvers from './apollo/resolvers'\r\nimport typeDefs from './apollo/typeDefs'\r\n\r\nimport App from './App'\r\n\r\n// init with Apollo Boost:\r\n// @ts-ignore\r\nconst client = new ApolloClient({\r\n\t// uri: 'http://localhost:4000',\r\n\t// uri: 'https://now-advanced.now.sh',\r\n\turi: 'https://env-1542080.mircloud.ru',\r\n\trequest: (operation) => {\r\n\t\tconst token = localStorage.getItem(AUTH_TOKEN)\r\n\t\toperation.setContext({\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: token ? `Bearer ${token}` : '',\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tclientState: {\r\n\t\tdefaults,\r\n\t\tresolvers,\r\n\t\ttypeDefs\r\n\t},\r\n\tcache: new InMemoryCache({\r\n\t\tdataIdFromObject: object => {\r\n\t\t\tswitch (object.__typename) {\r\n\t\t\t\tcase 'NewEnquiry': return 'NewEnquiry'\r\n\t\t\t\tdefault: return defaultDataIdFromObject(object)\r\n\t\t\t}\r\n\t\t},\r\n\t\tcacheRedirects: {\r\n\t\t\tQuery: {\r\n\t\t\t\tenquiryLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\t\tgetCacheKey({ __typename: 'Enquiry', id: args.id }),\r\n\t\t\t\torderLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\t\tgetCacheKey({ __typename: 'Order', id: args.id }),\r\n\t\t\t\tmodelLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\t\tgetCacheKey({ __typename: 'Model', id: args.id }),\r\n\t\t\t\tprodsLocal: (_, args, { getCacheKey }) =>\r\n\t\t\t\t\targs.ids.map(id =>\r\n\t\t\t\t\t\tgetCacheKey({ __typename: 'Prod', id: id }))\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n})\r\n\r\n// const cache = new InMemoryCache({\r\n//     dataIdFromObject: object => {\r\n//         switch (object.__typename) {\r\n//             case 'NewEnquiry': return 'NewEnquiry'\r\n//             default: return defaultDataIdFromObject(object)\r\n//         }\r\n//     }\r\n// })\r\n\r\n// const stateLink = withClientState({\r\n//     cache,\r\n//     defaults,\r\n//     resolvers,\r\n//     // typeDefs\r\n// })\r\n\r\n// const httpLink = new HttpLink({ uri: 'https://now-advanced.now.sh' })\r\n\r\n// const middlewareAuthLink = new ApolloLink((operation, forward) => {\r\n//     // get the authentication token from local storage if it exists\r\n//     const tokenValue = localStorage.getItem(AUTH_TOKEN)\r\n//     // return the headers to the context so httpLink can read them\r\n//     operation.setContext({\r\n//       headers: {\r\n//         Authorization: tokenValue ? `Bearer ${tokenValue}` : '',\r\n//       },\r\n//     })\r\n//     return forward(operation)\r\n// })\r\n// slightly different auth link init implementation -> https://www.apollographql.com/docs/react/recipes/authentication.html\r\n\r\n// // authenticated httplink\r\n// const httpLinkAuth = middlewareAuthLink.concat(httpLink)\r\n\r\n// const wsLink = new WebSocketLink({\r\n//     uri: `ws://now-advanced.now.sh`,\r\n//     options: {\r\n//         reconnect: true,\r\n//         connectionParams: {\r\n//         Authorization: `Bearer ${localStorage.getItem(AUTH_TOKEN)}`,\r\n//         },\r\n//     },\r\n// })\r\n  \r\n// const link = split(\r\n//     // split based on operation type\r\n//     ({ query }) => {\r\n//         const { kind, operation } = getMainDefinition(query)\r\n//         return kind === 'OperationDefinition' && operation === 'subscription'\r\n//     },\r\n//     wsLink,\r\n//     httpLinkAuth,\r\n// )\r\n\r\n// const client = new ApolloClient({\r\n//     cache,\r\n//     link: ApolloLink.from([\r\n//         stateLink,\r\n//         httpLinkAuth\r\n//     ]),\r\n//     connectToDevTools: true,\r\n// })\r\n\r\nconst token = localStorage.getItem(AUTH_TOKEN)\r\n\r\n// client.cache.reset()\r\n\r\nReactDOM.render(\r\n\t<ApolloProvider client={client}>\r\n\t\t<App token={token} client={client}/>\r\n\t</ApolloProvider>\r\n, document.getElementById('root'))\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register()  below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister()\r\n","export default `\r\n\ttype Details {\r\n\t\ttype: String\r\n\t\tid: ID\r\n\t\tenquiryId: ID\r\n\t\teditMode: Boolean\r\n\t\tclosing: Boolean\r\n\t}\r\n`"],"sourceRoot":""}